/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var r,a,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _createSuper(e){return function(){var t,r=_getPrototypeOf(e);if(_isNativeReflectConstruct()){var a=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var a=_superPropBase(e,t);if(a){var n=Object.getOwnPropertyDescriptor(a,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],a=!0,n=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(n)throw o}}return r}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,o=!0,i=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){i=!0,n=e},f:function(){try{o||null==a.return||a.return()}finally{if(i)throw n}}}}var requestAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,1e3/60)},cancelAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(e){clearTimeout(e)},_Array$prototype=Array.prototype,forEach=_Array$prototype.forEach,arrSlice=_Array$prototype.slice,arrMap=_Array$prototype.map,arrReduce=_Array$prototype.reduce,_console=console,warn=_console.warn,isDef=function(e){return null!=e},isUndef=function(e){return null==e},isFunc=function(e){return"function"==typeof e},createMethod=function(e){return isFunc(e)?function(){e.call.apply(e,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}},Helper=function(){function e(t){if(_classCallCheck(this,e),"string"==typeof t){var r=document.querySelectorAll(t);this.length=r.length;for(var a=0;a<this.length;a++)this[a]=r[a]}else if("object"!==_typeof(t)||1!==t.nodeType&&t!==document)if(t instanceof e){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!isIterable(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=t.length;for(var o=0;o<this.length;o++)1===t[o].nodeType&&(this[o]=t[o])}else this[0]=t,this.length=1}return _createClass(e,[{key:"css",value:function(e){var t=function(t){for(var r=t.length;r--;)return t[r].currentStyle?t[r].currentStyle[e]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[r],"")[e]:t[r].style[e]},r=function(e,t){for(var r=e.length;r--;)for(var a in t)e[r].style[a]=t[a];return e.style},a={setStyle:function(e){return r(this,e)},getStyle:function(){return t(this)}};return"string"==typeof e?a.getStyle.apply(this,arrSlice.call(arguments,1)):"object"!==_typeof(e)&&e?(warn("Method ".concat(e," does not exist")),!1):a.setStyle.apply(this,arguments)}},{key:"on",value:function(){for(var e=this.length;e--;)this[e].events||(this[e].events={},this[e].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[e].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[e].attachEvent("on".concat(arguments[0]),arguments[1]):this[e]["on".concat(arguments[0])]=arguments[1]:listenerDelegate(this[e],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}},{key:"off",value:function(){for(var e=this.length;e--;)this[e].events||(this[e].events={},this[e].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[e].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[e].detachEvent("on".concat(arguments[0]),arguments[1]):this[e]["on".concat(arguments[0])]=null:listenerDelegate(this[e],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}},{key:"is",value:function(e){if(isUndef(e))return!1;for(var t=helper(e),r=this.length;r--;)if(this[r]===t[r])return!0;return!1}}]),e}();function listenerDelegate(e,t,r,a,n,o){var i=function(e){for(var t=e.target;t&&t!==this;)t.matches(r)&&a.call(t,e),t=t.parentNode};!0===o?document.addEventListener?e.addEventListener(t,i,n||{passive:!1}):document.attachEvent?e.attachEvent("on".concat(t),i):e["on".concat(t)]=i:document.removeEventListener?e.removeEventListener(t,i,n||{passive:!1}):document.detachEvent?e.detachEvent("on".concat(t),i):e["on".concat(t)]=null}function isIterable(e){return isDef(e)&&"object"===_typeof(e)&&(Array.isArray(e)||isDef(window.Symbol)&&"function"==typeof e[window.Symbol.iterator]||isDef(e.forEach)||"number"==typeof e.length&&(0===e.length||e.length>0&&e.length-1 in e))}function helper(e){return new Helper(e)}var MIN_SIZE=2,THEME_COLOR="#00a8ff",LIB_CLASS_PREFIX="sjx-",E_MOUSEDOWN="mousedown",E_MOUSEUP="mouseup",E_MOUSEMOVE="mousemove",E_TOUCHSTART="touchstart",E_TOUCHEND="touchend",E_TOUCHMOVE="touchmove",E_DRAG_START="dragStart",E_DRAG="drag",E_DRAG_END="dragEnd",E_RESIZE_START="resizeStart",E_RESIZE="resize",E_RESIZE_END="resizeEnd",E_ROTATE_START="rotateStart",E_ROTATE="rotate",E_ROTATE_END="rotateEnd",E_SET_POINT_START="setPointStart",E_SET_POINT_END="setPointEnd",EMITTER_EVENTS=[E_DRAG_START,E_DRAG,,E_DRAG_END,E_RESIZE_START,E_RESIZE,E_RESIZE_END,E_ROTATE_START,E_ROTATE,E_ROTATE_END,E_SET_POINT_START,E_SET_POINT_END],CSS_PREFIXES=["","-webkit-","-moz-","-ms-","-o-"],ON_GETSTATE="ongetstate",ON_APPLY="onapply",ON_MOVE="onmove",ON_RESIZE="onresize",ON_ROTATE="onrotate",NOTIFIER_EVENTS=[ON_GETSTATE,ON_APPLY,ON_MOVE,ON_RESIZE,ON_ROTATE],NOTIFIER_CONSTANTS={NOTIFIER_EVENTS:NOTIFIER_EVENTS,ON_GETSTATE:ON_GETSTATE,ON_APPLY:ON_APPLY,ON_MOVE:ON_MOVE,ON_RESIZE:ON_RESIZE,ON_ROTATE:ON_ROTATE},EVENT_EMITTER_CONSTANTS={EMITTER_EVENTS:EMITTER_EVENTS,E_DRAG_START:E_DRAG_START,E_DRAG:E_DRAG,E_DRAG_END:E_DRAG_END,E_RESIZE_START:E_RESIZE_START,E_RESIZE:E_RESIZE,E_RESIZE_END:E_RESIZE_END,E_ROTATE_START:E_ROTATE_START,E_ROTATE:E_ROTATE,E_ROTATE_END:E_ROTATE_END,E_SET_POINT_START:E_SET_POINT_START,E_SET_POINT_END:E_SET_POINT_END},CLIENT_EVENTS_CONSTANTS={E_MOUSEDOWN:E_MOUSEDOWN,E_MOUSEUP:E_MOUSEUP,E_MOUSEMOVE:E_MOUSEMOVE,E_TOUCHSTART:E_TOUCHSTART,E_TOUCHEND:E_TOUCHEND,E_TOUCHMOVE:E_TOUCHMOVE},TRANSFORM_HANDLES_KEYS={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},TRANSFORM_EDGES_KEYS={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},TRANSFORM_HANDLES_CONSTANTS={TRANSFORM_HANDLES_KEYS:TRANSFORM_HANDLES_KEYS,TRANSFORM_EDGES_KEYS:TRANSFORM_EDGES_KEYS},ON_GETSTATE$1=NOTIFIER_CONSTANTS.ON_GETSTATE,ON_APPLY$1=NOTIFIER_CONSTANTS.ON_APPLY,ON_MOVE$1=NOTIFIER_CONSTANTS.ON_MOVE,ON_RESIZE$1=NOTIFIER_CONSTANTS.ON_RESIZE,ON_ROTATE$1=NOTIFIER_CONSTANTS.ON_ROTATE,Observable=function(){function e(){_classCallCheck(this,e),this.observers={}}return _createClass(e,[{key:"subscribe",value:function(e,t){var r=this.observers;return isUndef(r[e])&&Object.defineProperty(r,e,{value:[]}),r[e].push(t),this}},{key:"unsubscribe",value:function(e,t){var r=this.observers;if(isDef(r[e])){var a=r[e].indexOf(t);r[e].splice(a,1)}return this}},{key:"notify",value:function(e,t,r){isUndef(this.observers[e])||this.observers[e].forEach((function(a){if(t!==a)switch(e){case ON_MOVE$1:a.notifyMove(r);break;case ON_ROTATE$1:a.notifyRotate(r);break;case ON_RESIZE$1:a.notifyResize(r);break;case ON_APPLY$1:a.notifyApply(r);break;case ON_GETSTATE$1:a.notifyGetState(r)}}))}}]),e}(),Event=function(){function e(t){_classCallCheck(this,e),this.name=t,this.callbacks=[]}return _createClass(e,[{key:"registerCallback",value:function(e){this.callbacks.push(e)}},{key:"removeCallback",value:function(e){var t=this.callbacks(e);this.callbacks.splice(t,1)}}]),e}(),EventDispatcher=function(){function e(){_classCallCheck(this,e),this.events={}}return _createClass(e,[{key:"registerEvent",value:function(e){this.events[e]=new Event(e)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach((function(t){t.call(e,r)}))}},{key:"addEventListener",value:function(e,t){this.events[e].registerCallback(t)}},{key:"removeEventListener",value:function(e,t){this.events[e].removeCallback(t)}}]),e}(),E_DRAG$1=EVENT_EMITTER_CONSTANTS.E_DRAG,E_MOUSEMOVE$1=CLIENT_EVENTS_CONSTANTS.E_MOUSEMOVE,E_MOUSEUP$1=CLIENT_EVENTS_CONSTANTS.E_MOUSEUP,E_TOUCHMOVE$1=CLIENT_EVENTS_CONSTANTS.E_TOUCHMOVE,E_TOUCHEND$1=CLIENT_EVENTS_CONSTANTS.E_TOUCHEND,SubjectModel=function(){function e(t){_classCallCheck(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new EventDispatcher,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return _createClass(e,[{key:"enable",value:function(e){this._processOptions(e),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){throwNotImplementedError()}},{key:"_init",value:function(){throwNotImplementedError()}},{key:"_destroy",value:function(){throwNotImplementedError()}},{key:"_processOptions",value:function(){throwNotImplementedError()}},{key:"_start",value:function(){throwNotImplementedError()}},{key:"_moving",value:function(){throwNotImplementedError()}},{key:"_end",value:function(){throwNotImplementedError()}},{key:"_animate",value:function(){throwNotImplementedError()}},{key:"_drag",value:function(e){var t=e.dx,r=e.dy,a=_objectWithoutProperties(e,["dx","dy"]),n=_objectSpread2({dx:t,dy:r,transform:this._processMove(t,r)},a);this.proxyMethods.onMove.call(this,n),this._emitEvent(E_DRAG$1,n)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(e){this._start(e),helper(document).on(E_MOUSEMOVE$1,this._onMouseMove).on(E_MOUSEUP$1,this._onMouseUp)}},{key:"_onTouchStart",value:function(e){this._start(e.touches[0]),helper(document).on(E_TOUCHMOVE$1,this._onTouchMove).on(E_TOUCHEND$1,this._onTouchEnd)}},{key:"_onMouseMove",value:function(e){e.preventDefault&&e.preventDefault(),this._moving(e,this.el)}},{key:"_onTouchMove",value:function(e){e.preventDefault&&e.preventDefault(),this._moving(e.touches[0],this.el)}},{key:"_onMouseUp",value:function(e){helper(document).off(E_MOUSEMOVE$1,this._onMouseMove).off(E_MOUSEUP$1,this._onMouseUp),this._end(e,this.el)}},{key:"_onTouchEnd",value:function(e){helper(document).off(E_TOUCHMOVE$1,this._onTouchMove).off(E_TOUCHEND$1,this._onTouchEnd),0===e.touches.length&&this._end(e.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var e;(e=this.eventDispatcher).emit.apply(e,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(e,t){return this.eventDispatcher.addEventListener(e,t),this}},{key:"off",value:function(e,t){return this.eventDispatcher.removeEventListener(e,t),this}}]),e}(),throwNotImplementedError=function(){throw Error("Method not implemented")},RAD=Math.PI/180,snapCandidate=function(e,t){return 0===t?e:Math.round(e/t)*t},snapToGrid=function(e,t){if(0===t)return e;var r=snapCandidate(e,t);return r-e<t?r:void 0},floatToFixed=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;return Number(e.toFixed(t))},getMinMaxOfArray=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,r=[],a=function(t){var a=e.map((function(e){return e[t]}));r.push([Math.min.apply(Math,_toConsumableArray(a)),Math.max.apply(Math,_toConsumableArray(a))])},n=0;n<t;n++)a(n);return r},getOffset=function(e){return e.getBoundingClientRect()},addClass=function(e,t){if(t){if(e.classList){if(!(t.indexOf(" ")>-1))return e.classList.add(t);t.split(/\s+/).forEach((function(t){return e.classList.add(t)}))}return e}},removeClass=function(e,t){if(t){if(e.classList){if(!(t.indexOf(" ")>-1))return e.classList.remove(t);t.split(/\s+/).forEach((function(t){return e.classList.remove(t)}))}return e}},objectsCollide=function(e,t){var r=getOffset(e),a=r.top,n=r.left,o=getOffset(t),i=o.top,s=o.left,l=helper(e),c=helper(t);return!(a<i||a+parseFloat(l.css("height"))>i+parseFloat(c.css("height"))||n<s||n+parseFloat(l.css("width"))>s+parseFloat(c.css("width")))},matrixToCSS=function(e){var t="matrix3d(".concat(e.join(),")");return{transform:t,webkitTranform:t,mozTransform:t,msTransform:t,otransform:t}},getStyle=function(e,t){var r,a=window.getComputedStyle(e),n=null,o=_createForOfIteratorHelper(CSS_PREFIXES);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(n=a.getPropertyValue("".concat(i).concat(t))||n)break}}catch(e){o.e(e)}finally{o.f()}return n},NOTIFIER_EVENTS$1=NOTIFIER_CONSTANTS.NOTIFIER_EVENTS,ON_GETSTATE$2=NOTIFIER_CONSTANTS.ON_GETSTATE,ON_APPLY$2=NOTIFIER_CONSTANTS.ON_APPLY,ON_MOVE$2=NOTIFIER_CONSTANTS.ON_MOVE,ON_RESIZE$2=NOTIFIER_CONSTANTS.ON_RESIZE,ON_ROTATE$2=NOTIFIER_CONSTANTS.ON_ROTATE,EMITTER_EVENTS$1=EVENT_EMITTER_CONSTANTS.EMITTER_EVENTS,E_DRAG_START$1=EVENT_EMITTER_CONSTANTS.E_DRAG_START,E_DRAG$2=EVENT_EMITTER_CONSTANTS.E_DRAG,E_DRAG_END$1=EVENT_EMITTER_CONSTANTS.E_DRAG_END,E_RESIZE_START$1=EVENT_EMITTER_CONSTANTS.E_RESIZE_START,E_RESIZE$1=EVENT_EMITTER_CONSTANTS.E_RESIZE,E_RESIZE_END$1=EVENT_EMITTER_CONSTANTS.E_RESIZE_END,E_ROTATE_START$1=EVENT_EMITTER_CONSTANTS.E_ROTATE_START,E_ROTATE$1=EVENT_EMITTER_CONSTANTS.E_ROTATE,E_ROTATE_END$1=EVENT_EMITTER_CONSTANTS.E_ROTATE_END,TRANSFORM_HANDLES_KEYS$1=TRANSFORM_HANDLES_CONSTANTS.TRANSFORM_HANDLES_KEYS,TRANSFORM_EDGES_KEYS$1=TRANSFORM_HANDLES_CONSTANTS.TRANSFORM_EDGES_KEYS,E_MOUSEDOWN$1=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$1=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,E_MOUSEMOVE$2=CLIENT_EVENTS_CONSTANTS.E_MOUSEMOVE,E_MOUSEUP$2=CLIENT_EVENTS_CONSTANTS.E_MOUSEUP,E_TOUCHMOVE$2=CLIENT_EVENTS_CONSTANTS.E_TOUCHMOVE,E_TOUCHEND$2=CLIENT_EVENTS_CONSTANTS.E_TOUCHEND,TOP_LEFT=TRANSFORM_HANDLES_KEYS$1.TOP_LEFT,TOP_CENTER=TRANSFORM_HANDLES_KEYS$1.TOP_CENTER,TOP_RIGHT=TRANSFORM_HANDLES_KEYS$1.TOP_RIGHT,BOTTOM_LEFT=TRANSFORM_HANDLES_KEYS$1.BOTTOM_LEFT,BOTTOM_RIGHT=TRANSFORM_HANDLES_KEYS$1.BOTTOM_RIGHT,BOTTOM_CENTER=TRANSFORM_HANDLES_KEYS$1.BOTTOM_CENTER,MIDDLE_LEFT=TRANSFORM_HANDLES_KEYS$1.MIDDLE_LEFT,MIDDLE_RIGHT=TRANSFORM_HANDLES_KEYS$1.MIDDLE_RIGHT,TOP_EDGE=TRANSFORM_EDGES_KEYS$1.TOP_EDGE,BOTTOM_EDGE=TRANSFORM_EDGES_KEYS$1.BOTTOM_EDGE,LEFT_EDGE=TRANSFORM_EDGES_KEYS$1.LEFT_EDGE,RIGHT_EDGE=TRANSFORM_EDGES_KEYS$1.RIGHT_EDGE,keys=Object.keys,values=Object.values,Transformable=function(e){_inherits(r,SubjectModel);var t=_createSuper(r);function r(e,a,n){var o;if(_classCallCheck(this,r),(o=t.call(this,e)).constructor===r)throw new TypeError("Cannot construct Transformable instances directly");return o.observable=n,EMITTER_EVENTS$1.forEach((function(e){return o.eventDispatcher.registerEvent(e)})),_get(_getPrototypeOf(r.prototype),"enable",_assertThisInitialized(o)).call(_assertThisInitialized(o),a),o}return _createClass(r,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(e){var t=e.radians,a=_objectWithoutProperties(e,["radians"]),n=_objectSpread2({transform:this._processRotate(t),delta:t},a);this.proxyMethods.onRotate.call(this,n),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_ROTATE$1,n)}},{key:"_resize",value:function(e){var t=e.dx,a=e.dy,n=_objectWithoutProperties(e,["dx","dy"]),o=_objectSpread2({},this._processResize(t,a),{dx:t,dy:a},n);this.proxyMethods.onResize.call(this,o),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_RESIZE$1,o)}},{key:"_processOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.el;addClass(t,"".concat(LIB_CLASS_PREFIX,"drag"));var r=e.each,a=void 0===r?{move:!1,resize:!1,rotate:!1}:r,n=e.snap,o=void 0===n?{x:10,y:10,angle:10}:n,i=e.axis,s=void 0===i?"xy":i,l=e.cursorMove,c=void 0===l?"auto":l,u=e.cursorResize,h=void 0===u?"auto":u,f=e.cursorRotate,T=void 0===f?"auto":f,_=e.rotationPoint,p=void 0!==_&&_,d=e.restrict,E=e.draggable,y=void 0===E||E,v=e.resizable,m=void 0===v||v,x=e.rotatable,b=void 0===x||x,S=e.scalable,g=void 0!==S&&S,O=e.applyTranslate,M=void 0!==O&&O,A=e.onInit,N=void 0===A?function(){}:A,R=e.onDrop,C=void 0===R?function(){}:R,D=e.onMove,I=void 0===D?function(){}:D,k=e.onResize,w=void 0===k?function(){}:k,P=e.onRotate,V=void 0===P?function(){}:P,$=e.onDestroy,L=void 0===$?function(){}:$,j=e.container,G=void 0===j?t.parentNode:j,F=e.controlsContainer,H=void 0===F?G:F,U=e.proportions,Y=void 0!==U&&U,B=e.rotatorAnchor,X=void 0===B?null:B,W=e.rotatorOffset,z=void 0===W?50:W,Z=e.showNormal,K=void 0===Z||Z,q=e.custom;this.options={axis:s,cursorMove:c,cursorRotate:T,cursorResize:h,rotationPoint:p,restrict:d?helper(d)[0]||document.body:null,container:helper(G)[0],controlsContainer:helper(H)[0],snap:_objectSpread2({},o,{angle:o.angle*RAD}),each:a,proportions:Y,draggable:y,resizable:m,rotatable:b,scalable:g,applyTranslate:M,custom:"object"===_typeof(q)&&q||null,rotatorAnchor:X,rotatorOffset:z,showNormal:K},this.proxyMethods={onInit:createMethod(N),onDrop:createMethod(C),onMove:createMethod(I),onResize:createMethod(w),onRotate:createMethod(V),onDestroy:createMethod(L)},this.subscribe(a)}},{key:"_animate",value:function(){var e=this.observable,t=this.storage,a=this.options;if(!isUndef(t)&&(t.frame=requestAnimFrame(this._animate),t.doDraw)){t.doDraw=!1;var n=t.dox,o=t.doy,i=t.clientX,s=t.clientY,l=t.doDrag,c=t.doResize,u=t.doRotate,h=t.doSetCenter,f=t.revX,T=t.revY,_=t.mouseEvent,p=a.snap,d=a.each,E=d.move,y=d.resize,v=d.rotate,m=a.draggable,x=a.resizable,b=a.rotatable;if(c&&x){var S=t.transform,g=S.scX,O=S.scY,M=t.cx,A=t.cy,N=this._pointToElement({x:i,y:s}),R=N.x,C=N.y,D=n?snapToGrid(R-M,p.x/g):0,I=o?snapToGrid(C-A,p.y/O):0,k={dx:D=n?f?-D:D:0,dy:I=o?T?-I:I:0,clientX:i,clientY:s,mouseEvent:_};this._resize(k),y&&e.notify(ON_RESIZE$2,this,k)}if(l&&m){var w=t.nx,P=t.ny,V={dx:n?snapToGrid(i-w,p.x):0,dy:o?snapToGrid(s-P,p.y):0,clientX:i,clientY:s,mouseEvent:_};_get(_getPrototypeOf(r.prototype),"_drag",this).call(this,V),E&&e.notify(ON_MOVE$2,this,V)}if(u&&b){var $=t.pressang,L=t.center,j=Math.atan2(s-L.y,i-L.x)-$,G={clientX:i,clientY:s,mouseEvent:_};this._rotate(_objectSpread2({radians:snapToGrid(j,p.angle)},G)),v&&e.notify(ON_ROTATE$2,this,_objectSpread2({radians:j},G))}if(h&&b){var F=t.bx,H=t.by,U=this._pointToControls({x:i,y:s}),Y=U.x,B=U.y;this._moveCenterHandle(Y-F,B-H)}}}},{key:"_start",value:function(e){var t=e.clientX,a=e.clientY,n=this.observable,o=this.storage,i=this.storage.handles,s=this.options,l=s.axis,c=s.each,u=this.el,h=values(i).some((function(t){return helper(e.target).is(t)}))||u.contains(e.target);if(o.isTarget=h,h){var f=this._compute(e,u);keys(f).map((function(e){return o[e]=f[e]}));var T=f.onRightEdge,_=f.onBottomEdge,p=f.onTopEdge,d=f.onLeftEdge,E=f.handle,y=f.factor,v=f.revX,m=f.revY,x=f.doW,b=f.doH,S=T||_||p||d,g=i.rotator,O=i.center,M=i.radius;isDef(M)&&removeClass(M,"".concat(LIB_CLASS_PREFIX,"hidden"));var A=E.is(g),N=!!isDef(O)&&E.is(O),R=u.contains(e.target)&&!(A||S||N),C=this._cursorPoint({clientX:t,clientY:a}),D=C.x,I=C.y,k=this._pointToElement({x:D,y:I}),w=k.x,P=k.y,V=this._pointToControls({x:D,y:I}),$=V.x,L=V.y,j={mouseEvent:e,clientX:t,clientY:a,cx:w,cy:P,nx:D,ny:I,bx:$,by:L,doResize:S,doDrag:R,doRotate:A,doSetCenter:N,onExecution:!0,cursor:null,dox:/\x/.test(l)&&(!S||(E.is(i.ml)||E.is(i.mr)||E.is(i.tl)||E.is(i.tr)||E.is(i.bl)||E.is(i.br)||E.is(i.le)||E.is(i.re))),doy:/\y/.test(l)&&(!S||(E.is(i.br)||E.is(i.bl)||E.is(i.bc)||E.is(i.tr)||E.is(i.tl)||E.is(i.tc)||E.is(i.te)||E.is(i.be))),cached:{}};this.storage=_objectSpread2({},o,{},j);var G={clientX:t,clientY:a};S?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_RESIZE_START$1,G):A?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_ROTATE_START$1,G):R&&_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_DRAG_START$1,G);var F=c.move,H=c.resize,U=c.rotate,Y=S?E_RESIZE$1:A?E_ROTATE$1:E_DRAG$2,B=S&&H||A&&U||R&&F;n.notify(ON_GETSTATE$2,this,{clientX:t,clientY:a,actionName:Y,triggerEvent:B,factor:y,revX:v,revY:m,doW:x,doH:b}),this._draw()}}},{key:"_moving",value:function(e){var t=this.storage,r=void 0===t?{}:t,a=this.options;if(r.isTarget){var n=this._cursorPoint(e),o=n.x,i=n.y;r.mouseEvent=e,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,l=r.doDrag,c=r.doResize,u=r.cursor,h=a.cursorMove,f=a.cursorResize,T=a.cursorRotate;isUndef(u)&&(l?u=h:s?u=T:c&&(u=f),helper(document.body).css({cursor:u}))}}},{key:"_end",value:function(e){var t=e.clientX,a=e.clientY,n=this.options.each,o=this.observable,i=this.storage,s=this.storage,l=s.doResize,c=s.doDrag,u=s.doRotate,h=s.frame,f=s.handles.radius,T=s.isTarget,_=this.proxyMethods;if(T){var p=l?E_RESIZE$1:c?E_DRAG$2:E_ROTATE$1;i.doResize=!1,i.doDrag=!1,i.doRotate=!1,i.doSetCenter=!1,i.doDraw=!1,i.onExecution=!1,i.cursor=null,this._apply(p);var d={clientX:t,clientY:a};_.onDrop.call(this,d),l?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_RESIZE_END$1,d):u?_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_ROTATE_END$1,d):c&&_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,E_DRAG_END$1,d);var E=n.move,y=n.resize,v=n.rotate,m=l&&y||u&&v||c&&E;o.notify(ON_APPLY$2,this,{clientX:t,clientY:a,actionName:p,triggerEvent:m}),cancelAnimFrame(h),helper(document.body).css({cursor:"auto"}),isDef(f)&&addClass(f,"".concat(LIB_CLASS_PREFIX,"hidden"))}}},{key:"_compute",value:function(e,t){var r=this.storage.handles,a=helper(e.target),n=this._checkHandles(a,r),o=n.revX,i=n.revY,s=n.doW,l=n.doH,c=_objectWithoutProperties(n,["revX","revY","doW","doH"]),u=this._getState({revX:o,revY:i,doW:s,doH:l}),h=this._cursorPoint(e),f=h.x,T=h.y,_=Math.atan2(T-u.center.y,f-u.center.x);return _objectSpread2({},u,{},c,{handle:values(r).some((function(t){return helper(e.target).is(t)}))?a:helper(t),pressang:_})}},{key:"_checkHandles",value:function(e,t){var r=function(r){return r.some((function(r){return a=t[r],!!isDef(a)&&e.is(a);var a}))};return{revX:r([TOP_LEFT,MIDDLE_LEFT,BOTTOM_LEFT,TOP_CENTER,LEFT_EDGE]),revY:r([TOP_LEFT,TOP_RIGHT,TOP_CENTER,MIDDLE_LEFT,TOP_EDGE]),onTopEdge:r([TOP_CENTER,TOP_RIGHT,TOP_LEFT,TOP_EDGE]),onLeftEdge:r([TOP_LEFT,MIDDLE_LEFT,BOTTOM_LEFT,LEFT_EDGE]),onRightEdge:r([TOP_RIGHT,MIDDLE_RIGHT,BOTTOM_RIGHT,RIGHT_EDGE]),onBottomEdge:r([BOTTOM_RIGHT,BOTTOM_CENTER,BOTTOM_LEFT,BOTTOM_EDGE]),doW:r([MIDDLE_LEFT,MIDDLE_RIGHT,LEFT_EDGE,RIGHT_EDGE]),doH:r([TOP_CENTER,BOTTOM_CENTER,BOTTOM_EDGE,TOP_EDGE])}}},{key:"_restrictHandler",value:function(e){for(var t=null,r=null,a=this.getBoundingRect(e),n=this._getRestrictedBBox(),o=_slicedToArray(getMinMaxOfArray(n),2),i=_slicedToArray(o[0],2),s=i[0],l=i[1],c=_slicedToArray(o[1],2),u=c[0],h=c[1],f=0,T=a.length;f<T;f++){var _=_slicedToArray(a[f],2),p=_[0],d=_[1];(p<s||p>l)&&(t=p),(d<u||d>h)&&(r=d)}return{x:t,y:r}}},{key:"_destroy",value:function(){var e=this,t=this.el,r=this.storage,a=r.controls,n=r.wrapper;[t,a].map((function(t){return helper(t).off(E_MOUSEDOWN$1,e._onMouseDown).off(E_TOUCHSTART$1,e._onTouchStart)})),n.parentNode.removeChild(n)}},{key:"notifyMove",value:function(){_get(_getPrototypeOf(r.prototype),"_drag",this).apply(this,arguments)}},{key:"notifyRotate",value:function(e){var t=e.radians,r=_objectWithoutProperties(e,["radians"]),a=this.options.snap.angle;this._rotate(_objectSpread2({radians:snapToGrid(t,a)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(e){var t=e.clientX,a=e.clientY,n=e.actionName,o=e.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:t,clientY:a}),o&&(this._apply(n),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,"".concat(n,"End"),{clientX:t,clientY:a}))}},{key:"notifyGetState",value:function(e){var t=e.clientX,a=e.clientY,n=e.actionName,o=e.triggerEvent,i=_objectWithoutProperties(e,["clientX","clientY","actionName","triggerEvent"]);if(o){var s=this._getState(i);this.storage=_objectSpread2({},this.storage,{},s),_get(_getPrototypeOf(r.prototype),"_emitEvent",this).call(this,"".concat(n,"Start"),{clientX:t,clientY:a})}}},{key:"subscribe",value:function(e){var t=e.resize,r=e.move,a=e.rotate,n=this.observable;(r||t||a)&&n.subscribe(ON_GETSTATE$2,this).subscribe(ON_APPLY$2,this),r&&n.subscribe(ON_MOVE$2,this),t&&n.subscribe(ON_RESIZE$2,this),a&&n.subscribe(ON_ROTATE$2,this)}},{key:"unsubscribe",value:function(){var e=this,t=this.observable;NOTIFIER_EVENTS$1.map((function(r){return t.unsubscribe(r,e)}))}},{key:"disable",value:function(){var e=this.storage,t=this.proxyMethods,r=this.el;isUndef(e)||(e.onExecution&&helper(document).off(E_MOUSEMOVE$2,this._onMouseMove).off(E_MOUSEUP$2,this._onMouseUp).off(E_TOUCHMOVE$2,this._onTouchMove).off(E_TOUCHEND$2,this._onTouchEnd),removeClass(r,"".concat(LIB_CLASS_PREFIX,"drag")),this.unsubscribe(),this._destroy(),t.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(e){var t=e.dx,a=e.dy;this.options.draggable&&(this.storage=_objectSpread2({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),_get(_getPrototypeOf(r.prototype),"_drag",this).call(this,{dx:t,dy:a}),this._apply(E_DRAG$2))}},{key:"exeResize",value:function(e){var t=e.dx,r=e.dy,a=e.revX,n=void 0!==a&&a,o=e.revY,i=void 0!==o&&o,s=e.doW,l=void 0!==s&&s,c=e.doH,u=void 0!==c&&c;this.options.resizable&&(this.storage=_objectSpread2({},this.storage,{},this._getState({revX:n,revY:i,doW:l,doH:u})),this._resize({dx:t,dy:r}),this._apply(E_RESIZE$1))}},{key:"exeRotate",value:function(e){var t=e.delta;this.options.rotatable&&(this.storage=_objectSpread2({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:t}),this._apply(E_ROTATE$1))}},{key:"controls",get:function(){return this.storage.wrapper}}]),r}(),cloneMatrix=function(e){return e.map((function(e){return _toConsumableArray(e)}))},flatMatrix=function(e){return e.reduce((function(t,r,a){return[].concat(_toConsumableArray(t),[e[0][a],e[1][a],e[2][a],e[3][a]])}),[])},createIdentityMatrix=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;return _toConsumableArray(Array(e)).map((function(e,t,r){return r.map((function(){return+!t--}))}))},createTranslateMatrix=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return createIdentityMatrix().map((function(a,n){return a[3]=[e,t,r,1][n],a}))},createScaleMatrix=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return createIdentityMatrix().map((function(n,o){return n[o]=[e,t,r,a][o],n}))},createRotateMatrix=function(e,t){var r=createIdentityMatrix();return r[0][0]=t,r[0][1]=-e,r[1][0]=e,r[1][1]=t,r},dropTranslate=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=t?cloneMatrix(e):e;return r[0][3]=r[1][3]=r[2][3]=0,r},multiplyMatrixAndPoint=function(e,t){for(var r=[],a=0,n=e.length;a<n;++a){for(var o=0,i=0;i<n;++i)o+=+e[a][i]*t[i];r[a]=o}return r},multiplyMatrix=function(e,t){for(var r=[],a=0;a<t.length;a++){r[a]=[];for(var n=0;n<e[0].length;n++){for(var o=0,i=0;i<e.length;i++)o+=e[i][n]*t[a][i];r[a].push(o)}}return r},matrixInvert=function(e){for(var t,r=cloneMatrix(e),a=r.length,n=[],o=0;o<a;o++)n[o]=[];for(var i=0;i<a;i++)for(var s=0;s<a;s++)n[i][s]=0,i==s&&(n[i][s]=1);for(var l=0;l<a;l++){t=r[l][l];for(var c=0;c<a;c++)r[l][c]/=t,n[l][c]/=t;for(var u=l+1;u<a;u++){t=r[u][l];for(var h=0;h<a;h++)r[u][h]-=r[l][h]*t,n[u][h]-=n[l][h]*t}}for(var f=a-1;f>0;f--)for(var T=f-1;T>=0;T--){t=r[T][f];for(var _=0;_<a;_++)r[T][_]-=r[f][_]*t,n[T][_]-=n[f][_]*t}for(var p=0;p<a;p++)for(var d=0;d<a;d++)r[p][d]=n[p][d];return r},computeTransformMatrix=function(e,t){var r=_slicedToArray(t,3),a=r[0],n=r[1],o=r[2],i=createTranslateMatrix(-a,-n,-o),s=createTranslateMatrix(a,n,o);return multiplyMatrix(multiplyMatrix(i,e),s)},getCurrentTransformMatrix=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=arguments.length>2?arguments[2]:void 0,a=createIdentityMatrix(),n=e,o=r||getTransform(n),i=!1;n&&n instanceof Element;){var s=getTransformOrigin(n,i);if(a=multiplyMatrix(a,computeTransformMatrix(o,s)),i=!0,n===t||null===n.offsetParent)break;n=n.offsetParent,o=getTransform(n)}return a},decompose=function(e){var t=Math.sqrt(e[0][0]*e[0][0]+e[1][0]*e[1][0]+e[2][0]*e[2][0]),r=Math.sqrt(e[0][1]*e[0][1]+e[1][1]*e[1][1]+e[2][1]*e[2][1]),a=Math.sqrt(e[0][2]*e[0][2]+e[1][2]*e[1][2]+e[2][2]*e[2][2]),n=Math.atan2(-e[0][3]/a,e[1][3]/a),o=Math.asin(e[3][1]/a),i=Math.atan2(-e[3][0]/r,e[0][0]/t);return 1!==e[0][1]&&-1!==e[0][1]||(n=0,o=e[0][1]*-Math.PI/2,i=e[0][1]*Math.atan2(e[1][1]/r,e[0][1]/r)),{rotate:{x:n,y:o,z:i},translate:{x:e[0][3]/t,y:e[1][3]/r,z:e[2][3]/a},scale:{sX:t,sY:r,sZ:a}}},getTransform=function(e){var t=getStyle(e,"transform")||"none",r=createIdentityMatrix();if("none"===t)return r;var a=t.split(/\s*[(),]\s*/).slice(1,-1);if(16!==a.length)return[[+a[0],+a[2],0,+a[4]],[+a[1],+a[3],0,+a[5]],[0,0,1,0],[0,0,0,1]];for(var n=0;n<4;++n)for(var o=0;o<4;++o)r[o][n]=+a[4*n+o];return r},getTransformOrigin=function(e,t){for(var r=getStyle(e,"transform-origin"),a=r?r.split(" "):[],n=[t?-e.clientLeft:0,t?-e.clientTop:0,0,1],o=0;o<a.length;++o)n[o]+=parseFloat(a[o]);return n},getAbsoluteOffset=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.body,r=0,a=0,n=!1;e;){var o=getCurrentTransformMatrix(e.offsetParent),i=multiplyMatrixAndPoint(dropTranslate(o,!1),[e.offsetLeft+(n?e.clientLeft:0),e.offsetTop+(n?e.clientTop:0),0,1]),s=_slicedToArray(i,2),l=s[0],c=s[1];if(a+=l,r+=c,t===e)break;n=!0,e=e.offsetParent}return[a,r,0,1]},E_MOUSEDOWN$2=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$2=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,keys$1=Object.keys,entries=Object.entries,values$1=Object.values,Draggable=function(e){_inherits(r,Transformable);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"_init",value:function(e){var t=this,r=this.options,a=r.rotationPoint,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,l=r.showNormal,c=e.offsetLeft,u=e.offsetTop,h=e.offsetHeight,f=e.offsetWidth,T=createElement(["sjx-wrapper"]),_=createElement(["sjx-controls"]),p={},d=getCurrentTransformMatrix(e,n),E=_slicedToArray(getAbsoluteOffset(e,n),2),y=E[0],v=E[1],m=["data-sjx-cx","data-sjx-cy"].map((function(t){var r=e.getAttribute(t);return isDef(r)?Number(r):void 0})),x=m.every((function(e){return!isNaN(e)})),b=this._calculateVertices(d),S=b.rotator,g=void 0===S?null:S,O=b.anchor,M=void 0===O?null:O,A=_objectWithoutProperties(b,["rotator","anchor"]),N={};if(s){var R=l?renderLine([[M.x,M.y],g],"normal"):null;l&&_.appendChild(R);var C=null;a&&(C=renderLine([A.center,A.center],"radius"),addClass(C,"sjx-hidden"),_.appendChild(C)),N=_objectSpread2({},N,{normal:R,radius:C})}var D={te:[A.tl,A.tr],be:[A.bl,A.br],le:[A.tl,A.bl],re:[A.tr,A.br]},I=i?{tl:A.tl,tr:A.tr,br:A.br,bl:A.bl,tc:A.tc,bc:A.bc,ml:A.ml,mr:A.mr}:{},k=x?[].concat(_toConsumableArray(m),[0,1]):A.center,w=_objectSpread2({},I,{center:a&&s?k:void 0,rotator:g}),P=function(e,t){return keys$1(e).map((function(r){var a=e[r];if(!isUndef(a)){var n=t(a,r);p[r]=n,_.appendChild(n)}}))};P(D,renderLine),P(w,createHandler),T.appendChild(_),o.appendChild(T),this.storage={wrapper:T,controls:_,handles:_objectSpread2({},p,{},N),parent:e.parentNode,center:{isShifted:x},transform:{ctm:d},bBox:{width:f,height:h,left:c,top:u,offset:{left:y,top:v}},cached:{}},[e,_].map((function(e){return helper(e).on(E_MOUSEDOWN$2,t._onMouseDown).on(E_TOUCHSTART$2,t._onTouchStart)}))}},{key:"_pointToElement",value:function(e){var t=e.x,r=e.y,a=this.storage.transform.ctm,n=matrixInvert(a);return this._applyMatrixToPoint(dropTranslate(n,!1),t,r)}},{key:"_pointToControls",value:function(e){var t=e.x,r=e.y,a=this.storage.transform.wrapperMatrix,n=matrixInvert(a);return this._applyMatrixToPoint(dropTranslate(n,!1),t,r)}},{key:"_applyMatrixToPoint",value:function(e,t,r){var a=_slicedToArray(multiplyMatrixAndPoint(e,[t,r,0,1]),2);return{x:a[0],y:a[1]}}},{key:"_cursorPoint",value:function(e){var t=e.clientX,r=e.clientY,a=this.options.container,n=getCurrentTransformMatrix(a);return this._applyMatrixToPoint(matrixInvert(n),t,r)}},{key:"_getRestrictedBBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.storage.transform.containerMatrix,r=this.options,a=r.restrict,n=r.container,o=a||n;return _getBoundingRect(o,n,e?getCurrentTransformMatrix(o,n):t)}},{key:"_apply",value:function(){var e=this.el,t=this.storage,r=t.cached,a=t.controls,n=t.transform.matrix,o=t.center,i=this.options.applyTranslate,s=helper(a);if(!isUndef(r)){if(e.setAttribute("data-sjx-cx",o.elX),e.setAttribute("data-sjx-cy",o.elY),i){var l=helper(e),c=r.dx,u=r.dy,h=matrixToCSS(n),f=parseFloat(e.style.left||l.css("left")),T=parseFloat(e.style.top||l.css("top"));h.left="".concat(f+c,"px"),h.top="".concat(T+u,"px"),l.css(h),s.css(h)}this.storage.cached={}}}},{key:"_processResize",value:function(e,t){var r=this.storage,a=this.storage,n=a.transform,o=n.matrix,i=n.auxiliary.scale.translateMatrix,s=a.cached,l=(s=void 0===s?{}:s).dist,c=(l=void 0===l?{}:l).dx,u=void 0===c?e:c,h=l.dy,f=void 0===h?t:h,T=a.bBox,_=T.width,p=T.height,d=a.revX,E=a.revY,y=a.doW,v=a.doH,m=this.options,x=m.proportions,b=m.scalable,S=m.restrict,g=function(e,t){var r=y||!y&&!v?(_+e)/_:(p+t)/p,a=x?_*r:_+e,n=x?p*r:p+t;return[a/_,n/p,a,n]},O=function(e,t){var r=createScaleMatrix(e,t);return multiplyMatrix(multiplyMatrix(i,r),matrixInvert(i))},M=function(e,t){var r=e[0][3],a=e[1][3],n=createTranslateMatrix(r,a),o=createTranslateMatrix(r*(d?-1:1),a*(E?-1:1));return multiplyMatrix(multiplyMatrix(o,t),matrixInvert(n))},A=_slicedToArray(g(e,t),4),N=A[0],R=A[1],C=A[2],D=A[3],I=O(N,R),k=b?multiplyMatrix(I,o):M(I,o);this.storage.cached.bBox={width:C,height:D};var w=S?this._restrictHandler(k):{x:null,y:null},P=w.x,V=w.y,$=(null!==P||null!==V)&&S,L=$?u:e,j=$?f:t,G=_slicedToArray(g(L,j),4),F=G[0],H=G[1],U=G[2],Y=G[3],B=O(F,H),X=b?multiplyMatrix(B,o):M(B,o);return U<=MIN_SIZE||Y<=MIN_SIZE?{transform:X,width:U,height:Y}:(this._updateElementView(_objectSpread2({},matrixToCSS(flatMatrix(X)),{},!b&&{width:"".concat(U,"px"),height:"".concat(Y,"px")})),this._applyTransformToHandles({boxMatrix:X}),r.cached.dist={dx:L,dy:j},{transform:X,width:U,height:Y})}},{key:"_processMove",value:function(e,t){var r=this.storage,a=this.storage,n=a.transform,o=n.matrix,i=n.wrapperMatrix,s=n.auxiliary.translate.parentMatrix,l=a.center,c=a.cached,u=(c=void 0===c?{}:c).dist,h=(u=void 0===u?{}:u).dx,f=void 0===h?e:h,T=u.dy,_=void 0===T?t:T,p=this.options.restrict,d=_slicedToArray(multiplyMatrixAndPoint(s,[e,t,0,1]),2),E=d[0],y=d[1],v=multiplyMatrix(o,createTranslateMatrix(E,y)),m=p?this._restrictHandler(v):{x:null,y:null},x=null!==m.x&&p?f:e,b=null!==m.y&&p?_:t,S=_slicedToArray(multiplyMatrixAndPoint(s,[x,b,0,1]),2),g=S[0],O=S[1],M=multiplyMatrix(o,createTranslateMatrix(g,O)),A=multiplyMatrix(i,createTranslateMatrix(x,b)),N=matrixToCSS(flatMatrix(M)),R=matrixToCSS(flatMatrix(A));return this._updateElementView(N),this._updateWrapperView(R),r.cached.dist={dx:x,dy:b,ox:g,oy:O},l.isShifted,M}},{key:"_processRotate",value:function(e){var t=this.storage.transform,r=t.matrix,a=t.auxiliary.rotate.translateMatrix,n=this.options.restrict,o=floatToFixed(Math.cos(e),4),i=floatToFixed(Math.sin(e),4),s=createRotateMatrix(i,o),l=multiplyMatrix(multiplyMatrix(matrixInvert(a),s),a),c=multiplyMatrix(r,l),u=n?this._restrictHandler(c):{x:null,y:null},h=u.x,f=u.y;return isDef(h)||isDef(f)?c:(this._updateElementView(matrixToCSS(flatMatrix(c))),this._applyTransformToHandles({boxMatrix:c}),c)}},{key:"_getState",value:function(e){var t=e.revX,r=e.revY,a=e.doW,n=e.doH,o=this.el,i=this.storage,s=i.handles.center,l=i.parent,c=i.wrapper,u=i.center,h=this.options,f=h.container,T=h.restrict,_=h.scalable,p=T||f,d=p.offsetWidth,E=p.offsetHeight,y=_slicedToArray(getAbsoluteOffset(o,f),2),v=y[0],m=y[1],x=o.offsetLeft,b=o.offsetTop,S=o.offsetWidth,g=o.offsetHeight,O=getTransform(o),M=getCurrentTransformMatrix(o,f),A=getCurrentTransformMatrix(l,f),N=getCurrentTransformMatrix(c,f),R=T?getCurrentTransformMatrix(T,T.parentNode):getCurrentTransformMatrix(f,f.parentNode),C=S/2,D=g/2,I=n?0:t?-C:C,k=a?0:r?-D:D,w=_slicedToArray(multiplyMatrixAndPoint(M,[C,D,0,1]),2),P=w[0]+v,V=w[1]+m,$=s?getTransform(s):createIdentityMatrix(),L=(s?decompose(getCurrentTransformMatrix(s)):{translate:{x:P,y:V}}).translate,j=L.x,G=L.y,F=_slicedToArray(multiplyMatrixAndPoint(multiplyMatrix(matrixInvert(dropTranslate(M)),dropTranslate($)),[j-P,G-V,0,1]),2),H=F[0],U=F[1],Y=_slicedToArray(multiplyMatrixAndPoint(O,[H,U,0,1]),2),B=Y[0],X=Y[1],W=multiplyMatrixAndPoint(dropTranslate(R),[d,E,0,1]),z=decompose(getCurrentTransformMatrix(o,o.parentNode)).scale,Z=z.sX,K=z.sY;return{transform:{auxiliary:{scale:{translateMatrix:_?createTranslateMatrix(I,k):createTranslateMatrix(n?0:C,a?0:D)},translate:{parentMatrix:matrixInvert(dropTranslate(A))},rotate:{translateMatrix:createTranslateMatrix(B,X)}},scaleX:I,scaleY:k,matrix:O,ctm:M,parentMatrix:A,containerMatrix:R,wrapperMatrix:N,scX:Z,scY:K,containerBox:W},bBox:{width:S,height:g,left:x,top:b,offset:{left:v,top:m}},center:_objectSpread2({},u,{x:P,y:V,elX:B,elY:X,matrix:$}),revX:t,revY:r,doW:a,doH:n}}},{key:"_moveCenterHandle",value:function(e,t){var r=this.storage,a=r.handles.center,n=r.center.matrix,o=multiplyMatrix(n,createTranslateMatrix(e,t));helper(a).css(_objectSpread2({},matrixToCSS(flatMatrix(o)))),this.storage.center.isShifted=!0}},{key:"_updateElementView",value:function(e){helper(this.el).css(e)}},{key:"_updateWrapperView",value:function(e){helper(this.storage.wrapper).css(e)}},{key:"_calculateVertices",value:function(e){var t=this.el,r=this.options,a=r.rotatable,n=r.rotatorAnchor,o=r.rotatorOffset,i=r.container,s=t.offsetHeight,l=t.offsetWidth,c=_slicedToArray(getAbsoluteOffset(t,i),2),u=c[0],h=c[1],f=entries({tl:[0,0,0,1],bl:[0,s,0,1],br:[l,s,0,1],tr:[l,0,0,1],tc:[l/2,0,0,1],ml:[0,s/2,0,1],bc:[l/2,s,0,1],mr:[l,s/2,0,1],center:[l/2,s/2,0,1]}).reduce((function(r,a){var n=_slicedToArray(a,2),o=n[0],s=n[1];return[].concat(_toConsumableArray(r),[[o,multiplyMatrixAndPoint(e||getCurrentTransformMatrix(t,i),s)]])}),[]).reduce((function(e,t){var r=_slicedToArray(t,2),a=r[0],n=_slicedToArray(r[1],4),o=n[0],i=n[1],s=n[2],l=n[3];return e[a]=[o+u,i+h,s,l],e}),{}),T=null;if(a){var _={},p=1;switch(n){case"n":_.x=f.tc[0],_.y=f.tc[1];break;case"s":_.x=f.bc[0],_.y=f.bc[1],p=-1;break;case"w":_.x=f.ml[0],_.y=f.ml[1],p=-1;break;case"e":default:_.x=f.mr[0],_.y=f.mr[1]}var d="n"===n||"s"===n?Math.atan2(f.bl[1]-f.tl[1],f.bl[0]-f.tl[0]):Math.atan2(f.tl[1]-f.tr[1],f.tl[0]-f.tr[0]);T=[_.x-o*p*Math.cos(d),_.y-o*p*Math.sin(d)],f.rotator=T,f.anchor=_}return f}},{key:"_applyTransformToHandles",value:function(){var e=this.el,t=this.storage,r=t.wrapper,a=t.handles,n=t.transform,o=(n=void 0===n?{}:n).wrapperMatrix,i=void 0===o?getCurrentTransformMatrix(r,r.parentNode):o,s=t.center.isShifted,l=this.options,c=l.rotatable,u=l.resizable,h=l.showNormal,f=l.container,T=multiplyMatrix(getCurrentTransformMatrix(e,f),matrixInvert(i)),_=this._calculateVertices(T),p=_.anchor,d=void 0===p?null:p,E=_.center,y=_objectWithoutProperties(_,["anchor","center"]),v=null,m={};c&&(v=h?[[d.x,d.y],y.rotator]:null,m={rotator:y.rotator});var x=_objectSpread2({te:[y.tl,y.tr],be:[y.bl,y.br],le:[y.tl,y.bl],re:[y.tr,y.br]},h&&v&&{normal:v});keys$1(x).forEach((function(e){var t=_slicedToArray(x[e],2),r=t[0],n=t[1],o=getLineAttrs(r,n),i=o.cx,s=o.cy,l=o.length,c=o.theta;helper(a[e]).css({transform:"translate(".concat(i,"px, ").concat(s,"px) rotate(").concat(c,"deg)"),width:"".concat(l,"px")})}));var b=_objectSpread2({},u&&y,{},m,{},!s&&Boolean(E)&&{center:E});keys$1(b).forEach((function(e){var t=a[e],r=b[e];if(!isUndef(r)&&!isUndef(t)){var n=_slicedToArray(r,2),o=n[0],i=n[1];helper(t).css({transform:"translate(".concat(o,"px, ").concat(i,"px)")})}}))}},{key:"resetCenterPoint",value:function(){var e=this.el,t=this.el,r=t.offsetHeight,a=t.offsetWidth,n=this.storage,o=n.wrapper,i=n.handles.center,s=this.options.container;if(i){var l=_slicedToArray(getAbsoluteOffset(e,s),2),c=l[0],u=l[1],h=multiplyMatrix(getCurrentTransformMatrix(e,s),matrixInvert(getCurrentTransformMatrix(o,o.parentNode))),f=_slicedToArray(multiplyMatrixAndPoint(h,[a/2,r/2,0,1]),2),T=f[0],_=f[1];helper(i).css({transform:"translate(".concat(T+c,"px, ").concat(_+u,"px)")})}}},{key:"fitControlsToSize",value:function(){var e=createIdentityMatrix();this.storage=_objectSpread2({},this.storage,{transform:_objectSpread2({},this.storage.transform||{},{wrapperMatrix:e})}),this._updateWrapperView(matrixToCSS(flatMatrix(e))),this._applyTransformToHandles()}},{key:"getBoundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.el,r=this.options,a=r.scalable,n=r.restrict,o=r.container,i=this.storage,s=i.bBox,l=i.bBox,c=l.width,u=l.height,h=i.cached,f=(h=void 0===h?{}:h).bBox,T=(f=void 0===f?{}:f).width,_=void 0===T?c:T,p=f.height,d=void 0===p?u:p,E=a?s:_objectSpread2({},s,{width:_,height:d}),y=n||o;return _getBoundingRect(t,y,getCurrentTransformMatrix(t,y,e),E)}},{key:"applyAlignment",value:function(e){var t=this.options.container,r=this._calculateVertices(),a=(r.anchor,r.rotator,r.center,_objectWithoutProperties(r,["anchor","rotator","center"])),n=this._getRestrictedBBox(!0),o=values$1(a),i=_slicedToArray(getMinMaxOfArray(n),2),s=_slicedToArray(i[0],2),l=s[0],c=s[1],u=_slicedToArray(i[1],2),h=u[0],f=u[1],T=_slicedToArray(getMinMaxOfArray(o),2),_=_slicedToArray(T[0],2),p=_[0],d=_[1],E=_slicedToArray(T[1],2),y=E[0],v=E[1],m=_slicedToArray(multiplyMatrixAndPoint(matrixInvert(dropTranslate(getCurrentTransformMatrix(this.el.parentNode,t))),[function(){switch(!0){case/[l]/.test(e):return l-p;case/[r]/.test(e):return c-d;case/[h]/.test(e):return(c+l)/2-(d+p)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(e):return h-y;case/[b]/.test(e):return f-v;case/[v]/.test(e):return(f+h)/2-(v+y)/2;default:return 0}}(),0,1]),2),x=m[0],b=m[1],S=multiplyMatrix(getTransform(this.el),createTranslateMatrix(x,b));this._updateElementView(matrixToCSS(flatMatrix(S))),this.fitControlsToSize()}}]),r}(),createHandler=function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"handler",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=createElement(["sjx-hdl","sjx-hdl-".concat(n)]);return helper(i).css(_objectSpread2({transform:"translate(".concat(r,"px, ").concat(a,"px)")},o)),i},renderLine=function(e,t){var r=_slicedToArray(e,3),a=r[0],n=r[1],o=r[2],i=void 0===o?1:o,s=getLineAttrs(a,n,i),l=s.cx,c=s.cy,u=s.length,h=s.theta,f=createElement(["sjx-hdl-line","sjx-hdl-".concat(t)]);return helper(f).css({transform:"translate(".concat(l,"px, ").concat(c,"px) rotate(").concat(h,"deg)"),height:"".concat(i,"px"),width:"".concat(u,"px")}),f},getLineAttrs=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=_slicedToArray(e,2),n=a[0],o=a[1],i=_slicedToArray(t,2),s=i[0],l=i[1],c=Math.sqrt((s-n)*(s-n)+(l-o)*(l-o)),u=(n+s)/2-c/2,h=(o+l)/2-r/2,f=Math.atan2(o-l,n-s)*(180/Math.PI);return{cx:u,cy:h,thickness:r,theta:f,length:c}},_getBoundingRect=function(e,t,r,a){var n=_slicedToArray(getAbsoluteOffset(e,t),2),o=n[0],i=n[1],s=a||{width:e.offsetWidth,height:e.offsetHeight,offset:{left:o,top:i}},l=s.width,c=s.height,u=s.offset,h=u.left,f=u.top;return[[0,0,0,1],[l,0,0,1],[0,c,0,1],[l,c,0,1]].reduce((function(e,t){return[].concat(_toConsumableArray(e),[multiplyMatrixAndPoint(r,t)])}),[]).map((function(e){var t=_slicedToArray(e,4),r=t[0],a=t[1],n=t[2],o=t[3];return[r+h,a+f,n,o]}))},createElement=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=document.createElement("div");return e.forEach((function(e){return addClass(t,e)})),t},sepRE=/\s*,\s*|\s+/g,allowedElements=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function createSVGElement(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=document.createElementNS("http://www.w3.org/2000/svg",e);return t.forEach((function(e){return addClass(r,e)})),r}var createSVGPoint=function(e,t){var r=createSVGElement("svg").createSVGPoint();return r.x=e,r.y=t,r},checkChildElements=function e(t){var r=[];return isGroup(t)?forEach.call(t.childNodes,(function(t){if(1===t.nodeType){var a=t.tagName.toLowerCase();-1!==allowedElements.indexOf(a)&&("g"===a&&r.push.apply(r,_toConsumableArray(e(t))),r.push(t))}})):r.push(t),r},createSVGMatrix=function(){return createSVGElement("svg").createSVGMatrix()},createTranslateMatrix$1=function(e,t){var r=createSVGMatrix();return r.e=e,r.f=t,r},createRotateMatrix$1=function(e,t){var r=createSVGMatrix();return r.a=t,r.b=e,r.c=-e,r.d=t,r},createScaleMatrix$1=function(e,t){var r=createSVGMatrix();return r.a=e,r.d=t,r},getTransformToElement=function(e,t){return(t.getScreenCTM&&t.getScreenCTM()||createSVGMatrix()).inverse().multiply(e.getScreenCTM()||createSVGMatrix())},matrixToString=function(e){var t=e.a,r=e.b,a=e.c,n=e.d,o=e.e,i=e.f;return"matrix(".concat(t,",").concat(r,",").concat(a,",").concat(n,",").concat(o,",").concat(i,")")},pointTo=function(e,t,r){return createSVGPoint(t,r).matrixTransform(e)},cloneMatrix$1=function(e){var t=createSVGMatrix();return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f,t},isIdentity=function(e){var t=e.a,r=e.b,a=e.c,n=e.d,o=e.e,i=e.f;return 1===t&&0===r&&0===a&&1===n&&0===o&&0===i},checkElement=function(e){var t=e.tagName.toLowerCase();return-1!==allowedElements.indexOf(t)||(warn('Selected element "'.concat(t,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)},isGroup=function(e){return"g"===e.tagName.toLowerCase()},normalizeString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.replace(/[\n\r]/g,"").replace(/([^e])-/g,"$1 -").replace(/ +/g," ").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ")},parsePoints=function(e){return normalizeString(e).trim().split(sepRE).reduce((function(e,t,r,a){return r%2==0&&e.push(a.slice(r,r+2)),e}),[])},dRE=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,parsePath=function(e){for(var t=dRE.lastIndex=0,r=[];t=dRE.exec(e);){var a=_slicedToArray(t,3),n=a[1],o=a[2],i=n.toUpperCase(),s=normalizeString(o);r.push({relative:n!==i,key:i,cmd:n,values:s.trim().split(sepRE).map((function(e){if(!isNaN(e))return Number(e)}))})}return r},movePath=function(e){var t=e.path,r=e.dx,a=e.dy;try{for(var n=parsePath(t),o="",i=" ",s=!0,l=0,c=n.length;l<c;l++){var u=n[l],h=u.values,f=u.key,T=u.relative,_=[];switch(f){case"M":for(var p=0,d=h.length;p<d;p+=2){var E=_slicedToArray(h.slice(p,p+2),2),y=E[0],v=E[1];T&&!s||(y+=r,v+=a),_.push(y,v),s=!1}break;case"A":for(var m=0,x=h.length;m<x;m+=7){var b=h.slice(m,m+7);T||(b[5]+=r,b[6]+=a),_.push.apply(_,_toConsumableArray(b))}break;case"C":for(var S=0,g=h.length;S<g;S+=6){var O=h.slice(S,S+6);T||(O[0]+=r,O[1]+=a,O[2]+=r,O[3]+=a,O[4]+=r,O[5]+=a),_.push.apply(_,_toConsumableArray(O))}break;case"H":for(var M=0,A=h.length;M<A;M+=1){var N=h.slice(M,M+1);T||(N[0]+=r),_.push(N[0])}break;case"V":for(var R=0,C=h.length;R<C;R+=1){var D=h.slice(R,R+1);T||(D[0]+=a),_.push(D[0])}break;case"L":case"T":for(var I=0,k=h.length;I<k;I+=2){var w=_slicedToArray(h.slice(I,I+2),2),P=w[0],V=w[1];T||(P+=r,V+=a),_.push(P,V)}break;case"Q":case"S":for(var $=0,L=h.length;$<L;$+=4){var j=_slicedToArray(h.slice($,$+4),4),G=j[0],F=j[1],H=j[2],U=j[3];T||(G+=r,F+=a,H+=r,U+=a),_.push(G,F,H,U)}break;case"Z":h[0]="",i=""}o+=u.cmd+_.join(",")+i}return o}catch(e){warn("Path parsing error: "+e)}},resizePath=function(e){var t=e.path,r=e.localCTM;try{for(var a=parsePath(t),n="",o=" ",i=[],s=!0,l=0,c=a.length;l<c;l++){var u=a[l],h=u.values,f=u.key,T=u.relative;switch(f){case"A":var _=[],p=cloneMatrix$1(r);T&&(p.e=p.f=0);for(var d=0,E=h.length;d<E;d+=7){var y=_slicedToArray(h.slice(d,d+7),7),v=y[0],m=y[1],x=y[2],b=y[3],S=y[4],g=y[5],O=y[6],M=pointTo(p,g,O),A=M.x,N=M.y;_.push(floatToFixed(A),floatToFixed(N)),p.e=p.f=0;var R=pointTo(p,v,m),C=R.x,D=R.y;_.unshift(floatToFixed(C),floatToFixed(D),x,b,S)}i.push(_);break;case"C":var I=[],k=cloneMatrix$1(r);T&&(k.e=k.f=0);for(var w=0,P=h.length;w<P;w+=6){var V=_slicedToArray(h.slice(w,w+6),6),$=V[0],L=V[1],j=V[2],G=V[3],F=V[4],H=V[5],U=pointTo(k,$,L),Y=U.x,B=U.y,X=pointTo(k,j,G),W=X.x,z=X.y,Z=pointTo(k,F,H),K=Z.x,q=Z.y;I.push(floatToFixed(Y),floatToFixed(B),floatToFixed(W),floatToFixed(z),floatToFixed(K),floatToFixed(q))}i.push(I);break;case"H":var Q=[],J=cloneMatrix$1(r);T&&(J.e=J.f=0);for(var ee=0,te=h.length;ee<te;ee+=1){var re=_slicedToArray(h.slice(ee,ee+1),1)[0],ae=pointTo(J,re,0).x;Q.push(floatToFixed(ae))}i.push(Q);break;case"V":var ne=[],oe=cloneMatrix$1(r);T&&(oe.e=oe.f=0);for(var ie=0,se=h.length;ie<se;ie+=1){var le=_slicedToArray(h.slice(ie,ie+1),1)[0],ce=pointTo(oe,0,le).y;ne.push(floatToFixed(ce))}i.push(ne);break;case"T":case"L":var ue=[],he=cloneMatrix$1(r);T&&(he.e=he.f=0);for(var fe=0,Te=h.length;fe<Te;fe+=2){var _e=_slicedToArray(h.slice(fe,fe+2),2),pe=_e[0],de=_e[1],Ee=pointTo(he,pe,de),ye=Ee.x,ve=Ee.y;ue.push(floatToFixed(ye),floatToFixed(ve))}i.push(ue);break;case"M":var me=[],xe=cloneMatrix$1(r);T&&!s&&(xe.e=xe.f=0);for(var be=0,Se=h.length;be<Se;be+=2){var ge=_slicedToArray(h.slice(be,be+2),2),Oe=ge[0],Me=ge[1],Ae=pointTo(xe,Oe,Me),Ne=Ae.x,Re=Ae.y;me.push(floatToFixed(Ne),floatToFixed(Re)),s=!1}i.push(me);break;case"Q":var Ce=[],De=cloneMatrix$1(r);T&&(De.e=De.f=0);for(var Ie=0,ke=h.length;Ie<ke;Ie+=4){var we=_slicedToArray(h.slice(Ie,Ie+4),4),Pe=we[0],Ve=we[1],$e=we[2],Le=we[3],je=pointTo(De,Pe,Ve),Ge=je.x,Fe=je.y,He=pointTo(De,$e,Le),Ue=He.x,Ye=He.y;Ce.push(floatToFixed(Ge),floatToFixed(Fe),floatToFixed(Ue),floatToFixed(Ye))}i.push(Ce);break;case"S":var Be=[],Xe=cloneMatrix$1(r);T&&(Xe.e=Xe.f=0);for(var We=0,ze=h.length;We<ze;We+=4){var Ze=_slicedToArray(h.slice(We,We+4),4),Ke=Ze[0],qe=Ze[1],Qe=Ze[2],Je=Ze[3],et=pointTo(Xe,Ke,qe),tt=et.x,rt=et.y,at=pointTo(Xe,Qe,Je),nt=at.x,ot=at.y;Be.push(floatToFixed(tt),floatToFixed(rt),floatToFixed(nt),floatToFixed(ot))}i.push(Be);break;case"Z":i.push([""]),o=""}n+=u.cmd+i[l].join(",")+o}return n}catch(e){warn("Path parsing error: "+e)}},E_DRAG$3=EVENT_EMITTER_CONSTANTS.E_DRAG,E_RESIZE$2=EVENT_EMITTER_CONSTANTS.E_RESIZE,E_MOUSEDOWN$3=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$3=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,keys$2=Object.keys,entries$1=Object.entries,values$2=Object.values,DraggableSVG=function(e){_inherits(r,Transformable);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"_init",value:function(e){var t=this,r=this.options,a=r.rotationPoint,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,l=r.showNormal,c=r.custom,u=e.getBBox(),h=createSVGElement("g",["sjx-svg-wrapper"]),f=createSVGElement("g",["sjx-svg-controls"]),T=["data-sjx-cx","data-sjx-cy"].map((function(t){var r=e.getAttribute(t);return isDef(r)?Number(r):void 0})),_=T.every((function(e){return!isNaN(e)})),p=getTransformToElement(e,n),d=this._calculateVertices(p),E=d.rotator,y=void 0===E?null:E,v=d.anchor,m=void 0===v?null:v,x=_objectWithoutProperties(d,["rotator","anchor"]),b={},S={};if(s){var g=l?renderLine$1([m,y],THEME_COLOR,"normal"):null;l&&f.appendChild(g);var O=null;a&&((O=createSVGElement("line",["sjx-hidden"])).x1.baseVal.value=x.center.x,O.y1.baseVal.value=x.center.y,O.x2.baseVal.value=T[0]||x.center.x,O.y2.baseVal.value=T[1]||x.center.y,setLineStyle(O,"#fe3232"),O.setAttribute("opacity",.5),f.appendChild(O)),S=_objectSpread2({},S,{normal:g,radius:O})}var M=i?{tl:x.tl,tr:x.tr,br:x.br,bl:x.bl,tc:x.tc,bc:x.bc,ml:x.ml,mr:x.mr}:{},A={te:[x.tl,x.tr],be:[x.bl,x.br],le:[x.tl,x.bl],re:[x.tr,x.br]};keys$2(A).forEach((function(e){var t=A[e];isUndef(t)||(b[e]=renderLine$1(t,THEME_COLOR,e),f.appendChild(b[e]))}));var N=_?pointTo(createSVGMatrix(),T[0],T[1]):x.center,R=_objectSpread2({},M,{rotator:y,center:a&&s?N:void 0});keys$2(R).forEach((function(e){var t=R[e];if(!isUndef(t)){var r=t.x,a=t.y,n="center"===e?"#fe3232":THEME_COLOR;isDef(c)&&isFunc(c[e])?b[e]=c[e](p,u,pointTo):b[e]=createHandler$1(r,a,n,e),f.appendChild(b[e])}})),h.appendChild(f),o.appendChild(h),this.storage={wrapper:h,controls:f,handles:_objectSpread2({},b,{},S),parent:e.parentNode,center:{isShifted:_},transform:{ctm:p},bBox:u,cached:{},__data__:new WeakMap},[e,f].map((function(e){return helper(e).on(E_MOUSEDOWN$3,t._onMouseDown).on(E_TOUCHSTART$3,t._onTouchStart)}))}},{key:"_cursorPoint",value:function(e){var t=e.clientX,r=e.clientY,a=this.options.container;return this._applyMatrixToPoint(a.getScreenCTM().inverse(),t,r)}},{key:"_getRestrictedBBox",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.storage,r=(t=void 0===t?{}:t).transform,a=(r=void 0===r?{}:r).containerMatrix,n=this.options,o=(n=void 0===n?{}:n).container,i=n.restrict,s=i||o;return _getBoundingRect$1(s,e?getTransformToElement(s,o):a)}},{key:"_pointToElement",value:function(e){var t=e.x,r=e.y,a=this.storage.transform.ctm.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,t,r)}},{key:"_pointToControls",value:function(e){var t=e.x,r=e.y,a=this.storage.transform.wrapperMatrix.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,t,r)}},{key:"_applyMatrixToPoint",value:function(e,t,r){var a=createSVGElement("svg").createSVGPoint();return a.x=t,a.y=r,a.matrixTransform(e)}},{key:"_apply",value:function(e){var t=this.el,r=this.storage,a=r.bBox,n=r.cached,o=r.transform,i=r.center,s=r.__data__,l=this.options,c=l.container,u=l.scalable,h=l.applyTranslate,f=o.matrix,T=o.parentMatrix,_=o.ctm;if(t.setAttribute("data-sjx-cx",i.elX),t.setAttribute("data-sjx-cy",i.elY),!isUndef(n)){var p=n.scaleX,d=n.scaleY,E=n.dist,y=(E=void 0===E?{}:E).dx,v=E.dy,m=E.ox,x=E.oy,b=n.transformMatrix;if(e===E_DRAG$3){if(!h||!y&&!v)return;var S=createTranslateMatrix$1(m,x),g=S.multiply(f).multiply(S.inverse());if(this._updateElementView(["transform",g]),isGroup(t))checkChildElements(t).forEach((function(e){var t=createTranslateMatrix$1(y,v),r=t.multiply(getTransformToElement(e,e.parentNode)).multiply(t.inverse());if(isIdentity(r)||e.setAttribute("transform",matrixToString(r)),!isGroup(e)){var a=T.inverse();a.e=a.f=0;var n=pointTo(a,m,x),o=n.x,i=n.y;applyTranslate(e,{x:o,y:i})}}));else applyTranslate(t,{x:m,y:x})}if(e===E_RESIZE$2){if(!b)return;if(!u)if(isGroup(t)){checkChildElements(t).forEach((function(e){if(!isGroup(e)){var r=getTransformToElement(e,t),n=r.inverse().multiply(b).multiply(r);applyResize(e,{scaleX:p,scaleY:d,localCTM:n,bBox:a,__data__:s})}}))}else{var O=c.getScreenCTM()||createSVGMatrix(),M=t.getScreenCTM().multiply(b),A=O.inverse().multiply(M),N=_.inverse().multiply(A);applyResize(t,{scaleX:p,scaleY:d,localCTM:N,bBox:a,__data__:s})}this._applyTransformToHandles({boxMatrix:u?_.multiply(b):_})}}}},{key:"_processResize",value:function(e,t){var r=this.el,a=this.storage,n=this.storage,o=n.bBox,i=o.width,s=o.height,l=n.revX,c=n.revY,u=n.doW,h=n.doH,f=n.transform,T=f.matrix,_=f.auxiliary.scale.translateMatrix,p=n.cached,d=(p=void 0===p?{}:p).dist,E=(d=void 0===d?{}:d).dx,y=void 0===E?e:E,v=d.dy,m=void 0===v?t:v,x=this.options,b=x.proportions,S=x.scalable,g=x.restrict,O=r.getBBox(),M=O.x,A=O.y,N=function(e,t){var r=u||!u&&!h?(i+e)/i:(s+t)/s,a=b?i*r:i+e,n=b?s*r:s+t;return[a/i,n/s,a,n]},R=function(e,t){var r=createScaleMatrix$1(e,t);return _.multiply(r).multiply(_.inverse())},C=T.multiply(R.apply(void 0,_toConsumableArray(N(e,t)))),D=g?this._restrictHandler(C):{x:null,y:null},I=D.x,k=D.y,w=(null!==I||null!==k)&&g,P=w?y:e,V=w?m:t,$=_slicedToArray(N(P,V),4),L=$[0],j=$[1],G=$[2],F=$[3],H=R(L,j),U=T.multiply(H),Y=M-(G-i)*(h?.5:l?1:0),B=A-(F-s)*(u?.5:c?1:0);return S&&this._updateElementView(["transform",U]),a.cached=_objectSpread2({},a.cached,{scaleX:L,scaleY:j,transformMatrix:H,resultMatrix:U,dist:{dx:P,dy:V}}),this._apply(E_RESIZE$2),{x:Y,y:B,width:G,height:F,transform:U}}},{key:"_processMove",value:function(e,t){var r=this.storage,a=this.storage,n=a.center,o=a.transform,i=o.matrix,s=o.auxiliary.translate,l=s.translateMatrix,c=s.wrapperTranslateMatrix,u=s.parentMatrix,h=o.wrapperMatrix,f=a.cached,T=(f=void 0===f?{}:f).dist,_=(T=void 0===T?{}:T).dx,p=void 0===_?e:_,d=T.dy,E=void 0===d?t:d,y=this.options.restrict;u.e=u.f=0;var v=pointTo(u,e,t),m=v.x,x=v.y,b=createTranslateMatrix$1(m,x).multiply(i),S=y?this._restrictHandler(b):{x:null,y:null},g=null!==S.x&&y?p:e,O=null!==S.y&&y?E:t,M=pointTo(u,g,O),A=M.x,N=M.y;r.cached.dist={dx:floatToFixed(g),dy:floatToFixed(O),ox:floatToFixed(A),oy:floatToFixed(N)},l.e=A,l.f=N;var R=l.multiply(i);c.e=g,c.f=O;var C=c.multiply(h);if(this._updateWrapperView(C),this._updateElementView(["transform",R]),n.isShifted){var D=h.inverse();D.e=D.f=0;var I=pointTo(D,g,O),k=I.x,w=I.y;this._moveCenterHandle(-k,-w)}return R}},{key:"_processRotate",value:function(e){var t=this.storage.transform,r=t.matrix,a=t.wrapperMatrix,n=t.parentMatrix,o=t.auxiliary.rotate,i=o.translateMatrix,s=o.wrapperTranslateMatrix,l=this.options.restrict,c=floatToFixed(Math.cos(e)),u=floatToFixed(Math.sin(e)),h=createRotateMatrix$1(u,c);n.e=n.f=0;var f=n.inverse().multiply(h).multiply(n),T=i.multiply(f).multiply(i.inverse()).multiply(r),_=l?this._restrictHandler(T):{x:null,y:null},p=_.x,d=_.y;if(isDef(p)||isDef(d))return T;var E=s.multiply(h).multiply(s.inverse()).multiply(a);return this._updateWrapperView(E),this._updateElementView(["transform",T]),T}},{key:"_getState",value:function(e){var t=this,r=e.revX,a=e.revY,n=e.doW,o=e.doH,i=this.el,s=this.storage,l=s.wrapper,c=s.parent,u=s.handles.center,h=s.__data__,f=this.options,T=f.container,_=f.restrict,p=i.getBBox(),d=p.x,E=p.y,y=p.width,v=p.height,m=getTransformToElement(i,c),x=getTransformToElement(i,T),b=getTransformToElement(l,T),S=getTransformToElement(c,T),g=getTransformToElement(l,l.parentNode),O=S.inverse(),M=d+y*(o?.5:r?1:0),A=E+v*(n?.5:a?1:0),N=d+y/2,R=E+v/2,C=u?u.cx.baseVal.value:N,D=u?u.cy.baseVal.value:R,I=pointTo(b,C,D),k=I.x,w=I.y,P=u?pointTo(O,k,w):pointTo(m,N,R),V=P.x,$=P.y,L=pointTo(x,N,R),j=L.x,G=L.y;storeElementAttributes(this.el,this.storage),h.delete(i),checkChildElements(i).forEach((function(e){h.delete(e),storeElementAttributes(e,t.storage)}));var F=_objectSpread2({},this.storage.center||{},{x:u?k:j,y:u?w:G,elX:V,elY:$,hx:u?u.cx.baseVal.value:null,hy:u?u.cy.baseVal.value:null}),H=_?getTransformToElement(_,_.parentNode):getTransformToElement(T,T.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:createSVGMatrix(),translateMatrix:createTranslateMatrix$1(M,A)},translate:{parentMatrix:O,translateMatrix:createSVGMatrix(),wrapperTranslateMatrix:createSVGMatrix()},rotate:{translateMatrix:createTranslateMatrix$1(F.elX,F.elY),wrapperTranslateMatrix:createTranslateMatrix$1(F.x,F.y)}},matrix:m,ctm:x,parentMatrix:S,wrapperMatrix:g,containerMatrix:H,scX:Math.sqrt(x.a*x.a+x.b*x.b),scY:Math.sqrt(x.c*x.c+x.d*x.d)},bBox:p,center:F,revX:r,revY:a,doW:n,doH:o}}},{key:"_moveCenterHandle",value:function(e,t){var r=this.storage,a=r.handles,n=a.center,o=a.radius,i=r.center,s=i.hx,l=i.hy;if(!isUndef(n)){var c=s+e,u=l+t;n.cx.baseVal.value=c,n.cy.baseVal.value=u,o.x2.baseVal.value=c,o.y2.baseVal.value=u,this.storage.center.isShifted=!0}}},{key:"_updateElementView",value:function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];"transform"===r&&this.el.setAttribute(r,matrixToString(a))}},{key:"_updateWrapperView",value:function(e){this.storage.wrapper.setAttribute("transform",matrixToString(e))}},{key:"_calculateVertices",value:function(e){var t=this.el,r=this.options,a=r.rotatable,n=r.rotatorAnchor,o=r.rotatorOffset,i=r.container,s=t.getBBox(),l=s.x,c=s.y,u=s.width,h=s.height,f=u/2,T=h/2,_=entries$1({tl:[l,c],tr:[l+u,c],mr:[l+u,c+T],ml:[l,c+T],tc:[l+f,c],bc:[l+f,c+h],br:[l+u,c+h],bl:[l,c+h],center:[l+f,c+T]}).reduce((function(r,a){var n=_slicedToArray(a,2),o=n[0],s=_slicedToArray(n[1],2),l=s[0],c=s[1];return r[o]=pointTo(e||getTransformToElement(t,i),l,c),r}),{});if(a){var p={},d=1;switch(n){case"n":var E=_.tc,y=E.x,v=E.y;p.x=y,p.y=v;break;case"s":var m=_.bc,x=m.x,b=m.y;p.x=x,p.y=b,d=-1;break;case"w":var S=_.ml,g=S.x,O=S.y;p.x=g,p.y=O,d=-1;break;case"e":default:var M=_.mr,A=M.x,N=M.y;p.x=A,p.y=N}var R="n"===n||"s"===n?Math.atan2(_.bl.y-_.tl.y,_.bl.x-_.tl.x):Math.atan2(_.tl.y-_.tr.y,_.tl.x-_.tr.x),C=o*d,D={x:p.x-C*Math.cos(R),y:p.y-C*Math.sin(R)};_.rotator=D,_.anchor=p}return _}},{key:"_applyTransformToHandles",value:function(e){var t=e.boxMatrix,r=this.el,a=this.options.rotatable,n=this.storage,o=n.wrapper,i=n.handles,s=n.center.isShifted,l=n.transform,c=(l=void 0===l?{}:l).wrapperMatrix,u=void 0===c?getTransformToElement(o,o.parentNode):c,h=r.getBBox(),f=h.x,T=h.y,_=h.width/2,p=h.height/2,d=u.inverse().multiply(t),E=pointTo(d,f+_,T+p),y=this._calculateVertices(d),v=y.anchor,m=void 0===v?null:v,x=y.center,b=_objectWithoutProperties(y,["anchor","center"]),S={te:[b.tl,b.tr],be:[b.bl,b.br],le:[b.tl,b.bl],re:[b.tr,b.br]};if(a){var g=i.normal,O=i.radius;isDef(g)&&(g.x1.baseVal.value=m.x,g.y1.baseVal.value=m.y,g.x2.baseVal.value=b.rotator.x,g.y2.baseVal.value=b.rotator.y),isDef(O)&&(O.x1.baseVal.value=E.x,O.y1.baseVal.value=E.y,s||(O.x2.baseVal.value=E.x,O.y2.baseVal.value=E.y))}keys$2(S).forEach((function(e){var t=i[e],r=_slicedToArray(S[e],2),a=r[0],n=r[1];isUndef(a)||isUndef(t)||entries$1({x1:a.x,y1:a.y,x2:n.x,y2:n.y}).map((function(e){var r=_slicedToArray(e,2),a=r[0],n=r[1];return t.setAttribute(a,n)}))}));var M=_objectSpread2({},b,{},!s&&Boolean(x)&&{center:x});keys$2(M).forEach((function(e){var t=i[e],r=M[e];isUndef(r)||isUndef(t)||(t.setAttribute("cx",r.x),t.setAttribute("cy",r.y))}))}},{key:"resetCenterPoint",value:function(){var e=this.el,t=this.storage,r=t.bBox,a=r.width,n=r.height,o=r.x,i=r.y,s=t.handles,l=s.center,c=s.radius;if(l){var u=getTransformToElement(e,e.parentNode),h=pointTo(u,o+a/2,i+n/2),f=h.x,T=h.y;l.cx.baseVal.value=f,l.cy.baseVal.value=T,l.isShifted=!1,c.x2.baseVal.value=f,c.y2.baseVal.value=T}}},{key:"fitControlsToSize",value:function(){var e=this.el,t=this.options.container,r=getTransformToElement(e,t),a=createSVGMatrix();this.storage=_objectSpread2({},this.storage,{transform:_objectSpread2({},this.storage.transform||{},{wrapperMatrix:a})}),this._updateWrapperView(a),this._applyTransformToHandles({boxMatrix:r})}},{key:"getBoundingRect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.el,r=this.options,a=r.restrict,n=r.container,o=this.storage.bBox,i=a||n,s=e?getTransformToElement(t.parentNode,i).multiply(e):getTransformToElement(t,i);return _getBoundingRect$1(t,s,o)}},{key:"applyAlignment",value:function(e){var t=this.options.container,r=this._calculateVertices(),a=(r.anchor,r.rotator,r.center,_objectWithoutProperties(r,["anchor","rotator","center"])),n=this._getRestrictedBBox(!0),o=values$2(a).map((function(e){return[e.x,e.y]})),i=_slicedToArray(getMinMaxOfArray(n),2),s=_slicedToArray(i[0],2),l=s[0],c=s[1],u=_slicedToArray(i[1],2),h=u[0],f=u[1],T=_slicedToArray(getMinMaxOfArray(o),2),_=_slicedToArray(T[0],2),p=_[0],d=_[1],E=_slicedToArray(T[1],2),y=E[0],v=E[1],m=getTransformToElement(this.el.parentNode,t);m.e=m.f=0;var x=pointTo(m.inverse(),function(){switch(!0){case/[l]/.test(e):return l-p;case/[r]/.test(e):return c-d;case/[h]/.test(e):return(c+l)/2-(d+p)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(e):return h-y;case/[b]/.test(e):return f-v;case/[v]/.test(e):return(f+h)/2-(v+y)/2;default:return 0}}()),b=x.x,S=x.y,g=createTranslateMatrix$1(b,S).multiply(getTransformToElement(this.el,this.el.parentNode));this._updateElementView(["transform",g]),this.fitControlsToSize()}}]),r}(),applyTranslate=function(e,t){var r=t.x,a=t.y,n=[];switch(e.tagName.toLowerCase()){case"text":var o=isDef(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,i=isDef(e.y.baseVal[0])?e.y.baseVal[0].value+a:(Number(e.getAttribute("y"))||0)+a;n.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=isDef(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,l=isDef(e.y.baseVal.value)?e.y.baseVal.value+a:(Number(e.getAttribute("y"))||0)+a;n.push(["x",s],["y",l]);break;case"circle":case"ellipse":var c=e.cx.baseVal.value+r,u=e.cy.baseVal.value+a;n.push(["cx",c],["cy",u]);break;case"line":var h=e.x1.baseVal.value+r,f=e.y1.baseVal.value+a,T=e.x2.baseVal.value+r,_=e.y2.baseVal.value+a;n.push(["x1",h],["y1",f],["x2",T],["y2",_]);break;case"polygon":case"polyline":var p=parsePoints(e.getAttribute("points")).map((function(e){return e[0]=Number(e[0])+r,e[1]=Number(e[1])+a,e.join(" ")})).join(" ");n.push(["points",p]);break;case"path":var d=e.getAttribute("d");n.push(["d",movePath({path:d,dx:r,dy:a})])}n.forEach((function(t){e.setAttribute(t[0],t[1])}))},applyResize=function(e,t){var r=t.scaleX,a=t.scaleY,n=t.localCTM,o=t.bBox,i=o.width,s=o.height,l=[],c=t.__data__.get(e);switch(e.tagName.toLowerCase()){case"text":case"tspan":var u=c.x,h=c.y,f=c.textLength,T=pointTo(n,u,h),_=T.x,p=T.y;l.push(["x",_+(r<0?i:0)],["y",p-(a<0?s:0)],["textLength",Math.abs(r*f)]);break;case"circle":var d=c.r,E=c.cx,y=c.cy,v=d*(Math.abs(r)+Math.abs(a))/2,m=pointTo(n,E,y),x=m.x,b=m.y;l.push(["r",v],["cx",x],["cy",b]);break;case"foreignobject":case"image":case"rect":var S=c.width,g=c.height,O=c.x,M=c.y,A=pointTo(n,O,M),N=A.x,R=A.y,C=Math.abs(S*r),D=Math.abs(g*a);l.push(["x",N-(r<0?C:0)],["y",R-(a<0?D:0)],["width",C],["height",D]);break;case"ellipse":var I=c.rx,k=c.ry,w=c.cx,P=c.cy,V=pointTo(n,w,P),$=V.x,L=V.y,j=createSVGMatrix();j.a=r,j.d=a;var G=pointTo(j,I,k),F=G.x,H=G.y;l.push(["rx",Math.abs(F)],["ry",Math.abs(H)],["cx",$],["cy",L]);break;case"line":var U=c.resX1,Y=c.resY1,B=c.resX2,X=c.resY2,W=pointTo(n,U,Y),z=W.x,Z=W.y,K=pointTo(n,B,X),q=K.x,Q=K.y;l.push(["x1",z],["y1",Z],["x2",q],["y2",Q]);break;case"polygon":case"polyline":var J=c.points,ee=parsePoints(J).map((function(e){var t=pointTo(n,Number(e[0]),Number(e[1])),r=t.x,a=t.y;return e[0]=floatToFixed(r),e[1]=floatToFixed(a),e.join(" ")})).join(" ");l.push(["points",ee]);break;case"path":var te=c.path;l.push(["d",resizePath({path:te,localCTM:n})])}l.forEach((function(t){var r=_slicedToArray(t,2),a=r[0],n=r[1];e.setAttribute(a,n)}))},createHandler$1=function(e,t,r,a){var n=createSVGElement("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(a)]);return entries$1({cx:e,cy:t,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"}).forEach((function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];return n.setAttribute(r,a)})),n},setLineStyle=function(e,t){e.setAttribute("stroke",t),e.setAttribute("stroke-dasharray","3 3"),e.setAttribute("vector-effect","non-scaling-stroke")},storeElementAttributes=function(e,t){var r=null;switch(e.tagName.toLowerCase()){case"text":r={x:isDef(e.x.baseVal[0])?e.x.baseVal[0].value:Number(e.getAttribute("x"))||0,y:isDef(e.y.baseVal[0])?e.y.baseVal[0].value:Number(e.getAttribute("y"))||0,textLength:isDef(e.textLength.baseVal)?e.textLength.baseVal.value:Number(e.getAttribute("textLength"))||null};break;case"circle":r={r:e.r.baseVal.value,cx:e.cx.baseVal.value,cy:e.cy.baseVal.value};break;case"foreignobject":case"image":case"rect":r={width:e.width.baseVal.value,height:e.height.baseVal.value,x:e.x.baseVal.value,y:e.y.baseVal.value};break;case"ellipse":r={rx:e.rx.baseVal.value,ry:e.ry.baseVal.value,cx:e.cx.baseVal.value,cy:e.cy.baseVal.value};break;case"line":r={resX1:e.x1.baseVal.value,resY1:e.y1.baseVal.value,resX2:e.x2.baseVal.value,resY2:e.y2.baseVal.value};break;case"polygon":case"polyline":r={points:e.getAttribute("points")};break;case"path":r={path:e.getAttribute("d")}}t.__data__.set(e,r)},renderLine$1=function(e,t,r){var a=_slicedToArray(e,2),n=a[0],o=a[1],i=createSVGElement("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),s={x1:n.x,y1:n.y,x2:o.x,y2:o.y,stroke:t,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return entries$1(s).forEach((function(e){var t=_slicedToArray(e,2),r=t[0],a=t[1];return i.setAttribute(r,a)})),i},_getBoundingRect$1=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getBBox(),a=r.x,n=r.y,o=r.width,i=r.height,s=[[a,n],[a+o,n],[a+o,n+i],[a,n+i]];return s.map((function(e){var r=_slicedToArray(e,2),a=r[0],n=r[1],o=pointTo(t,a,n);return[o.x,o.y]}))};function drag(e,t){if(this.length){var r=isDef(t)&&t instanceof Observable?t:new Observable;return arrReduce.call(this,(function(t,a){return a instanceof SVGElement?checkElement(a)&&t.push(new DraggableSVG(a,e,r)):t.push(new Draggable(a,e,r)),t}),[])}}var EMITTER_EVENTS$2=EVENT_EMITTER_CONSTANTS.EMITTER_EVENTS,E_MOUSEDOWN$4=CLIENT_EVENTS_CONSTANTS.E_MOUSEDOWN,E_TOUCHSTART$4=CLIENT_EVENTS_CONSTANTS.E_TOUCHSTART,Cloneable=function(e){_inherits(r,SubjectModel);var t=_createSuper(r);function r(e,a){var n;return _classCallCheck(this,r),(n=t.call(this,e)).enable(a),n}return _createClass(r,[{key:"_init",value:function(){var e=this,t=this.el,r=this.options,a=helper(t),n=r.style,o=r.appendTo,i=_objectSpread2({position:"absolute","z-index":"2147483647"},n);this.storage={css:i,parent:isDef(o)?helper(o)[0]:document.body},a.on(E_MOUSEDOWN$4,this._onMouseDown).on(E_TOUCHSTART$4,this._onTouchStart),EMITTER_EVENTS$2.slice(0,3).forEach((function(t){e.eventDispatcher.registerEvent(t)}))}},{key:"_processOptions",value:function(e){var t={},r=null,a=document,n=function(){},o=function(){},i=function(){},s=function(){};if(isDef(e)){var l=e.style,c=e.appendTo,u=e.stack,h=e.onInit,f=e.onMove,T=e.onDrop,_=e.onDestroy;t=isDef(l)&&"object"===_typeof(l)?l:t,r=c||null;var p=isDef(u)?helper(u)[0]:document;n=createMethod(h),o=createMethod(f),i=isFunc(T)?function(e){var t=this.storage.clone;objectsCollide(t,p)&&T.call(this,e,this.el,t)}:function(){},s=createMethod(_)}this.options={style:t,appendTo:r,stack:a},this.proxyMethods={onInit:n,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(e){var t=e.clientX,r=e.clientY,a=this.storage,n=this.el,o=a.parent,i=a.css,s=getOffset(o),l=s.left,c=s.top;i.left="".concat(t-l,"px"),i.top="".concat(r-c,"px");var u=n.cloneNode(!0);helper(u).css(i),a.clientX=t,a.clientY=r,a.cx=t,a.cy=r,a.clone=u,helper(o)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(e){var t=e.clientX,r=e.clientY,a=this.storage;a.clientX=t,a.clientY=r,a.doDraw=!0,a.doMove=!0}},{key:"_end",value:function(e){var t=this.storage,r=t.clone,a=t.frameId;t.doDraw=!1,cancelAnimFrame(a),isUndef(r)||(this.proxyMethods.onDrop.call(this,e),r.parentNode.removeChild(r),delete t.clone)}},{key:"_animate",value:function(){var e=this.storage;e.frameId=requestAnimFrame(this._animate);var t=e.doDraw,r=e.clientX,a=e.clientY,n=e.cx,o=e.cy;t&&(e.doDraw=!1,this._drag({dx:r-n,dy:a-o}))}},{key:"_processMove",value:function(e,t){var r=this.storage.clone,a="translate(".concat(e,"px, ").concat(t,"px)");helper(r).css({transform:a,webkitTranform:a,mozTransform:a,msTransform:a,otransform:a})}},{key:"_destroy",value:function(){var e=this.storage,t=this.proxyMethods,r=this.el;isUndef(e)||(helper(r).off(E_MOUSEDOWN$4,this._onMouseDown).off(E_TOUCHSTART$4,this._onTouchStart),t.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),r}();function clone(e){if(this.length)return arrMap.call(this,(function(t){return new Cloneable(t,e)}))}var Subjx=function(e){_inherits(r,Helper);var t=_createSuper(r);function r(){return _classCallCheck(this,r),t.apply(this,arguments)}return _createClass(r,[{key:"drag",value:function(){return drag.call.apply(drag,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return clone.call.apply(clone,[this].concat(Array.prototype.slice.call(arguments)))}}]),r}();function subjx(e){return new Subjx(e)}Object.defineProperty(subjx,"createObservable",{value:function(){return new Observable}}),Object.defineProperty(subjx,"Subjx",{value:Subjx}),Object.defineProperty(subjx,"Observable",{value:Observable}),module.exports=subjx;
