/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function tt(a){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,r,n;e=a,n=o[r=t],r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(o,t))})}return a}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function q(t){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function C(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(n){return function(){var t,e=q(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var r=q(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}(this,t)}}function Z(t,e,r){return(Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=q(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(r):a.value}})(t,e,r||t)}function ie(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw o}}return r}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function F(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function U(t){return null==t}function V(t){return"function"==typeof t}function et(t){return V(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var $=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},g=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,h=t.forEach,f=t.slice,v=t.map,p=t.reduce,se=console.warn,W=function(t){return null!=t},d=function(){function o(t){if(i(this,o),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==K(t)||1!==t.nodeType&&t!==document)if(t instanceof o){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!function(t){return W(t)&&"object"===K(t)&&(Array.isArray(t)||W(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||W(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=t.length;for(var a=0;a<this.length;a++)1===t[a].nodeType&&(this[a]=t[a])}else this[0]=t,this.length=1}return r(o,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,f.call(arguments,1)):"object"!==K(r)&&r?(se("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.addEventListener?this[a].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[a].attachEvent("on".concat(t),e):this[a]["on".concat(t)]=e:y(this[a],t,e,r,n,!0);return this}},{key:"off",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[a].removeEventListener(t,e,r):document.detachEvent?this[a].detachEvent("on".concat(t),e):this[a]["on".concat(t)]=null:y(this[a],t,e,r,n,!1);return this}},{key:"is",value:function(t){if(U(t))return!1;for(var e=rt(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),o}();function y(t,e,r,n,a,o){function i(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,a||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,a||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function rt(t){return new d(t)}function Q(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0}function ce(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}function k(r,t){for(var e=1<arguments.length&&void 0!==t?t:2,n=[],a=function(e){var t=r.map(function(t){return t[e]});n.push([Math.min.apply(Math,F(t)),Math.max.apply(Math,F(t))])},o=0;o<e;o++)a(o);return n}function b(t){return t.getBoundingClientRect()}function nt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function J(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function at(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function x(t,e){var r,n=window.getComputedStyle(t),a=null,o=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=l(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){i=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}(P);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(a=n.getPropertyValue("".concat(i).concat(e))||a)break}}catch(t){o.e(t)}finally{o.f()}return a}function m(t){return t.map(function(t){return F(t)})}function ot(n){return n.reduce(function(t,e,r){return[].concat(F(t),[n[0][r],n[1][r],n[2][r],n[3][r]])},[])}function it(t){return F(Array(0<arguments.length&&void 0!==t?t:4)).map(function(t,e,r){return r.map(function(){return+!e--})})}function st(r,n,t){var a=2<arguments.length&&void 0!==t?t:0;return it().map(function(t,e){return t[3]=[r,n,a,1][e],t})}function ct(t,e){var r=!(1<arguments.length&&void 0!==e)||e?m(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r}function lt(t,e){for(var r=[],n=0,a=t.length;n<a;++n){for(var o=0,i=0;i<a;++i)o+=+t[n][i]*e[i];r[n]=o}return r}function ut(t,e){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var a=0;a<t[0].length;a++){for(var o=0,i=0;i<t.length;i++)o+=t[i][a]*e[n][i];r[n].push(o)}}return r}function ht(t){for(var e,r=m(t),n=r.length,a=[],o=0;o<n;o++)a[o]=[];for(var i=0;i<n;i++)for(var s=0;s<n;s++)a[i][s]=0,i==s&&(a[i][s]=1);for(var c=0;c<n;c++){e=r[c][c];for(var l=0;l<n;l++)r[c][l]/=e,a[c][l]/=e;for(var u=c+1;u<n;u++){e=r[u][c];for(var h=0;h<n;h++)r[u][h]-=r[c][h]*e,a[u][h]-=a[c][h]*e}}for(var f=n-1;0<f;f--)for(var v=f-1;0<=v;v--){e=r[v][f];for(var p=0;p<n;p++)r[v][p]-=r[f][p]*e,a[v][p]-=a[f][p]*e}for(var d=0;d<n;d++)for(var y=0;y<n;y++)r[d][y]=a[d][y];return r}function ft(t,e,r){for(var n,a,o,i,s,c,l,u=1<arguments.length&&void 0!==e?e:document.body,h=2<arguments.length?r:void 0,f=it(),v=t,p=h||Se(v),d=!1;v&&v instanceof Element;){var y=Re(v,d);if(f=ut(f,(n=p,void 0,a=ie(y,3),o=a[0],i=a[1],s=a[2],c=st(-o,-i,-s),l=st(o,i,s),ut(ut(c,n),l))),d=!0,v===u||null===v.offsetParent)break;v=v.offsetParent,p=Se(v)}return f}function vt(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),n=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]),a=Math.atan2(-t[0][3]/n,t[1][3]/n),o=Math.asin(t[3][1]/n),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=t[a=0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:a,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/n},scale:{sX:e,sY:r,sZ:n}}}function pt(t,e){for(var r=1<arguments.length&&void 0!==e?e:document.body,n=0,a=0,o=!1;t;){var i=ft(t.offsetParent),s=ie(lt(ct(i,!1),[t.offsetLeft+(o?t.clientLeft:0),t.offsetTop+(o?t.clientTop:0),0,1]),2);if(a+=s[0],n+=s[1],r===t)break;o=!0,t=t.offsetParent}return[a,n,0,1]}var dt=2,A="#00a8ff",yt="sjx-",_="dragStart",E="drag",T="dragEnd",w="resizeStart",M="resize",O="resizeEnd",S="rotateStart",R="rotate",N="rotateEnd",j="setPointStart",D="setPointEnd",P=["","-webkit-","-moz-","-ms-","-o-"],Y="ongetstate",X="onapply",B="onmove",L="onresize",H="onrotate",z={NOTIFIER_EVENTS:[Y,X,B,L,H],ON_GETSTATE:Y,ON_APPLY:X,ON_MOVE:B,ON_RESIZE:L,ON_ROTATE:H},I={EMITTER_EVENTS:[_,E,,T,w,M,O,S,R,N,j,D],E_DRAG_START:_,E_DRAG:E,E_DRAG_END:T,E_RESIZE_START:w,E_RESIZE:M,E_RESIZE_END:O,E_ROTATE_START:S,E_ROTATE:R,E_ROTATE_END:N,E_SET_POINT_START:j,E_SET_POINT_END:D},G="mousedown",bt="mouseup",xt="mousemove",mt="touchstart",gt="touchend",_t="touchmove",Et={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},Tt={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},wt=z.ON_GETSTATE,kt=z.ON_APPLY,Mt=z.ON_MOVE,Ot=z.ON_RESIZE,St=z.ON_ROTATE,Rt=function(){function t(){i(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return U(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(W(r[t])){var n=r[t].indexOf(e);r[t].splice(n,1)}return this}},{key:"notify",value:function(e,r,n){U(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case Mt:t.notifyMove(n);break;case St:t.notifyRotate(n);break;case Ot:t.notifyResize(n);break;case kt:t.notifyApply(n);break;case wt:t.notifyGetState(n)}})}}]),t}(),Vt=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return r(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}(),At=function(){function t(){i(this,t),this.events={}}return r(t,[{key:"registerEvent",value:function(t){this.events[t]=new Vt(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),Nt=I.E_DRAG,jt=xt,Dt=bt,Pt=_t,Ct=gt,Yt=function(){function e(t){i(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new At,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){Xt()}},{key:"_init",value:function(){Xt()}},{key:"_destroy",value:function(){Xt()}},{key:"_processOptions",value:function(){Xt()}},{key:"_start",value:function(){Xt()}},{key:"_moving",value:function(){Xt()}},{key:"_end",value:function(){Xt()}},{key:"_animate",value:function(){Xt()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,n=C(t,["dx","dy"]),a=tt({dx:e,dy:r,transform:this._processMove(e,r)},n);this.proxyMethods.onMove.call(this,a),this._emitEvent(Nt,a)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),rt(document).on(jt,this._onMouseMove).on(Dt,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),rt(document).on(Pt,this._onTouchMove).on(Ct,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){rt(document).off(jt,this._onMouseMove).off(Dt,this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){rt(document).off(Pt,this._onTouchMove).off(Ct,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),Xt=function(){throw Error("Method not implemented")},Bt=Math.PI/180,Lt=z.NOTIFIER_EVENTS,Ht=z.ON_GETSTATE,zt=z.ON_APPLY,It=z.ON_MOVE,Gt=z.ON_RESIZE,Wt=z.ON_ROTATE,Ft=I.EMITTER_EVENTS,qt=I.E_DRAG_START,Zt=I.E_DRAG,Ut=I.E_DRAG_END,$t=I.E_RESIZE_START,Qt=I.E_RESIZE,Jt=I.E_RESIZE_END,Kt=I.E_ROTATE_START,te=I.E_ROTATE,ee=I.E_ROTATE_END,re=Et,ne=Tt,ae=G,oe=mt,le=xt,ue=bt,he=_t,fe=gt,ve=re.TOP_LEFT,pe=re.TOP_CENTER,de=re.TOP_RIGHT,ye=re.BOTTOM_LEFT,be=re.BOTTOM_RIGHT,xe=re.BOTTOM_CENTER,me=re.MIDDLE_LEFT,ge=re.MIDDLE_RIGHT,_e=ne.TOP_EDGE,Ee=ne.BOTTOM_EDGE,Te=ne.LEFT_EDGE,we=ne.RIGHT_EDGE,ke=Object.keys,Me=Object.values,Oe=function(){o(F,Yt);var a=c(F);function F(t,e,r){var n;if(i(this,F),(n=a.call(this,t)).constructor===F)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,Ft.forEach(function(t){return n.eventDispatcher.registerEvent(t)}),Z(q(F.prototype),"enable",s(n)).call(s(n),e),n}return r(F,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,r=C(t,["radians"]),n=tt({transform:this._processRotate(e),delta:e},r);this.proxyMethods.onRotate.call(this,n),Z(q(F.prototype),"_emitEvent",this).call(this,te,n)}},{key:"_resize",value:function(t){var e=t.dx,r=t.dy,n=C(t,["dx","dy"]),a=tt({},this._processResize(e,r),{dx:e,dy:r},n);this.proxyMethods.onResize.call(this,a),Z(q(F.prototype),"_emitEvent",this).call(this,Qt,a)}},{key:"_processOptions",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},r=this.el;nt(r,"".concat(yt,"drag"));var n=e.each,a=void 0===n?{move:!1,resize:!1,rotate:!1}:n,o=e.snap,i=void 0===o?{x:10,y:10,angle:10}:o,s=e.axis,c=void 0===s?"xy":s,l=e.cursorMove,u=void 0===l?"auto":l,h=e.cursorResize,f=void 0===h?"auto":h,v=e.cursorRotate,p=void 0===v?"auto":v,d=e.rotationPoint,y=void 0!==d&&d,b=e.restrict,x=e.draggable,m=void 0===x||x,g=e.resizable,_=void 0===g||g,E=e.rotatable,T=void 0===E||E,w=e.scalable,k=void 0!==w&&w,M=e.applyTranslate,O=void 0!==M&&M,S=e.onInit,R=void 0===S?function(){}:S,V=e.onDrop,A=void 0===V?function(){}:V,N=e.onMove,j=void 0===N?function(){}:N,D=e.onResize,P=void 0===D?function(){}:D,C=e.onRotate,Y=void 0===C?function(){}:C,X=e.onDestroy,B=void 0===X?function(){}:X,L=e.container,H=void 0===L?r.parentNode:L,z=e.controlsContainer,I=void 0===z?H:z,G=e.proportions,W=void 0!==G&&G,F=e.rotatorAnchor,q=void 0===F?null:F,Z=e.rotatorOffset,U=void 0===Z?50:Z,$=e.showNormal,Q=void 0===$||$,J=e.custom;this.options={axis:c,cursorMove:u,cursorRotate:p,cursorResize:f,rotationPoint:y,restrict:b?rt(b)[0]||document.body:null,container:rt(H)[0],controlsContainer:rt(I)[0],snap:tt({},i,{angle:i.angle*Bt}),each:a,proportions:W,draggable:m,resizable:_,rotatable:T,scalable:k,applyTranslate:O,custom:"object"===K(J)&&J||null,rotatorAnchor:q,rotatorOffset:U,showNormal:Q},this.proxyMethods={onInit:et(R),onDrop:et(A),onMove:et(j),onResize:et(P),onRotate:et(Y),onDestroy:et(B)},this.subscribe(a)}},{key:"_animate",value:function(){var t=this,e=t.observable,r=t.storage,n=t.options;if(!U(r)&&(r.frame=$(t._animate),r.doDraw)){r.doDraw=!1;var a=r.dox,o=r.doy,i=r.clientX,s=r.clientY,c=r.doDrag,l=r.doResize,u=r.doRotate,h=r.doSetCenter,f=r.revX,v=r.revY,p=r.mouseEvent,d=n.snap,y=n.each,b=y.move,x=y.resize,m=y.rotate,g=n.draggable,_=n.resizable,E=n.rotatable;if(l&&_){var T=r.transform,w=T.scX,k=T.scY,M=r.cx,O=r.cy,S=this._pointToElement({x:i,y:s}),R=S.x,V=S.y,A=a?Q(R-M,d.x/w):0,N=o?Q(V-O,d.y/k):0,j={dx:A=a?f?-A:A:0,dy:N=o?v?-N:N:0,clientX:i,clientY:s,mouseEvent:p};t._resize(j),x&&e.notify(Gt,t,j)}if(c&&g){var D=r.nx,P=r.ny,C={dx:a?Q(i-D,d.x):0,dy:o?Q(s-P,d.y):0,clientX:i,clientY:s,mouseEvent:p};Z(q(F.prototype),"_drag",this).call(this,C),b&&e.notify(It,t,C)}if(u&&E){var Y=r.pressang,X=r.center,B=Math.atan2(s-X.y,i-X.x)-Y,L={clientX:i,clientY:s,mouseEvent:p};t._rotate(tt({radians:Q(B,d.angle)},L)),m&&e.notify(Wt,t,tt({radians:B},L))}if(h&&E){var H=r.bx,z=r.by,I=this._pointToControls({x:i,y:s}),G=I.x,W=I.y;t._moveCenterHandle(G-H,W-z)}}}},{key:"_start",value:function(e){var t=e.clientX,r=e.clientY,n=this.observable,a=this.storage,o=this.storage.handles,i=this.options,s=i.axis,c=i.each,l=this.el,u=Me(o).some(function(t){return rt(e.target).is(t)})||l.contains(e.target);if(a.isTarget=u){var h=this._compute(e,l);ke(h).map(function(t){return a[t]=h[t]});var f=h.onRightEdge,v=h.onBottomEdge,p=h.onTopEdge,d=h.onLeftEdge,y=h.handle,b=h.factor,x=h.revX,m=h.revY,g=h.doW,_=h.doH,E=f||v||p||d,T=o.rotator,w=o.center,k=o.radius;W(k)&&J(k,"".concat(yt,"hidden"));var M=y.is(T),O=!!W(w)&&y.is(w),S=l.contains(e.target)&&!(M||E||O),R=this._cursorPoint({clientX:t,clientY:r}),V=R.x,A=R.y,N=this._pointToElement({x:V,y:A}),j=N.x,D=N.y,P=this._pointToControls({x:V,y:A}),C=P.x,Y=P.y,X={mouseEvent:e,clientX:t,clientY:r,cx:j,cy:D,nx:V,ny:A,bx:C,by:Y,doResize:E,doDrag:S,doRotate:M,doSetCenter:O,onExecution:!0,cursor:null,dox:/\x/.test(s)&&(!E||(y.is(o.ml)||y.is(o.mr)||y.is(o.tl)||y.is(o.tr)||y.is(o.bl)||y.is(o.br)||y.is(o.le)||y.is(o.re))),doy:/\y/.test(s)&&(!E||(y.is(o.br)||y.is(o.bl)||y.is(o.bc)||y.is(o.tr)||y.is(o.tl)||y.is(o.tc)||y.is(o.te)||y.is(o.be))),cached:{}};this.storage=tt({},a,{},X);var B={clientX:t,clientY:r};E?Z(q(F.prototype),"_emitEvent",this).call(this,$t,B):M?Z(q(F.prototype),"_emitEvent",this).call(this,Kt,B):S&&Z(q(F.prototype),"_emitEvent",this).call(this,qt,B);var L=c.move,H=c.resize,z=c.rotate,I=E?Qt:M?te:Zt,G=E&&H||M&&z||S&&L;n.notify(Ht,this,{clientX:t,clientY:r,actionName:I,triggerEvent:G,factor:b,revX:x,revY:m,doW:g,doH:_}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,n=this.options;if(r.isTarget){var a=this._cursorPoint(t),o=a.x,i=a.y;r.mouseEvent=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,c=r.doDrag,l=r.doResize,u=r.cursor,h=n.cursorMove,f=n.cursorResize,v=n.cursorRotate;U(u)&&(c?u=h:s?u=v:l&&(u=f),rt(document.body).css({cursor:u}))}}},{key:"_end",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.each,a=this.observable,o=this.storage,i=this.storage,s=i.doResize,c=i.doDrag,l=i.doRotate,u=i.frame,h=i.handles.radius,f=i.isTarget,v=this.proxyMethods;if(f){var p=s?Qt:c?Zt:te;o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(p);var d={clientX:e,clientY:r};v.onDrop.call(this,d),s?Z(q(F.prototype),"_emitEvent",this).call(this,Jt,d):l?Z(q(F.prototype),"_emitEvent",this).call(this,ee,d):c&&Z(q(F.prototype),"_emitEvent",this).call(this,Ut,d);var y=n.move,b=n.resize,x=n.rotate,m=s&&b||l&&x||c&&y;a.notify(zt,this,{clientX:e,clientY:r,actionName:p,triggerEvent:m}),g(u),rt(document.body).css({cursor:"auto"}),W(h)&&nt(h,"".concat(yt,"hidden"))}}},{key:"_compute",value:function(e,t){var r=this.storage.handles,n=rt(e.target),a=this._checkHandles(n,r),o=a.revX,i=a.revY,s=a.doW,c=a.doH,l=C(a,["revX","revY","doW","doH"]),u=this._getState({revX:o,revY:i,doW:s,doH:c}),h=this._cursorPoint(e),f=h.x,v=h.y,p=Math.atan2(v-u.center.y,f-u.center.x);return tt({},u,{},l,{handle:Me(r).some(function(t){return rt(e.target).is(t)})?n:rt(t),pressang:p})}},{key:"_checkHandles",value:function(e,r){function t(t){return t.some(function(t){return function(t){return!!W(t)&&e.is(t)}(r[t])})}return{revX:t([ve,me,ye,pe,Te]),revY:t([ve,de,pe,me,_e]),onTopEdge:t([pe,de,ve,_e]),onLeftEdge:t([ve,me,ye,Te]),onRightEdge:t([de,ge,be,we]),onBottomEdge:t([be,xe,ye,Ee]),doW:t([me,ge,Te,we]),doH:t([pe,xe,Ee,_e])}}},{key:"_restrictHandler",value:function(t){for(var e=null,r=null,n=this.getBoundingRect(t),a=this._getRestrictedBBox(),o=ie(k(a),2),i=ie(o[0],2),s=i[0],c=i[1],l=ie(o[1],2),u=l[0],h=l[1],f=0,v=n.length;f<v;f++){var p=ie(n[f],2),d=p[0],y=p[1];(d<s||c<d)&&(e=d),(y<u||h<y)&&(r=y)}return{x:e,y:r}}},{key:"_destroy",value:function(){var e=this,t=this.el,r=this.storage,n=r.controls,a=r.wrapper;[t,n].map(function(t){return rt(t).off(ae,e._onMouseDown).off(oe,e._onTouchStart)}),a.parentNode.removeChild(a)}},{key:"notifyMove",value:function(){Z(q(F.prototype),"_drag",this).apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=C(t,["radians"]),n=this.options.snap.angle;this._rotate(tt({radians:Q(e,n)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:r}),a&&(this._apply(n),Z(q(F.prototype),"_emitEvent",this).call(this,"".concat(n,"End"),{clientX:e,clientY:r}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent,o=C(t,["clientX","clientY","actionName","triggerEvent"]);if(a){var i=this._getState(o);this.storage=tt({},this.storage,{},i),Z(q(F.prototype),"_emitEvent",this).call(this,"".concat(n,"Start"),{clientX:e,clientY:r})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,a=this.observable;(r||e||n)&&a.subscribe(Ht,this).subscribe(zt,this),r&&a.subscribe(It,this),e&&a.subscribe(Gt,this),n&&a.subscribe(Wt,this)}},{key:"unsubscribe",value:function(){var e=this,r=this.observable;Lt.map(function(t){return r.unsubscribe(t,e)})}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;U(t)||(t.onExecution&&rt(document).off(le,this._onMouseMove).off(ue,this._onMouseUp).off(he,this._onTouchMove).off(fe,this._onTouchEnd),J(r,"".concat(yt,"drag")),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,r=t.dy;this.options.draggable&&(this.storage=tt({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),Z(q(F.prototype),"_drag",this).call(this,{dx:e,dy:r}),this._apply(Zt))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,n=t.revX,a=void 0!==n&&n,o=t.revY,i=void 0!==o&&o,s=t.doW,c=void 0!==s&&s,l=t.doH,u=void 0!==l&&l;this.options.resizable&&(this.storage=tt({},this.storage,{},this._getState({revX:a,revY:i,doW:c,doH:u})),this._resize({dx:e,dy:r}),this._apply(Qt))}},{key:"exeRotate",value:function(t){var e=t.delta;this.options.rotatable&&(this.storage=tt({},this.storage,{},this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:e}),this._apply(te))}},{key:"controls",get:function(){return this.storage.wrapper}}]),F}(),Se=function(t){var e=x(t,"transform")||"none",r=it();if("none"===e)return r;var n=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==n.length)return[[+n[0],+n[2],0,+n[4]],[+n[1],+n[3],0,+n[5]],[0,0,1,0],[0,0,0,1]];for(var a=0;a<4;++a)for(var o=0;o<4;++o)r[o][a]=+n[4*a+o];return r},Re=function(t,e){for(var r=x(t,"transform-origin"),n=r?r.split(" "):[],a=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1],o=0;o<n.length;++o)a[o]+=parseFloat(n[o]);return a},Ve=G,Ae=mt,Ne=Object.keys,je=Object.entries,De=Object.values,Pe=function(){o(e,Oe);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(r){var e=this,t=this.options,n=t.rotationPoint,a=t.container,o=t.controlsContainer,i=t.resizable,s=t.rotatable,c=t.showNormal,l=r.offsetLeft,u=r.offsetTop,h=r.offsetHeight,f=r.offsetWidth,v=Le(["sjx-wrapper"]),p=Le(["sjx-controls"]),d={},y=ft(r,a),b=ie(pt(r,a),2),x=b[0],m=b[1],g=["data-sjx-cx","data-sjx-cy"].map(function(t){var e=r.getAttribute(t);return W(e)?Number(e):void 0}),_=g.every(function(t){return!isNaN(t)}),E=this._calculateVertices(y),T=E.rotator,w=void 0===T?null:T,k=E.anchor,M=void 0===k?null:k,O=C(E,["rotator","anchor"]),S={};if(s){var R=c?Ye([[M.x,M.y],w],"normal"):null;c&&p.appendChild(R);var V=null;n&&(V=Ye([O.center,O.center],"radius"),nt(V,"sjx-hidden"),p.appendChild(V)),S=tt({},S,{normal:R,radius:V})}function A(n,a){return Ne(n).map(function(t){var e=n[t];if(!U(e)){var r=a(e,t);d[t]=r,p.appendChild(r)}})}var N={te:[O.tl,O.tr],be:[O.bl,O.br],le:[O.tl,O.bl],re:[O.tr,O.br]},j=i?{tl:O.tl,tr:O.tr,br:O.br,bl:O.bl,tc:O.tc,bc:O.bc,ml:O.ml,mr:O.mr}:{},D=_?[].concat(F(g),[0,1]):O.center,P=tt({},j,{center:n&&s?D:void 0,rotator:w});A(N,Ye),A(P,Ce),v.appendChild(p),o.appendChild(v),this.storage={wrapper:v,controls:p,handles:tt({},d,{},S),parent:r.parentNode,center:{isShifted:_},transform:{ctm:y},bBox:{width:f,height:h,left:l,top:u,offset:{left:x,top:m}},cached:{}},[r,p].map(function(t){return rt(t).on(Ve,e._onMouseDown).on(Ae,e._onTouchStart)})}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm,a=ht(n);return this._applyMatrixToPoint(ct(a,!1),e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.wrapperMatrix,a=ht(n);return this._applyMatrixToPoint(ct(a,!1),e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=ie(lt(t,[e,r,0,1]),2);return{x:n[0],y:n[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container,a=ft(n);return this._applyMatrixToPoint(ht(a),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t,r=this.storage.transform.containerMatrix,n=this.options,a=n.restrict,o=n.container,i=a||o;return Be(i,o,e?ft(i,o):r)}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.cached,n=e.controls,a=e.transform.matrix,o=e.center,i=this.options.applyTranslate,s=rt(n);if(!U(r)){if(t.setAttribute("data-sjx-cx",o.elX),t.setAttribute("data-sjx-cy",o.elY),i){var c=rt(t),l=r.dx,u=r.dy,h=at(a),f=parseFloat(t.style.left||c.css("left")),v=parseFloat(t.style.top||c.css("top"));h.left="".concat(f+l,"px"),h.top="".concat(v+u,"px"),c.css(h),s.css(h)}this.storage.cached={}}}},{key:"_processResize",value:function(t,e){function r(t,e){var r=_||!_&&!E?(b+t)/b:(x+e)/x,n=w?b*r:b+t,a=w?x*r:x+e;return[n/b,a/x,n,a]}function n(t,e){var r=function(r,n,t,e){var a=2<arguments.length&&void 0!==t?t:1,o=3<arguments.length&&void 0!==e?e:1;return it().map(function(t,e){return t[e]=[r,n,a,o][e],t})}(t,e);return ut(ut(l,r),ht(l))}function a(t,e){var r=t[0][3],n=t[1][3],a=st(r,n),o=st(r*(m?-1:1),n*(g?-1:1));return ut(ut(o,e),ht(a))}var o=this.storage,i=this.storage,s=i.transform,c=s.matrix,l=s.auxiliary.scale.translateMatrix,u=i.cached,h=(u=void 0===u?{}:u).dist,f=(h=void 0===h?{}:h).dx,v=void 0===f?t:f,p=h.dy,d=void 0===p?e:p,y=i.bBox,b=y.width,x=y.height,m=i.revX,g=i.revY,_=i.doW,E=i.doH,T=this.options,w=T.proportions,k=T.scalable,M=T.restrict,O=ie(r(t,e),4),S=O[0],R=O[1],V=O[2],A=O[3],N=n(S,R),j=k?ut(N,c):a(N,c);this.storage.cached.bBox={width:V,height:A};var D=M?this._restrictHandler(j):{x:null,y:null},P=D.x,C=D.y,Y=(null!==P||null!==C)&&M,X=Y?v:t,B=Y?d:e,L=ie(r(X,B),4),H=L[0],z=L[1],I=L[2],G=L[3],W=n(H,z),F=k?ut(W,c):a(W,c);return I<=dt||G<=dt||(this._updateElementView(tt({},at(ot(F)),{},!k&&{width:"".concat(I,"px"),height:"".concat(G,"px")})),this._applyTransformToHandles({boxMatrix:F}),o.cached.dist={dx:X,dy:B}),{transform:F,width:I,height:G}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=this.storage,a=n.transform,o=a.matrix,i=a.wrapperMatrix,s=a.auxiliary.translate.parentMatrix,c=n.center,l=n.cached,u=(l=void 0===l?{}:l).dist,h=(u=void 0===u?{}:u).dx,f=void 0===h?t:h,v=u.dy,p=void 0===v?e:v,d=this.options.restrict,y=ie(lt(s,[t,e,0,1]),2),b=y[0],x=y[1],m=ut(o,st(b,x)),g=d?this._restrictHandler(m):{x:null,y:null},_=null!==g.x&&d?f:t,E=null!==g.y&&d?p:e,T=ie(lt(s,[_,E,0,1]),2),w=T[0],k=T[1],M=ut(o,st(w,k)),O=ut(i,st(_,E)),S=at(ot(M)),R=at(ot(O));return this._updateElementView(S),this._updateWrapperView(R),r.cached.dist={dx:_,dy:E,ox:w,oy:k},c.isShifted,M}},{key:"_processRotate",value:function(t){var e=this.storage.transform,r=e.matrix,n=e.auxiliary.rotate.translateMatrix,a=this.options.restrict,o=ce(Math.cos(t),4),i=function(t,e){var r=it();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r}(ce(Math.sin(t),4),o),s=ut(ut(ht(n),i),n),c=ut(r,s),l=a?this._restrictHandler(c):{x:null,y:null},u=l.x,h=l.y;return W(u)||W(h)||(this._updateElementView(at(ot(c))),this._applyTransformToHandles({boxMatrix:c})),c}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,i=this.storage,s=i.handles.center,c=i.parent,l=i.wrapper,u=i.center,h=this.options,f=h.container,v=h.restrict,p=h.scalable,d=v||f,y=d.offsetWidth,b=d.offsetHeight,x=ie(pt(o,f),2),m=x[0],g=x[1],_=o.offsetLeft,E=o.offsetTop,T=o.offsetWidth,w=o.offsetHeight,k=Se(o),M=ft(o,f),O=ft(c,f),S=ft(l,f),R=v?ft(v,v.parentNode):ft(f,f.parentNode),V=T/2,A=w/2,N=a?0:e?-V:V,j=n?0:r?-A:A,D=ie(lt(M,[V,A,0,1]),2),P=D[0]+m,C=D[1]+g,Y=s?Se(s):it(),X=(s?vt(ft(s)):{translate:{x:P,y:C}}).translate,B=X.x,L=X.y,H=ie(lt(ut(ht(ct(M)),ct(Y)),[B-P,L-C,0,1]),2),z=H[0],I=H[1],G=ie(lt(k,[z,I,0,1]),2),W=G[0],F=G[1],q=lt(ct(R),[y,b,0,1]),Z=vt(ft(o,o.parentNode)).scale,U=Z.sX,$=Z.sY;return{transform:{auxiliary:{scale:{translateMatrix:p?st(N,j):st(a?0:V,n?0:A)},translate:{parentMatrix:ht(ct(O))},rotate:{translateMatrix:st(W,F)}},scaleX:N,scaleY:j,matrix:k,ctm:M,parentMatrix:O,containerMatrix:R,wrapperMatrix:S,scX:U,scY:$,containerBox:q},bBox:{width:T,height:w,left:_,top:E,offset:{left:m,top:g}},center:tt({},u,{x:P,y:C,elX:W,elY:F,matrix:Y}),revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,a=r.center.matrix,o=ut(a,st(t,e));rt(n).css(tt({},at(ot(o)))),this.storage.center.isShifted=!0}},{key:"_updateElementView",value:function(t){rt(this.el).css(t)}},{key:"_updateWrapperView",value:function(t){rt(this.storage.wrapper).css(t)}},{key:"_calculateVertices",value:function(o){var i=this.el,t=this.options,e=t.rotatable,r=t.rotatorAnchor,n=t.rotatorOffset,s=t.container,a=i.offsetHeight,c=i.offsetWidth,l=ie(pt(i,s),2),u=l[0],h=l[1],f=je({tl:[0,0,0,1],bl:[0,a,0,1],br:[c,a,0,1],tr:[c,0,0,1],tc:[c/2,0,0,1],ml:[0,a/2,0,1],bc:[c/2,a,0,1],mr:[c,a/2,0,1],center:[c/2,a/2,0,1]}).reduce(function(t,e){var r=ie(e,2),n=r[0],a=r[1];return[].concat(F(t),[[n,lt(o||ft(i,s),a)]])},[]).reduce(function(t,e){var r=ie(e,2),n=r[0],a=ie(r[1],4),o=a[0],i=a[1],s=a[2],c=a[3];return t[n]=[o+u,i+h,s,c],t},{}),v=null;if(e){var p={},d=1;switch(r){case"n":p.x=f.tc[0],p.y=f.tc[1];break;case"s":p.x=f.bc[0],p.y=f.bc[1],d=-1;break;case"w":p.x=f.ml[0],p.y=f.ml[1],d=-1;break;case"e":default:p.x=f.mr[0],p.y=f.mr[1]}var y="n"===r||"s"===r?Math.atan2(f.bl[1]-f.tl[1],f.bl[0]-f.tl[0]):Math.atan2(f.tl[1]-f.tr[1],f.tl[0]-f.tr[0]);v=[p.x-n*d*Math.cos(y),p.y-n*d*Math.sin(y)],f.rotator=v,f.anchor=p}return f}},{key:"_applyTransformToHandles",value:function(){var t=this.el,e=this.storage,r=e.wrapper,l=e.handles,n=e.transform,a=(n=void 0===n?{}:n).wrapperMatrix,o=void 0===a?ft(r,r.parentNode):a,i=e.center.isShifted,s=this.options,c=s.rotatable,u=s.resizable,h=s.showNormal,f=s.container,v=ut(ft(t,f),ht(o)),p=this._calculateVertices(v),d=p.anchor,y=void 0===d?null:d,b=p.center,x=C(p,["anchor","center"]),m=null,g={};c&&(m=h?[[y.x,y.y],x.rotator]:null,g={rotator:x.rotator});var _=tt({te:[x.tl,x.tr],be:[x.bl,x.br],le:[x.tl,x.bl],re:[x.tr,x.br]},h&&m&&{normal:m});Ne(_).forEach(function(t){var e=ie(_[t],2),r=e[0],n=e[1],a=Xe(r,n),o=a.cx,i=a.cy,s=a.length,c=a.theta;rt(l[t]).css({transform:"translate(".concat(o,"px, ").concat(i,"px) rotate(").concat(c,"deg)"),width:"".concat(s,"px")})});var E=tt({},u&&x,{},g,{},!i&&Boolean(b)&&{center:b});Ne(E).forEach(function(t){var e=l[t],r=E[t];if(!U(r)&&!U(e)){var n=ie(r,2),a=n[0],o=n[1];rt(e).css({transform:"translate(".concat(a,"px, ").concat(o,"px)")})}})}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.el,r=e.offsetHeight,n=e.offsetWidth,a=this.storage,o=a.wrapper,i=a.handles.center,s=this.options.container;if(i){var c=ie(pt(t,s),2),l=c[0],u=c[1],h=ut(ft(t,s),ht(ft(o,o.parentNode))),f=ie(lt(h,[n/2,r/2,0,1]),2),v=f[0],p=f[1];rt(i).css({transform:"translate(".concat(v+l,"px, ").concat(p+u,"px)")})}}},{key:"fitControlsToSize",value:function(){var t=it();this.storage=tt({},this.storage,{transform:tt({},this.storage.transform||{},{wrapperMatrix:t})}),this._updateWrapperView(at(ot(t))),this._applyTransformToHandles()}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,r=this.el,n=this.options,a=n.scalable,o=n.restrict,i=n.container,s=this.storage,c=s.bBox,l=s.bBox,u=l.width,h=l.height,f=s.cached,v=(f=void 0===f?{}:f).bBox,p=(v=void 0===v?{}:v).width,d=void 0===p?u:p,y=v.height,b=a?c:tt({},c,{width:d,height:void 0===y?h:y}),x=o||i;return Be(r,x,ft(r,x,e),b)}},{key:"applyAlignment",value:function(t){var e=this.options.container,r=this._calculateVertices(),n=(r.anchor,r.rotator,r.center,C(r,["anchor","rotator","center"])),a=this._getRestrictedBBox(!0),o=De(n),i=ie(k(a),2),s=ie(i[0],2),c=s[0],l=s[1],u=ie(i[1],2),h=u[0],f=u[1],v=ie(k(o),2),p=ie(v[0],2),d=p[0],y=p[1],b=ie(v[1],2),x=b[0],m=b[1],g=ie(lt(ht(ct(ft(this.el.parentNode,e))),[function(){switch(!0){case/[l]/.test(t):return c-d;case/[r]/.test(t):return l-y;case/[h]/.test(t):return(l+c)/2-(y+d)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(t):return h-x;case/[b]/.test(t):return f-m;case/[v]/.test(t):return(f+h)/2-(m+x)/2;default:return 0}}(),0,1]),2),_=g[0],E=g[1],T=ut(Se(this.el),st(_,E));this._updateElementView(at(ot(T))),this.fitControlsToSize()}}]),e}(),Ce=function(t,e,r){var n=ie(t,2),a=n[0],o=n[1],i=2<arguments.length&&void 0!==r?r:{},s=Le(["sjx-hdl","sjx-hdl-".concat(1<arguments.length&&void 0!==e?e:"handler")]);return rt(s).css(tt({transform:"translate(".concat(a,"px, ").concat(o,"px)")},i)),s},Ye=function(t,e){var r=ie(t,3),n=r[0],a=r[1],o=r[2],i=void 0===o?1:o,s=Xe(n,a,i),c=s.cx,l=s.cy,u=s.length,h=s.theta,f=Le(["sjx-hdl-line","sjx-hdl-".concat(e)]);return rt(f).css({transform:"translate(".concat(c,"px, ").concat(l,"px) rotate(").concat(h,"deg)"),height:"".concat(i,"px"),width:"".concat(u,"px")}),f},Xe=function(t,e,r){var n=2<arguments.length&&void 0!==r?r:1,a=ie(t,2),o=a[0],i=a[1],s=ie(e,2),c=s[0],l=s[1],u=Math.sqrt((c-o)*(c-o)+(l-i)*(l-i));return{cx:(o+c)/2-u/2,cy:(i+l)/2-n/2,thickness:n,theta:Math.atan2(i-l,o-c)*(180/Math.PI),length:u}},Be=function(t,e,r,n){var a=ie(pt(t,e),2),o=a[0],i=a[1],s=n||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},c=s.width,l=s.height,u=s.offset,h=u.left,f=u.top;return[[0,0,0,1],[c,0,0,1],[0,l,0,1],[c,l,0,1]].reduce(function(t,e){return[].concat(F(t),[lt(r,e)])},[]).map(function(t){var e=ie(t,4),r=e[0],n=e[1],a=e[2],o=e[3];return[r+h,n+f,a,o]})},Le=function(t){var e=0<arguments.length&&void 0!==t?t:[],r=document.createElement("div");return e.forEach(function(t){return nt(r,t)}),r},He=/\s*,\s*|\s+/g,ze=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Ie(t,e){var r=1<arguments.length&&void 0!==e?e:[],n=document.createElementNS("http://www.w3.org/2000/svg",t);return r.forEach(function(t){return nt(n,t)}),n}function Ge(t){var r=[];return tr(t)?h.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==ze.indexOf(e)&&("g"===e&&r.push.apply(r,F(Ge(t))),r.push(t))}}):r.push(t),r}function We(){return Ie("svg").createSVGMatrix()}function Fe(t,e){var r=We();return r.e=t,r.f=e,r}function qe(t,e){return(e.getScreenCTM&&e.getScreenCTM()||We()).inverse().multiply(t.getScreenCTM()||We())}function Ze(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(a,",").concat(o,",").concat(i,")")}function Ue(t,e,r){return function(t,e){var r=Ie("svg").createSVGPoint();return r.x=t,r.y=e,r}(e,r).matrixTransform(t)}function $e(t){var e=We();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function Qe(t){return(0<arguments.length&&void 0!==t?t:"").replace(/[\n\r]/g,"").replace(/([^e])-/g,"$1 -").replace(/ +/g," ").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ")}function Je(t){return Qe(t).trim().split(He).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function Ke(t){for(var e=er.lastIndex=0,r=[];e=er.exec(t);){var n=ie(e,3),a=n[1],o=n[2],i=a.toUpperCase(),s=Qe(o);r.push({relative:a!==i,key:i,cmd:a,values:s.trim().split(He).map(function(t){if(!isNaN(t))return Number(t)})})}return r}var tr=function(t){return"g"===t.tagName.toLowerCase()},er=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,rr=I.E_DRAG,nr=I.E_RESIZE,ar=G,or=mt,ir=Object.keys,sr=Object.entries,cr=Object.values,lr=function(){o(e,Oe);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(r){var e=this,t=this.options,n=t.rotationPoint,a=t.container,o=t.controlsContainer,i=t.resizable,s=t.rotatable,c=t.showNormal,l=t.custom,u=r.getBBox(),h=Ie("g",["sjx-svg-wrapper"]),f=Ie("g",["sjx-svg-controls"]),v=["data-sjx-cx","data-sjx-cy"].map(function(t){var e=r.getAttribute(t);return W(e)?Number(e):void 0}),p=v.every(function(t){return!isNaN(t)}),d=qe(r,a),y=this._calculateVertices(d),b=y.rotator,x=void 0===b?null:b,m=y.anchor,g=void 0===m?null:m,_=C(y,["rotator","anchor"]),E={},T={};if(s){var w=c?dr([g,x],A,"normal"):null;c&&f.appendChild(w);var k=null;n&&((k=Ie("line",["sjx-hidden"])).x1.baseVal.value=_.center.x,k.y1.baseVal.value=_.center.y,k.x2.baseVal.value=v[0]||_.center.x,k.y2.baseVal.value=v[1]||_.center.y,vr(k,"#fe3232"),k.setAttribute("opacity",.5),f.appendChild(k)),T=tt({},T,{normal:w,radius:k})}var M=i?{tl:_.tl,tr:_.tr,br:_.br,bl:_.bl,tc:_.tc,bc:_.bc,ml:_.ml,mr:_.mr}:{},O={te:[_.tl,_.tr],be:[_.bl,_.br],le:[_.tl,_.bl],re:[_.tr,_.br]};ir(O).forEach(function(t){var e=O[t];U(e)||(E[t]=dr(e,A,t),f.appendChild(E[t]))});var S=p?Ue(We(),v[0],v[1]):_.center,R=tt({},M,{rotator:x,center:n&&s?S:void 0});ir(R).forEach(function(t){var e=R[t];if(!U(e)){var r=e.x,n=e.y,a="center"===t?"#fe3232":A;W(l)&&V(l[t])?E[t]=l[t](d,u,Ue):E[t]=fr(r,n,a,t),f.appendChild(E[t])}}),h.appendChild(f),o.appendChild(h),this.storage={wrapper:h,controls:f,handles:tt({},E,{},T),parent:r.parentNode,center:{isShifted:p},transform:{ctm:d},bBox:u,cached:{},__data__:new WeakMap},[r,f].map(function(t){return rt(t).on(ar,e._onMouseDown).on(or,e._onTouchStart)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container;return this._applyMatrixToPoint(n.getScreenCTM().inverse(),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t,r=this.storage,n=(r=void 0===r?{}:r).transform,a=(n=void 0===n?{}:n).containerMatrix,o=this.options,i=(o=void 0===o?{}:o).container,s=o.restrict||i;return yr(s,e?qe(s,i):a)}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.wrapperMatrix.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=Ie("svg").createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var n=this.el,e=this.storage,a=e.bBox,r=e.cached,o=e.transform,i=e.center,s=e.__data__,c=this.options,l=c.container,u=c.scalable,h=c.applyTranslate,f=o.matrix,v=o.parentMatrix,p=o.ctm;if(n.setAttribute("data-sjx-cx",i.elX),n.setAttribute("data-sjx-cy",i.elY),!U(r)){var d=r.scaleX,y=r.scaleY,b=r.dist,x=(b=void 0===b?{}:b).dx,m=b.dy,g=b.ox,_=b.oy,E=r.transformMatrix;if(t===rr){if(!h||!x&&!m)return;var T=Fe(g,_),w=T.multiply(f).multiply(T.inverse());if(this._updateElementView(["transform",w]),tr(n))Ge(n).forEach(function(t){var e=Fe(x,m),r=e.multiply(qe(t,t.parentNode)).multiply(e.inverse());if(function(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===n&&1===a&&0===o&&0===i}(r)||t.setAttribute("transform",Ze(r)),!tr(t)){var n=v.inverse();n.e=n.f=0;var a=Ue(n,g,_),o=a.x,i=a.y;ur(t,{x:o,y:i})}});else ur(n,{x:g,y:_})}if(t===nr){if(!E)return;if(!u)if(tr(n)){Ge(n).forEach(function(t){if(!tr(t)){var e=qe(t,n),r=e.inverse().multiply(E).multiply(e);hr(t,{scaleX:d,scaleY:y,localCTM:r,bBox:a,__data__:s})}})}else{var k=l.getScreenCTM()||We(),M=n.getScreenCTM().multiply(E),O=k.inverse().multiply(M),S=p.inverse().multiply(O);hr(n,{scaleX:d,scaleY:y,localCTM:S,bBox:a,__data__:s})}this._applyTransformToHandles({boxMatrix:u?p.multiply(E):p})}}}},{key:"_processResize",value:function(t,e){function r(t,e){var r=f||!f&&!v?(c+t)/c:(l+e)/l,n=w?c*r:c+t,a=w?l*r:l+e;return[n/c,a/l,n,a]}function n(t,e){var r=function(t,e){var r=We();return r.a=t,r.d=e,r}(t,e);return y.multiply(r).multiply(y.inverse())}var a=this.el,o=this.storage,i=this.storage,s=i.bBox,c=s.width,l=s.height,u=i.revX,h=i.revY,f=i.doW,v=i.doH,p=i.transform,d=p.matrix,y=p.auxiliary.scale.translateMatrix,b=i.cached,x=(b=void 0===b?{}:b).dist,m=(x=void 0===x?{}:x).dx,g=void 0===m?t:m,_=x.dy,E=void 0===_?e:_,T=this.options,w=T.proportions,k=T.scalable,M=T.restrict,O=a.getBBox(),S=O.x,R=O.y,V=d.multiply(n.apply(void 0,F(r(t,e)))),A=M?this._restrictHandler(V):{x:null,y:null},N=A.x,j=A.y,D=(null!==N||null!==j)&&M,P=D?g:t,C=D?E:e,Y=ie(r(P,C),4),X=Y[0],B=Y[1],L=Y[2],H=Y[3],z=n(X,B),I=d.multiply(z),G=S-(L-c)*(v?.5:u?1:0),W=R-(H-l)*(f?.5:h?1:0);return k&&this._updateElementView(["transform",I]),o.cached=tt({},o.cached,{scaleX:X,scaleY:B,transformMatrix:z,resultMatrix:I,dist:{dx:P,dy:C}}),this._apply(nr),{x:G,y:W,width:L,height:H,transform:I}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=this.storage,a=n.center,o=n.transform,i=o.matrix,s=o.auxiliary.translate,c=s.translateMatrix,l=s.wrapperTranslateMatrix,u=s.parentMatrix,h=o.wrapperMatrix,f=n.cached,v=(f=void 0===f?{}:f).dist,p=(v=void 0===v?{}:v).dx,d=void 0===p?t:p,y=v.dy,b=void 0===y?e:y,x=this.options.restrict;u.e=u.f=0;var m=Ue(u,t,e),g=m.x,_=m.y,E=Fe(g,_).multiply(i),T=x?this._restrictHandler(E):{x:null,y:null},w=null!==T.x&&x?d:t,k=null!==T.y&&x?b:e,M=Ue(u,w,k),O=M.x,S=M.y;r.cached.dist={dx:ce(w),dy:ce(k),ox:ce(O),oy:ce(S)},c.e=O,c.f=S;var R=c.multiply(i);l.e=w,l.f=k;var V=l.multiply(h);if(this._updateWrapperView(V),this._updateElementView(["transform",R]),a.isShifted){var A=h.inverse();A.e=A.f=0;var N=Ue(A,w,k),j=N.x,D=N.y;this._moveCenterHandle(-j,-D)}return R}},{key:"_processRotate",value:function(t){var e=this.storage.transform,r=e.matrix,n=e.wrapperMatrix,a=e.parentMatrix,o=e.auxiliary.rotate,i=o.translateMatrix,s=o.wrapperTranslateMatrix,c=this.options.restrict,l=ce(Math.cos(t)),u=function(t,e){var r=We();return r.a=e,r.b=t,r.c=-t,r.d=e,r}(ce(Math.sin(t)),l);a.e=a.f=0;var h=a.inverse().multiply(u).multiply(a),f=i.multiply(h).multiply(i.inverse()).multiply(r),v=c?this._restrictHandler(f):{x:null,y:null},p=v.x,d=v.y;if(W(p)||W(d))return f;var y=s.multiply(u).multiply(s.inverse()).multiply(n);return this._updateWrapperView(y),this._updateElementView(["transform",f]),f}},{key:"_getState",value:function(t){var e=this,r=t.revX,n=t.revY,a=t.doW,o=t.doH,i=this.el,s=this.storage,c=s.wrapper,l=s.parent,u=s.handles.center,h=s.__data__,f=this.options,v=f.container,p=f.restrict,d=i.getBBox(),y=d.x,b=d.y,x=d.width,m=d.height,g=qe(i,l),_=qe(i,v),E=qe(c,v),T=qe(l,v),w=qe(c,c.parentNode),k=T.inverse(),M=y+x*(o?.5:r?1:0),O=b+m*(a?.5:n?1:0),S=y+x/2,R=b+m/2,V=u?u.cx.baseVal.value:S,A=u?u.cy.baseVal.value:R,N=Ue(E,V,A),j=N.x,D=N.y,P=u?Ue(k,j,D):Ue(g,S,R),C=P.x,Y=P.y,X=Ue(_,S,R),B=X.x,L=X.y;pr(this.el,this.storage),h["delete"](i),Ge(i).forEach(function(t){h["delete"](t),pr(t,e.storage)});var H=tt({},this.storage.center||{},{x:u?j:B,y:u?D:L,elX:C,elY:Y,hx:u?u.cx.baseVal.value:null,hy:u?u.cy.baseVal.value:null}),z=p?qe(p,p.parentNode):qe(v,v.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:We(),translateMatrix:Fe(M,O)},translate:{parentMatrix:k,translateMatrix:We(),wrapperTranslateMatrix:We()},rotate:{translateMatrix:Fe(H.elX,H.elY),wrapperTranslateMatrix:Fe(H.x,H.y)}},matrix:g,ctm:_,parentMatrix:T,wrapperMatrix:w,containerMatrix:z,scX:Math.sqrt(_.a*_.a+_.b*_.b),scY:Math.sqrt(_.c*_.c+_.d*_.d)},bBox:d,center:H,revX:r,revY:n,doW:a,doH:o}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,a=n.center,o=n.radius,i=r.center,s=i.hx,c=i.hy;if(!U(a)){var l=s+t,u=c+e;a.cx.baseVal.value=l,a.cy.baseVal.value=u,o.x2.baseVal.value=l,o.y2.baseVal.value=u,this.storage.center.isShifted=!0}}},{key:"_updateElementView",value:function(t){var e=ie(t,2),r=e[0],n=e[1];"transform"===r&&this.el.setAttribute(r,Ze(n))}},{key:"_updateWrapperView",value:function(t){this.storage.wrapper.setAttribute("transform",Ze(t))}},{key:"_calculateVertices",value:function(s){var c=this.el,t=this.options,e=t.rotatable,r=t.rotatorAnchor,n=t.rotatorOffset,l=t.container,a=c.getBBox(),o=a.x,i=a.y,u=a.width,h=a.height,f=u/2,v=h/2,p=sr({tl:[o,i],tr:[o+u,i],mr:[o+u,i+v],ml:[o,i+v],tc:[o+f,i],bc:[o+f,i+h],br:[o+u,i+h],bl:[o,i+h],center:[o+f,i+v]}).reduce(function(t,e){var r=ie(e,2),n=r[0],a=ie(r[1],2),o=a[0],i=a[1];return t[n]=Ue(s||qe(c,l),o,i),t},{});if(e){var d={},y=1;switch(r){case"n":var b=p.tc,x=b.x,m=b.y;d.x=x,d.y=m;break;case"s":var g=p.bc,_=g.x,E=g.y;d.x=_,d.y=E,y=-1;break;case"w":var T=p.ml,w=T.x,k=T.y;d.x=w,d.y=k,y=-1;break;case"e":default:var M=p.mr,O=M.x,S=M.y;d.x=O,d.y=S}var R="n"===r||"s"===r?Math.atan2(p.bl.y-p.tl.y,p.bl.x-p.tl.x):Math.atan2(p.tl.y-p.tr.y,p.tl.x-p.tr.x),V=n*y,A={x:d.x-V*Math.cos(R),y:d.y-V*Math.sin(R)};p.rotator=A,p.anchor=d}return p}},{key:"_applyTransformToHandles",value:function(t){var e=t.boxMatrix,r=this.el,n=this.options.rotatable,a=this.storage,o=a.wrapper,i=a.handles,s=a.center.isShifted,c=a.transform,l=(c=void 0===c?{}:c).wrapperMatrix,u=void 0===l?qe(o,o.parentNode):l,h=r.getBBox(),f=h.x,v=h.y,p=h.width/2,d=h.height/2,y=u.inverse().multiply(e),b=Ue(y,f+p,v+d),x=this._calculateVertices(y),m=x.anchor,g=void 0===m?null:m,_=x.center,E=C(x,["anchor","center"]),T={te:[E.tl,E.tr],be:[E.bl,E.br],le:[E.tl,E.bl],re:[E.tr,E.br]};if(n){var w=i.normal,k=i.radius;W(w)&&(w.x1.baseVal.value=g.x,w.y1.baseVal.value=g.y,w.x2.baseVal.value=E.rotator.x,w.y2.baseVal.value=E.rotator.y),W(k)&&(k.x1.baseVal.value=b.x,k.y1.baseVal.value=b.y,s||(k.x2.baseVal.value=b.x,k.y2.baseVal.value=b.y))}ir(T).forEach(function(t){var a=i[t],e=ie(T[t],2),r=e[0],n=e[1];U(r)||U(a)||sr({x1:r.x,y1:r.y,x2:n.x,y2:n.y}).map(function(t){var e=ie(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)})});var M=tt({},E,{},!s&&Boolean(_)&&{center:_});ir(M).forEach(function(t){var e=i[t],r=M[t];U(r)||U(e)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))})}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.storage,r=e.bBox,n=r.width,a=r.height,o=r.x,i=r.y,s=e.handles,c=s.center,l=s.radius;if(c){var u=qe(t,t.parentNode),h=Ue(u,o+n/2,i+a/2),f=h.x,v=h.y;c.cx.baseVal.value=f,c.cy.baseVal.value=v,c.isShifted=!1,l.x2.baseVal.value=f,l.y2.baseVal.value=v}}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.options.container,r=qe(t,e),n=We();this.storage=tt({},this.storage,{transform:tt({},this.storage.transform||{},{wrapperMatrix:n})}),this._updateWrapperView(n),this._applyTransformToHandles({boxMatrix:r})}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,r=this.el,n=this.options,a=n.restrict,o=n.container,i=this.storage.bBox,s=a||o,c=e?qe(r.parentNode,s).multiply(e):qe(r,s);return yr(r,c,i)}},{key:"applyAlignment",value:function(t){var e=this.options.container,r=this._calculateVertices(),n=(r.anchor,r.rotator,r.center,C(r,["anchor","rotator","center"])),a=this._getRestrictedBBox(!0),o=cr(n).map(function(t){return[t.x,t.y]}),i=ie(k(a),2),s=ie(i[0],2),c=s[0],l=s[1],u=ie(i[1],2),h=u[0],f=u[1],v=ie(k(o),2),p=ie(v[0],2),d=p[0],y=p[1],b=ie(v[1],2),x=b[0],m=b[1],g=qe(this.el.parentNode,e);g.e=g.f=0;var _=Ue(g.inverse(),function(){switch(!0){case/[l]/.test(t):return c-d;case/[r]/.test(t):return l-y;case/[h]/.test(t):return(l+c)/2-(y+d)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(t):return h-x;case/[b]/.test(t):return f-m;case/[v]/.test(t):return(f+h)/2-(m+x)/2;default:return 0}}()),E=_.x,T=_.y,w=Fe(E,T).multiply(qe(this.el,this.el.parentNode));this._updateElementView(["transform",w]),this.fitControlsToSize()}}]),e}(),ur=function(e,t){var r=t.x,n=t.y,a=[];switch(e.tagName.toLowerCase()){case"text":var o=W(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,i=W(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=W(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=W(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",s],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;a.push(["cx",l],["cy",u]);break;case"line":var h=e.x1.baseVal.value+r,f=e.y1.baseVal.value+n,v=e.x2.baseVal.value+r,p=e.y2.baseVal.value+n;a.push(["x1",h],["y1",f],["x2",v],["y2",p]);break;case"polygon":case"polyline":var d=Je(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");a.push(["points",d]);break;case"path":var y=e.getAttribute("d");a.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var a=Ke(e),o="",i=" ",s=!0,c=0,l=a.length;c<l;c++){var u=a[c],h=u.values,f=u.key,v=u.relative,p=[];switch(f){case"M":for(var d=0,y=h.length;d<y;d+=2){var b=ie(h.slice(d,d+2),2),x=b[0],m=b[1];v&&!s||(x+=r,m+=n),p.push(x,m),s=!1}break;case"A":for(var g=0,_=h.length;g<_;g+=7){var E=h.slice(g,g+7);v||(E[5]+=r,E[6]+=n),p.push.apply(p,F(E))}break;case"C":for(var T=0,w=h.length;T<w;T+=6){var k=h.slice(T,T+6);v||(k[0]+=r,k[1]+=n,k[2]+=r,k[3]+=n,k[4]+=r,k[5]+=n),p.push.apply(p,F(k))}break;case"H":for(var M=0,O=h.length;M<O;M+=1){var S=h.slice(M,M+1);v||(S[0]+=r),p.push(S[0])}break;case"V":for(var R=0,V=h.length;R<V;R+=1){var A=h.slice(R,R+1);v||(A[0]+=n),p.push(A[0])}break;case"L":case"T":for(var N=0,j=h.length;N<j;N+=2){var D=ie(h.slice(N,N+2),2),P=D[0],C=D[1];v||(P+=r,C+=n),p.push(P,C)}break;case"Q":case"S":for(var Y=0,X=h.length;Y<X;Y+=4){var B=ie(h.slice(Y,Y+4),4),L=B[0],H=B[1],z=B[2],I=B[3];v||(L+=r,H+=n,z+=r,I+=n),p.push(L,H,z,I)}break;case"Z":i=h[0]=""}o+=u.cmd+p.join(",")+i}return o}catch(t){se("Path parsing error: "+t)}}({path:y,dx:r,dy:n})])}a.forEach(function(t){e.setAttribute(t[0],t[1])})},hr=function(a,t){var e=t.scaleX,r=t.scaleY,o=t.localCTM,n=t.bBox,i=n.width,s=n.height,c=[],l=t.__data__.get(a);switch(a.tagName.toLowerCase()){case"text":case"tspan":var u=l.x,h=l.y,f=l.textLength,v=Ue(o,u,h),p=v.x,d=v.y;c.push(["x",p+(e<0?i:0)],["y",d-(r<0?s:0)],["textLength",Math.abs(e*f)]);break;case"circle":var y=l.r,b=l.cx,x=l.cy,m=y*(Math.abs(e)+Math.abs(r))/2,g=Ue(o,b,x),_=g.x,E=g.y;c.push(["r",m],["cx",_],["cy",E]);break;case"foreignobject":case"image":case"rect":var T=l.width,w=l.height,k=l.x,M=l.y,O=Ue(o,k,M),S=O.x,R=O.y,V=Math.abs(T*e),A=Math.abs(w*r);c.push(["x",S-(e<0?V:0)],["y",R-(r<0?A:0)],["width",V],["height",A]);break;case"ellipse":var N=l.rx,j=l.ry,D=l.cx,P=l.cy,C=Ue(o,D,P),Y=C.x,X=C.y,B=We();B.a=e,B.d=r;var L=Ue(B,N,j),H=L.x,z=L.y;c.push(["rx",Math.abs(H)],["ry",Math.abs(z)],["cx",Y],["cy",X]);break;case"line":var I=l.resX1,G=l.resY1,W=l.resX2,F=l.resY2,q=Ue(o,I,G),Z=q.x,U=q.y,$=Ue(o,W,F),Q=$.x,J=$.y;c.push(["x1",Z],["y1",U],["x2",Q],["y2",J]);break;case"polygon":case"polyline":var K=l.points,tt=Je(K).map(function(t){var e=Ue(o,Number(t[0]),Number(t[1])),r=e.x,n=e.y;return t[0]=ce(r),t[1]=ce(n),t.join(" ")}).join(" ");c.push(["points",tt]);break;case"path":var et=l.path;c.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=Ke(e),a="",o=" ",i=[],s=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative;switch(f){case"A":var p=[],d=$e(r);v&&(d.e=d.f=0);for(var y=0,b=h.length;y<b;y+=7){var x=ie(h.slice(y,y+7),7),m=x[0],g=x[1],_=x[2],E=x[3],T=x[4],w=x[5],k=x[6],M=Ue(d,w,k),O=M.x,S=M.y;p.push(ce(O),ce(S)),d.e=d.f=0;var R=Ue(d,m,g),V=R.x,A=R.y;p.unshift(ce(V),ce(A),_,E,T)}i.push(p);break;case"C":var N=[],j=$e(r);v&&(j.e=j.f=0);for(var D=0,P=h.length;D<P;D+=6){var C=ie(h.slice(D,D+6),6),Y=C[0],X=C[1],B=C[2],L=C[3],H=C[4],z=C[5],I=Ue(j,Y,X),G=I.x,W=I.y,F=Ue(j,B,L),q=F.x,Z=F.y,U=Ue(j,H,z),$=U.x,Q=U.y;N.push(ce(G),ce(W),ce(q),ce(Z),ce($),ce(Q))}i.push(N);break;case"H":var J=[],K=$e(r);v&&(K.e=K.f=0);for(var tt=0,et=h.length;tt<et;tt+=1){var rt=ie(h.slice(tt,tt+1),1)[0],nt=Ue(K,rt,0).x;J.push(ce(nt))}i.push(J);break;case"V":var at=[],ot=$e(r);v&&(ot.e=ot.f=0);for(var it=0,st=h.length;it<st;it+=1){var ct=ie(h.slice(it,it+1),1)[0],lt=Ue(ot,0,ct).y;at.push(ce(lt))}i.push(at);break;case"T":case"L":var ut=[],ht=$e(r);v&&(ht.e=ht.f=0);for(var ft=0,vt=h.length;ft<vt;ft+=2){var pt=ie(h.slice(ft,ft+2),2),dt=pt[0],yt=pt[1],bt=Ue(ht,dt,yt),xt=bt.x,mt=bt.y;ut.push(ce(xt),ce(mt))}i.push(ut);break;case"M":var gt=[],_t=$e(r);v&&!s&&(_t.e=_t.f=0);for(var Et=0,Tt=h.length;Et<Tt;Et+=2){var wt=ie(h.slice(Et,Et+2),2),kt=wt[0],Mt=wt[1],Ot=Ue(_t,kt,Mt),St=Ot.x,Rt=Ot.y;gt.push(ce(St),ce(Rt)),s=!1}i.push(gt);break;case"Q":var Vt=[],At=$e(r);v&&(At.e=At.f=0);for(var Nt=0,jt=h.length;Nt<jt;Nt+=4){var Dt=ie(h.slice(Nt,Nt+4),4),Pt=Dt[0],Ct=Dt[1],Yt=Dt[2],Xt=Dt[3],Bt=Ue(At,Pt,Ct),Lt=Bt.x,Ht=Bt.y,zt=Ue(At,Yt,Xt),It=zt.x,Gt=zt.y;Vt.push(ce(Lt),ce(Ht),ce(It),ce(Gt))}i.push(Vt);break;case"S":var Wt=[],Ft=$e(r);v&&(Ft.e=Ft.f=0);for(var qt=0,Zt=h.length;qt<Zt;qt+=4){var Ut=ie(h.slice(qt,qt+4),4),$t=Ut[0],Qt=Ut[1],Jt=Ut[2],Kt=Ut[3],te=Ue(Ft,$t,Qt),ee=te.x,re=te.y,ne=Ue(Ft,Jt,Kt),ae=ne.x,oe=ne.y;Wt.push(ce(ee),ce(re),ce(ae),ce(oe))}i.push(Wt);break;case"Z":i.push([""]),o=""}a+=u.cmd+i[c].join(",")+o}return a}catch(t){se("Path parsing error: "+t)}}({path:et,localCTM:o})])}c.forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];a.setAttribute(r,n)})},fr=function(t,e,r,n){var a=Ie("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(n)]);return sr({cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"}).forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)}),a},vr=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},pr=function(t,e){var r=null;switch(t.tagName.toLowerCase()){case"text":r={x:W(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,y:W(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,textLength:W(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null};break;case"circle":r={r:t.r.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"foreignobject":case"image":case"rect":r={width:t.width.baseVal.value,height:t.height.baseVal.value,x:t.x.baseVal.value,y:t.y.baseVal.value};break;case"ellipse":r={rx:t.rx.baseVal.value,ry:t.ry.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"line":r={resX1:t.x1.baseVal.value,resY1:t.y1.baseVal.value,resX2:t.x2.baseVal.value,resY2:t.y2.baseVal.value};break;case"polygon":case"polyline":r={points:t.getAttribute("points")};break;case"path":r={path:t.getAttribute("d")}}e.__data__.set(t,r)},dr=function(t,e,r){var n=ie(t,2),a=n[0],o=n[1],i=Ie("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),s={x1:a.x,y1:a.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return sr(s).forEach(function(t){var e=ie(t,2),r=e[0],n=e[1];return i.setAttribute(r,n)}),i},yr=function(t,o,e){var r=2<arguments.length&&void 0!==e?e:t.getBBox(),n=r.x,a=r.y,i=r.width,s=r.height;return[[n,a],[n+i,a],[n+i,a+s],[n,a+s]].map(function(t){var e=ie(t,2),r=e[0],n=e[1],a=Ue(o,r,n);return[a.x,a.y]})};function br(r,t){if(this.length){var n=W(t)&&t instanceof Rt?t:new Rt;return p.call(this,function(t,e){return e instanceof SVGElement?function(t){var e=t.tagName.toLowerCase();return-1!==ze.indexOf(e)||(se('Selected element "'.concat(e,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)}(e)&&t.push(new lr(e,r,n)):t.push(new Pe(e,r,n)),t},[])}}var xr=I.EMITTER_EVENTS,mr=G,gr=mt,_r=function(){o(a,Yt);var n=c(a);function a(t,e){var r;return i(this,a),(r=n.call(this,t)).enable(e),r}return r(a,[{key:"_init",value:function(){var e=this,t=this.el,r=this.options,n=rt(t),a=r.style,o=r.appendTo,i=tt({position:"absolute","z-index":"2147483647"},a);this.storage={css:i,parent:W(o)?rt(o)[0]:document.body},n.on(mr,this._onMouseDown).on(gr,this._onTouchStart),xr.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e={},r=null,n=document,a=function(){},o=function(){},i=function(){},s=function(){};if(W(t)){var c=t.style,l=t.appendTo,u=t.stack,h=t.onInit,f=t.onMove,v=t.onDrop,p=t.onDestroy;e=W(c)&&"object"===K(c)?c:e,r=l||null;var d=W(u)?rt(u)[0]:document;a=et(h),o=et(f),i=V(v)?function(t){var e=this.storage.clone;!function(t,e){var r=b(t),n=r.top,a=r.left,o=b(e),i=o.top,s=o.left,c=rt(t),l=rt(e);return!(n<i||n+parseFloat(c.css("height"))>i+parseFloat(l.css("height"))||a<s||a+parseFloat(c.css("width"))>s+parseFloat(l.css("width")))}(e,d)||v.call(this,t,this.el,e)}:function(){},s=et(p)}this.options={style:e,appendTo:r,stack:n},this.proxyMethods={onInit:a,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,a=this.el,o=n.parent,i=n.css,s=b(o),c=s.left,l=s.top;i.left="".concat(e-c,"px"),i.top="".concat(r-l,"px");var u=a.cloneNode(!0);rt(u).css(i),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=u,rt(o)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage;n.clientX=e,n.clientY=r,n.doDraw=!0,n.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,g(n),U(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=$(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,a=t.cx,o=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-a,dy:n-o}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,n="translate(".concat(t,"px, ").concat(e,"px)");rt(r).css({transform:n,webkitTranform:n,mozTransform:n,msTransform:n,otransform:n})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;U(t)||(rt(r).off(mr,this._onMouseDown).off(gr,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),a}();function Er(e){if(this.length)return v.call(this,function(t){return new _r(t,e)})}var Tr=function(){o(e,d);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"drag",value:function(){return br.call.apply(br,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return Er.call.apply(Er,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function wr(t){return new Tr(t)}return Object.defineProperty(wr,"createObservable",{value:function(){return new Rt}}),Object.defineProperty(wr,"Subjx",{value:Tr}),Object.defineProperty(wr,"Observable",{value:Rt}),wr});
