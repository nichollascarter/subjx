!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.subjx=e():t.subjx=e()}(window,function(){return(o={},r.m=n=[function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(0);var H=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},i=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},o=Array.prototype.forEach,r=Array.prototype.slice,a=Array.prototype.map,s=Array.prototype.reduce,Ot=console.warn;function I(t){return null!=t}function W(t){return null==t}function h(t){return"function"==typeof t}function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var l=function(){function a(t){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),!I(t))throw new Error("Passed parameter must be selector/element/elementArray");if("string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var n=0;n<this.length;n++)this[n]=e[n]}else if(1===t.nodeType||t===document)this[0]=t,this.length=1;else if(t instanceof a||"object"===c(t)){this.length=t.length;for(var o=0;o<this.length;o++)this[o]=t[o]}else if(Array.isArray(t))for(var r=this.length=0;r<this.length;r++)1===t.nodeType&&(this[r]=t[r],this.length++)}return function(t,e,n){e&&u(t.prototype,e),n&&u(t,n)}(a,[{key:"css",value:function(n){var t={setStyle:function(t){return function(t,e){for(var n=t.length;n--;)for(var o in e)t[n].style[o]=e[o];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[n]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[n]:t[e].style[n]}(this)}};return"string"==typeof n?t.getStyle.apply(this,r.call(arguments,1)):"object"!==c(n)&&n?(Ot("Method ".concat(n," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"find",value:function(t){for(var e=this.length;e--;)return F(this[e].querySelectorAll(t))}},{key:"each",value:function(t){for(var e,n=r.call(this,0),o=n.length-1;0<=o;--o)e=o,t.call(n[e]);return this}},{key:"on",value:function(t,e,n,o){for(var r=this.length;r--;)this[r].events||(this[r].events={},this[r].events[t]=[]),2===arguments.length?document.addEventListener?this[r].addEventListener(t,e,!1):document.attachEvent?this[r].attachEvent("on".concat(t),e):this[r]["on".concat(t)]=e:3===arguments.length&&"string"==typeof e&&f(this[r],t,e,n,o,!0);return this}},{key:"off",value:function(t,e,n,o){for(var r=this.length;r--;)this[r].events||(this[r].events={},this[r].events[t]=[]),2===arguments.length?document.removeEventListener?this[r].removeEventListener(t,e,!1):document.detachEvent?this[r].detachEvent("on".concat(t),e):this[r]["on".concat(t)]=null:3===arguments.length&&"string"==typeof e&&f(this[r],t,e,n,o,!1);return this}},{key:"is",value:function(t){for(var e=F(t),n=this.length;n--;)if(this[n]===e[n])return!0;return!1}}]),a}();function f(t,e,n,o,r,a){function i(t){for(var e=t.target;e&&e!==this;)e.matches(n)&&o.call(e,t),e=e.parentNode}!0===a?document.addEventListener?t.addEventListener(e,i,r||!1):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,r||!1):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function F(t){return new l(t)}function p(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var y=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.observers={}}return function(t,e,n){e&&p(t.prototype,e),n&&p(t,n)}(t,[{key:"subscribe",value:function(t,e){var n=this.observers;return W(n[t])&&Object.defineProperty(n,t,{value:[]}),n[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var n=this.observers;if(I(n[t])){var o=n[t].indexOf(e);n[t].splice(o,1)}return this}},{key:"notify",value:function(e,n,o){W(this.observers[e])||this.observers[e].forEach(function(t){if(n!==t)switch(e){case"onmove":t.notifyMove(o);break;case"onrotate":t.notifyRotate(o);break;case"onresize":t.notifyResize(o);break;case"onapply":t.notifyApply(o);break;case"ongetstate":t.notifyGetState(o)}})}}]),t}();function C(t){return t.getBoundingClientRect()}function R(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function D(t){var e=t.match(/-?\d+\.?\d+|-?\d+/g);return e?e.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function q(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function z(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}var U=Math.PI/180;Math.PI;function G(t,e){if(0===e)return t;var n=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return n-t<e?n:void 0}function X(t,e,n,o,r,a,i,s,c){var u=parseFloat(n)/2,l=parseFloat(o)/2,h=t+u,f=e+l,p=t-h,y=e-f,v=Math.atan2(s?0:y,c?0:p)+r,d=Math.sqrt(Math.pow(c?0:u,2)+Math.pow(s?0:l,2)),b=Math.cos(v),m=Math.sin(v),x=f+d*(m=!0===i?-m:m);return{left:At(h+d*(b=!0===a?-b:b)),top:At(x)}}function At(t,e){var n=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(n))}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(t){v(e,t,n[t])})}return e}function v(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var b=function(){function n(t,e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.constructor===n)throw new TypeError("Cannot construct Subject instances directly");this.el=t,this.storage=null,this.proxyMethods=null,this.observable=e,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return function(t,e,n){e&&d(t.prototype,e),n&&d(t,n)}(n,[{key:"enable",value:function(t){W(this.storage)?(this._processOptions(t),this._init(this.el)):Ot("Already enabled")}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,n=this.el;W(t)||(t.onExecution&&(this._end(),F(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),z(n,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,n),delete this.storage)}},{key:"_init",value:function(){}},{key:"_destroy",value:function(){}},{key:"_cursorPoint",value:function(){}},{key:"_drag",value:function(){var t;this._processMove.apply(this,arguments),(t=this.proxyMethods.onMove).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_rotate",value:function(){var t;this._processRotate.apply(this,arguments),(t=this.proxyMethods.onRotate).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_resize",value:function(){var t;this._processResize.apply(this,arguments),(t=this.proxyMethods.onResize).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_processOptions",value:function(t){var e=this.el;q(e,"sjx-drag");var n={x:10,y:10,angle:10*U},o={move:!1,resize:!1,rotate:!1},r=null,a=!1,i="xy",s="auto",c="auto",u="auto",l="#00a8ff",h=!1,f=function(){},p=function(){},y=function(){},v=function(){},d=function(){},b=function(){},m=e.parentNode;if(I(t)){var x=t.snap,g=t.each,_=t.axis,w=t.cursorMove,M=t.cursorResize,k=t.cursorRotate,j=t.rotationPoint,E=t.restrict,T=t.onInit,S=t.onDrop,O=t.onMove,A=t.onResize,P=t.onRotate,V=t.onDestroy,C=t.container,R=t.proportions,D=t.themeColor;if(I(x)){var z=x.x,X=x.y,Y=x.angle;n.x=W(z)?10:z,n.y=W(X)?10:X,n.angle=W(Y)?n.angle:Y*U}if(I(g)){var N=g.move,B=g.resize,L=g.rotate;o.move=N||!1,o.resize=B||!1,o.rotate=L||!1}I(E)&&(r="parent"===E?e.parentNode:F(E)[0]||document),l=D||"#00a8ff",s=w||"auto",c=M||"auto",u=k||"auto",i=_||"xy",m=I(C)&&F(C)[0]?F(C)[0]:m,h=j||!1,a=R||!1,f=Q(T),d=Q(S),p=Q(O),v=Q(A),y=Q(P),b=Q(V),f.call(this,e)}this.options={axis:i,themeColor:l,cursorMove:s,cursorRotate:u,cursorResize:c,rotationPoint:h,restrict:r,container:m,snap:n,each:o,proportions:a},this.proxyMethods={onInit:f,onDrop:d,onMove:p,onResize:v,onRotate:y,onDestroy:b},this.subscribe(o)}},{key:"_draw",value:function(){this._animate()}},{key:"_animate",value:function(){var t=this,e=t.observable,n=t.storage,o=t.options;if(!W(n)&&(n.frame=H(t._animate),n.doDraw)){n.doDraw=!1;var r=n.dox,a=n.doy,i=n.clientX,s=n.clientY,c=n.doDrag,u=n.doResize,l=n.doRotate,h=n.doSetCenter,f=n.revX,p=n.revY,y=n.handle,v=o.snap,d=o.each,b=o.restrict,m=d.move,x=d.resize,g=d.rotate;if(u){var _=n.transform,w=n.cx,M=n.cy,k=this._pointToElement({x:i,y:s}),j=k.x,E=k.y,T=r?G(j-w,v.x/_.scX):0,S=a?G(E-M,v.y/_.scY):0;T=r?f?-T:T:0,S=a?p?-S:S:0,t._resize(T,S,y[0]),x&&e.notify("onresize",t,{dx:T,dy:S,handle:y[0]})}if(c){var O=n.restrictOffset,A=n.elementOffset,P=n.nx,V=n.ny;I(b)&&(i-O.left<P-A.left&&(i=P-A.left+O.left),s-O.top<V-A.top&&(s=V-A.top+O.top));var C=r?G(i-P,v.x):0,R=a?G(s-V,v.y):0;t._drag(C,R),m&&e.notify("onmove",t,{dx:C,dy:R})}if(l){var D=n.pressang,z=n.center,X=Math.atan2(s-z.y,i-z.x)-D;t._rotate(G(X,v.angle)),g&&e.notify("onrotate",t,{radians:X})}if(h){var Y=n.bx,N=n.by,B=this._pointToControls({x:i,y:s}),L=B.x,F=B.y;t._moveCenterHandle(L-Y,F-N)}}}},{key:"_start",value:function(t){t.stopImmediatePropagation&&t.stopImmediatePropagation();var e=this.observable,n=this.storage,o=this.options,r=this.el,a=this._compute(t);Object.keys(a).forEach(function(t){n[t]=a[t]});var i=a.onRightEdge,s=a.onBottomEdge,c=a.onTopEdge,u=a.onLeftEdge,l=a.handle,h=a.factor,f=a.revX,p=a.revY,y=a.doW,v=a.doH,d=i||s||c||u,b=n.handles,m=n.radius,x=o.axis,g=o.restrict;I(m)&&z(m,"sjx-hidden");var _=l.is(b.rotator),w=!!I(b.center)&&l.is(b.center),M=t.clientX,k=t.clientY,j=this._cursorPoint({clientX:M,clientY:k}),E=j.x,T=j.y,S=this._pointToElement({x:E,y:T}),O=S.x,A=S.y,P=this._pointToControls({x:E,y:T}),V={clientX:M,clientY:k,nx:E,ny:T,cx:O,cy:A,bx:P.x,by:P.y,doResize:d,doDrag:!(_||d||w),doRotate:_,doSetCenter:w,onExecution:!0,cursor:null,elementOffset:C(r),restrictOffset:I(g)?C(g):null,dox:/\x/.test(x)&&(!d||(l.is(b.ml)||l.is(b.mr)||l.is(b.tl)||l.is(b.tr)||l.is(b.bl)||l.is(b.br))),doy:/\y/.test(x)&&(!d||(l.is(b.br)||l.is(b.bl)||l.is(b.bc)||l.is(b.tr)||l.is(b.tl)||l.is(b.tc)))};this.storage=Y({},n,V),e.notify("ongetstate",this,{factor:h,revX:f,revY:p,doW:y,doH:v}),this._draw()}},{key:"_moving",value:function(t){t.preventDefault&&t.preventDefault();var e=this.storage,n=this.options,o=this._cursorPoint(t),r=o.x,a=o.y;e.e=t,e.clientX=r,e.clientY=a,e.doDraw=!0;var i=e.doRotate,s=e.doDrag,c=e.doResize,u=e.cursor,l=n.cursorMove,h=n.cursorResize,f=n.cursorRotate;W(u)&&(s?u=l:i?u=f:c&&(u=h),F(document.body).css({cursor:u}))}},{key:"_end",value:function(t){I(t)&&t.stopImmediatePropagation&&t.stopImmediatePropagation();var e=this.observable,n=this.storage,o=this.proxyMethods,r=this.el,a=n.doResize?"resize":n.doDrag?"drag":"rotate";n.doResize=!1,n.doDrag=!1,n.doRotate=!1,n.doSetCenter=!1,n.doDraw=!1,n.onExecution=!1,n.cursor=null,this._apply(a),o.onDrop.call(this,t,r),e.notify("onapply",this,{actionName:a,e:t}),i(n.frame),F(document.body).css({cursor:"auto"}),I(n.radius)&&q(n.radius,"sjx-hidden")}},{key:"_checkHandles",value:function(t,e){var n=t.is(e.tl),o=t.is(e.tc),r=t.is(e.tr),a=t.is(e.bl),i=t.is(e.bc),s=t.is(e.br),c=t.is(e.ml),u=t.is(e.mr);return{revX:n||c||a||o,revY:n||r||o||c,onTopEdge:o||r||n,onLeftEdge:n||c||a,onRightEdge:r||u||s,onBottomEdge:s||i||a,doW:c||u,doH:o||i}}},{key:"_onMouseDown",value:function(t){this._start(t),F(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),F(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){F(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){F(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"notifyMove",value:function(t){var e=t.dx,n=t.dy;this._drag(e,n)}},{key:"notifyRotate",value:function(t){var e=this.options.snap;this._rotate(G(t.radians,e.angle))}},{key:"notifyResize",value:function(t){var e=t.dx,n=t.dy;this._resize(e,n)}},{key:"notifyApply",value:function(t){var e=t.actionName,n=t.e;this.proxyMethods.onDrop.call(this,n,this.el),this._apply(e)}},{key:"notifyGetState",value:function(t){var e=this.storage,n=this._getState(t);this.storage=Y({},e,n)}},{key:"subscribe",value:function(t){var e=this.observable,n=t.resize,o=t.move,r=t.rotate;(o||n||r)&&e.subscribe("ongetstate",this).subscribe("onapply",this),o&&e.subscribe("onmove",this),n&&e.subscribe("onresize",this),r&&e.subscribe("onrotate",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}}]),n}();function Q(t){return h(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){r=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function M(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function g(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function w(t,e){return!e||"object"!==x(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function k(t){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var E=function(){function r(t,e,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(o=w(this,k(r).call(this,t,n))).enable(e),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(r,b),function(t,e,n){e&&_(t.prototype,e),n&&_(t,n)}(r,[{key:"_init",value:function(t){var e=document.createElement("div");q(e,"sjx-wrapper"),t.parentNode.insertBefore(e,t);var n=F(t),o=this.options.rotationPoint,r=t.style,a=r.left,i=r.top,s=r.width,c=r.height,u=s||n.css("width"),l=c||n.css("height"),h=i||n.css("top"),f=a||n.css("left"),p=F(e.parentNode),y={top:h,left:f,width:u,height:l,transform:R(n)},v=document.createElement("div"),d={normal:["sjx-normal"],tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"],center:o?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0,rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"]};Object.keys(d).forEach(function(t){var e=d[t];if(!W(e)){var n=function(t){var e=document.createElement("div");return t.forEach(function(t){q(e,t)}),e}(e);d[t]=n,v.appendChild(n)}}),I(d.center)&&F(d.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")});q(v,"sjx-controls"),e.appendChild(v);var b=F(v);b.css(y);var m=F(e);this.storage={controls:v,handles:d,radius:m.find(".sjx-radius"),parent:p},b.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;F(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);var e=t.parentNode;e.parentNode.removeChild(e)}},{key:"_compute",value:function(t){var e=this.storage.handles,n=F(t.target),o=this._checkHandles(n,e),r=o.revX,a=o.revY,i=o.onTopEdge,s=o.onLeftEdge,c=o.onRightEdge,u=o.onBottomEdge,l=o.doW,h=o.doH,f=n.is(e.tr)||n.is(e.bl)?-1:1,p=this._getState({factor:f,revX:r,revY:a,doW:l,doH:h}),y=this._cursorPoint(t),v=y.x,d=y.y;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(t){g(e,t,n[t])})}return e}({},p,{onTopEdge:i,onLeftEdge:s,onRightEdge:c,onBottomEdge:u,handle:n,pressang:Math.atan2(d-p.center.y,v-p.center.x)})}},{key:"_pointToElement",value:function(t){var e=this.storage.transform,n=t.x,o=t.y,r=M(e.matrix);return r[4]=r[5]=0,this._applyMatrixToPoint(O(r),n,o)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,n){return S({x:e,y:n},t)}},{key:"_cursorPoint",value:function(t){var e=D(R(F(this.options.container)));return S({x:t.clientX,y:t.clientY},O(e))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,n=F(t),o=e.cached,r=e.controls,a=e.transform,i=e.handles,s=F(r),c=parseFloat(s.css("width"))/2,u=parseFloat(s.css("height"))/2,l=i.center,h=I(l),f=h?parseFloat(F(l).css("left")):c,p=h?parseFloat(F(l).css("top")):u;if(t.setAttribute("data-cx",f),t.setAttribute("data-cy",p),!W(o)){var y=o.dx,v=o.dy,d=T(a.matrix),b=parseFloat(t.style.left||n.css("left")),m=parseFloat(t.style.top||n.css("top"));d.left="".concat(b+y,"px"),d.top="".concat(m+v,"px"),n.css(d),s.css(d),this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var n=this.el,o=this.storage,r=this.options.proportions,a=o.controls,i=o.coords,s=o.cw,c=o.ch,u=o.transform,l=o.refang,h=o.revX,f=o.revY,p=o.doW,y=o.doH,v=p||!p&&!y?(s+t)/s:(c+e)/c,d=r?s*v:s+t,b=r?c*v:c+e;if(!(d<2||b<2)){var m=M(u.matrix),x=X(m[4],m[5],d,b,l,h,f,p,y),g=i.left-x.left,_=i.top-x.top;m[4]+=g,m[5]+=_;var w=T(m);w.width="".concat(d,"px"),w.height="".concat(b,"px"),F(a).css(w),F(n).css(w),o.cached={dx:g,dy:_}}}},{key:"_processMove",value:function(t,e){var n=this.el,o=this.storage,r=o.controls,a=o.transform,i=a.matrix,s=M(a.parentMatrix);s[4]=s[5]=0;var c=M(i);c[4]=i[4]+t,c[5]=i[5]+e;var u=T(c);F(r).css(u),F(n).css(u),o.cached={dx:t,dy:e}}},{key:"_processRotate",value:function(t){var e=this.el,n=this.storage,o=n.controls,r=n.transform,a=n.center,i=r.matrix,s=r.parentMatrix,c=At(Math.cos(t)),u=At(Math.sin(t)),l=[1,0,0,1,a.cx,a.cy],h=[c,u,-u,c,0,0],f=M(s);f[4]=f[5]=0;var p=T(N(N(N(l,N(O(f),N(h,f))),O(l)),i));F(o).css(p),F(e).css(p)}},{key:"_getState",value:function(t){var e=t.factor,n=t.revX,o=t.revY,r=t.doW,a=t.doH,i=this.el,s=this.storage,c=this.options.container,u=s.handles,l=s.controls,h=s.parent,f=u.center,p=u.tl,y=u.tr,v=C(p),d=C(y),b=Math.atan2(d.top-v.top,d.left-v.left)*e,m=F(l),x=D(R(F(c))),g=D(R(F(l))),_=D(R(h)),w={matrix:g,parentMatrix:h===c?N(_,x):x,scX:Math.sqrt(g[0]*g[0]+g[1]*g[1]),scY:Math.sqrt(g[2]*g[2]+g[3]*g[3])},M=parseFloat(m.css("width")),k=parseFloat(m.css("height")),j=X(g[4],g[5],M,k,b,n,o,r,a),E=M/2,T=k/2,S=C(i),O=I(f),A=O?parseFloat(F(f).css("left")):E,P=O?parseFloat(F(f).css("top")):T,V=O?7:0;return{transform:w,cw:M,ch:k,coords:j,center:{x:S.left+A-V,y:S.top+P-V,cx:E-A-V,cy:T-P-V,hx:A,hy:P},factor:e,refang:b,revX:n,revY:o,doW:r,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var n=this.storage,o=n.handles,r=n.center,a="".concat(r.hx+t,"px"),i="".concat(r.hy+e,"px");F(o.center).css({left:a,top:i})}},{key:"resetCenterPoint",value:function(){F(this.storage.handles.center).css({left:null,top:null})}},{key:"controls",get:function(){return this.storage.controls}}]),r}();function T(t){var e="matrix(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function S(t,e){var n=t.x,o=t.y,r=m(e,6),a=r[0],i=r[1],s=r[2],c=r[3];return{x:a*n+s*o+r[4],y:i*n+c*o+r[5]}}function O(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var n=e.length,o=[],r=[],a=0;a<n;a+=1){o[o.length]=[],r[r.length]=[];for(var i=0;i<n;i+=1)o[a][i]=a==i?1:0,r[a][i]=e[a][i]}for(var s=0;s<n;s+=1){var c=r[s][s];if(0===c){for(var u=s+1;u<n;u+=1)if(0!==r[u][s]){for(var l=0;l<n;l++)c=r[s][l],r[s][l]=r[u][l],r[u][l]=c,c=o[s][l],o[s][l]=o[u][l],o[u][l]=c;break}if(0===(c=r[s][s]))return}for(var h=0;h<n;h++)r[s][h]=r[s][h]/c,o[s][h]=o[s][h]/c;for(var f=0;f<n;f++)if(f!=s){c=r[f][s];for(var p=0;p<n;p++)r[f][p]-=c*r[s][p],o[f][p]-=c*o[s][p]}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]}}function N(t,e){for(var n=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],o=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],r=[],a=0;a<o.length;a++){r[a]=[];for(var i=0;i<n[0].length;i++){for(var s=0,c=0;c<n.length;c++)s+=n[c][i]*o[a][c];r[a].push(s)}}return[r[0][0],r[1][0],r[0][1],r[1][1],r[0][2],r[1][2]]}var A=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g"];function P(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function nt(){return P("svg").createSVGMatrix()}function ot(t,e){return(e.getScreenCTM()||nt()).inverse().multiply(t.getScreenCTM()||nt())}function V(t){return"matrix(".concat(t.a,",").concat(t.b,",").concat(t.c,",").concat(t.d,",").concat(t.e,",").concat(t.f,")")}function Pt(t,e,n,o){var r=e.createSVGPoint();return r.x=n,r.y=o,r.matrixTransform(t)}function Vt(t){var e=nt();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function Z(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Ct(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){r=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var B=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,L=/\s*,\s*|\s+/g;function Rt(t){for(var e=B.lastIndex=0,n=[];e=B.exec(t);){var o=e[1],r=o.toUpperCase(),a=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");n.push({relative:o!==r,key:r,cmd:o,values:a.trim().split(L).map(function(t){if(!isNaN(t))return Number(t)})})}return n}function $(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function K(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function tt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function et(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function rt(t){return(rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function at(t,e){return(at=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var it=/[+-]?\d+(\.\d+)?/g,st=function(){function r(t,e,n){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(o=et(this,rt(r).call(this,t,n))).enable(e),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&at(t,e)}(r,b),function(t,e,n){e&&tt(t.prototype,e),n&&tt(t,n)}(r,[{key:"_init",value:function(t){var e=this.options,n=e.rotationPoint,o=e.container,a=e.themeColor,r=P("g");o.appendChild(r);var i=t.getBBox(),s=i.width,c=i.height,u=i.x,l=i.y,h=ot(t,o),f=P("rect");[["width",s],["height",c],["x",u],["y",l],["fill",a],["fill-opacity",.1],["stroke",a],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",V(h)]].forEach(function(t){f.setAttribute(t[0],t[1])});var p=P("g"),y=P("g"),v=P("g");v.appendChild(f),r.appendChild(v),r.appendChild(y),r.appendChild(p);var d=f.getBBox(),b=d.x,m=d.y,x=d.width,g=d.height,_=t.getAttribute("data-cx"),w=t.getAttribute("data-cy"),M=ot(f,f.parentNode),k=Pt(M,o,b+x/2,m+g/2),j={tl:Pt(M,o,b,m),tr:Pt(M,o,b+x,m),br:Pt(M,o,b+x,m+g),bl:Pt(M,o,b,m+g),tc:Pt(M,o,b+x/2,m),bc:Pt(M,o,b+x/2,m+g),ml:Pt(M,o,b,m+g/2),mr:Pt(M,o,b+x,m+g/2),center:n?function(t,e,n){if(W(e)||W(n))return null;var o=t.createSVGPoint();return o.x=e,o.y=n,o}(o,_,w)||k:void 0,rotator:{}},E=Math.atan2(j.tl.y-j.tr.y,j.tl.x-j.tr.x);j.rotator.x=j.mr.x-50*Math.cos(E),j.rotator.y=j.mr.y-50*Math.sin(E);var T=P("line");T.x1.baseVal.value=j.mr.x,T.y1.baseVal.value=j.mr.y,T.x2.baseVal.value=j.rotator.x,T.y2.baseVal.value=j.rotator.y,yt(T,a),y.appendChild(T);var S=null;n&&(q(S=P("line"),"sjx-hidden"),S.x1.baseVal.value=k.x,S.y1.baseVal.value=k.y,S.x2.baseVal.value=_||k.x,S.y2.baseVal.value=w||k.y,yt(S,"#fe3232"),S.setAttribute("opacity",.5),y.appendChild(S)),Object.keys(j).forEach(function(t){var e=j[t];if(!W(e)){var n=e.x,o=e.y,r="center"===t?"#fe3232":a;j[t]=function(t,e,n){var o=P("circle");q(o,"sjx-svg-hdl");var r={cx:t,cy:e,r:5.5,fill:n,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(r).map(function(t){o.setAttribute(t,r[t])}),o}(n,o,r),p.appendChild(j[t])}}),this.storage={wrapper:r,box:f,handles:j,normalLine:T,radius:n?S:void 0,parent:t.parentNode},F(r).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.wrapper;F(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}},{key:"_compute",value:function(t){var e=this.storage.handles,n=F(t.target),o=this._checkHandles(n,e),r=o.revX,a=o.revY,i=o.onTopEdge,s=o.onLeftEdge,c=o.onRightEdge,u=o.onBottomEdge,l=o.doW,h=o.doH,f=this._getState({revX:r,revY:a,doW:l,doH:h}),p=this._cursorPoint(t),y=p.x,v=p.y;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),o.forEach(function(t){K(e,t,n[t])})}return e}({},f,{doW:l,doH:h,onTopEdge:i,onLeftEdge:s,onRightEdge:c,onBottomEdge:u,handle:n,pressang:Math.atan2(v-f.center.y,y-f.center.x)})}},{key:"_cursorPoint",value:function(t){var e=this.options.container;return Pt(e.getScreenCTM().inverse(),e,t.clientX,t.clientY)}},{key:"_pointToElement",value:function(t){var e=this.storage.transform,n=t.x,o=t.y,r=e.ctm.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,n,o)}},{key:"_pointToControls",value:function(t){var e=this.storage.transform,n=t.x,o=t.y,r=e.boxCTM.inverse();return r.e=r.f=0,this._applyMatrixToPoint(r,n,o)}},{key:"_applyMatrixToPoint",value:function(t,e,n){var o=this.options.container.createSVGPoint();return o.x=e,o.y=n,o.matrixTransform(t)}},{key:"_apply",value:function(t){var i=this.el,e=this.storage,s=this.options.container,n=e.box,o=e.handles,r=e.cached,a=e.transform,c=a.matrix,u=i.getBBox(),l=u.x,h=u.y,f=u.width,p=u.height,y=I(o.center)?Pt(a.boxCTM,s,o.center.cx.baseVal.value,o.center.cy.baseVal.value):Pt(c,s,l+f/2,h+p/2);if(i.setAttribute("data-cx",y.x),i.setAttribute("data-cy",y.y),!W(r)){var v=r.scaleX,d=r.scaleY,b=r.dx,m=r.dy,x=r.ox,g=r.oy;if("drag"===t){if(0===b&&0===m)return;var _=nt();_.e=b,_.f=m;var w=_.multiply(c).multiply(_.inverse());if(i.setAttribute("transform",V(w)),ht(i))ft(i).forEach(function(t){var e=s.createSVGPoint(),n=ot(i.parentNode,s).inverse();e.x=x,e.y=g,n.e=n.f=0;var o=e.matrixTransform(n),r=nt();r.e=b,r.f=m;var a=r.multiply(ot(t,t.parentNode)).multiply(r.inverse());!function(t){return 1===t.a&&0===t.b&&0===t.c&&1===t.d&&0===t.e&&0===t.f}(a)&&t.setAttribute("transform",V(a)),ht(t)||ct(t,{x:o.x,y:o.y})});else ct(i,{x:b,y:m})}if("resize"===t){var M=n.getBBox(),k=M.x,j=M.y,E=M.width,T=M.height;if(lt(e,{x:k,y:j,width:E,height:T},s),ht(i))ft(i).forEach(function(t){ht(t)||ut(t,{scaleX:v,scaleY:d,defaultCTM:t.__ctm__,bBox:a.bBox,container:s,storage:e})});else ut(i,{scaleX:v,scaleY:d,defaultCTM:a.ctm,bBox:a.bBox,container:s,storage:e});i.setAttribute("transform",V(c))}this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var n=this.el,o=this.storage,r=this.options,a=r.container,i=r.proportions,s=this.storage,c=s.box,u=s.left,l=s.top,h=s.cw,f=s.ch,p=s.transform,y=s.revX,v=s.revY,d=s.doW,b=s.doH,m=p.matrix,x=p.scMatrix,g=p.trMatrix,_=p.scaleX,w=p.scaleY,M=c.getBBox(),k=M.width,j=M.height,E=d||!d&&!b?(h+t)/h:(f+e)/f;if(k=i?h*E:h+t,j=i?f*E:f+e,!(Math.abs(k)<5||Math.abs(j)<5)){var T=k/h,S=j/f;x.a=T,x.b=0,x.c=0,x.d=S,x.e=0,x.f=0,g.e=_,g.f=w;var O=g.multiply(x).multiply(g.inverse()),A=m.multiply(O);n.setAttribute("transform",V(A)),this.storage.cached={scaleX:T,scaleY:S},lt(o,{x:u-(k-h)*(b?.5:y?1:0),y:l-(j-f)*(d?.5:v?1:0),width:k,height:j},a)}}},{key:"_processMove",value:function(t,e){var n=this.options.container,o=this.storage,r=o.transform,a=o.wrapper,i=o.center,s=r.matrix,c=r.trMatrix,u=r.scMatrix,l=r.wrapperMatrix,h=r.parentMatrix;u.e=t,u.f=e;var f=u.multiply(l);a.setAttribute("transform",V(f)),h.e=h.f=0;var p=Pt(h.inverse(),n,t,e),y=p.x,v=p.y;c.e=y,c.f=v;var d=c.multiply(s);if(this.el.setAttribute("transform",V(d)),this.storage.cached={dx:y,dy:v,ox:t,oy:e},i.isShifted){var b=l.inverse();b.e=b.f=0;var m=Pt(b,n,t,e),x=m.x,g=m.y;this._moveCenterHandle(-x,-g)}}},{key:"_processRotate",value:function(t){var e=this.storage,n=e.center,o=e.transform,r=e.wrapper,a=o.matrix,i=o.wrapperMatrix,s=o.parentMatrix,c=o.trMatrix,u=o.scMatrix,l=o.rotMatrix,h=At(Math.cos(t)),f=At(Math.sin(t));c.e=n.x,c.f=n.y,l.a=h,l.b=f,l.c=-f,l.d=h;var p=c.multiply(l).multiply(c.inverse()).multiply(i);r.setAttribute("transform",V(p)),u.e=n.el_x,u.f=n.el_y,s.e=s.f=0;var y=s.inverse().multiply(l).multiply(s),v=u.multiply(y).multiply(u.inverse()).multiply(a);this.el.setAttribute("transform",V(v))}},{key:"_getState",value:function(t){var e=t.revX,n=t.revY,o=t.doW,r=t.doH,a=this.el,i=this.storage,s=this.options.container,c=i.box,u=i.wrapper,l=i.parent,h=i.handles.center,f=a.getBBox(),p=f.x,y=f.y,v=f.width,d=f.height,b=c.getBBox(),m=b.width,x=b.height,g=b.x,_=b.y,w=ot(a,l),M=ot(a,s),k=ot(c.parentNode,s),j=ot(l,s),E=p+v*(r?.5:e?1:0),T=y+d*(o?.5:n?1:0),S={matrix:w,ctm:M,boxCTM:k,parentMatrix:j,wrapperMatrix:ot(u,u.parentNode),trMatrix:nt(),scMatrix:nt(),rotMatrix:nt(),scaleX:E,scaleY:T,scX:Math.sqrt(M.a*M.a+M.b*M.b),scY:Math.sqrt(M.c*M.c+M.d*M.d),bBox:f},O=g+m/2,A=_+x/2,P=h?h.cx.baseVal.value:O,V=h?h.cy.baseVal.value:A,C=Pt(k,s,P,V),R=C.x,D=C.y,z=I(h)?Pt(j.inverse(),s,R,D):Pt(w,s,p+v/2,y+d/2),X=z.x,Y=z.y,N=Pt(ot(c,s),s,O,A),B=N.x,L=N.y;return ft(a).forEach(function(t){t.__ctm__=ot(t,s)}),{transform:S,cw:m,ch:x,center:{x:h?R:B,y:h?D:L,el_x:X,el_y:Y,hx:h?h.cx.baseVal.value:null,hy:h?h.cy.baseVal.value:null,isShifted:At(B,3)!==At(R,3)&&At(L,3)!==At(D,3)},left:g,top:_,revX:e,revY:n,doW:o,doH:r}}},{key:"_moveCenterHandle",value:function(t,e){var n=this.storage,o=n.handles,r=n.center,a=n.radius;W(o.center)||(o.center.cx.baseVal.value=r.hx+t,o.center.cy.baseVal.value=r.hy+e,a.x2.baseVal.value=r.hx+t,a.y2.baseVal.value=r.hy+e)}},{key:"resetCenterPoint",value:function(){var t=this.storage,e=t.box,n=t.handles,o=t.radius,r=n.center,a=this.options.container,i=e.getBBox(),s=i.width,c=i.height,u=i.x,l=i.y,h=Pt(ot(e,e.parentNode),a,u+s/2,l+c/2),f=h.x,p=h.y;r.cx.baseVal.value=f,r.cy.baseVal.value=p,r.isShifted=!1,o.x2.baseVal.value=f,o.y2.baseVal.value=p}},{key:"controls",get:function(){return this.storage.wrapper}}]),r}();function ct(e,t){var n=t.x,o=t.y,r=[];switch(e.tagName.toLowerCase()){case"use":case"image":case"text":case"rect":var a=e.x.baseVal.value+n,i=e.y.baseVal.value+o;r.push(["x",a],["y",i]);break;case"circle":case"ellipse":var s=e.cx.baseVal.value+n,c=e.cy.baseVal.value+o;r.push(["cx",s],["cy",c]);break;case"line":var u=e.x1.baseVal.value+n,l=e.y1.baseVal.value+o,h=e.x2.baseVal.value+n,f=e.y2.baseVal.value+o;r.push(["x1",u],["y1",l],["x2",h],["y2",f]);break;case"polygon":case"polyline":var p=pt(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+n,t[1]=Number(t[1])+o,t.join(" ")}).join(" ");r.push(["points",p]);break;case"path":var y=e.getAttribute("d");r.push(["d",function(t){var e=t.path,n=t.dx,o=t.dy;try{for(var r=Rt(e),a="",i=" ",s=!0,c=0,u=r.length;c<u;c++){var l=r[c],h=l.values,f=l.key,p=l.relative,y=[];switch(f){case"M":for(var v=0,d=h.length;v<d;v+=2){var b=Ct(h.slice(v,v+2),2),m=b[0],x=b[1];p&&!s||(m+=n,x+=o),y.push(m,x),s=!1}break;case"A":for(var g=0,_=h.length;g<_;g+=7){var w=h.slice(g,g+7);p||(w[5]+=n,w[6]+=o),y.push.apply(y,Z(w))}break;case"C":for(var M=0,k=h.length;M<k;M+=6){var j=h.slice(M,M+6);p||(j[0]+=n,j[1]+=o,j[2]+=n,j[3]+=o,j[4]+=n,j[5]+=o),y.push.apply(y,Z(j))}break;case"H":for(var E=0,T=h.length;E<T;E+=1){var S=h.slice(E,E+1);p||(S[0]+=n),y.push(S[0])}break;case"V":for(var O=0,A=h.length;O<A;O+=1){var P=h.slice(O,O+1);p||(P[0]+=o),y.push(P[0])}break;case"L":case"T":for(var V=0,C=h.length;V<C;V+=2){var R=Ct(h.slice(V,V+2),2);m=R[0],x=R[1];p||(m+=n,x+=o),y.push(m,x)}break;case"Q":case"S":for(var D=0,z=h.length;D<z;D+=4){var X=Ct(h.slice(D,D+4),4),Y=X[0],N=X[1],B=X[2],L=X[3];p||(Y+=n,N+=o,B+=n,L+=o),y.push(Y,N,B,L)}break;case"Z":i=h[0]=""}a+=l.cmd+y.join(",")+i}return a}catch(t){Ot("Path parsing error: "+t)}}({path:y,dx:n,dy:o})])}r.forEach(function(t){e.setAttribute(t[0],t[1])})}function ut(e,t){var n=t.scaleX,o=t.scaleY,r=t.bBox,a=t.defaultCTM,i=t.container,s=r.width,c=r.height,u=[],l=ot(e,i),h=a.inverse().multiply(l);switch(e.tagName.toLowerCase()){case"text":var f=e.x.baseVal.value,p=e.y.baseVal.value,y=Pt(h,i,f,p),v=y.x,d=y.y;u.push(["x",v+(n<0?s:0)],["y",d+(o<0?c:0)]);break;case"circle":var b=e.r.baseVal.value,m=e.cx.baseVal.value,x=e.cy.baseVal.value,g=b*(Math.abs(n)+Math.abs(o))/2,_=Pt(h,i,m,x),w=_.x,M=_.y;u.push(["r",g],["cx",w],["cy",M]);break;case"image":case"rect":var k=e.width.baseVal.value,j=e.height.baseVal.value,E=e.x.baseVal.value,T=e.y.baseVal.value,S=Pt(h,i,E,T),O=S.x,A=S.y,P=Math.abs(k*n),V=Math.abs(j*o);u.push(["x",O-(n<0?P:0)],["y",A-(o<0?V:0)],["width",P],["height",V]);break;case"ellipse":var C=e.rx.baseVal.value,R=e.ry.baseVal.value,D=e.cx.baseVal.value,z=e.cy.baseVal.value,X=Pt(h,i,D,z),Y=X.x,N=X.y,B=nt();B.a=n,B.d=o;var L=Pt(B,i,C,R),F=L.x,H=L.y;u.push(["rx",Math.abs(F)],["ry",Math.abs(H)],["cx",Y],["cy",N]);break;case"line":var I=e.x1.baseVal.value,W=e.y1.baseVal.value,q=e.x2.baseVal.value,U=e.y2.baseVal.value,G=Pt(h,i,I,W),Q=G.x,Z=G.y,$=Pt(h,i,q,U),J=$.x,K=$.y;u.push(["x1",Q],["y1",Z],["x2",J],["y2",K]);break;case"polygon":case"polyline":var tt=pt(e.getAttribute("points")).map(function(t){var e=Pt(h,i,Number(t[0]),Number(t[1])),n=e.x,o=e.y;return t[0]=n,t[1]=o,t.join(" ")}).join(" ");u.push(["points",tt]);break;case"path":var et=e.getAttribute("d");u.push(["d",function(t){var e=t.path,n=t.localCTM,o=t.container;try{for(var r=Rt(e),a="",i=" ",s=[],c=!0,u=0,l=r.length;u<l;u++){var h=r[u],f=h.values,p=h.key,y=h.relative;switch(p){case"A":for(var v=[],d=0,b=f.length;d<b;d+=7){var m=Ct(f.slice(d,d+7),7),x=m[0],g=m[1],_=m[2],w=m[3],M=m[4],k=m[5],j=m[6],E=Vt(n);y&&(E.e=E.f=0);var T=Pt(E,o,k,j),S=T.x,O=T.y;v.push(At(S),At(O)),E.e=E.f=0;var A=Pt(E,o,x,g),P=A.x,V=A.y;v.unshift(At(P),At(V),_,w,M)}s.push(v);break;case"C":for(var C=[],R=0,D=f.length;R<D;R+=6){var z=Ct(f.slice(R,R+6),6),X=z[0],Y=z[1],N=z[2],B=z[3],L=(k=z[4],j=z[5],Vt(n));y&&(L.e=L.f=0);var F=Pt(L,o,X,Y),H=F.x,I=F.y,W=Pt(L,o,N,B),q=W.x,U=W.y,G=Pt(L,o,k,j);S=G.x,O=G.y;C.push(At(H),At(I),At(q),At(U),At(S),At(O))}s.push(C);break;case"H":for(var Q=[],Z=0,$=f.length;Z<$;Z+=1){k=Ct(f.slice(Z,Z+1),1)[0];var J=Vt(n);y&&(J.e=J.f=0);S=Pt(J,o,k,0).x;Q.push(At(S))}s.push(Q);break;case"V":for(var K=[],tt=0,et=f.length;tt<et;tt+=1){j=Ct(f.slice(tt,tt+1),1)[0];var nt=Vt(n);y&&(nt.e=nt.f=0);O=Pt(nt,o,0,j).y;K.push(At(O))}s.push(K);break;case"T":case"L":for(var ot=[],rt=0,at=f.length;rt<at;rt+=2){var it=Ct(f.slice(rt,rt+2),2),st=(k=it[0],j=it[1],Vt(n));y&&(st.e=st.f=0);var ct=Pt(st,o,k,j);S=ct.x,O=ct.y;ot.push(At(S),At(O))}s.push(ot);break;case"M":for(var ut=[],lt=0,ht=f.length;lt<ht;lt+=2){var ft=Ct(f.slice(lt,lt+2),2),pt=(k=ft[0],j=ft[1],Vt(n));y&&!c&&(pt.e=pt.f=0);var yt=Pt(pt,o,k,j);S=yt.x,O=yt.y;ut.push(At(S),At(O)),c=!1}s.push(ut);break;case"Q":for(var vt=[],dt=0,bt=f.length;dt<bt;dt+=4){var mt=Ct(f.slice(dt,dt+4),4),xt=(X=mt[0],Y=mt[1],k=mt[2],j=mt[3],Vt(n));y&&(xt.e=xt.f=0);var gt=Pt(xt,o,X,Y),_t=(H=gt.x,I=gt.y,Pt(xt,o,k,j));S=_t.x,O=_t.y;vt.push(At(H),At(I),At(S),At(O))}s.push(vt);break;case"S":for(var wt=[],Mt=0,kt=f.length;Mt<kt;Mt+=4){var jt=Ct(f.slice(Mt,Mt+4),4),Et=(N=jt[0],B=jt[1],k=jt[2],j=jt[3],Vt(n));y&&(Et.e=Et.f=0);var Tt=Pt(Et,o,N,B),St=(q=Tt.x,U=Tt.y,Pt(Et,o,k,j));S=St.x,O=St.y;wt.push(At(q),At(U),At(S),At(O))}s.push(wt);break;case"Z":s.push([""]),i=""}a+=h.cmd+s[u].join(",")+i}return a}catch(t){Ot("Path parsing error: "+t)}}({path:et,localCTM:h,container:i})])}u.forEach(function(t){e.setAttribute(t[0],t[1])})}function lt(t,e,n){var o=t.box,r=t.handles,a=t.normalLine,i=t.radius,s=t.center,c=e.x,u=e.y,l=e.width,h=e.height,f=l/2,p=h/2,y=ot(o,o.parentNode),v=Pt(y,n,c+f,u+p),d={tl:Pt(y,n,c,u),tr:Pt(y,n,c+l,u),br:Pt(y,n,c+l,u+h),bl:Pt(y,n,c,u+h),tc:Pt(y,n,c+f,u),bc:Pt(y,n,c+f,u+h),ml:Pt(y,n,c,u+p),mr:Pt(y,n,c+l,u+p),rotator:{},center:!s.isShifted&&I(r.center)?v:void 0},b=Math.atan2(d.tl.y-d.tr.y,d.tl.x-d.tr.x);d.rotator.x=d.mr.x-50*Math.cos(b),d.rotator.y=d.mr.y-50*Math.sin(b),a.x1.baseVal.value=d.mr.x,a.y1.baseVal.value=d.mr.y,a.x2.baseVal.value=d.rotator.x,a.y2.baseVal.value=d.rotator.y,I(i)&&(i.x1.baseVal.value=v.x,i.y1.baseVal.value=v.y,s.isShifted||(i.x2.baseVal.value=v.x,i.y2.baseVal.value=v.y));var m={x:c+=l<0?l:0,y:u+=h<0?h:0,width:Math.abs(l),height:Math.abs(h)};Object.keys(m).forEach(function(t){o.setAttribute(t,m[t])}),Object.keys(d).forEach(function(t){var e=r[t],n=d[t];W(n)||(e.setAttribute("cx",n.x),e.setAttribute("cy",n.y))})}function ht(t){return"g"===t.tagName.toLowerCase()}function ft(t){var n=[];return ht(t)?o.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==A.indexOf(e)&&("g"===e&&n.push.apply(n,$(ft(t))),n.push(t))}}):n.push(t),n}function pt(t){return t.match(it).reduce(function(t,e,n,o){return n%2==0&&t.push(o.slice(n,n+2)),t},[])}function yt(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")}function vt(n,t){if(this.length){var o=I(t)&&t instanceof y?t:new y;return s.call(this,function(t,e){return e instanceof SVGElement?function(t){var e=t.tagName.toLowerCase();return-1!==A.indexOf(e)||(Ot("Selected element is not allowed to transform. Allowed elements:\ncircle, ellipse, image, line, path, polygon, polyline, rect, text, g"),!1)}(e)&&t.push(new st(e,n,o)):t.push(new E(e,n,o)),t},[])}}function dt(t){return(dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function bt(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var mt=function(){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.el=t,this.options=e||{},this.storage=null,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this),this.enable()}return function(t,e,n){e&&bt(t.prototype,e),n&&bt(t,n)}(n,[{key:"enable",value:function(){W(this.storage)?this._init():Ot("Already enabled")}},{key:"disable",value:function(){this._destroy()}},{key:"_init",value:function(){var t=this,e=t.el,n=t.options,o=F(e),r=n.style,a=n.onDrop,i=n.appendTo,s=n.stack,c={position:"absolute","z-index":"2147483647",style:I(r)&&"object"===dt(r)?r:void 0},u=I(s)?F(s)[0]:document,l=h(a)?function(t){var e=this.storage.clone;!function(t,e){var n=C(t),o=n.top,r=n.left,a=C(e),i=a.top,s=a.left,c=F(t),u=F(e);return!(o<i||o+parseFloat(c.css("height"))>i+parseFloat(u.css("height"))||r<s||r+parseFloat(c.css("width"))>s+parseFloat(u.css("width")))}(e,u)||a.call(this,t,this.el,e)}:function(){};t.storage={onDrop:l,options:n,css:c,parent:I(i)?F(i)[0]:document.body,stack:u},o.on("mousedown",t._onMouseDown).on("touchstart",t._onTouchStart)}},{key:"_start",value:function(t){t.stopImmediatePropagation&&t.stopImmediatePropagation();var e=this.storage,n=this.el,o=e.parent,r=e.css,a=C(o),i=t.clientX,s=t.clientY;r.left="".concat(i-a.left,"px"),r.top="".concat(s-a.top,"px");var c=n.cloneNode(!0);F(c).css(r),e.clientX=i,e.clientY=s,e.cx=i,e.cy=s,e.clone=c,F(o)[0].appendChild(c),this._draw()}},{key:"_move",value:function(t){t.preventDefault&&t.preventDefault();var e=this.storage;e.clientX=t.clientX,e.clientY=t.clientY,e.doDraw=!0,e.doMove=!0}},{key:"_end",value:function(t){t.stopImmediatePropagation&&t.stopImmediatePropagation();var e=this.storage,n=e.clone,o=e.frameId,r=e.onDrop;e.doDraw=!1,i(o),W(n)||(r.call(this,t),n.parentNode.removeChild(n),delete e.clone)}},{key:"_draw",value:function(){this._animate()}},{key:"_animate",value:function(){var t=this.storage;t.frameId=H(this._animate);var e=t.doDraw,n=t.clientX,o=t.clientY,r=t.cx,a=t.cy,i=t.clone;if(e){t.doDraw=!1;var s="translate(".concat(n-r,"px, ").concat(o-a,"px)");F(i).css({transform:s,webkitTranform:s,mozTransform:s,msTransform:s,otransform:s})}}},{key:"_destroy",value:function(){W(this.storage)||(F(this.el).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),delete this.storage)}},{key:"_onMouseDown",value:function(t){this._start(t),F(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onMouseMove",value:function(t){this._move(t)}},{key:"_onMouseUp",value:function(t){this._end(t),F(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),F(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onTouchMove",value:function(t){this._move(t.touches[0])}},{key:"_onTouchEnd",value:function(t){0===t.touches.length&&this._end(t.changedTouches[0]),F(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)}}]),n}();function xt(e){if(this.length)return a.call(this,function(t){return new mt(t,e)})}function gt(t){return(gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function wt(t,e){return!e||"object"!==gt(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Mt(t){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kt(t,e){return(kt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var jt=function(){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),wt(this,Mt(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kt(t,e)}(e,l),function(t,e,n){e&&_t(t.prototype,e),n&&_t(t,n)}(e,[{key:"drag",value:function(){return vt.call.apply(vt,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return xt.call.apply(xt,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();
/* @license
 * Move/Rotate/Resize tool
 * Released under the MIT license, 2018-2019
 * Karen Sarksyan
 * nichollascarter@gmail.com
*/
function Et(t){return new jt(t)}n.d(e,"default",function(){return Et}),n.d(e,"Subjx",function(){return jt}),n.d(e,"Observable",function(){return y}),Object.defineProperty(Et,"createObservable",{value:function(){return new y}})}],r.c=o,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)).default;function r(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return n[t].call(e.exports,e,e.exports,r),e.l=!0,e.exports}var n,o});