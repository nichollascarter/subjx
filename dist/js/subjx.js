/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function O(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function a(e,t){var r,n=Object.keys(e);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(e),t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)),n}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){O(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){if(null==t)return{};var r,n=function(t,e){if(null==t)return{};for(var r,n={},a=Object.keys(t),o=0;o<a.length;o++)r=a[o],0<=e.indexOf(r)||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols)for(var a=Object.getOwnPropertySymbols(t),o=0;o<a.length;o++)r=a[o],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r]);return n}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(r);return u(this,n?(t=o(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function mt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw o}}return r}(t,e)||f(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||f(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){if(t){if("string"==typeof t)return v(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function S(t){return null==t}function R(t){return"function"==typeof t}function N(t){return R(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var k=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},d=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,e=t.forEach,y=t.slice,p=t.map,b=t.reduce,gt=console.warn,j=function(t){return null!=t},x=function(){function i(t){if(s(this,i),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==w(t)||1!==t.nodeType&&t!==document)if(t instanceof i){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!j(o=t)||"object"!==w(o)||!(Array.isArray(o)||j(window.Symbol)&&"function"==typeof o[window.Symbol.iterator]||j(o.forEach)||"number"==typeof o.length&&(0===o.length||0<o.length&&o.length-1 in o)))throw new Error("Passed parameter must be selector/element/elementArray");this.length=t.length;for(var a=0;a<this.length;a++)1===t[a].nodeType&&(this[a]=t[a])}else this[0]=t,this.length=1;var o}return c(i,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){var e=t.length;if(e--)return(t[e].currentStyle||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],""):t[e].style))[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,y.call(arguments,1)):"object"!==w(r)&&r?(gt("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.addEventListener?this[t].addEventListener(arguments[0],arguments[1],arguments[2]||{passive:!1}):document.attachEvent?this[t].attachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=arguments[1]:m(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!0);return this}},{key:"off",value:function(){for(var t=this.length;t--;)this[t].events||(this[t].events={},this[t].events[arguments[0]]=[]),"string"!=typeof arguments[1]?document.removeEventListener?this[t].removeEventListener(arguments[0],arguments[1],arguments[2]):document.detachEvent?this[t].detachEvent("on".concat(arguments[0]),arguments[1]):this[t]["on".concat(arguments[0])]=null:m(this[t],arguments[0],arguments[1],arguments[2],arguments[3],!1);return this}},{key:"is",value:function(t){if(S(t))return!1;for(var e=D(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),i}();function m(t,e,r,n,a,o){function i(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,a||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,a||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function D(t){return new x(t)}function V(t,e){if(0===e)return t;var r,n=(r=t,0===(n=e)?r:Math.round(r/n)*n);return n-t<e?n:void 0}function _t(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6;return Number(t.toFixed(e))}function g(t,e){return t=t.map(function(t){return t[e]}),[Math.min.apply(Math,z(t)),Math.max.apply(Math,z(t))]}function _(t){return t.getBoundingClientRect()}function P(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function E(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function T(t){return{transform:t="matrix3d(".concat(t.join(),")"),webkitTranform:t,mozTransform:t,msTransform:t,otransform:t}}function M(t,e){var r=window.getComputedStyle(t),n=null,a=function(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=f(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,e=function(){};return{s:e,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:e}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,i=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return o=t.done,t},e:function(t){i=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw a}}}}(ct);try{for(a.s();!(o=a.n()).done;){var o=o.value;if(n=r.getPropertyValue("".concat(o).concat(e))||n)break}}catch(t){a.e(t)}finally{a.f()}return n}function C(t){return t.map(z)}function Y(n){return n.reduce(function(t,e,r){return[].concat(z(t),[n[0][r],n[1][r],n[2][r],n[3][r]])},[])}function X(){return z(Array(0<arguments.length&&void 0!==arguments[0]?arguments[0]:4)).map(function(t,e,r){return r.map(function(){return+!e--})})}function L(r,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return X().map(function(t,e){return t[3]=[r,n,a,1][e],t})}function I(t){return(t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1]?C(t):t)[0][3]=t[1][3]=t[2][3]=0,t}function H(t,e){for(var r=[],n=0,a=t.length;n<a;++n){for(var o=0,i=0;i<a;++i)o+=+t[n][i]*e[i];r[n]=o}return r}function B(t,e){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var a=0;a<t[0].length;a++){for(var o=0,i=0;i<t.length;i++)o+=t[i][a]*e[n][i];r[n].push(o)}}return r}function G(t){for(var e=C(t),r=e.length,n=[],a=0;a<r;a++)n[a]=[];for(var o=0;o<r;o++)for(var i=0;i<r;i++)n[o][i]=0,o==i&&(n[o][i]=1);for(var s=0;s<r;s++){u=e[s][s];for(var c=0;c<r;c++)e[s][c]/=u,n[s][c]/=u;for(var l=s+1;l<r;l++)for(var u=e[l][s],h=0;h<r;h++)e[l][h]-=e[s][h]*u,n[l][h]-=n[s][h]*u}for(var f=r-1;0<f;f--)for(var v=f-1;0<=v;v--){u=e[v][f];for(var d=0;d<r;d++)e[v][d]-=e[f][d]*u,n[v][d]-=n[f][d]*u}for(var y=0;y<r;y++)for(var p=0;p<r;p++)e[y][p]=n[y][p];return e}function F(t){for(var e,r,n,a,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body,i=2<arguments.length?arguments[2]:void 0,s=X(),c=t,l=i||ve(c),u=!1;c&&c instanceof Element;){var h=de(c,u),s=B(s,(e=l,r=a=n=r=void 0,r=mt(h=h,3),n=r[0],a=r[1],h=r[2],r=L(-n,-a,-h),h=L(n,a,h),B(B(r,e),h))),u=!0;if(c===o||null===c.offsetParent)break;c=c.offsetParent,l=ve(c)}return s}function W(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),n=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]),a=Math.atan2(-t[0][3]/n,t[1][3]/n),o=Math.asin(t[3][1]/n),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=t[a=0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:a,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/n},scale:{sX:e,sY:r,sZ:n}}}function q(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body,r=0,n=0,a=!1;t;){var o=F(t.offsetParent),o=mt(H(I(o,!1),[t.offsetLeft+(a?t.clientLeft:0),t.offsetTop+(a?t.clientTop:0),0,1]),2);if(n+=o[0],r+=o[1],e===t)break;a=!0,t=t.offsetParent}return[n,r,0,1]}var Z=2,U="#00a8ff",Q="sjx-",$="dragStart",J="drag",K="dragEnd",tt="resizeStart",et="resize",rt="resizeEnd",nt="rotateStart",at="rotate",ot="rotateEnd",it="setPointStart",st="setPointEnd",ct=["","-webkit-","-moz-","-ms-","-o-"],lt="ongetstate",ut="onapply",ht="onmove",ft="onresize",t="onrotate",t={NOTIFIER_EVENTS:[lt,ut,ht,ft,t],ON_GETSTATE:lt,ON_APPLY:ut,ON_MOVE:ht,ON_RESIZE:ft,ON_ROTATE:t},K={EMITTER_EVENTS:[$,J,,K,tt,et,rt,nt,at,ot,it,st],E_DRAG_START:$,E_DRAG:J,E_DRAG_END:K,E_RESIZE_START:tt,E_RESIZE:et,E_RESIZE_END:rt,E_ROTATE_START:nt,E_ROTATE:at,E_ROTATE_END:ot,E_SET_POINT_START:it,E_SET_POINT_END:st},tt="mousedown",et="mouseup",rt="mousemove",nt="touchstart",at="touchend",ot="touchmove",it={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},st={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},vt=t.ON_GETSTATE,dt=t.ON_APPLY,yt=t.ON_MOVE,pt=t.ON_RESIZE,bt=t.ON_ROTATE,xt=function(){function t(){s(this,t),this.observers={}}return c(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return S(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;return j(r[t])&&(e=r[t].indexOf(e),r[t].splice(e,1)),this}},{key:"notify",value:function(e,r,n){S(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case yt:t.notifyMove(n);break;case bt:t.notifyRotate(n);break;case pt:t.notifyResize(n);break;case dt:t.notifyApply(n);break;case vt:t.notifyGetState(n)}})}}]),t}(),Et=function(){function e(t){s(this,e),this.name=t,this.callbacks=[]}return c(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){t=this.callbacks(t);this.callbacks.splice(t,1)}}]),e}(),Mt=function(){function t(){s(this,t),this.events={}}return c(t,[{key:"registerEvent",value:function(t){this.events[t]=new Et(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),Tt=K.E_DRAG,kt=rt,wt=et,Ot=ot,St=at,At=function(){function e(t){s(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new Mt,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return c(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){Rt()}},{key:"_init",value:function(){Rt()}},{key:"_destroy",value:function(){Rt()}},{key:"_processOptions",value:function(){Rt()}},{key:"_start",value:function(){Rt()}},{key:"_moving",value:function(){Rt()}},{key:"_end",value:function(){Rt()}},{key:"_animate",value:function(){Rt()}},{key:"_drag",value:function(t){var e=t.dx,r=t.dy,t=l(t,["dx","dy"]),t=A({dx:e,dy:r,transform:this._processMove(e,r)},t);this.proxyMethods.onMove.call(this,t),this._emitEvent(Tt,t)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),D(document).on(kt,this._onMouseMove).on(wt,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),D(document).on(Ot,this._onTouchMove).on(St,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){D(document).off(kt,this._onMouseMove).off(wt,this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){D(document).off(Ot,this._onTouchMove).off(St,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),Rt=function(){throw Error("Method not implemented")},Nt=Math.PI/180,jt=t.NOTIFIER_EVENTS,Dt=t.ON_GETSTATE,Vt=t.ON_APPLY,Pt=t.ON_MOVE,Ct=t.ON_RESIZE,Yt=t.ON_ROTATE,Xt=K.EMITTER_EVENTS,Lt=K.E_DRAG_START,It=K.E_DRAG,zt=K.E_DRAG_END,Ht=K.E_RESIZE_START,Bt=K.E_RESIZE,Gt=K.E_RESIZE_END,Ft=K.E_ROTATE_START,Wt=K.E_ROTATE,qt=K.E_ROTATE_END,Zt=tt,Ut=nt,Qt=rt,$t=et,Jt=ot,Kt=at,te=it.TOP_LEFT,ee=it.TOP_CENTER,re=it.TOP_RIGHT,ne=it.BOTTOM_LEFT,ae=it.BOTTOM_RIGHT,oe=it.BOTTOM_CENTER,ie=it.MIDDLE_LEFT,se=it.MIDDLE_RIGHT,ce=st.TOP_EDGE,le=st.BOTTOM_EDGE,ue=st.LEFT_EDGE,he=st.RIGHT_EDGE,fe=function(){i(o,At);var a=h(o);function o(t,e,r){var n;if(s(this,o),(n=a.call(this,t)).constructor===o)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,Xt.forEach(function(t){return n.eventDispatcher.registerEvent(t)}),n.enable(e),n}return c(o,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.radians,t=l(t,["radians"]),t=A({transform:this._processRotate(e),delta:e},t);this.proxyMethods.onRotate.call(this,t),this._emitEvent(Wt,t)}},{key:"_resize",value:function(t){var e=t.dx,r=t.dy,t=l(t,["dx","dy"]),t=A(A({},this._processResize(e,r)),{},{dx:e,dy:r},t);this.proxyMethods.onResize.call(this,t),this._emitEvent(Bt,t)}},{key:"_processOptions",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.el;P(e,"".concat(Q,"drag"));var r=t.each,n=void 0===r?{move:!1,resize:!1,rotate:!1}:r,a=t.snap,o=void 0===a?{x:10,y:10,angle:10}:a,i=t.axis,s=void 0===i?"xy":i,c=t.cursorMove,l=void 0===c?"auto":c,u=t.cursorResize,h=void 0===u?"auto":u,f=t.cursorRotate,v=void 0===f?"auto":f,d=t.rotationPoint,y=void 0!==d&&d,p=t.restrict,b=t.draggable,x=void 0===b||b,m=t.resizable,g=void 0===m||m,_=t.rotatable,E=void 0===_||_,M=t.scalable,T=void 0!==M&&M,k=t.applyTranslate,r=void 0!==k&&k,a=t.onInit,i=void 0===a?function(){}:a,c=t.onDrop,u=void 0===c?function(){}:c,f=t.onMove,d=void 0===f?function(){}:f,b=t.onResize,m=void 0===b?function(){}:b,_=t.onRotate,M=void 0===_?function(){}:_,k=t.onDestroy,a=void 0===k?function(){}:k,c=t.container,f=void 0===c?e.parentNode:c,b=t.controlsContainer,_=void 0===b?f:b,k=t.proportions,e=void 0!==k&&k,c=t.rotatorAnchor,b=void 0===c?null:c,k=t.rotatorOffset,c=void 0===k?50:k,k=t.showNormal,k=void 0===k||k,t=t.custom;this.options={axis:s,cursorMove:l,cursorRotate:v,cursorResize:h,rotationPoint:y,restrict:p?D(p)[0]||document.body:null,container:D(f)[0],controlsContainer:D(_)[0],snap:A(A({},o),{},{angle:o.angle*Nt}),each:n,proportions:e,draggable:x,resizable:g,rotatable:E,scalable:T,applyTranslate:r,custom:"object"===w(t)&&t||null,rotatorAnchor:b,rotatorOffset:c,showNormal:k},this.proxyMethods={onInit:N(i),onDrop:N(u),onMove:N(d),onResize:N(m),onRotate:N(M),onDestroy:N(a)},this.subscribe(n)}},{key:"_animate",value:function(){var t,e,r,n,a,o,i,s,c,l,u,h,f,v,d,y,p,b,x,m,g,_=this,E=_.observable,M=_.storage,T=_.options;S(M)||(M.frame=k(_._animate),M.doDraw&&(M.doDraw=!1,t=M.dox,e=M.doy,g=M.clientX,m=M.clientY,r=M.doDrag,u=M.doResize,p=M.doRotate,n=M.doSetCenter,a=M.revX,o=M.revY,i=T.snap,s=(d=T.each).move,c=d.resize,l=d.rotate,y=T.draggable,f=T.resizable,x=T.rotatable,u&&f&&(v=(h=M.transform).scX,d=h.scY,T=M.cx,u=M.cy,h=(f=this._pointToElement({x:g,y:m})).x,f=f.y,v=t?V(h-T,i.x/v):0,d=e?V(f-u,i.y/d):0,d={dx:v=t?a?-v:v:0,dy:d=e?o?-d:d:0,clientX:g,clientY:m},_._resize(d),c&&E.notify(Ct,_,d)),r&&y&&(y=M.nx,b=M.ny,b={dx:t?V(g-y,i.x):0,dy:e?V(m-b,i.y):0,clientX:g,clientY:m},_._drag(b),s&&E.notify(Pt,_,b)),p&&x&&(b=M.pressang,p=M.center,p=Math.atan2(m-p.y,g-p.x)-b,b={clientX:g,clientY:m},_._rotate(A({radians:V(p,i.angle)},b)),l&&E.notify(Yt,_,A({radians:p},b))),n&&x&&(x=M.bx,M=M.by,m=(g=this._pointToControls({x:g,y:m})).x,g=g.y,_._moveCenterHandle(m-x,g-M))))}},{key:"_start",value:function(e){var r,t,n,a,o,i,s,c,l,u,h,f=e.clientX,v=e.clientY,d=this.observable,y=this.storage,p=this.storage.handles,b=this.options,x=b.axis,m=b.each,g=this.el,_=Object.values(p).some(function(t){return D(e.target).is(t)})||g.contains(e.target);(y.isTarget=_)&&(r=this._compute(e,g),Object.keys(r).map(function(t){return y[t]=r[t]}),u=r.onRightEdge,l=r.onBottomEdge,s=r.onTopEdge,c=r.onLeftEdge,h=r.handle,t=r.factor,n=r.revX,a=r.revY,o=r.doW,i=r.doH,b=u||l||s||c,_=p.rotator,u=p.center,l=p.radius,j(l)&&E(l,"".concat(Q,"hidden")),s=h.is(_),c=!!j(u)&&h.is(u),l=g.contains(e.target)&&!(s||b||c),u=(_=this._cursorPoint({clientX:f,clientY:v})).x,g=_.y,x={clientX:f,clientY:v,cx:(_=this._pointToElement({x:u,y:g})).x,cy:_.y,nx:u,ny:g,bx:(g=this._pointToControls({x:u,y:g})).x,by:g.y,doResize:b,doDrag:l,doRotate:s,doSetCenter:c,onExecution:!0,cursor:null,dox:/\x/.test(x)&&(!b||(h.is(p.ml)||h.is(p.mr)||h.is(p.tl)||h.is(p.tr)||h.is(p.bl)||h.is(p.br)||h.is(p.le)||h.is(p.re))),doy:/\y/.test(x)&&(!b||(h.is(p.br)||h.is(p.bl)||h.is(p.bc)||h.is(p.tr)||h.is(p.tl)||h.is(p.tc)||h.is(p.te)||h.is(p.be))),cached:{}},this.storage=A(A({},y),x),h={clientX:f,clientY:v},b?this._emitEvent(Ht,h):s?this._emitEvent(Ft,h):l&&this._emitEvent(Lt,h),p=m.move,x=m.resize,h=m.rotate,m=b?Bt:s?Wt:It,p=b&&x||s&&h||l&&p,d.notify(Dt,this,{clientX:f,clientY:v,actionName:m,triggerEvent:p,factor:t,revX:n,revY:a,doW:o,doH:i}),this._draw())}},{key:"_moving",value:function(t){var e,r,n,a=this.storage,o=void 0===a?{}:a,i=this.options;o.isTarget&&(r=(e=this._cursorPoint(t)).x,n=e.y,o.e=t,o.clientX=r,o.clientY=n,o.doDraw=!0,a=o.doRotate,e=o.doDrag,t=o.doResize,r=o.cursor,n=i.cursorMove,o=i.cursorResize,i=i.cursorRotate,S(r)&&(e?r=n:a?r=i:t&&(r=o),D(document.body).css({cursor:r})))}},{key:"_end",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.each,a=this.observable,o=this.storage,i=this.storage,s=i.doResize,c=i.doDrag,l=i.doRotate,u=i.frame,h=i.handles.radius,t=i.isTarget,i=this.proxyMethods;t&&(t=s?Bt:c?It:Wt,o.doResize=!1,o.doDrag=!1,o.doRotate=!1,o.doSetCenter=!1,o.doDraw=!1,o.onExecution=!1,o.cursor=null,this._apply(t),o={clientX:e,clientY:r},i.onDrop.call(this,o),s?this._emitEvent(Gt,o):l?this._emitEvent(qt,o):c&&this._emitEvent(zt,o),i=n.move,o=n.resize,n=n.rotate,i=s&&o||l&&n||c&&i,a.notify(Vt,this,{clientX:e,clientY:r,actionName:t,triggerEvent:i}),d(u),D(document.body).css({cursor:"auto"}),j(h)&&P(h,"".concat(Q,"hidden")))}},{key:"_compute",value:function(e,t){var r=this.storage.handles,n=D(e.target),a=this._checkHandles(n,r),o=a.revX,i=a.revY,s=a.doW,c=a.doH,a=l(a,["revX","revY","doW","doH"]),i=this._getState({revX:o,revY:i,doW:s,doH:c}),s=this._cursorPoint(e),c=s.x,s=s.y,c=Math.atan2(s-i.center.y,c-i.center.x);return A(A(A({},i),a),{},{handle:Object.values(r).some(function(t){return D(e.target).is(t)})?n:D(t),pressang:c})}},{key:"_checkHandles",value:function(e,r){function t(t){return t.some(function(t){return t=r[t],!!j(t)&&e.is(t)})}return{revX:t([te,ie,ne,ee,ue]),revY:t([te,re,ee,ie,ce]),onTopEdge:t([ee,re,te,ce]),onLeftEdge:t([te,ie,ne,ue]),onRightEdge:t([re,se,ae,he]),onBottomEdge:t([ae,oe,ne,le]),doW:t([ie,se,ue,he]),doH:t([ee,oe,le,ce])}}},{key:"_destroy",value:function(){var e=this,t=this.el,r=this.storage,n=r.controls,r=r.wrapper;[t,n].map(function(t){return D(t).off(Zt,e._onMouseDown).off(Ut,e._onTouchStart)}),r.parentNode.removeChild(r)}},{key:"notifyMove",value:function(){this._drag.apply(this,arguments)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=l(t,["radians"]),t=this.options.snap.angle;this._rotate(A({radians:V(e,t)},r))}},{key:"notifyResize",value:function(){this._resize.apply(this,arguments)}},{key:"notifyApply",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,t=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:e,clientY:r}),t&&(this._apply(n),this._emitEvent("".concat(n,"End"),{clientX:e,clientY:r}))}},{key:"notifyGetState",value:function(t){var e=t.clientX,r=t.clientY,n=t.actionName,a=t.triggerEvent,t=l(t,["clientX","clientY","actionName","triggerEvent"]);a&&(t=this._getState(t),this.storage=A(A({},this.storage),t),this._emitEvent("".concat(n,"Start"),{clientX:e,clientY:r}))}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,t=this.observable;(r||e||n)&&t.subscribe(Dt,this).subscribe(Vt,this),r&&t.subscribe(Pt,this),e&&t.subscribe(Ct,this),n&&t.subscribe(Yt,this)}},{key:"unsubscribe",value:function(){var e=this,r=this.observable;jt.map(function(t){return r.unsubscribe(t,e)})}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;S(t)||(t.onExecution&&D(document).off(Qt,this._onMouseMove).off($t,this._onMouseUp).off(Jt,this._onTouchMove).off(Kt,this._onTouchEnd),E(r,"".concat(Q,"drag")),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var e=t.dx,t=t.dy;this.options.draggable&&(this.storage=A(A({},this.storage),this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._drag({dx:e,dy:t}),this._apply(It))}},{key:"exeResize",value:function(t){var e=t.dx,r=t.dy,n=t.revX,a=void 0!==n&&n,o=t.revY,n=void 0!==o&&o,o=t.doW,o=void 0!==o&&o,t=t.doH,t=void 0!==t&&t;this.options.resizable&&(this.storage=A(A({},this.storage),this._getState({revX:a,revY:n,doW:o,doH:t})),this._resize({dx:e,dy:r}),this._apply(Bt))}},{key:"exeRotate",value:function(t){t=t.delta;this.options.rotatable&&(this.storage=A(A({},this.storage),this._getState({revX:!1,revY:!1,doW:!1,doH:!1})),this._rotate({radians:t}),this._apply(Wt))}}]),o}(),ve=function(t){var t=M(t,"transform")||"none",e=X();if("none"===t)return e;var r=t.split(/\s*[(),]\s*/).slice(1,-1);if(16!==r.length)return[[+r[0],+r[2],0,+r[4]],[+r[1],+r[3],0,+r[5]],[0,0,1,0],[0,0,0,1]];for(var n=0;n<4;++n)for(var a=0;a<4;++a)e[a][n]=+r[4*n+a];return e},de=function(t,e){for(var r=M(t,"transform-origin"),n=r?r.split(" "):[],a=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1],o=0;o<n.length;++o)a[o]+=parseFloat(n[o]);return a},ye=tt,pe=nt,be=function(){i(e,fe);var t=h(e);function e(){return s(this,e),t.apply(this,arguments)}return c(e,[{key:"_init",value:function(e){var r=this,t=this.options,n=t.rotationPoint,a=t.container,o=t.controlsContainer,i=t.resizable,s=t.rotatable,c=t.showNormal,l=t.rotatorOffset,u=t.rotatorAnchor,h=e.offsetHeight,f=e.offsetWidth,v=Me(["sjx-wrapper"]),d=Me(["sjx-controls"]),y={},p=F(e,a),t=mt(q(e,a),2),b=t[0],x=t[1],a=["data-sjx-cx","data-sjx-cy"].map(function(t){t=e.getAttribute(t);return j(t)?Number(t):void 0}),t=a.every(function(t){return!isNaN(t)}),f={tl:[0,0,0,1],bl:[0,h,0,1],br:[f,h,0,1],tr:[f,0,0,1],tc:[f/2,0,0,1],ml:[0,h/2,0,1],bc:[f/2,h,0,1],mr:[f,h/2,0,1],center:[f/2,h/2,0,1]},m=Object.entries(f).reduce(function(t,e){var r=mt(e,2),e=r[0],r=r[1];return[].concat(z(t),[[e,H(p,r)]])},[]).reduce(function(t,e){var r=mt(e,2),n=r[0],a=mt(r[1],4),o=a[0],e=a[1],r=a[2],a=a[3];return t[n]=[o+b,e+x,r,a],t},{}),h={},f=null;if(s){var g={},_=1;switch(u){case"n":g.x=m.tc[0],g.y=m.tc[1];break;case"s":g.x=m.bc[0],g.y=m.bc[1],_=-1;break;case"w":g.x=m.ml[0],g.y=m.ml[1],_=-1;break;case"e":default:g.x=m.mr[0],g.y=m.mr[1]}var E="n"===u||"s"===u?Math.atan2(m.bl[1]-m.tl[1],m.bl[0]-m.tl[0]):Math.atan2(m.tl[1]-m.tr[1],m.tl[0]-m.tr[0]),f=[g.x-l*_*Math.cos(E),g.y-l*_*Math.sin(E)],l=c?me([[g.x,g.y],f]):null;c&&d.appendChild(l);E=null;n&&(E=me([m.center,m.center]),P(E,"sjx-hidden"),d.appendChild(E)),h=A(A({},h),{},{normal:l,radius:E})}E={te:[m.tl,m.tr],be:[m.bl,m.br],le:[m.tl,m.bl],re:[m.tr,m.br]},i=i?{tl:m.tl,tr:m.tr,br:m.br,bl:m.bl,tc:m.tc,bc:m.bc,ml:m.ml,mr:m.mr}:{},a=t?[].concat(z(a),[0,1]):m.center,a=A(A({},i),{},{center:n&&s?a:void 0,rotator:f}),f=function(r,n){return Object.keys(r).map(function(t){var e=r[t];S(e)||(e=n(e,t),y[t]=e,d.appendChild(e))})};f(E,me),f(a,xe),v.appendChild(d),o.appendChild(v),this.storage={wrapper:v,controls:d,handles:A(A({},y),h),parent:e.parentNode,center:{isShifted:t},cached:{}},[e,d].map(function(t){return D(t).on(ye,r._onMouseDown).on(pe,r._onTouchStart)})}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,t=this.storage.transform.ctm,t=G(t);return this._applyMatrixToPoint(I(t,!1),e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,t=this.storage.transform.wrapperMatrix,t=G(t);return this._applyMatrixToPoint(I(t,!1),e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){r=mt(H(t,[e,r,0,1]),2);return{x:r[0],y:r[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,t=this.options.container,t=F(t);return this._applyMatrixToPoint(G(t),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,n=r.restrict,r=r.container,a=null,o=null,e=Ee(n,r,e),i=this.getBoundingRect(t),t=mt(g(e,0),2),s=t[0],c=t[1],e=mt(g(e,1),2),l=e[0],u=e[1],h=0,f=i.length;h<f;h++){var v=mt(i[h],2),d=v[0],v=v[1];(d<s||c<d)&&(a=d),(v<l||u<v)&&(o=v)}return{x:a,y:o}}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=e.cached,n=e.controls,a=e.transform.matrix,o=e.center,i=this.options.applyTranslate,e=D(n);S(r)||(t.setAttribute("data-sjx-cx",o.elX),t.setAttribute("data-sjx-cy",o.elY),i&&(n=D(t),o=r.dx,i=r.dy,r=T(a),a=parseFloat(t.style.left||n.css("left")),t=parseFloat(t.style.top||n.css("top")),r.left="".concat(a+o,"px"),r.top="".concat(t+i,"px"),n.css(r),e.css(r)),this.storage.cached={})}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.transform,i=o.matrix,s=o.auxiliary.scale.translateMatrix,c=a.cached,l=(c=void 0===c?{}:c).dist,u=(l=void 0===l?{}:l).dx,h=void 0===u?t:u,f=l.dy,v=void 0===f?e:f,d=a.box,y=d.width,p=d.height,b=a.revX,x=a.revY,m=a.doW,g=a.doH,_=this.options,E=_.proportions,M=_.scalable,o=_.restrict,c=function(t,e){var r=m||!m&&!g?(y+t)/y:(p+e)/p,t=E?y*r:y+t,e=E?p*r:p+e;return[t/y,e/p,t,e]},u=function(t,e){e=function(r,n){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1;return X().map(function(t,e){return t[e]=[r,n,a,o][e],t})}(t,e);return B(B(s,e),G(s))},l=function(t,e){var r=t[0][3],n=t[1][3],t=L(r,n),n=L(r*(b?-1:1),n*(x?-1:1));return B(B(n,e),G(t))},f=mt(c(t,e),4),d=f[0],a=f[1],_=f[2],f=f[3],a=u(d,a),a=(M?B:l)(a,i);this.storage.cached.box={width:_,height:f};f=o?this._restrictHandler(a):{x:null,y:null},a=f.x,f=f.y,o=(null!==a||null!==f)&&o,h=o?h:t,t=o?v:e,o=mt(c(h,t),4),v=o[0],e=o[1],c=o[2],o=o[3];if(!(Math.abs(c)<=Z||Math.abs(o)<=Z)){e=u(v,e),i=(M?B:l)(e,i);return D(r).css(A(A({},T(Y(i))),!M&&{width:"".concat(c,"px"),height:"".concat(o,"px")})),_e(n,this.options,{el:r,boxMatrix:i}),n.cached.dist={dx:h,dy:t},{transform:i,width:c,height:o}}}},{key:"_processMove",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.wrapper,i=a.transform,s=i.matrix,c=i.wrapperMatrix,l=i.auxiliary.translate.parentMatrix,u=a.center,h=a.cached,f=(h=void 0===h?{}:h).dist,v=(f=void 0===f?{}:f).dx,i=void 0===v?t:v,a=f.dy,h=void 0===a?e:a,v=this.options.restrict,f=mt(H(l,[t,e,0,1]),2),a=f[0],f=f[1],f=B(s,L(a,f)),f=v?this._restrictHandler(f):{x:null,y:null},t=null!==f.x&&v?i:t,h=null!==f.y&&v?h:e,e=mt(H(l,[t,h,0,1]),2),l=e[0],e=e[1],l=B(s,L(l,e)),e=B(c,L(t,h)),c=T(Y(l)),e=T(Y(e));return D(r).css(c),D(o).css(e),n.cached.dist={dx:t,dy:h},u.isShifted,l}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage.transform,n=r.matrix,a=r.auxiliary.rotate.translateMatrix,o=this.options.restrict,i=_t(Math.cos(t),4),r=_t(Math.sin(t),4),i=(t=r,r=i,(i=X())[0][0]=r,i[0][1]=-t,i[1][0]=t,i[1][1]=r,i),a=B(B(G(a),i),a),n=B(n,a),a=o?this._restrictHandler(n):{x:null,y:null},o=a.x,a=a.y;return j(o)||j(a)||(D(e).css(T(Y(n))),_e(this.storage,this.options,{el:e,boxMatrix:n})),n}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,i=this.storage,s=i.handles.center,c=i.parent,l=i.wrapper,u=i.center,h=this.options,f=h.container,v=h.restrict,d=h.scalable,y=v||f,p=y.offsetWidth,b=y.offsetHeight,x=mt(q(o,f),2),m=x[0],g=x[1],_=o.offsetLeft,E=o.offsetTop,M=o.offsetWidth,T=o.offsetHeight,k=ve(o),w=F(o,f),O=F(c,f),S=F(l,f),t=v?F(v,v.parentNode):F(f,f.parentNode),i=M/2,h=T/2,y=a?0:e?-i:i,x=n?0:r?-h:h,c=mt(H(w,[i,h,0,1]),2),l=c[0]+m,v=c[1]+g,f=s?ve(s):X(),c=(s?W(F(s)):{translate:{x:l,y:v}}).translate,s=c.x,c=c.y,s=mt(H(B(G(I(w)),I(f)),[s-l,c-v,0,1]),2),c=s[0],s=s[1],c=mt(H(k,[c,s,0,1]),2),s=c[0],c=c[1],p=H(I(t),[p,b,0,1]),b=W(F(o,o.parentNode)).scale,o=b.sX,b=b.sY;return{transform:{auxiliary:{scale:{translateMatrix:d?L(y,x):L(a?0:i,n?0:h)},translate:{parentMatrix:G(I(O))},rotate:{translateMatrix:L(s,c)}},scaleX:y,scaleY:x,matrix:k,ctm:w,parentMatrix:O,containerMatrix:t,wrapperMatrix:S,scX:o,scY:b,containerBox:p},box:{width:M,height:T,left:_,top:E,offset:{left:m,top:g}},center:A(A({},u),{},{x:l,y:v,elX:s,elY:c,matrix:f}),revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,r=r.center.matrix,e=B(r,L(t,e));D(n).css(A({},T(Y(e)))),this.storage.center.isShifted=!0}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.el,r=e.offsetHeight,n=e.offsetWidth,a=this.storage,o=a.wrapper,i=a.handles.center,s=this.options.container;i&&(a=(e=mt(q(t,s),2))[0],e=e[1],o=B(F(t,s),G(F(o,o.parentNode))),r=(n=mt(H(o,[n/2,r/2,0,1]),2))[0],n=n[1],D(i).css({transform:"translate(".concat(r+a,"px, ").concat(n+e,"px)")}))}},{key:"fitControlsToSize",value:function(){var t=this.el;this.storage.wrapper.removeAttribute("transform"),_e(this.storage,this.options,{el:t})}},{key:"getBoundingRect",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=this.el,r=this.options,n=r.scalable,a=r.restrict,o=this.storage,i=o.box,s=o.box,c=s.width,r=s.height,s=o.cached,o=(s=void 0===s?{}:s).box,s=(o=void 0===o?{}:o).width,s=void 0===s?c:s,o=o.height,o=void 0===o?r:o,o=n?i:A(A({},i),{},{width:s,height:o});return Ee(e,a,F(e,a,t),o)}},{key:"controls",get:function(){return this.storage.wrapper}}]),e}(),xe=function(t){var e=mt(t,2),r=e[0],n=e[1],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"handler",e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},t=Me(["sjx-hdl","sjx-hdl-".concat(t)]);return D(t).css(A({transform:"translate(".concat(r,"px, ").concat(n,"px)")},e)),t},me=function(t,e){var r=mt(t,3),n=r[0],a=r[1],o=r[2],t=void 0===o?1:o,r=ge(n,a,t),o=r.cx,n=r.cy,a=r.length,r=r.theta,e=Me(["sjx-hdl-line","sjx-hdl-".concat(e)]);return D(e).css({transform:"translate(".concat(o,"px, ").concat(n,"px) rotate(").concat(r,"deg)"),height:"".concat(t,"px"),width:"".concat(a,"px")}),e},ge=function(t,e){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=mt(t,2),a=n[0],o=n[1],t=mt(e,2),n=t[0],e=t[1],t=Math.sqrt((n-a)*(n-a)+(e-o)*(e-o));return{cx:(a+n)/2-t/2,cy:(o+e)/2-r/2,thickness:r,theta:Math.atan2(o-e,a-n)*(180/Math.PI),length:t}},_e=function(t,e,r){var n=t.wrapper,o=t.handles,a=t.transform,i=(a=void 0===a?{}:a).wrapperMatrix,s=void 0===i?F(n,n.parentNode):i,c=t.center,l=e.rotationPoint,u=e.rotatable,h=e.resizable,f=e.showNormal,v=e.rotatorOffset,a=e.rotatorAnchor,n=e.container,i=r.el,t=r.el,e=t.offsetHeight,r=t.offsetWidth,t=mt(q(i,n),2),d=t[0],y=t[1],p=B(F(i,n),G(s)),r=A({tl:[0,0,0,1],tr:[r,0,0,1],bl:[0,e,0,1],br:[r,e,0,1],tc:[r/2,0,0,1],ml:[0,e/2,0,1],bc:[r/2,e,0,1],mr:[r,e/2,0,1]},l&&u&&!c.isShifted&&{center:[r/2,e/2,0,1]}),b=Object.entries(r).reduce(function(t,e){var r=mt(e,2),e=r[0],r=r[1];return[].concat(z(t),[[e,H(p,r)]])},[]).reduce(function(t,e){var r=mt(e,2),n=r[0],a=mt(r[1],4),o=a[0],e=a[1],r=a[2],a=a[3];return t[n]=[o+d,e+y,r,a],t},{}),e=null,r={};if(u){var x={},m=1;switch(a){case"n":x.x=b.tc[0],x.y=b.tc[1];break;case"s":x.x=b.bc[0],x.y=b.bc[1],m=-1;break;case"w":x.x=b.ml[0],x.y=b.ml[1],m=-1;break;case"e":default:x.x=b.mr[0],x.y=b.mr[1]}var a="n"===a||"s"===a?Math.atan2(b.bl[1]-b.tl[1],b.bl[0]-b.tl[0]):Math.atan2(b.tl[1]-b.tr[1],b.tl[0]-b.tr[0]),v=v*m,g=[x.x-v*Math.cos(a),x.y-v*Math.sin(a)],e=f?[[x.x,x.y],g]:null,r={rotator:g}}var g=A({},b),_=A({te:[b.tl,b.tr],be:[b.bl,b.br],le:[b.tl,b.bl],re:[b.tr,b.br]},f&&e&&{normal:e});Object.keys(_).forEach(function(t){var e=mt(_[t],2),r=e[0],n=e[1],a=ge(r,n),e=a.cx,r=a.cy,n=a.length,a=a.theta;D(o[t]).css({transform:"translate(".concat(e,"px, ").concat(r,"px) rotate(").concat(a,"deg)"),width:"".concat(n,"px")})});var E=A(A({},h&&g),r);Object.keys(E).forEach(function(t){var e,r=E[t];r&&(r=(e=mt(r,2))[0],e=e[1],D(o[t]).css({transform:"translate(".concat(r,"px, ").concat(e,"px)")}))})},Ee=function(t,e,r,n){var a=mt(q(t,e),2),e=a[0],a=a[1],t=n||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:e,top:a}},e=t.width,a=t.height,t=t.offset,o=t.left,i=t.top;return[[0,0,0,1],[e,0,0,1],[0,a,0,1],[e,a,0,1]].reduce(function(t,e){return[].concat(z(t),[H(r,e)])},[]).map(function(t){var e=mt(t,4),r=e[0],n=e[1],t=e[2],e=e[3];return[r+o,n+i,t,e]})},Me=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=document.createElement("div");return t.forEach(function(t){return P(e,t)}),e},Te=Oe("svg").createSVGPoint(),ke=/[+-]?\d+(\.\d+)?/g,we=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Oe(t,e){var e=1<arguments.length&&void 0!==e?e:[],r=document.createElementNS("http://www.w3.org/2000/svg",t);return e.forEach(function(t){return P(r,t)}),r}function Se(t){var r=[];return Ye(t)?e.call(t.childNodes,function(t){var e;1===t.nodeType&&(e=t.tagName.toLowerCase(),-1!==we.indexOf(e)&&("g"===e&&r.push.apply(r,z(Se(t))),r.push(t)))}):r.push(t),r}function Ae(){return Oe("svg").createSVGMatrix()}function Re(t,e){var r=Ae();return r.e=t,r.f=e,r}function Ne(t,e){return(e.getScreenCTM&&e.getScreenCTM()||Ae()).inverse().multiply(t.getScreenCTM()||Ae())}function je(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,t=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(a,",").concat(o,",").concat(t,")")}function De(t,e,r){return Te.x=e,Te.y=r,Te.matrixTransform(t)}function Ve(t){var e=Ae();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function Pe(t){return t.match(ke).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function Ce(t){for(var e=Xe.lastIndex=0,r=[];e=Xe.exec(t);){var n=mt(e,3),a=n[1],o=n[2],n=a.toUpperCase(),o=o.replace(/([^e])-/g,"$1 -").replace(/ +/g," ");r.push({relative:a!==n,key:n,cmd:a,values:o.trim().split(Le).map(function(t){if(!isNaN(t))return Number(t)})})}return r}var Ye=function(t){return"g"===t.tagName.toLowerCase()},Xe=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,Le=/\s*,\s*|\s+/g,Ie=K.E_DRAG,ze=K.E_RESIZE,He=tt,Be=nt,Ge=function(){i(e,fe);var t=h(e);function e(){return s(this,e),t.apply(this,arguments)}return c(e,[{key:"_init",value:function(e){var r=this,t=this.options,n=t.rotationPoint,a=t.container,o=t.controlsContainer,i=t.resizable,s=t.rotatable,c=t.rotatorAnchor,l=t.rotatorOffset,u=t.showNormal,h=t.custom,f=e.getBBox(),v=f.x,d=f.y,y=f.width,p=f.height,b=Oe("g",["sjx-svg-wrapper"]),x=Oe("g",["sjx-svg-controls"]),m=["data-sjx-cx","data-sjx-cy"].map(function(t){t=e.getAttribute(t);return j(t)?Number(t):void 0}),t=m.every(function(t){return!isNaN(t)}),p={tl:[v,d],tr:[v+y,d],mr:[v+y,d+p/2],ml:[v,d+p/2],tc:[v+y/2,d],bc:[v+y/2,d+p],br:[v+y,d+p],bl:[v,d+p],center:[v+y/2,d+p/2]},g=Ne(e,a),_=Object.entries(p).reduce(function(t,e){var r=mt(e,2),n=r[0],e=mt(r[1],2),r=e[0],e=e[1];return A(A({},t),{},O({},n,De(g,r,e)))},{}),E={},a={},p=null;if(s){var M={},T=1;switch(c){case"n":M.x=_.tc.x,M.y=_.tc.y;break;case"s":M.x=_.bc.x,M.y=_.bc.y,T=-1;break;case"w":M.x=_.ml.x,M.y=_.ml.y,T=-1;break;case"e":default:M.x=_.mr.x,M.y=_.mr.y}c="n"===c||"s"===c?Math.atan2(_.bl.y-_.tl.y,_.bl.x-_.tl.x):Math.atan2(_.tl.y-_.tr.y,_.tl.x-_.tr.x),p={x:M.x-l*T*Math.cos(c),y:M.y-l*T*Math.sin(c)},c=u?$e([M,p],U,"norm"):null;u&&x.appendChild(c);u=null;n&&((u=Oe("line",["sjx-hidden"])).x1.baseVal.value=_.center.x,u.y1.baseVal.value=_.center.y,u.x2.baseVal.value=m[0]||_.center.x,u.y2.baseVal.value=m[1]||_.center.y,Ue(u,"#fe3232"),u.setAttribute("opacity",.5),x.appendChild(u)),a=A(A({},a),{},{normal:c,radius:u})}var p=i?A(A({},_),{},{rotator:p}):{},k={te:[p.tl,p.tr],be:[p.bl,p.br],le:[p.tl,p.bl],re:[p.tr,p.br]};Object.keys(k).forEach(function(t){var e=k[t];S(e)||(E[t]=$e(e,U,t),x.appendChild(E[t]))});var m=t?De(Ae(),m[0],m[1]):_.center,w=A(A({},p),{},{center:n&&s?m:void 0});Object.keys(w).forEach(function(t){var e,r,n=w[t];S(n)||(e=n.x,r=n.y,n="center"===t?"#fe3232":U,j(h)&&R(h[t])?E[t]=h[t](g,f,De):E[t]=Ze(e,r,n,t),x.appendChild(E[t]))}),b.appendChild(x),o.appendChild(b),this.storage={wrapper:b,controls:x,handles:A(A({},E),a),parent:e.parentNode,center:{isShifted:t},cached:{}},[e,x].map(function(t){return D(t).on(He,r._onMouseDown).on(Be,r._onTouchStart)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,t=this.options.container;return this._applyMatrixToPoint(t.getScreenCTM().inverse(),e,r)}},{key:"_restrictHandler",value:function(t){for(var e=this.storage.transform.containerMatrix,r=this.options,n=r.container,r=r.restrict,a=null,o=null,e=Je(void 0===r?n:r,e),i=this.getBoundingRect(t),t=mt(g(e,0),2),s=t[0],c=t[1],e=mt(g(e,1),2),l=e[0],u=e[1],h=0,f=i.length;h<f;h++){var v=mt(i[h],2),d=v[0],v=v[1];(d<s||c<d)&&(a=d),(v<l||u<v)&&(o=v)}return{x:a,y:o}}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,t=this.storage.transform.ctm.inverse();return t.e=t.f=0,this._applyMatrixToPoint(t,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,t=this.storage.transform.wrapperMatrix.inverse();return t.e=t.f=0,this._applyMatrixToPoint(t,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=Oe("svg").createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var r=this.el,n=this.storage,e=this.storage,a=e.bBox,o=e.cached,i=e.transform,s=e.center,c=this.options,l=this.options,u=l.container,h=l.scalable,e=l.applyTranslate,l=i.matrix,f=i.parentMatrix,i=i.ctm;if(r.setAttribute("data-sjx-cx",s.elX),r.setAttribute("data-sjx-cy",s.elY),!S(o)){var v=o.scaleX,d=o.scaleY,y=o.dx,p=o.dy,b=o.ox,x=o.oy,m=o.transformMatrix;if(t===Ie){if(!e||0===y&&0===p)return;var g=Re(y,p),g=g.multiply(l).multiply(g.inverse());r.setAttribute("transform",je(g)),Ye(r)?Se(r).forEach(function(t){var e,r,n,a,o,i=Re(y,p),s=i.multiply(Ne(t,t.parentNode)).multiply(i.inverse());r=(e=s).a,n=e.b,a=e.c,o=e.d,i=e.e,e=e.f,1===r&&0===n&&0===a&&1===o&&0===i&&0===e||t.setAttribute("transform",je(s)),Ye(t)||((s=f.inverse()).e=s.f=0,Fe(t,A({},De(s,b,x))))}):Fe(r,{x:y,y:p})}t===ze&&m&&(h||(Ye(r)?Se(r).forEach(function(t){var e;Ye(t)||(e=(e=Ne(t,r)).inverse().multiply(m).multiply(e),We(t,{scaleX:v,scaleY:d,localCTM:e,bBox:a,container:u,storage:n,cached:o}))}):(g=u.getScreenCTM()||Ae(),t=r.getScreenCTM().multiply(m),t=g.inverse().multiply(t),t=i.inverse().multiply(t),We(r,{scaleX:v,scaleY:d,localCTM:t,bBox:a,container:u,storage:n,cached:o}))),qe(n,c,{boxMatrix:h?i.multiply(m):i,element:r}))}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,a=this.storage,o=a.bBox,i=o.width,s=o.height,c=a.revX,l=a.revY,u=a.doW,h=a.doH,f=a.transform,v=f.matrix,d=f.auxiliary.scale.translateMatrix,y=a.cached,p=(y=void 0===y?{}:y).dist,b=(p=void 0===p?{}:p).dx,x=void 0===b?t:b,m=p.dy,g=void 0===m?e:m,_=this.options,E=_.proportions,o=_.scalable,f=_.restrict,a=r.getBBox(),y=a.x,b=a.y,p=function(t,e){var r=u||!u&&!h?(i+t)/i:(s+e)/s,t=E?i*r:i+t,e=E?s*r:s+e;return[t/i,e/s,t,e]},m=function(t,e){var r,e=(r=t,t=e,(e=Ae()).a=r,e.d=t,e);return d.multiply(e).multiply(d.inverse())},_=v.multiply(m.apply(void 0,z(p(t,e)))),a=f?this._restrictHandler(_):{x:null,y:null},_=a.x,a=a.y,f=(null!==_||null!==a)&&f,x=f?x:t,t=f?g:e,f=mt(p(x,t),4),g=f[0],e=f[1],p=f[2],f=f[3];if(!(Math.abs(p)<=Z||Math.abs(f)<=Z)){m=m(g,e),v=v.multiply(m),c=y-(p-i)*(h?.5:c?1:0),l=b-(f-s)*(u?.5:l?1:0);return o&&r.setAttribute("transform",je(v)),n.cached=A(A({},n.cached),{},{scaleX:g,scaleY:e,transformMatrix:m,resultMatrix:v,dist:{dx:x,dy:t}}),this._apply(ze),{x:c,y:l,width:p,height:f,transform:v}}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=this.storage,a=n.wrapper,o=n.center,i=n.transform,s=i.matrix,c=i.auxiliary.translate,l=c.translateMatrix,u=c.wrapperTranslateMatrix,h=i.wrapperMatrix,f=i.parentMatrix,v=n.cached,d=(v=void 0===v?{}:v).dist,c=(d=void 0===d?{}:d).dx,i=void 0===c?t:c,n=d.dy,v=void 0===n?e:n,c=this.options.restrict;f.e=f.f=0;d=De(f.inverse(),t,e),n=d.x,d=d.y,d=Re(n,d).multiply(s),d=c?this._restrictHandler(d):{x:null,y:null},t=null!==d.x&&c?i:t,e=null!==d.y&&c?v:e;r.cached.dist={dx:t,dy:e};r=De(f.inverse(),t,e),f=r.x,r=r.y;l.e=f,l.f=r;s=l.multiply(s);u.e=t,u.f=e;u=u.multiply(h);return a.setAttribute("transform",je(u)),this.el.setAttribute("transform",je(s)),o.isShifted&&((h=h.inverse()).e=h.f=0,e=(t=De(h,t,e)).x,t=t.y,this._moveCenterHandle(-e,-t)),s}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.wrapper,n=e.transform,a=n.matrix,o=n.wrapperMatrix,i=n.parentMatrix,s=n.auxiliary.rotate,c=s.translateMatrix,l=s.wrapperTranslateMatrix,e=this.options.restrict,n=_t(Math.cos(t)),s=_t(Math.sin(t)),n=(t=s,s=n,(n=Ae()).a=s,n.b=t,n.c=-t,n.d=s,n);i.e=i.f=0;i=i.inverse().multiply(n).multiply(i),c=c.multiply(i).multiply(c.inverse()).multiply(a),a=e?this._restrictHandler(c):{x:null,y:null},e=a.x,a=a.y;if(j(e)||j(a))return c;o=l.multiply(n).multiply(l.inverse()).multiply(o);return r.setAttribute("transform",je(o)),this.el.setAttribute("transform",je(c)),c}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,a=t.doH,o=this.el,i=this.storage,s=i.wrapper,c=i.parent,l=i.handles.center,u=this.options,h=u.container,f=u.restrict,v=u.rotationPoint,d=o.getBBox(),y=d.x,p=d.y,b=d.width,x=d.height,m=Ne(o,c),g=Ne(o,h),_=Ne(s,h),E=Ne(c,h),t=Ne(s,s.parentNode),i=E.inverse(),u=y+b*(a?.5:e?1:0),c=p+x*(n?.5:r?1:0),s=y+b/2,y=p+x/2,b=v?l.cx.baseVal.value:s,p=v?l.cy.baseVal.value:y,x=De(_,b,p),_=x.x,b=x.y,p=v?De(i,_,b):De(m,s,y),x=p.x,p=p.y,s=De(g,s,y),y=s.x,s=s.y;Qe(this.el),Se(o).forEach(function(t){t.__ctm__=Ne(t,t.parentNode),Qe(t)});l=A(A({},this.storage.center||{}),{},{x:v?_:y,y:v?b:s,elX:x,elY:p,hx:v?l.cx.baseVal.value:null,hy:v?l.cy.baseVal.value:null}),h=f?Ne(f,f.parentNode):Ne(h,h.parentNode);return{transform:{auxiliary:{scale:{scaleMatrix:Ae(),translateMatrix:Re(u,c)},translate:{parentMatrix:i,translateMatrix:Ae(),wrapperTranslateMatrix:Ae()},rotate:{translateMatrix:Re(l.elX,l.elY),wrapperTranslateMatrix:Re(l.x,l.y)}},matrix:m,ctm:g,parentMatrix:E,wrapperMatrix:t,containerMatrix:h,scX:Math.sqrt(g.a*g.a+g.b*g.b),scY:Math.sqrt(g.c*g.c+g.d*g.d)},bBox:d,center:l,revX:e,revY:r,doW:n,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,a=n.center,o=n.radius,n=r.center,r=n.hx,n=n.hy;S(a)||(t=r+t,e=n+e,a.cx.baseVal.value=t,a.cy.baseVal.value=e,o.x2.baseVal.value=t,o.y2.baseVal.value=e,this.storage.center.isShifted=!0)}},{key:"resetCenterPoint",value:function(){var t=this.el,e=this.storage,r=e.bBox,n=r.width,a=r.height,o=r.x,i=r.y,r=e.handles,e=r.center,r=r.radius;e&&(t=Ne(t,t.parentNode),a=(i=De(t,o+n/2,i+a/2)).x,i=i.y,e.cx.baseVal.value=a,e.cy.baseVal.value=i,e.isShifted=!1,r.x2.baseVal.value=a,r.y2.baseVal.value=i)}},{key:"fitControlsToSize",value:function(){var t=this.el,e=this.storage.wrapper,r=this.options.container,n=t.getBBox(),a=n.width,o=n.height,i=n.x,s=n.y,n=Ne(t,r),r=Ae();this.storage.transform.wrapperMatrix=r,e.setAttribute("transform",je(r)),qe(this.storage,this.options,{x:i,y:s,width:a,height:o,boxMatrix:n,element:t})}},{key:"getBoundingRect",value:function(t){var e=this.el,r=this.options.restrict,n=this.storage.bBox;return Je(e,Ne(e.parentNode,r).multiply(t),n)}},{key:"controls",get:function(){return this.storage.wrapper}}]),e}(),Fe=function(e,t){var r=t.x,n=t.y,a=[];switch(e.tagName.toLowerCase()){case"text":var o=j(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,i=j(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=j(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=j(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",s],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;a.push(["cx",l],["cy",u]);break;case"line":s=e.x1.baseVal.value+r,c=e.y1.baseVal.value+n,l=e.x2.baseVal.value+r,u=e.y2.baseVal.value+n;a.push(["x1",s],["y1",c],["x2",l],["y2",u]);break;case"polygon":case"polyline":var h=Pe(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");a.push(["points",h]);break;case"path":h=e.getAttribute("d");a.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var a=Ce(e),o="",i=" ",s=!0,c=0,l=a.length;c<l;c++){var u=a[c],h=u.values,f=u.key,v=u.relative,d=[];switch(f){case"M":for(var y=0,p=h.length;y<p;y+=2){var b=mt(h.slice(y,y+2),2),x=b[0],b=b[1];v&&!s||(x+=r,b+=n),d.push(x,b),s=!1}break;case"A":for(var m=0,g=h.length;m<g;m+=7){var _=h.slice(m,m+7);v||(_[5]+=r,_[6]+=n),d.push.apply(d,z(_))}break;case"C":for(var E=0,M=h.length;E<M;E+=6){var T=h.slice(E,E+6);v||(T[0]+=r,T[1]+=n,T[2]+=r,T[3]+=n,T[4]+=r,T[5]+=n),d.push.apply(d,z(T))}break;case"H":for(var k=0,w=h.length;k<w;k+=1){var O=h.slice(k,k+1);v||(O[0]+=r),d.push(O[0])}break;case"V":for(var S=0,A=h.length;S<A;S+=1){var R=h.slice(S,S+1);v||(R[0]+=n),d.push(R[0])}break;case"L":case"T":for(var N=0,j=h.length;N<j;N+=2){var D=mt(h.slice(N,N+2),2),V=D[0],D=D[1];v||(V+=r,D+=n),d.push(V,D)}break;case"Q":case"S":for(var P=0,C=h.length;P<C;P+=4){var Y=mt(h.slice(P,P+4),4),X=Y[0],L=Y[1],I=Y[2],Y=Y[3];v||(X+=r,L+=n,I+=r,Y+=n),d.push(X,L,I,Y)}break;case"Z":h[0]="",i=""}o+=u.cmd+d.join(",")+i}return o}catch(t){gt("Path parsing error: "+t)}}({path:h,dx:r,dy:n})])}a.forEach(function(t){e.setAttribute(t[0],t[1])})},We=function(r,t){var e=t.scaleX,n=t.scaleY,a=t.localCTM,t=t.bBox,o=t.width,i=t.height,s=[];switch(r.tagName.toLowerCase()){case"text":case"tspan":var c=r.__data__,l=c.x,u=c.y,c=c.textLength,l=De(a,l,u),u=l.x,l=l.y;s.push(["x",u+(e<0?o:0)],["y",l-(n<0?i:0)],["textLength",Math.abs(e*c)]);break;case"circle":var h=r.__data__,f=h.r,v=h.cx,h=h.cy,f=f*(Math.abs(e)+Math.abs(n))/2,v=De(a,v,h),h=v.x,v=v.y;s.push(["r",f],["cx",h],["cy",v]);break;case"foreignobject":case"image":case"rect":var f=r.__data__,h=f.width,d=f.height,v=f.x,f=f.y,v=De(a,v,f),f=v.x,v=v.y,h=Math.abs(h*e),d=Math.abs(d*n);s.push(["x",f-(e<0?h:0)],["y",v-(n<0?d:0)],["width",h],["height",d]);break;case"ellipse":var d=r.__data__,y=d.rx,p=d.ry,b=d.cx,x=d.cy,d=De(a,b,x),b=d.x,x=d.y,d=Ae();d.a=e,d.d=n;y=De(d,y,p),p=y.x,y=y.y;s.push(["rx",Math.abs(p)],["ry",Math.abs(y)],["cx",b],["cy",x]);break;case"line":p=r.__data__,y=p.resX1,b=p.resY1,x=p.resX2,p=p.resY2,y=De(a,y,b),b=y.x,y=y.y,x=De(a,x,p),p=x.x,x=x.y;s.push(["x1",b],["y1",y],["x2",p],["y2",x]);break;case"polygon":case"polyline":var m=r.__data__.points,m=Pe(m).map(function(t){var e=De(a,Number(t[0]),Number(t[1])),r=e.x,e=e.y;return t[0]=r,t[1]=e,t.join(" ")}).join(" ");s.push(["points",m]);break;case"path":m=r.__data__.path;s.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=Ce(e),a="",o=" ",i=[],s=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative;switch(f){case"A":for(var d=[],y=0,p=h.length;y<p;y+=7){var b=mt(h.slice(y,y+7),7),x=b[0],m=b[1],g=b[2],_=b[3],E=b[4],M=b[5],T=b[6],b=Ve(r);v&&(b.e=b.f=0);M=De(b,M,T),T=M.x,M=M.y;d.push(_t(T),_t(M)),b.e=b.f=0;x=De(b,x,m),m=x.x,x=x.y;d.unshift(_t(m),_t(x),g,_,E)}i.push(d);break;case"C":for(var k=[],w=0,O=h.length;w<O;w+=6){var S=mt(h.slice(w,w+6),6),A=S[0],R=S[1],N=S[2],j=S[3],D=S[4],V=S[5],S=Ve(r);v&&(S.e=S.f=0);A=De(S,A,R),R=A.x,A=A.y,N=De(S,N,j),j=N.x,N=N.y,D=De(S,D,V),V=D.x,D=D.y;k.push(_t(R),_t(A),_t(j),_t(N),_t(V),_t(D))}i.push(k);break;case"H":for(var P=[],C=0,Y=h.length;C<Y;C+=1){var X=mt(h.slice(C,C+1),1)[0],L=Ve(r);v&&(L.e=L.f=0);X=De(L,X,0).x;P.push(_t(X))}i.push(P);break;case"V":for(var I=[],z=0,H=h.length;z<H;z+=1){var B=mt(h.slice(z,z+1),1)[0],G=Ve(r);v&&(G.e=G.f=0);B=De(G,0,B).y;I.push(_t(B))}i.push(I);break;case"T":case"L":for(var F=[],W=0,q=h.length;W<q;W+=2){var Z=mt(h.slice(W,W+2),2),U=Z[0],Q=Z[1],Z=Ve(r);v&&(Z.e=Z.f=0);U=De(Z,U,Q),Q=U.x,U=U.y;F.push(_t(Q),_t(U))}i.push(F);break;case"M":for(var $=[],J=0,K=h.length;J<K;J+=2){var tt=mt(h.slice(J,J+2),2),et=tt[0],rt=tt[1],tt=Ve(r);v&&!s&&(tt.e=tt.f=0);et=De(tt,et,rt),rt=et.x,et=et.y;$.push(_t(rt),_t(et)),s=!1}i.push($);break;case"Q":for(var nt=[],at=0,ot=h.length;at<ot;at+=4){var it=mt(h.slice(at,at+4),4),st=it[0],ct=it[1],lt=it[2],ut=it[3],it=Ve(r);v&&(it.e=it.f=0);st=De(it,st,ct),ct=st.x,st=st.y,lt=De(it,lt,ut),ut=lt.x,lt=lt.y;nt.push(_t(ct),_t(st),_t(ut),_t(lt))}i.push(nt);break;case"S":for(var ht=[],ft=0,vt=h.length;ft<vt;ft+=4){var dt=mt(h.slice(ft,ft+4),4),yt=dt[0],pt=dt[1],bt=dt[2],xt=dt[3],dt=Ve(r);v&&(dt.e=dt.f=0);yt=De(dt,yt,pt),pt=yt.x,yt=yt.y,bt=De(dt,bt,xt),xt=bt.x,bt=bt.y;ht.push(_t(pt),_t(yt),_t(xt),_t(bt))}i.push(ht);break;case"Z":i.push([""]),o=""}a+=u.cmd+i[c].join(",")+o}return a}catch(t){gt("Path parsing error: "+t)}}({path:m,localCTM:a})])}s.forEach(function(t){var e=mt(t,2),t=e[0],e=e[1];r.setAttribute(t,e)})},qe=function(t,e,r){var n=e.rotatable,a=e.rotatorAnchor,o=e.rotatorOffset,i=t.wrapper,s=t.handles,c=t.center,l=t.transform,u=(l=void 0===l?{}:l).wrapperMatrix,h=void 0===u?Ne(i,i.parentNode):u,f=r.boxMatrix,e=r.element.getBBox(),t=e.x,l=e.y,i=e.width,u=e.height,r=i/2,e=u/2,v=h.inverse().multiply(f),f=De(v,t+r,l+e),e=A({tl:[t,l],tr:[t+i,l],mr:[t+i,l+e],ml:[t,l+e],tc:[t+r,l],bc:[t+r,l+u],br:[t+i,l+u],bl:[t,l+u]},!c.isShifted&&{center:[t+r,l+e]}),d=Object.entries(e).reduce(function(t,e){var r=mt(e,2),e=r[0],r=r[1];return t[e]=De(v,r[0],r[1]),t},{}),y={te:[d.tl,d.tr],be:[d.bl,d.br],le:[d.tl,d.bl],re:[d.tr,d.br]};if(n){var p={},b=1;switch(a){case"n":p.x=d.tc.x,p.y=d.tc.y;break;case"s":p.x=d.bc.x,p.y=d.bc.y,b=-1;break;case"w":p.x=d.ml.x,p.y=d.ml.y,b=-1;break;case"e":default:p.x=d.mr.x,p.y=d.mr.y}n="n"===a||"s"===a?Math.atan2(d.bl.y-d.tl.y,d.bl.x-d.tl.x):Math.atan2(d.tl.y-d.tr.y,d.tl.x-d.tr.x),a=o*b,o={x:p.x-a*Math.cos(n),y:p.y-a*Math.sin(n)},a=s.normal,n=s.radius;j(a)&&(a.x1.baseVal.value=p.x,a.y1.baseVal.value=p.y,a.x2.baseVal.value=o.x,a.y2.baseVal.value=o.y),j(n)&&(n.x1.baseVal.value=f.x,n.y1.baseVal.value=f.y,c.isShifted||(n.x2.baseVal.value=f.x,n.y2.baseVal.value=f.y)),d.rotator=o}Object.keys(y).forEach(function(t){var r=s[t],e=mt(y[t],2),t=e[0],e=e[1];S(t)||S(r)||Object.entries({x1:t.x,y1:t.y,x2:e.x,y2:e.y}).map(function(t){var e=mt(t,2),t=e[0],e=e[1];return r.setAttribute(t,e)})}),Object.keys(d).forEach(function(t){var e=s[t],t=d[t];S(t)||S(e)||(e.setAttribute("cx",t.x),e.setAttribute("cy",t.y))})},Ze=function(t,e,r,n){var a=Oe("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(n)]),r={cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"};return Object.entries(r).forEach(function(t){var e=mt(t,2),t=e[0],e=e[1];return a.setAttribute(t,e)}),a},Ue=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},Qe=function(t){switch(t.tagName.toLowerCase()){case"text":var e=j(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,r=j(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,n=j(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null;t.__data__={x:e,y:r,textLength:n};break;case"circle":var a=t.r.baseVal.value,o=t.cx.baseVal.value,i=t.cy.baseVal.value;t.__data__={r:a,cx:o,cy:i};break;case"foreignobject":case"image":case"rect":n=t.width.baseVal.value,a=t.height.baseVal.value,o=t.x.baseVal.value,i=t.y.baseVal.value;t.__data__={width:n,height:a,x:o,y:i};break;case"ellipse":var s=t.rx.baseVal.value,c=t.ry.baseVal.value,l=t.cx.baseVal.value,u=t.cy.baseVal.value;t.__data__={rx:s,ry:c,cx:l,cy:u};break;case"line":s=t.x1.baseVal.value,c=t.y1.baseVal.value,l=t.x2.baseVal.value,u=t.y2.baseVal.value;t.__data__={resX1:s,resY1:c,resX2:l,resY2:u};break;case"polygon":case"polyline":var h=t.getAttribute("points");t.__data__={points:h};break;case"path":h=t.getAttribute("d");t.__data__={path:h}}},$e=function(t,e,r){var n=mt(t,2),t=n[0],n=n[1],a=Oe("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),e={x1:t.x,y1:t.y,x2:n.x,y2:n.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return Object.entries(e).forEach(function(t){var e=mt(t,2),t=e[0],e=e[1];return a.setAttribute(t,e)}),a},Je=function(t,r){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:t.getBBox(),n=e.x,a=e.y,t=e.width,e=e.height;return[[n,a],[n+t,a],[n+t,a+e],[n,a+e]].map(function(t){var e=mt(t,2),t=e[0],e=e[1],e=De(r,t,e);return[e.x,e.y]})};function Ke(r,t){if(this.length){var n=j(t)&&t instanceof xt?t:new xt;return b.call(this,function(t,e){return e instanceof SVGElement?function(t){t=t.tagName.toLowerCase();return-1!==we.indexOf(t)||(gt('Selected element "'.concat(t,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)}(e)&&t.push(new Ge(e,r,n)):t.push(new be(e,r,n)),t},[])}}var tr=K.EMITTER_EVENTS,er=tt,rr=nt,nr=function(){i(n,At);var r=h(n);function n(t,e){return s(this,n),(t=r.call(this,t)).enable(e),t}return c(n,[{key:"_init",value:function(){var e=this,t=this.el,r=this.options,n=D(t),t=r.style,r=r.appendTo,t=A({position:"absolute","z-index":"2147483647"},t);this.storage={css:t,parent:j(r)?D(r)[0]:document.body},n.on(er,this._onMouseDown).on(rr,this._onTouchStart),tr.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e,r,n,a,o,c,l,i={},s=null,u=document,h=function(){},f=function(){},v=function(){},d=function(){};j(t)&&(e=t.style,r=t.appendTo,n=t.stack,a=t.onInit,o=t.onMove,c=t.onDrop,t=t.onDestroy,i=j(e)&&"object"===w(e)?e:i,s=r||null,l=j(n)?D(n)[0]:document,h=N(a),f=N(o),v=R(c)?function(t){var e,r,n,a,o,i,s=this.storage.clone;(r=l,n=_(e=s),a=n.top,o=n.left,i=_(r),n=i.top,i=i.left,e=D(e),r=D(r),a<n||a+parseFloat(e.css("height"))>n+parseFloat(r.css("height"))||o<i||o+parseFloat(e.css("width"))>i+parseFloat(r.css("width")))||c.call(this,t,this.el,s)}:function(){},d=N(t)),this.options={style:i,appendTo:s,stack:u},this.proxyMethods={onInit:h,onDrop:v,onMove:f,onDestroy:d}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,a=this.el,o=n.parent,i=n.css,s=_(o),t=s.left,s=s.top;i.left="".concat(e-t,"px"),i.top="".concat(r-s,"px");a=a.cloneNode(!0);D(a).css(i),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=a,D(o)[0].appendChild(a),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,t=this.storage;t.clientX=e,t.clientY=r,t.doDraw=!0,t.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,d(n),S(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=k(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,a=t.cx,o=t.cy;e&&(t.doDraw=!1,this._drag({dx:r-a,dy:n-o}))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,e="translate(".concat(t,"px, ").concat(e,"px)");D(r).css({transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;S(t)||(D(r).off(er,this._onMouseDown).off(rr,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),n}();function ar(e){if(this.length)return p.call(this,function(t){return new nr(t,e)})}var or=function(){i(e,x);var t=h(e);function e(){return s(this,e),t.apply(this,arguments)}return c(e,[{key:"drag",value:function(){return Ke.call.apply(Ke,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return ar.call.apply(ar,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function ir(t){return new or(t)}return Object.defineProperty(ir,"createObservable",{value:function(){return new xt}}),Object.defineProperty(ir,"Subjx",{value:or}),Object.defineProperty(ir,"Observable",{value:xt}),ir});
