/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function gt(a){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,r,n;e=a,n=o[r=t],r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(a,t,Object.getOwnPropertyDescriptor(o,t))})}return a}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function R(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},o=Object.keys(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(n){return function(){var t,e=_t(n);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var r=_t(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}(this,t)}}function kt(t,e,r){return(kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_t(t)););return t}(t,e);if(n){var a=Object.getOwnPropertyDescriptor(n,e);return a.get?a.get.call(r):a.value}})(t,e,r||t)}function se(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[],n=!0,a=!1,o=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);n=!0);}catch(t){a=!0,o=t}finally{try{n||null==s["return"]||s["return"]()}finally{if(a)throw o}}return r}(t,e)||l(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xt(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||l(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function tt(t){return t}function Et(t){return null==t}function y(t){return"function"==typeof t}function et(t){return y(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:tt}var Mt=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},k=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},t=Array.prototype,h=t.forEach,v=t.slice,f=t.map,d=t.reduce,ce=console.warn,j=function(t){return null!=t},p=function(){function o(t){if(i(this,o),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==K(t)||1!==t.nodeType&&t!==document)if(t instanceof o){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!function(t){return j(t)&&"object"===K(t)&&(Array.isArray(t)||j(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||j(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=t.length;for(var a=0;a<this.length;a++)1===t[a].nodeType&&(this[a]=t[a])}else this[0]=t,this.length=1}return r(o,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,v.call(arguments,1)):"object"!==K(r)&&r?(ce("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.addEventListener?this[a].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[a].attachEvent("on".concat(t),e):this[a]["on".concat(t)]=e:m(this[a],t,e,r,n,!0);return this}},{key:"off",value:function(t,e,r,n){for(var a=this.length;a--;)this[a].events||(this[a].events={},this[a].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[a].removeEventListener(t,e,r):document.detachEvent?this[a].detachEvent("on".concat(t),e):this[a]["on".concat(t)]=null:m(this[a],t,e,r,n,!1);return this}},{key:"is",value:function(t){if(Et(t))return!1;for(var e=rt(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),o}();function m(t,e,r,n,a,o){function i(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,a||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,a||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function rt(t){return new p(t)}function Tt(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0}function le(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}function T(r,t){for(var e=1<arguments.length&&void 0!==t?t:2,n=[],a=function(e){var t=r.map(function(t){return t[e]});n.push([Math.min.apply(Math,Xt(t)),Math.max.apply(Math,Xt(t))])},o=0;o<e;o++)a(o);return n}function x(t){return t.getBoundingClientRect()}function nt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function B(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function X(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function b(t,e){var r,n=window.getComputedStyle(t),a=null,o=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=l(t))){var e=0,r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,i=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return o=t.done,t},e:function(t){i=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(i)throw a}}}}(z);try{for(o.s();!(r=o.n()).done;){var i=r.value;if(a=n.getPropertyValue("".concat(i).concat(e))||a)break}}catch(t){o.e(t)}finally{o.f()}return a}function g(t){return t.map(function(t){return Xt(t)})}function H(n){return n.reduce(function(t,e,r){return[].concat(Xt(t),[n[0][r],n[1][r],n[2][r],n[3][r]])},[])}function at(t){return Xt(Array(0<arguments.length&&void 0!==t?t:4)).map(function(t,e,r){return r.map(function(){return+!e--})})}function ot(r,n,t){var a=2<arguments.length&&void 0!==t?t:0;return at().map(function(t,e){return t[3]=[r,n,a,1][e],t})}function L(r,n,t,e){var a=2<arguments.length&&void 0!==t?t:1,o=3<arguments.length&&void 0!==e?e:1;return at().map(function(t,e){return t[e]=[r,n,a,o][e],t})}function _(t,e){var r=at();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r}function it(t,e){var r=!(1<arguments.length&&void 0!==e)||e?g(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r}function st(t,e){for(var r=[],n=0,a=t.length;n<a;++n){for(var o=0,i=0;i<a;++i)o+=+t[n][i]*e[i];r[n]=o}return r}function ct(t,e){for(var r=[],n=0;n<e.length;n++){r[n]=[];for(var a=0;a<t[0].length;a++){for(var o=0,i=0;i<t.length;i++)o+=t[i][a]*e[n][i];r[n].push(o)}}return r}function lt(t){for(var e,r=g(t),n=r.length,a=[],o=0;o<n;o++)a[o]=[];for(var i=0;i<n;i++)for(var s=0;s<n;s++)a[i][s]=0,i==s&&(a[i][s]=1);for(var c=0;c<n;c++){e=r[c][c];for(var l=0;l<n;l++)r[c][l]/=e,a[c][l]/=e;for(var u=c+1;u<n;u++){e=r[u][c];for(var h=0;h<n;h++)r[u][h]-=r[c][h]*e,a[u][h]-=a[c][h]*e}}for(var v=n-1;0<v;v--)for(var f=v-1;0<=f;f--){e=r[f][v];for(var d=0;d<n;d++)r[f][d]-=r[v][d]*e,a[f][d]-=a[v][d]*e}for(var p=0;p<n;p++)for(var y=0;y<n;y++)r[p][y]=a[p][y];return r}function ut(t,e,r){for(var n,a,o,i,s,c,l,u=1<arguments.length&&void 0!==e?e:document.body,h=2<arguments.length?r:void 0,v=at(),f=t,d=h||Ce(f),p=!1;f&&f instanceof Element;){var y=Ae(f,p);if(v=ct(v,(n=d,void 0,a=se(y,3),o=a[0],i=a[1],s=a[2],c=ot(-o,-i,-s),l=ot(o,i,s),ct(ct(c,n),l))),p=!0,f===u||null===f.offsetParent)break;f=f.offsetParent,d=Ce(f)}return v}function ht(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),n=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]),a=Math.atan2(-t[0][3]/n,t[1][3]/n),o=Math.asin(t[3][1]/n),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=t[a=0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:a,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/n},scale:{sX:e,sY:r,sZ:n}}}function vt(t,e){for(var r=1<arguments.length&&void 0!==e?e:document.body,n=0,a=0,o=t,i=!1;o&&o.offsetParent;){var s=ut(o.offsetParent),c=se(st(it(s,!1),[o.offsetLeft+(i?o.clientLeft:0),o.offsetTop+(i?o.clientTop:0),0,1]),2);if(a+=c[0],n+=c[1],r===o)break;i=!0,o=o.offsetParent}return[a,n,0,1]}var I=2,w="#00a8ff",ft="sjx-",E="dragStart",M="drag",O="dragEnd",S="resizeStart",V="resize",C="resizeEnd",A="rotateStart",N="rotate",P="rotateEnd",D="setPointStart",Y="setPointEnd",z=["","-webkit-","-moz-","-ms-","-o-"],G="ongetstate",W="onapply",F="onmove",q="onresize",Z="onrotate",Q={NOTIFIER_EVENTS:[G,W,F,q,Z],ON_GETSTATE:G,ON_APPLY:W,ON_MOVE:F,ON_RESIZE:q,ON_ROTATE:Z},U={EMITTER_EVENTS:[E,M,,O,S,V,C,A,N,P,D,Y],E_DRAG_START:E,E_DRAG:M,E_DRAG_END:O,E_RESIZE_START:S,E_RESIZE:V,E_RESIZE_END:C,E_ROTATE_START:A,E_ROTATE:N,E_ROTATE_END:P,E_SET_POINT_START:D,E_SET_POINT_END:Y},$="mousedown",J="mouseup",dt="mousemove",pt="touchstart",yt="touchend",mt="touchmove",xt={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},bt={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"},wt=Q.ON_GETSTATE,Rt=Q.ON_APPLY,Ot=Q.ON_MOVE,St=Q.ON_RESIZE,Vt=Q.ON_ROTATE,Ct=function(){function t(){i(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return Et(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(j(r[t])){var n=r[t].indexOf(e);r[t].splice(n,1)}return this}},{key:"notify",value:function(e,r,n){Et(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case Ot:t.notifyMove(n);break;case Vt:t.notifyRotate(n);break;case St:t.notifyResize(n);break;case Rt:t.notifyApply(n);break;case wt:t.notifyGetState(n)}})}}]),t}(),At=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return r(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}(),Nt=function(){function t(){i(this,t),this.events={}}return r(t,[{key:"registerEvent",value:function(t){this.events[t]=new At(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}(),Pt=U.E_DRAG,Dt=dt,jt=J,Bt=mt,Yt=yt,zt=function(){function e(t){i(this,e),this.elements=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new Nt,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.elements),this.proxyMethods.onInit.call(this,this.elements)}},{key:"disable",value:function(){Ht()}},{key:"_init",value:function(){Ht()}},{key:"_destroy",value:function(){Ht()}},{key:"_processOptions",value:function(){Ht()}},{key:"_start",value:function(){Ht()}},{key:"_moving",value:function(){Ht()}},{key:"_end",value:function(){Ht()}},{key:"_animate",value:function(){Ht()}},{key:"_drag",value:function(t){var e=t.element,r=t.dx,n=t.dy,a=R(t,["element","dx","dy"]),o=gt({dx:r,dy:n,transform:this._processMove(e,{dx:r,dy:n})},a);this.proxyMethods.onMove.call(this,o),this._emitEvent(Pt,o)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),rt(document).on(Dt,this._onMouseMove).on(jt,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),rt(document).on(Bt,this._onTouchMove).on(Yt,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0])}},{key:"_onMouseUp",value:function(t){rt(document).off(Dt,this._onMouseMove).off(jt,this._onMouseUp),this._end(t,this.elements)}},{key:"_onTouchEnd",value:function(t){rt(document).off(Bt,this._onTouchMove).off(Yt,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.elements)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}(),Ht=function(){throw Error("Method not implemented")},Lt=Math.PI/180,It=Q.NOTIFIER_EVENTS,Gt=Q.ON_GETSTATE,Wt=Q.ON_APPLY,Ft=Q.ON_MOVE,qt=Q.ON_RESIZE,Zt=Q.ON_ROTATE,Qt=U.EMITTER_EVENTS,Ut=U.E_DRAG_START,$t=U.E_DRAG,Jt=U.E_DRAG_END,Kt=U.E_RESIZE_START,te=U.E_RESIZE,ee=U.E_RESIZE_END,re=U.E_ROTATE_START,ne=U.E_ROTATE,ae=U.E_ROTATE_END,oe=xt,ie=bt,ue=$,he=pt,ve=dt,fe=J,de=mt,pe=yt,ye=oe.TOP_LEFT,me=oe.TOP_CENTER,xe=oe.TOP_RIGHT,be=oe.BOTTOM_LEFT,ge=oe.BOTTOM_RIGHT,_e=oe.BOTTOM_CENTER,ke=oe.MIDDLE_LEFT,Ee=oe.MIDDLE_RIGHT,Me=ie.TOP_EDGE,Te=ie.BOTTOM_EDGE,we=ie.LEFT_EDGE,Re=ie.RIGHT_EDGE,Oe=Object.keys,Se=Object.values,Ve=function(){o(bt,zt);var a=c(bt);function bt(t,e,r){var n;if(i(this,bt),(n=a.call(this,t)).constructor===bt)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,Qt.forEach(function(t){return n.eventDispatcher.registerEvent(t)}),kt(_t(bt.prototype),"enable",s(n)).call(s(n),e),n}return r(bt,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.element,r=t.radians,n=R(t,["element","radians"]),a=gt({transform:this._processRotate(e,r),delta:r},n);this.proxyMethods.onRotate.call(this,a),kt(_t(bt.prototype),"_emitEvent",this).call(this,ne,a)}},{key:"_resize",value:function(t){var e=t.element,r=t.dx,n=t.dy,a=R(t,["element","dx","dy"]),o=gt({},this._processResize(e,{dx:r,dy:n}),{dx:r,dy:n},a);this.proxyMethods.onResize.call(this,o),kt(_t(bt.prototype),"_emitEvent",this).call(this,te,o)}},{key:"_processOptions",value:function(t){var e=0<arguments.length&&void 0!==t?t:{},r=this.elements;Xt(r).map(function(t){return nt(t,"".concat(ft,"drag"))});var n=e.each,a=void 0===n?{move:!1,resize:!1,rotate:!1}:n,o=e.snap,i=void 0===o?{x:10,y:10,angle:10}:o,s=e.axis,c=void 0===s?"xy":s,l=e.cursorMove,u=void 0===l?"auto":l,h=e.cursorResize,v=void 0===h?"auto":h,f=e.cursorRotate,d=void 0===f?"auto":f,p=e.rotationPoint,y=void 0!==p&&p,m=e.restrict,x=e.draggable,b=void 0===x||x,g=e.resizable,_=void 0===g||g,k=e.rotatable,E=void 0===k||k,M=e.scalable,T=void 0!==M&&M,w=e.applyTranslate,R=void 0!==w&&w,O=e.onInit,S=void 0===O?tt:O,V=e.onDrop,C=void 0===V?tt:V,A=e.onMove,N=void 0===A?tt:A,P=e.onResize,D=void 0===P?tt:P,j=e.onRotate,B=void 0===j?tt:j,Y=e.onDestroy,z=void 0===Y?tt:Y,X=e.container,H=void 0===X?r[0].parentNode:X,L=e.controlsContainer,I=void 0===L?H:L,G=e.proportions,W=void 0!==G&&G,F=e.rotatorAnchor,q=void 0===F?null:F,Z=e.rotatorOffset,Q=void 0===Z?50:Z,U=e.showNormal,$=void 0===U||U,J=e.custom;this.options={axis:c,cursorMove:u,cursorRotate:d,cursorResize:v,rotationPoint:y,restrict:m?rt(m)[0]||document.body:null,container:rt(H)[0],controlsContainer:rt(I)[0],snap:gt({},i,{angle:i.angle*Lt}),each:a,proportions:W,draggable:b,resizable:_,rotatable:E,scalable:T,applyTranslate:R,custom:"object"===K(J)&&J||null,rotatorAnchor:q,rotatorOffset:Q,showNormal:$,isGrouped:1<r.length},this.proxyMethods={onInit:et(S),onDrop:et(C),onMove:et(N),onResize:et(D),onRotate:et(B),onDestroy:et(z)},this.subscribe(a)}},{key:"_animate",value:function(){var h=this,s=this,t=s.observable,e=s.storage,r=s.options,n=s.elements;if(!Et(e)&&(e.frame=Mt(s._animate),e.doDraw)){e.doDraw=!1;var v=e.dox,f=e.doy,a=e.clientX,o=e.clientY,i=e.relativeX,c=e.relativeY,l=e.doDrag,u=e.doResize,d=e.doRotate,p=e.doSetCenter,y=e.revX,m=e.revY,x=e.mouseEvent,b=e.data,g=r.snap,_=r.each,k=_.move,E=_.resize,M=_.rotate,T=r.draggable,w=r.resizable,R=r.rotatable,O=r.isGrouped,S=r.restrict;if(u&&w){var V=Tt(a-i,g.x),C=Tt(o-c,g.y),A=e.cached,N=e.cached,P=(N=void 0===N?{}:N).dist,D=(P=void 0===P?{}:P).dx,j=void 0===D?V:D,B=P.dy,Y=void 0===B?C:B,z={dx:V,dy:C,clientX:a,clientY:o,mouseEvent:x},X=S?n.reduce(function(t,e){var r=b.get(e).transform.ctm,n=O?{x:V,y:C}:h._pointToTransform({x:V,y:C,matrix:r}),a=n.x,o=n.y,i=v?y?-a:a:0,s=f?m?-o:o:0,c=h._processResizeRestrict(e,{dx:i,dy:s}),l=c.x,u=c.y;return{x:null!==l&&null===t.x?V:t.x,y:null!==u&&null===t.y?C:t.y}},{x:null,y:null}):{x:null,y:null},H=X.x,L=X.y,I=S&&(null!==H||null!==L),G=I?j:V,W=I?Y:C,F=gt({},z,{dx:G,dy:W,revX:y,revY:m,dox:v,doy:f});n.map(function(t){var e=b.get(t).transform.ctm,r=O?{x:G,y:W}:h._pointToTransform({x:G,y:W,matrix:e}),n=r.x,a=r.y,o=v?y?-n:n:0,i=f?m?-a:a:0;s._resize(gt({},F,{element:t,dx:o,dy:i}))}),this.storage.cached=gt({},A,{dist:{dx:G,dy:W}}),this._processControlsResize({dx:G,dy:W}),E&&t.notify(qt,s,F)}if(l&&T){var q=v?Tt(a-i,g.x):0,Z=f?Tt(o-c,g.y):0,Q=e.cached,U=e.cached,$=(U=void 0===U?{}:U).dist,J=($=void 0===$?{}:$).dx,K=void 0===J?q:J,tt=$.dy,et=void 0===tt?Z:tt,rt={dx:q,dy:Z,clientX:a,clientY:o,mouseEvent:x},nt=S?n.reduce(function(t,e){var r=h._processMoveRestrict(e,rt),n=r.x,a=r.y;return{x:null!==at&&null===t.x&&S?n:t.x,y:null!==ot&&null===t.y&&S?a:t.y}},{x:null,y:null}):{x:null,y:null},at=nt.x,ot=nt.y,it=null!==at&&S?K:q,st=null!==ot&&S?et:Z,ct=gt({},rt,{dx:it,dy:st});this.storage.cached=gt({},Q,{dist:{dx:it,dy:st}}),n.map(function(t){return kt(_t(bt.prototype),"_drag",h).call(h,gt({element:t},ct,{dx:it,dy:st}))}),this._processControlsMove({dx:it,dy:st}),k&&t.notify(Ft,s,ct)}if(d&&R){var lt=e.pressang,ut=e.center,ht=Math.atan2(o-ut.y,a-ut.x),vt=Tt(ht-lt,g.angle),ft={clientX:a,clientY:o,mouseEvent:x};if(S)if(n.some(function(t){var e=h._processRotateRestrict(t,vt),r=e.x,n=e.y;return null!==r||null!==n}))return;n.map(function(t){return s._rotate(gt({element:t,radians:vt},ft))}),this._processControlsRotate({radians:vt}),M&&t.notify(Zt,s,gt({radians:vt},ft))}if(p&&R){var dt=e.bx,pt=e.by,yt=this._pointToControls({x:a,y:o}),mt=yt.x,xt=yt.y;s._moveCenterHandle(mt-dt,xt-pt)}}}},{key:"_start",value:function(e){var t=e.clientX,r=e.clientY,n=this.elements,a=this.observable,o=this.options,i=o.axis,s=o.each,c=this.storage,l=this.storage.handles,u=Se(l).some(function(t){return rt(e.target).is(t)})||n.some(function(t){return t.contains(e.target)});if(c.isTarget=u){var h=this._compute(e,n);Oe(h).map(function(t){return c[t]=h[t]});var v=h.onRightEdge,f=h.onBottomEdge,d=h.onTopEdge,p=h.onLeftEdge,y=h.handle,m=h.factor,x=h.revX,b=h.revY,g=h.doW,_=h.doH,k=v||f||d||p,E=l.rotator,M=l.center,T=l.radius;j(T)&&B(T,"".concat(ft,"hidden"));var w=y.is(E),R=!!j(M)&&y.is(M),O=u&&!(w||k||R),S={mouseEvent:e,clientX:t,clientY:r,doResize:k,doDrag:O,doRotate:w,doSetCenter:R,onExecution:!0,cursor:null,dox:/\x/.test(i)&&(!k||(y.is(l.ml)||y.is(l.mr)||y.is(l.tl)||y.is(l.tr)||y.is(l.bl)||y.is(l.br)||y.is(l.le)||y.is(l.re))),doy:/\y/.test(i)&&(!k||(y.is(l.br)||y.is(l.bl)||y.is(l.bc)||y.is(l.tr)||y.is(l.tl)||y.is(l.tc)||y.is(l.te)||y.is(l.be)))};this.storage=gt({},c,{},S);var V={clientX:t,clientY:r};k?kt(_t(bt.prototype),"_emitEvent",this).call(this,Kt,V):w?kt(_t(bt.prototype),"_emitEvent",this).call(this,re,V):O&&kt(_t(bt.prototype),"_emitEvent",this).call(this,Ut,V);var C=s.move,A=s.resize,N=s.rotate,P=k?te:w?ne:$t,D=k&&A||w&&N||O&&C;a.notify(Gt,this,{clientX:t,clientY:r,actionName:P,triggerEvent:D,factor:m,revX:x,revY:b,doW:g,doH:_}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,n=this.options;if(r.isTarget){var a=this._cursorPoint(t),o=a.x,i=a.y;r.mouseEvent=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,c=r.doDrag,l=r.doResize,u=r.cursor,h=n.cursorMove,v=n.cursorResize,f=n.cursorRotate;Et(u)&&(c?u=h:s?u=f:l&&(u=v),rt(document.body).css({cursor:u}))}}},{key:"_end",value:function(t){var e=this,r=t.clientX,n=t.clientY,a=this.elements,o=this.options.each,i=this.observable,s=this.storage,c=this.storage,l=c.doResize,u=c.doDrag,h=c.doRotate,v=c.frame,f=c.handles.radius,d=c.isTarget,p=this.proxyMethods;if(d){var y=l?te:u?$t:ne;s.doResize=!1,s.doDrag=!1,s.doRotate=!1,s.doSetCenter=!1,s.doDraw=!1,s.onExecution=!1,s.cursor=null,a.map(function(t){return e._applyTransformToElement(t,y)});var m={clientX:r,clientY:n};p.onDrop.call(this,m),l?kt(_t(bt.prototype),"_emitEvent",this).call(this,ee,m):h?kt(_t(bt.prototype),"_emitEvent",this).call(this,ae,m):u&&kt(_t(bt.prototype),"_emitEvent",this).call(this,Jt,m);var x=o.move,b=o.resize,g=o.rotate,_=l&&b||h&&g||u&&x;i.notify(Wt,this,{clientX:r,clientY:n,actionName:y,triggerEvent:_}),k(v),rt(document.body).css({cursor:"auto"}),j(f)&&nt(f,"".concat(ft,"hidden"))}}},{key:"_compute",value:function(e,t){var s=this,r=this.storage,n=(r=void 0===r?{}:r).handles,c=r.data,a=rt(e.target),o=this._checkHandles(a,n),l=o.revX,u=o.revY,h=o.doW,v=o.doH,i=R(o,["revX","revY","doW","doH"]),f=this._getCommonState(),d=this._cursorPoint(e),p=d.x,y=d.y,m=this._pointToControls({x:p,y:y},f.transform),x=m.x,b=m.y;t.map(function(t){var e=s._getElementState(t,{revX:l,revY:u,doW:h,doH:v}),r=e.transform,n=R(e,["transform"]),a=s._pointToTransform({x:p,y:y,matrix:r.ctm}),o=a.x,i=a.y;c.set(t,gt({},c.get(t),{},n,{transform:r,cx:o,cy:i}))});var g=Math.atan2(y-f.center.y,p-f.center.x);return gt({data:c},i,{handle:Se(n).some(function(t){return rt(e.target).is(t)})?a:rt(t[0]),pressang:g},f,{revX:l,revY:u,doW:h,doH:v,relativeX:p,relativeY:y,bx:x,by:b})}},{key:"_checkHandles",value:function(e,r){function t(t){return t.some(function(t){return function(t){return!!j(t)&&e.is(t)}(r[t])})}return{revX:t([ye,ke,be,me,we]),revY:t([ye,xe,me,ke,Me]),onTopEdge:t([me,xe,ye,Me]),onLeftEdge:t([ye,ke,be,we]),onRightEdge:t([xe,Ee,ge,Re]),onBottomEdge:t([ge,_e,be,Te]),doW:t([ke,Ee,we,Re]),doH:t([me,_e,Te,Me])}}},{key:"_restrictHandler",value:function(t,e){for(var r=null,n=null,a=this.getBoundingRect(t,e),o=this._getRestrictedBBox(),i=se(T(o),2),s=se(i[0],2),c=s[0],l=s[1],u=se(i[1],2),h=u[0],v=u[1],f=0,d=a.length;f<d;f++){var p=se(a[f],2),y=p[0],m=p[1];(y<c||l<y)&&(r=y),(m<h||v<m)&&(n=m)}return{x:r,y:n}}},{key:"_destroy",value:function(){var e=this,t=this.elements,r=this.storage,n=(r=void 0===r?{}:r).controls,a=r.wrapper;[].concat(Xt(t),[n]).map(function(t){return rt(t).off(ue,e._onMouseDown).off(he,e._onTouchStart)}),a.parentNode.removeChild(a)}},{key:"notifyMove",value:function(t){var e=this,r=t.dx,n=t.dy;this.elements.map(function(t){return kt(_t(bt.prototype),"_drag",e).call(e,{element:t,dx:r,dy:n})}),this._processControlsMove({dx:r,dy:n})}},{key:"notifyRotate",value:function(t){var e=this,r=t.radians,n=R(t,["radians"]),a=this.elements,o=this.options,i=(o=void 0===o?{}:o).snap.angle;a.map(function(t){return e._rotate(gt({element:t,radians:Tt(r,i)},n))}),this._processControlsRotate({radians:r})}},{key:"notifyResize",value:function(t){var o=this,i=t.dx,s=t.dy,c=t.revX,l=t.revY,u=t.dox,h=t.doy,e=this.elements,v=this.storage.data,f=this.options.isGrouped;e.map(function(t){var e=v.get(t).transform.ctm,r=f?{x:i,y:s}:o._pointToTransform({x:i,y:s,matrix:e}),n=r.x,a=r.y;o._resize({element:t,dx:u?c?-n:n:0,dy:h?l?-a:a:0})}),this._processControlsResize({dx:i,dy:s})}},{key:"notifyApply",value:function(t){var e=this,r=t.clientX,n=t.clientY,a=t.actionName,o=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:r,clientY:n}),o&&(this.elements.map(function(t){return e._applyTransformToElement(t,a)}),kt(_t(bt.prototype),"_emitEvent",this).call(this,"".concat(a,"End"),{clientX:r,clientY:n}))}},{key:"notifyGetState",value:function(t){var r=this,e=t.clientX,n=t.clientY,a=t.actionName,o=t.triggerEvent,i=R(t,["clientX","clientY","actionName","triggerEvent"]);if(o){var s=this.elements,c=this.storage.data;s.map(function(t){var e=r._getElementState(t,i);c.set(t,gt({},c.get(t),{},e))});var l=this._getCommonState();this.storage=gt({},this.storage,{},l),kt(_t(bt.prototype),"_emitEvent",this).call(this,"".concat(a,"Start"),{clientX:e,clientY:n})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,n=t.rotate,a=this.observable;(r||e||n)&&a.subscribe(Gt,this).subscribe(Wt,this),r&&a.subscribe(Ft,this),e&&a.subscribe(qt,this),n&&a.subscribe(Zt,this)}},{key:"unsubscribe",value:function(){var e=this,r=this.observable;It.map(function(t){return r.unsubscribe(t,e)})}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.elements;Et(t)||(t.onExecution&&rt(document).off(ve,this._onMouseMove).off(fe,this._onMouseUp).off(de,this._onTouchMove).off(pe,this._onTouchEnd),r.map(function(t){return B(t,"".concat(ft,"drag"))}),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var r=this,e=t.dx,n=t.dy,a=this.elements,o=this.options.draggable,i=this.storage,s=this.storage.data;if(o){var c=this._getCommonState();a.map(function(t){var e=r._getElementState(t,{revX:!1,revY:!1,doW:!1,doH:!1});s.set(t,gt({},s.get(t),{},e))}),this.storage=gt({},i,{},c),a.map(function(t){kt(_t(bt.prototype),"_drag",r).call(r,{element:t,dx:e,dy:n}),r._applyTransformToElement(t,$t)}),this._processControlsMove({dx:e,dy:n})}}},{key:"exeResize",value:function(t){var r=this,e=t.dx,n=t.dy,a=t.revX,o=void 0!==a&&a,i=t.revY,s=void 0!==i&&i,c=t.doW,l=void 0!==c&&c,u=t.doH,h=void 0!==u&&u,v=this.elements,f=this.options.resizable,d=this.storage,p=this.storage.data;if(f){var y=this._getCommonState();v.map(function(t){var e=r._getElementState(t,{revX:o,revY:s,doW:l,doH:h});p.set(t,gt({},p.get(t),{},e))}),this.storage=gt({},d,{},y),v.map(function(t){r._resize({element:t,dx:e,dy:n}),r._applyTransformToElement(t,te)}),this._processControlsMove({dx:e,dy:n})}}},{key:"exeRotate",value:function(t){var r=this,e=t.delta,n=this.elements,a=this.options.rotatable,o=this.storage,i=this.storage.data;if(a){var s=this._getCommonState();n.map(function(t){var e=r._getElementState(t,{revX:!1,revY:!1,doW:!1,doH:!1});i.set(t,gt({},i.get(t),{},e))}),this.storage=gt({},o,{},s),n.map(function(t){r._rotate({element:t,radians:e}),r._applyTransformToElement(t,ne)}),this._processControlsRotate({radians:e})}}},{key:"controls",get:function(){return this.storage.wrapper}}]),bt}(),Ce=function(t){var e=b(t,"transform")||"none",r=at();if("none"===e)return r;var n=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==n.length)return[[+n[0],+n[2],0,+n[4]],[+n[1],+n[3],0,+n[5]],[0,0,1,0],[0,0,0,1]];for(var a=0;a<4;++a)for(var o=0;o<4;++o)r[o][a]=+n[4*a+o];return r},Ae=function(t,e){for(var r=b(t,"transform-origin"),n=r?r.split(" "):[],a=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1],o=0;o<n.length;++o)a[o]+=parseFloat(n[o]);return a},Ne=$,Pe=pt,De=Object.keys,je=Object.entries,Be=Object.values,Ye=function(){o(e,Ve);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this,r=this.options,n=r.rotationPoint,a=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,c=r.showNormal,l=Ie(["sjx-wrapper"]),u=Ie(["sjx-controls"]),h={},v=this._getVertices(),f=v.rotator,d=void 0===f?null:f,p=v.anchor,y=void 0===p?null:p,m=R(v,["rotator","anchor"]),x={};if(s){var b=c?Xe([[y.x,y.y],d],"normal"):null;c&&u.appendChild(b);var g=null;n&&(g=Xe([m.center,m.center],"radius"),nt(g,"sjx-hidden"),u.appendChild(g)),x=gt({},x,{normal:b,radius:g})}function _(n,a){return De(n).map(function(t){var e=n[t];if(!Et(e)){var r=a(e,t);h[t]=r,u.appendChild(r)}})}var k={te:[m.tl,m.tr],be:[m.bl,m.br],le:[m.tl,m.bl],re:[m.tr,m.br]},E=i?{tl:m.tl,tr:m.tr,br:m.br,bl:m.bl,tc:m.tc,bc:m.bc,ml:m.ml,mr:m.mr}:{},M=m.center,T=gt({},E,{center:n&&s?M:void 0,rotator:d});_(k,Xe),_(T,ze),l.appendChild(u),o.appendChild(l);var w=new WeakMap;t.map(function(t){return w.set(t,{parent:t.parentNode,center:{isShifted:!1},transform:{ctm:ut(t,a)},bBox:e._getBBox(),cached:{},__data__:new WeakMap})}),this.storage={wrapper:l,controls:u,handles:gt({},h,{},x),data:w},[].concat(Xt(t),[u]).map(function(t){return rt(t).on(Ne,e._onMouseDown).on(Pe,e._onTouchStart)})}},{key:"_pointToTransform",value:function(t){var e=t.x,r=t.y,n=t.matrix,a=lt(n);return this._applyMatrixToPoint(it(a,!1),e,r)}},{key:"_pointToControls",value:function(t,e){var r=t.x,n=t.y,a=(1<arguments.length&&void 0!==e?e:this.storage.transform).controlsMatrix,o=lt(a);return this._applyMatrixToPoint(it(o,!1),r,n)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=se(st(t,[e,r,0,1]),2);return{x:n[0],y:n[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container,a=ut(n);return this._applyMatrixToPoint(lt(a),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t,r=this.storage.transform.containerMatrix,n=this.options,a=n.restrict,o=n.container,i=a||o;return Le(i,o,e?ut(i,o):r)}},{key:"_applyTransformToElement",value:function(t){var e=this.storage,r=e.controls,n=e.center,a=e.data,o=this.options.applyTranslate,i=a.get(t),s=i.cached,c=i.transform.matrix,l=rt(r);if(!Et(s)){if(t.setAttribute("data-sjx-cx",n.elX),t.setAttribute("data-sjx-cy",n.elY),o){var u=rt(t),h=s.dx,v=s.dy,f=X(c),d=parseFloat(t.style.left||u.css("left")),p=parseFloat(t.style.top||u.css("top"));f.left="".concat(d+h,"px"),f.top="".concat(p+v,"px"),u.css(f),l.css(f)}this.storage.cached={}}}},{key:"_processResize",value:function(t,e){var r,n,a,o,i,s,c,l,u,h,v,f,d=e.dx,p=e.dy,y=this.storage,m=y.revX,x=y.revY,b=y.doW,g=y.doH,_=y.data,k=y.bBox,E=k.width,M=k.height,T=this.options,w=T.proportions,R=T.scalable,O=_.get(t),S=O.transform,V=S.matrix,C=S.auxiliary.scale.translateMatrix,A=O.cached,N=se((r=d,n=p,a=b||!b&&!g?(E+r)/E:(M+n)/M,[(o=w?E*a:E+r)/E,(i=w?M*a:M+n)/M,o,i]),4),P=N[0],D=N[1],j=N[2],B=N[3],Y=(P,D,s=L(),ct(ct(C,s),lt(C))),z=R?ct(Y,V):(l=V,u=(c=Y)[0][3],h=c[1][3],v=ot(u,h),f=ot(u*(m?-1:1),h*(x?-1:1)),ct(ct(f,l),lt(v)));return j<=I||B<=I||(this._updateElementView(t,gt({},X(H(z)),{},!R&&{width:"".concat(j,"px"),height:"".concat(B,"px")})),_.set(t,gt({},O,{cached:gt({},A,{dx:d,dy:p,bBox:{width:j,height:B}})}))),{transform:z,width:j,height:B}}},{key:"_processMove",value:function(t,e){var r=e.dx,n=e.dy,a=this.storage,o=a.data,i=a.center,s=o.get(t),c=s.transform,l=c.matrix,u=c.auxiliary.translate.parentMatrix,h=s.cached,v=void 0===h?{}:h,f=se(st(u,[r,n,0,1]),2),d=f[0],p=f[1],y=ct(l,ot(d,p)),m=X(H(y));return this._updateElementView(t,m),o.set(t,gt({},s,{cached:gt({},v,{dist:{dx:le(r),dy:le(n),ox:le(d),oy:le(p)}})})),i.isShifted,y}},{key:"_processRotate",value:function(t,e){var r=this.storage.data,n=this.options.restrict,a=r.get(t).transform,o=a.matrix,i=a.auxiliary.rotate.translateMatrix,s=le(Math.cos(e),4),c=le(Math.sin(e),4),l=_(c,s),u=ct(ct(lt(i),l),i),h=ct(o,u),v=n?this._restrictHandler(h):{x:null,y:null},f=v.x,d=v.y;return j(f)||j(d)||this._updateElementView(t,X(H(h))),h}},{key:"_getElementState",value:function(t,e){var r=e.revX,n=e.revY,a=e.doW,o=e.doH,i=this.storage,s=i.handles.center,c=i.wrapper,l=i.data,u=this.options,h=u.container,v=u.restrict,f=u.scalable,d=l.get(t),p=d.parent,y=d.center,m=v||h,x=m.offsetWidth,b=m.offsetHeight,g=se(vt(t,h),2),_=g[0],k=g[1],E=t.offsetLeft,M=t.offsetTop,T=t.offsetWidth,w=t.offsetHeight,R=Ce(t),O=ut(t,h),S=ut(p,h),V=ut(c,h),C=v?ut(v,v.parentNode):ut(h,h.parentNode),A=T/2,N=w/2,P=se(st(O,[A,N,0,1]),2),D=o?0:r?-A:A,j=a?0:n?-N:N,B=P[0]+_,Y=P[1]+k,z=s?Ce(s):at(),X=(s?ht(ut(s)):{translate:{x:B,y:Y}}).translate,H=X.x,L=X.y,I=se(st(ct(lt(it(O)),it(z)),[H-B,L-Y,0,1]),2),G=I[0],W=I[1],F=se(st(R,[G,W,0,1]),2),q=F[0],Z=F[1],Q=st(it(C),[x,b,0,1]),U=ht(ut(t,t.parentNode)).scale,$=U.sX,J=U.sY;return{transform:{auxiliary:{scale:{translateMatrix:f?ot(D,j):ot(o?0:A,a?0:N)},translate:{parentMatrix:lt(it(S))},rotate:{translateMatrix:ot(q,Z)}},scaleX:D,scaleY:j,matrix:R,ctm:O,parentMatrix:S,containerMatrix:C,wrapperMatrix:V,scX:$,scY:J,containerBox:Q},bBox:{width:T,height:w,left:E,top:M,offset:{left:_,top:k}},center:gt({},y,{x:B,y:Y,elX:q,elY:Z,matrix:z}),revX:r,revY:n,doW:a,doH:o}}},{key:"_getCommonState",value:function(){var t=this.elements,e=this.storage,r=e.controls,n=e.handles.center,a=e.center,o=this.options,i=o.container,s=o.restrict,c=se(vt(t[0],i),2),l=c[0],u=c[1],h=ut(r,i),v=this._getBBox(),f=v.width,d=v.height,p=se(st(h,[f/2,d/2,0,1]),2),y=p[0]+l,m=p[1]+u,x=n?Ce(n):at();return{transform:{controlsMatrix:ut(r,r.parentNode),containerMatrix:s?ut(s,s.parentNode):ut(i,i.parentNode)},bBox:gt({},this._getBBox()),center:gt({},a,{x:y,y:m,matrix:x})}}},{key:"_getBBox",value:function(){var t=se(this.elements,1)[0],e=this.options,r=e.isGrouped,n=e.container;if(r)return this._getGroupBbox();var a=se(vt(t,n),2),o=a[0],i=a[1];return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}}}},{key:"_processControlsResize",value:function(){this._applyTransformToHandles({boxMatrix:at()})}},{key:"_processControlsMove",value:function(t){var e=t.dx,r=t.dy,n=this.storage.transform.controlsMatrix,a=ct(n,ot(e,r)),o=X(H(a));this._updateControlsView(o)}},{key:"_processControlsRotate",value:function(){this._applyTransformToHandles({boxMatrix:at()})}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles.center,a=r.center.matrix,o=ct(a,ot(t,e));rt(n).css(gt({},X(H(o)))),this.storage.center.isShifted=!0}},{key:"_processMoveRestrict",value:function(t,e){var r=e.dx,n=e.dy,a=this.storage.data.get(t).transform,o=a.matrix,i=a.auxiliary.translate.parentMatrix,s=se(st(i,[r,n,0,1]),2),c=s[0],l=s[1],u=ct(o,ot(c,l));return this._restrictHandler(u)}},{key:"_processRotateRestrict",value:function(t,e){var r=this.storage.data.get(t).transform,n=r.matrix,a=r.auxiliary.rotate.translateMatrix,o=le(Math.cos(e),4),i=le(Math.sin(e),4),s=_(i,o),c=ct(ct(lt(a),s),a),l=ct(n,c);return this._restrictHandler(l)}},{key:"_processResizeRestrict",value:function(t,e){var r,n,a,o,i,s,c,l,u,h,v,f,d=e.dx,p=e.dy,y=this.storage,m=y.revX,x=y.revY,b=y.doW,g=y.doH,_=y.data,k=y.bBox,E=k.width,M=k.height,T=this.options,w=T.proportions,R=T.scalable,O=_.get(t).transform,S=O.matrix,V=O.auxiliary.scale.translateMatrix,C=se((r=d,n=p,a=b||!b&&!g?(E+r)/E:(M+n)/M,[(o=w?E*a:E+r)/E,(i=w?M*a:M+n)/M,o,i]),2),A=C[0],N=C[1],P=(A,N,s=L(),ct(ct(V,s),lt(V))),D=R?ct(P,S):(l=S,u=(c=P)[0][3],h=c[1][3],v=ot(u,h),f=ot(u*(m?-1:1),h*(x?-1:1)),ct(ct(f,l),lt(v)));return this._restrictHandler(D)}},{key:"_updateElementView",value:function(t,e){rt(t).css(e)}},{key:"_updateControlsView",value:function(t){rt(this.storage.controls).css(t)}},{key:"_getVertices",value:function(t){var e=0<arguments.length&&void 0!==t?t:at(),r=this.elements,n=se(r=void 0===r?[]:r,1)[0],a=this.options,o=a.isGrouped,i=a.rotatable,s=a.rotatorAnchor,c=a.rotatorOffset,l=o?this._getGroupVertices():this._getElementVertices(n,e),u=null;if(i){var h={},v=1;switch(s){case"n":h.x=l.tc[0],h.y=l.tc[1];break;case"s":h.x=l.bc[0],h.y=l.bc[1],v=-1;break;case"w":h.x=l.ml[0],h.y=l.ml[1],v=-1;break;case"e":default:h.x=l.mr[0],h.y=l.mr[1]}var f="n"===s||"s"===s?Math.atan2(l.bl[1]-l.tl[1],l.bl[0]-l.tl[0]):Math.atan2(l.tl[1]-l.tr[1],l.tl[0]-l.tr[0]);u=[h.x-c*v*Math.cos(f),h.y-c*v*Math.sin(f)],l.rotator=u,l.anchor=h}return l}},{key:"_getElementVertices",value:function(t,e){var r=this.options,n=r.container,a=r.isGrouped,o=se(vt(t,n),2),l=o[0],u=o[1],i=t.offsetWidth,s=t.offsetHeight,c={tl:[0,0,0,1],bl:[0,s,0,1],br:[i,s,0,1],tr:[i,0,0,1],tc:[i/2,0,0,1],ml:[0,s/2,0,1],bc:[i/2,s,0,1],mr:[i,s/2,0,1],center:[i/2,s/2,0,1]},h=a?e:ct(ut(t,n),e);return je(c).reduce(function(t,e){var r=se(e,2),n=r[0],a=r[1];return[].concat(Xt(t),[[n,st(h,a)]])},[]).reduce(function(t,e){var r=se(e,2),n=r[0],a=se(r[1],4),o=a[0],i=a[1],s=a[2],c=a[3];return t[n]=[o+l,i+u,s,c],t},{})}},{key:"_getGroupVertices",value:function(){var t=this._getGroupBbox(),e=t.x,r=t.y,n=t.width,a=t.height,o=n/2,i=a/2;return{tl:[e,r],tr:[e+n,r],mr:[e+n,r+i],ml:[e,r+i],tc:[e+o,r],bc:[e+o,r+a],br:[e+n,r+a],bl:[e,r+a],center:[e+o,r+i]}}},{key:"_getGroupBbox",value:function(){var t=this.elements,u=this.options.container,e=t.reduce(function(t,e){var r=se(vt(e,u),2),i=r[0],s=r[1],n=e.offsetWidth,a=e.offsetHeight,o=[[0,0,0,1],[0,a,0,1],[n,a,0,1],[n,0,0,1]],c=ut(e,u),l=o.reduce(function(t,e){return[].concat(Xt(t),[st(c,e)])},[]).map(function(t){var e=se(t,4),r=e[0],n=e[1],a=e[2],o=e[3];return[r+i,n+s,a,o]});return[].concat(Xt(t),[l])},[]),r=se(T(e.reduce(function(t,e){return[].concat(Xt(t),Xt(e))},[])),2),n=se(r[0],2),a=n[0],o=n[1],i=se(r[1],2),s=i[0];return{x:a,y:s,width:o-a,height:i[1]-s}}},{key:"_getElementBBox",value:function(t){var e=this.options.container,r=se(vt(t,e),2),i=r[0],s=r[1],n=t.offsetWidth,a=t.offsetHeight,o=[[0,0,0,1],[0,a,0,1],[n,a,0,1],[n,0,0,1]],c=ut(t,e),l=o.reduce(function(t,e){return[].concat(Xt(t),[st(c,e)])},[]).map(function(t){var e=se(t,4),r=e[0],n=e[1],a=e[2],o=e[3];return[r+i,n+s,a,o]}),u=se(T(l),2),h=se(u[0],2),v=h[0],f=h[1],d=se(u[1],2),p=d[0];return{x:v,y:p,width:f-v,height:d[1]-p}}},{key:"_applyTransformToHandles",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).boxMatrix,r=void 0===e?at():e,n=this.options,a=n.rotatable,o=n.resizable,i=n.showNormal,s=this.storage,l=s.handles,c=s.center,u=(c=void 0===c?{}:c).isShifted,h=void 0!==u&&u,v=s.transform.controlsMatrix,f=ct(r,lt(v)),d=this._getVertices(f),p=d.anchor,y=void 0===p?null:p,m=d.center,x=R(d,["anchor","center"]),b=null,g={};a&&(b=i?[[y.x,y.y],x.rotator]:null,g={rotator:x.rotator});var _=gt({te:[x.tl,x.tr],be:[x.bl,x.br],le:[x.tl,x.bl],re:[x.tr,x.br]},i&&b&&{normal:b});De(_).forEach(function(t){var e=se(_[t],2),r=e[0],n=e[1],a=He(r,n),o=a.cx,i=a.cy,s=a.length,c=a.theta;rt(l[t]).css({transform:"translate(".concat(o,"px, ").concat(i,"px) rotate(").concat(c,"deg)"),width:"".concat(s,"px")})});var k=gt({},o&&x,{},g,{},!h&&Boolean(m)&&{center:m});De(k).forEach(function(t){var e=l[t],r=k[t];if(!Et(r)&&!Et(e)){var n=se(r,2),a=n[0],o=n[1];rt(e).css({transform:"translate(".concat(a,"px, ").concat(o,"px)")})}})}},{key:"resetCenterPoint",value:function(){var t=this.elements,e=se(t=void 0===t?[]:t,1)[0],r=this.storage,n=r.wrapper,a=r.handles.center,o=this.options.container;if(a){var i=e.offsetHeight,s=e.offsetWidth,c=se(vt(e,o),2),l=c[0],u=c[1],h=ct(ut(e,o),lt(ut(n,n.parentNode))),v=se(st(h,[s/2,i/2,0,1]),2),f=v[0],d=v[1];rt(a).css({transform:"translate(".concat(f+l,"px, ").concat(d+u,"px)")})}}},{key:"fitControlsToSize",value:function(){var t=at();this.storage=gt({},this.storage,{transform:gt({},this.storage.transform||{},{controlsMatrix:t})}),this._updateControlsView(X(H(t))),this._applyTransformToHandles()}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:null,r=this.elements,n=se(r=void 0===r?[]:r,1)[0],a=this.options,o=a.scalable,i=a.restrict,s=a.container,c=this.storage,l=c.bBox,u=c.bBox,h=(u=void 0===u?{}:u).width,v=u.height,f=c.cached,d=(f=void 0===f?{}:f).bBox,p=(d=void 0===d?{}:d).width,y=void 0===p?h:p,m=d.height,x=o?l:gt({},l,{width:y,height:void 0===m?v:m}),b=i||s;return Le(n,b,ut(n,b,e),x)}},{key:"applyAlignment",value:function(t){var e=this.elements,r=this.options.container,n=this._getVertices(),a=(n.anchor,n.rotator,n.center,R(n,["anchor","rotator","center"])),o=this._getRestrictedBBox(!0),i=Be(a),s=se(T(o),2),c=se(s[0],2),l=c[0],u=c[1],h=se(s[1],2),v=h[0],f=h[1],d=se(T(i),2),p=se(d[0],2),y=p[0],m=p[1],x=se(d[1],2),b=x[0],g=x[1],_=se(st(lt(it(ut(e[0].parentNode,r))),[function(){switch(!0){case/[l]/.test(t):return l-y;case/[r]/.test(t):return u-m;case/[h]/.test(t):return(u+l)/2-(m+y)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(t):return v-b;case/[b]/.test(t):return f-g;case/[v]/.test(t):return(f+v)/2-(g+b)/2;default:return 0}}(),0,1]),2),k=_[0],E=_[1],M=ct(Ce(e[0]),ot(k,E));this._updateElementView(e[0],X(H(M))),this.fitControlsToSize()}}]),e}(),ze=function(t,e,r){var n=se(t,2),a=n[0],o=n[1],i=2<arguments.length&&void 0!==r?r:{},s=Ie(["sjx-hdl","sjx-hdl-".concat(1<arguments.length&&void 0!==e?e:"handler")]);return rt(s).css(gt({transform:"translate(".concat(a,"px, ").concat(o,"px)")},i)),s},Xe=function(t,e){var r=se(t,3),n=r[0],a=r[1],o=r[2],i=void 0===o?1:o,s=He(n,a,i),c=s.cx,l=s.cy,u=s.length,h=s.theta,v=Ie(["sjx-hdl-line","sjx-hdl-".concat(e)]);return rt(v).css({transform:"translate(".concat(c,"px, ").concat(l,"px) rotate(").concat(h,"deg)"),height:"".concat(i,"px"),width:"".concat(u,"px")}),v},He=function(t,e,r){var n=2<arguments.length&&void 0!==r?r:1,a=se(t,2),o=a[0],i=a[1],s=se(e,2),c=s[0],l=s[1],u=Math.sqrt((c-o)*(c-o)+(l-i)*(l-i));return{cx:(o+c)/2-u/2,cy:(i+l)/2-n/2,thickness:n,theta:Math.atan2(i-l,o-c)*(180/Math.PI),length:u}},Le=function(t,e,r,n){var a=se(vt(t,e),2),o=a[0],i=a[1],s=n||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},c=s.width,l=s.height,u=s.offset,h=(u=void 0===u?{}:u).left,v=u.top;return[[0,0,0,1],[c,0,0,1],[0,l,0,1],[c,l,0,1]].reduce(function(t,e){return[].concat(Xt(t),[st(r,e)])},[]).map(function(t){var e=se(t,4),r=e[0],n=e[1],a=e[2],o=e[3];return[r+h,n+v,a,o]})},Ie=function(t){var e=0<arguments.length&&void 0!==t?t:[],r=document.createElement("div");return e.forEach(function(t){return nt(r,t)}),r},Ge=/\s*,\s*|\s+/g,We=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Fe(t,e){var r=1<arguments.length&&void 0!==e?e:[],n=document.createElementNS("http://www.w3.org/2000/svg",t);return r.forEach(function(t){return nt(n,t)}),n}function qe(t){var r=[];return or(t)?h.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==We.indexOf(e)&&("g"===e&&r.push.apply(r,Xt(qe(t))),r.push(t))}}):r.push(t),r}function Ze(){return Fe("svg").createSVGMatrix()}function Qe(t,e){var r=Ze();return r.e=t,r.f=e,r}function Ue(t,e){var r=Ze();return r.a=e,r.b=t,r.c=-t,r.d=e,r}function $e(t,e){var r=Ze();return r.a=t,r.d=e,r}function Je(t,e){return(e.getScreenCTM&&e.getScreenCTM()||Ze()).inverse().multiply(t.getScreenCTM()||Ze())}function Ke(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(a,",").concat(o,",").concat(i,")")}function tr(t,e,r){return function(t,e){var r=Fe("svg").createSVGPoint();return r.x=t,r.y=e,r}(e,r).matrixTransform(t)}function er(t){var e=Ze();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}function rr(t){return(0<arguments.length&&void 0!==t?t:"").replace(/[\n\r]/g,"").replace(/([^e])-/g,"$1 -").replace(/ +/g," ").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ")}function nr(t){return rr(t).trim().split(Ge).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function ar(t){for(var o=ir.lastIndex=0,i=[],e=function(){var t=se(o,3),e=t[1],r=t[2],n=e.toUpperCase(),a=e!==n;(function(r,n){return Array.from(new Array(Math.ceil(r.length/n)),function(t,e){return r.slice(e*n,e*n+n)})})(rr(r).trim().split(Ge).map(function(t){if(!isNaN(t))return Number(t)}),function(t){return[{size:2,condition:["M","m","L","l","T","t"].includes(t)},{size:1,condition:["H","h","V","v"].includes(t)},{size:6,condition:["C","c"].includes(t)},{size:4,condition:["S","s","Q","q"].includes(t)},{size:7,condition:["A","a"].includes(t)},{size:1,condition:!0}].find(function(t){return!!t.condition})}(e).size).map(function(t){return i.push({relative:a,key:n,cmd:e,values:t})})};o=ir.exec(t);)e();return cr(sr(i))}var or=function(t){return"g"===t.tagName.toLowerCase()},ir=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,sr=function(t){var jt=null,Bt=null,Yt=null,zt=null;return t.reduce(function(t,e){var r,n=e.cmd,a=e.values;switch(n){case"M":var o=se(a,2),i=o[0],s=o[1];r={key:"M",values:[i,s]},jt=Yt=i,Bt=zt=s;break;case"m":var c=se(a,2),l=c[0],u=c[1],h=jt+l,v=Bt+u;r={key:"M",values:[h,v]},jt=Yt=h,Bt=zt=v;break;case"L":var f=se(a,2),d=f[0],p=f[1];r={key:"L",values:[d,p]},jt=d,Bt=p;break;case"l":var y=se(a,2),m=y[0],x=y[1],b=jt+m,g=Bt+x;r={key:"L",values:[b,g]},jt=b,Bt=g;break;case"C":var _=se(a,6),k=_[0],E=_[1],M=_[2],T=_[3],w=_[4],R=_[5];r={key:"C",values:[k,E,M,T,w,R]},jt=w,Bt=R;break;case"c":var O=se(a,6),S=O[0],V=O[1],C=O[2],A=O[3],N=O[4],P=O[5],D=[jt+S,Bt+V,jt+C,Bt+A,jt+N,Bt+P];r={key:"C",values:[].concat(D)},jt=D[4],Bt=D[5];break;case"Q":var j=se(a,4),B=j[0],Y=j[1],z=j[2],X=j[3];r={key:"Q",values:[B,Y,z,X]},jt=z,Bt=X;break;case"q":var H=se(a,4),L=H[0],I=H[1],G=H[2],W=H[3],F=[jt+L,Bt+I,jt+G,Bt+W];t.push({key:"Q",values:[].concat(F)}),jt=F[2],Bt=F[3];break;case"A":var q=se(a,7),Z=q[0],Q=q[1],U=q[2],$=q[3],J=q[4],K=q[5],tt=q[6];r={key:"A",values:[Z,Q,U,$,J,K,tt]},jt=K,Bt=tt;break;case"a":var et=se(a,7),rt=et[0],nt=et[1],at=et[2],ot=et[3],it=et[4],st=et[5],ct=et[6],lt=jt+st,ut=Bt+ct;r={key:"A",values:[rt,nt,at,ot,it,lt,ut]},jt=lt,Bt=ut;break;case"H":var ht=se(a,1)[0];r={key:"H",values:[ht]},jt=ht;break;case"h":var vt=se(a,1)[0],ft=jt+vt;r={key:"H",values:[ft]},jt=ft;break;case"V":var dt=se(a,1)[0];r={key:"V",values:[dt]},Bt=dt;break;case"v":var pt=se(a,1)[0],yt=Bt+pt;r={key:"V",values:[yt]},Bt=yt;break;case"S":var mt=se(a,4),xt=mt[0],bt=mt[1],gt=mt[2],_t=mt[3];r={key:"S",values:[xt,bt,gt,_t]},jt=gt,Bt=_t;break;case"s":var kt=se(a,4),Et=kt[0],Mt=kt[1],Tt=kt[2],wt=kt[3],Rt=[jt+Et,Bt+Mt,jt+Tt,Bt+wt];r={key:"S",values:[].concat(Rt)},jt=Rt[2],Bt=Rt[3];break;case"T":var Ot=se(a,2),St=Ot[0],Vt=Ot[1];r={key:"T",values:[St,Vt]},jt=St,Bt=Vt;break;case"t":var Ct=se(a,2),At=Ct[0],Nt=Ct[1],Pt=jt+At,Dt=Bt+Nt;r={key:"T",values:[Pt,Dt]},jt=Pt,Bt=Dt;break;case"Z":case"z":r={key:"Z",values:[]},jt=Yt,Bt=zt}return[].concat(Xt(t),[r])},[])},cr=function(t){var W=null,F=null,q=null,Z=null,Q=null,U=null,$=null;return t.reduce(function(t,e){var r,n=e.key,a=e.values;switch(n){case"M":var o=se(a,2),i=o[0],s=o[1];r=[{key:"M",values:[i,s]}],Z=U=i,Q=$=s;break;case"C":var c=se(a,6),l=c[0],u=c[1],h=c[2],v=c[3],f=c[4],d=c[5];r=[{key:"C",values:[l,u,h,v,f,d]}],F=h,q=v,Z=f,Q=d;break;case"L":var p=se(a,2),y=p[0],m=p[1];r=[{key:"L",values:[y,m]}],Z=y,Q=m;break;case"H":var x=se(a,1)[0];r=[{key:"L",values:[x,Q]}],Z=x;break;case"V":var b=se(a,1)[0];r=[{key:"L",values:[Z,b]}],Q=b;break;case"S":var g,_,k=se(a,4),E=k[0],M=k[1],T=k[2],w=k[3];_="C"===W||"S"===W?(g=Z+(Z-F),Q+(Q-q)):(g=Z,Q),r=[{key:"C",values:[g,_,E,M,T,w]}],F=E,q=M,Z=T,Q=w;break;case"T":var R,O,S=se(a,2),V=S[0],C=S[1];O="Q"===W||"T"===W?(R=Z+(Z-F),Q+(Q-q)):(R=Z,Q),r=[{key:"C",values:[Z+2*(R-Z)/3,Q+2*(O-Q)/3,V+2*(R-V)/3,C+2*(O-C)/3,V,C]}],F=R,q=O,Z=V,Q=C;break;case"Q":var A=se(a,4),N=A[0],P=A[1],D=A[2],j=A[3];r=[{key:"C",values:[Z+2*(N-Z)/3,Q+2*(P-Q)/3,D+2*(N-D)/3,j+2*(P-j)/3,D,j]}],F=N,q=P,Z=D,Q=j;break;case"A":var B=se(a,7),Y=B[0],z=B[1],X=B[2],H=B[3],L=B[4],I=B[5],G=B[6];if(0===Y||0===z)r=[{key:"C",values:[Z,Q,I,G,I,G]}],Z=I,Q=G;else if(Z!==I||Q!==G)r=lr(Z,Q,I,G,Y,z,X,H,L).map(function(t){return{key:"C",values:t}}),Z=I,Q=G;break;case"Z":r=[e],Z=U,Q=$}return W=n,[].concat(Xt(t),Xt(r))},[])},lr=function t(e,r,n,a,o,i,s,c,l,u){function h(t,e,r){return{x:t*Math.cos(r)-e*Math.sin(r),y:t*Math.sin(r)+e*Math.cos(r)}}var v,f,d,p,y,m=(v=s,Math.PI*v/180),x=[];if(u)f=u[0],d=u[1],p=u[2],y=u[3];else{var b=h(e,r,-m);e=b.x,r=b.y;var g=h(n,a,-m),_=(e-(n=g.x))/2,k=(r-(a=g.y))/2,E=_*_/(o*o)+k*k/(i*i);1<E&&(o*=E=Math.sqrt(E),i*=E);var M=o*o,T=i*i,w=M*T-M*k*k-T*_*_,R=M*k*k+T*_*_,O=(c===l?-1:1)*Math.sqrt(Math.abs(w/R));p=O*o*k/i+(e+n)/2,y=O*-i*_/o+(r+a)/2,f=Math.asin(parseFloat(((r-y)/i).toFixed(9))),d=Math.asin(parseFloat(((a-y)/i).toFixed(9))),e<p&&(f=Math.PI-f),n<p&&(d=Math.PI-d),f<0&&(f=2*Math.PI+f),d<0&&(d=2*Math.PI+d),l&&d<f&&(f-=2*Math.PI),!l&&f<d&&(d-=2*Math.PI)}var S=d-f;if(Math.abs(S)>120*Math.PI/180){var V=d,C=n,A=a,N=l&&f<d?1:-1;d=f+120*Math.PI/180*N,n=p+o*Math.cos(d),a=y+i*Math.sin(d),x=t(n,a,C,A,o,i,s,0,l,[d,V,p,y])}S=d-f;var P=Math.cos(f),D=Math.sin(f),j=Math.cos(d),B=Math.sin(d),Y=Math.tan(S/4),z=4/3*o*Y,X=4/3*i*Y,H=[e,r],L=[e+z*D,r-X*P],I=[n+z*B,a-X*j],G=[n,a];if(L[0]=2*H[0]-L[0],L[1]=2*H[1]-L[1],u)return[L,I,G].concat(Xt(x));x=[L,I,G].concat(Xt(x)).join().split(",");var W=[],F=[];return x.forEach(function(t,e){e%2?F.push(h(x[e-1],x[e],m).y):F.push(h(x[e],x[e+1],m).x),6===F.length&&(W.push(F),F=[])}),W},ur=U.E_DRAG,hr=U.E_RESIZE,vr=U.E_ROTATE,fr=$,dr=pt,pr=Object.keys,yr=Object.entries,mr=Object.values,xr=function(){o(e,Ve);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this,r=this.options,n=r.rotationPoint,a=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,c=r.showNormal,l=Fe("g",["sjx-svg-wrapper"]),u=Fe("g",["sjx-svg-controls"]),h=this._getVertices(),v=h.rotator,f=void 0===v?null:v,d=h.anchor,p=void 0===d?null:d,y=R(h,["rotator","anchor"]),m={},x={},b=Array.isArray(n)?tr(Ze(),n[0],n[1]):y.center;if(s){var g=c?Mr([p,f],w,"normal"):null;c&&u.appendChild(g);var _=null;n&&((_=Fe("line",["sjx-hidden"])).x1.baseVal.value=y.center.x,_.y1.baseVal.value=y.center.y,_.x2.baseVal.value=b.x,_.y2.baseVal.value=b.y,kr(_,"#fe3232"),_.setAttribute("opacity",.5),u.appendChild(_)),x=gt({},x,{normal:g,radius:_})}var k=i?{tl:y.tl,tr:y.tr,br:y.br,bl:y.bl,tc:y.tc,bc:y.bc,ml:y.ml,mr:y.mr}:{},E={te:[y.tl,y.tr],be:[y.bl,y.br],le:[y.tl,y.bl],re:[y.tr,y.br]};pr(E).forEach(function(t){var e=E[t];Et(e)||(m[t]=Mr(e,w,t),u.appendChild(m[t]))});var M=gt({},k,{rotator:f,center:n&&s?b:void 0});pr(M).forEach(function(t){var e=M[t];if(!Et(e)){var r=e.x,n=e.y,a="center"===t?"#fe3232":w;m[t]=_r(r,n,a,t),u.appendChild(m[t])}}),l.appendChild(u),o.appendChild(l);var T=new WeakMap;t.map(function(t){return T.set(t,{parent:t.parentNode,transform:{ctm:Je(t,a)},bBox:t.getBBox(),__data__:new WeakMap,cached:{}})}),this.storage={wrapper:l,controls:u,handles:gt({},m,{},x),data:T,center:{isShifted:Boolean(n)}},[].concat(Xt(t),[u]).map(function(t){return rt(t).on(fr,e._onMouseDown).on(dr,e._onTouchStart)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY,n=this.options.container;return this._applyMatrixToPoint(n.getScreenCTM().inverse(),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t,r=this.storage,n=(r=void 0===r?{}:r).transform,a=(n=void 0===n?{}:n).containerMatrix,o=this.options,i=(o=void 0===o?{}:o).container,s=o.restrict||i;return Tr(s,e?Je(s,i):a)}},{key:"_pointToTransform",value:function(t){var e=t.x,r=t.y,n=t.matrix.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_pointToControls",value:function(t,e){var r=t.x,n=t.y,a=(1<arguments.length&&void 0!==e?e:this.storage.transform).controlsMatrix.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,r,n)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=Fe("svg").createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_applyTransformToElement",value:function(n,t){var e=this.storage,r=(e=void 0===e?{}:e).data,a=e.bBox,o=this.options,i=(o=void 0===o?{}:o).isGrouped,s=o.scalable,c=o.applyTranslate,l=r.get(n),u=l.cached,h=void 0===u?{}:u,v=R(l,["cached"]),f=v.transform,d=f.matrix,p=f.parentMatrix,y=v.__data__,m=h.scaleX,x=h.scaleY,b=h.dist,g=(b=void 0===b?{}:b).dx,_=b.dy,k=b.ox,E=b.oy,M=h.transformMatrix;if(t===ur){if(!c||!g&&!_)return;var T=Qe(k,E),w=T.multiply(d).multiply(T.inverse());this._updateElementView(["transform",w]),or(n)?qe(n).map(function(t){var e=Qe(g,_),r=e.multiply(Je(t,t.parentNode)).multiply(e.inverse());if(function(t){var e=t.a,r=t.b,n=t.c,a=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===n&&1===a&&0===o&&0===i}(r)||t.setAttribute("transform",Ke(r)),!or(t)){var n=p.inverse();n.e=n.f=0;var a=tr(n,k,E),o=a.x,i=a.y;br(t,{x:o,y:i})}}):br(n,{x:k,y:E})}if(t===hr){if(!M)return;if(!s)if(or(n)||i)qe(n).forEach(function(t){if(!or(t)){var e=Je(t,i?n.parentNode:n),r=e.inverse().multiply(M).multiply(e);gr(t,{dx:g,dy:_,scaleX:m,scaleY:x,localCTM:r,transformMatrix:M,bBox:a,__data__:y,isGrouped:i})}});else gr(n,{dx:g,dy:_,scaleX:m,scaleY:x,localCTM:M,transformMatrix:M,bBox:a,__data__:y,isGrouped:i})}i&&t===vr&&(this._applyTransformToHandles(),this._updateControlsView()),r.set(n,gt({},v))}},{key:"_processResize",value:function(t,e){var r,n,a,o,i,s,c=e.dx,l=e.dy,u=this.storage,h=u.revX,v=u.revY,f=u.doW,d=u.doH,p=u.data,y=u.bBox,m=y.x,x=y.y,b=y.width,g=y.height,_=this.options,k=_.isGrouped,E=_.proportions,M=_.scalable,T=p.get(t),w=T.transform,R=w.matrix,O=w.auxiliary.scale.translateMatrix,S=T.cached,V=void 0===S?{}:S,C=se((r=c,n=l,a=f||!f&&!d?(b+r)/b:(g+n)/g,[(o=E?b*a:b+r)/b,(i=E?g*a:g+n)/g,o,i]),4),A=C[0],N=C[1],P=C[2],D=C[3],j=(A,N,s=$e(),O.multiply(s).multiply(O.inverse())),B=m-(P-b)*(d?.5:h?1:0),Y=x-(D-g)*(f?.5:v?1:0),z=k?j.multiply(R):R.multiply(j);return M&&this._updateElementView(t,["transform",z]),p.set(t,gt({},T,{cached:gt({},V,{scaleX:A,scaleY:N,transformMatrix:j,resultMatrix:z})})),this._applyTransformToElement(t,hr),{x:B,y:Y,width:P,height:D,transform:z}}},{key:"_processMove",value:function(t,e){var r=e.dx,n=e.dy,a=this.storage.data,o=a.get(t),i=o.transform,s=i.matrix,c=i.auxiliary.translate,l=c.translateMatrix,u=c.parentMatrix,h=o.cached;u.e=u.f=0;var v=tr(u,r,n),f=v.x,d=v.y;a.set(t,gt({},o,{cached:gt({},h,{dist:{dx:le(r),dy:le(n),ox:le(f),oy:le(d)}})})),l.e=f,l.f=d;var p=l.multiply(s);return this._updateElementView(t,["transform",p]),p}},{key:"_processRotate",value:function(t,e){var r=this.storage,n=(r=void 0===r?{}:r).data.get(t).transform,a=n.matrix,o=n.parentMatrix,i=n.auxiliary.rotate.translateMatrix,s=le(Math.cos(e)),c=le(Math.sin(e)),l=Ue(c,s);o.e=o.f=0;var u=o.inverse().multiply(l).multiply(o),h=i.multiply(u).multiply(i.inverse()).multiply(a);return this._updateElementView(t,["transform",h]),h}},{key:"_getElementState",value:function(e,t){var r=t.revX,n=t.revY,a=t.doW,o=t.doH,i=this.options,s=i.container,c=i.isGrouped,l=this.storage,u=l.data,h=l.controls,v=l.handles.center,f=u.get(e),d=f.__data__;Er(e,f,s),d["delete"](e),qe(e).forEach(function(t){d["delete"](t),Er(t,f,e,c)});var p=this._getBBox(),y=p.x,m=p.y,x=p.width,b=p.height,g=Je(e,e.parentNode),_=Je(e,s),k=Je(e.parentNode,s),E=k.inverse(),M=y+x*(o?.5:r?1:0),T=m+b*(a?.5:n?1:0),w=Je(h,s),R=y+x/2,O=m+b/2,S=v?v.cx.baseVal.value:R,V=v?v.cy.baseVal.value:O,C=tr(w,S,V),A=C.x,N=C.y,P=v?tr(E,A,N):tr(c?E:g,R,O),D=P.x,j=P.y,B=tr(c?E:Ze(),M,T),Y=B.x,z=B.y;return{transform:{auxiliary:{scale:{scaleMatrix:Ze(),translateMatrix:Qe(Y,z)},translate:{parentMatrix:E,translateMatrix:Ze()},rotate:{translateMatrix:Qe(D,j)}},matrix:g,ctm:_,parentMatrix:k,scX:Math.sqrt(_.a*_.a+_.b*_.b),scY:Math.sqrt(_.c*_.c+_.d*_.d)},bBox:p}}},{key:"_getCommonState",value:function(){var t=this.elements,e=this.options,r=e.isGrouped,n=e.container,a=e.restrict,o=this.storage,i=o.controls,s=o.handles.center,c=this._getBBox(),l=c.x,u=c.y,h=l+c.width/2,v=u+c.height/2,f=Je(i,n),d=s?s.cx.baseVal.value:h,p=s?s.cy.baseVal.value:v,y=tr(f,d,p),m=y.x,x=y.y,b=Je(i.parentNode,n),g=s?tr(b.inverse(),m,x):tr(f,h,v),_=g.x,k=g.y,E=tr(r?Ze():Je(t[0],n),h,v),M=E.x,T=E.y,w=a?Je(a,a.parentNode):Je(n,n.parentNode),R=gt({},this.storage.center||{},{x:s?m:M,y:s?x:T,elX:_,elY:k,hx:s?s.cx.baseVal.value:null,hy:s?s.cy.baseVal.value:null});return{transform:{containerMatrix:w,controlsMatrix:Je(i,i.parentNode),controlsTranslateMatrix:Ze(),wrapperOriginMatrix:Qe(R.x,R.y)},bBox:c,center:R}}},{key:"_getVertices",value:function(t){var e=0<arguments.length&&void 0!==t?t:Ze(),r=this.elements,n=this.options,a=n.isGrouped,o=n.rotatable,i=n.rotatorAnchor,s=n.rotatorOffset,c=n.container,l=this._getBBox(),u=l.x,h=l.y,v=l.width,f=l.height,d=v/2,p=f/2,y={tl:[u,h],tr:[u+v,h],mr:[u+v,h+p],ml:[u,h+p],tc:[u+d,h],bc:[u+d,h+f],br:[u+v,h+f],bl:[u,h+f],center:[u+d,h+p]},m=a?e:e.multiply(Je(r[0],c)),x=yr(y).reduce(function(t,e){var r=se(e,2),n=r[0],a=se(r[1],2),o=a[0],i=a[1];return t[n]=tr(m,o,i),t},{});if(o){var b={},g=1;switch(i){case"n":var _=x.tc,k=_.x,E=_.y;b.x=k,b.y=E;break;case"s":var M=x.bc,T=M.x,w=M.y;b.x=T,b.y=w,g=-1;break;case"w":var R=x.ml,O=R.x,S=R.y;b.x=O,b.y=S,g=-1;break;case"e":default:var V=x.mr,C=V.x,A=V.y;b.x=C,b.y=A}var N="n"===i||"s"===i?Math.atan2(x.bl.y-x.tl.y,x.bl.x-x.tl.x):Math.atan2(x.tl.y-x.tr.y,x.tl.x-x.tr.x),P=s*g,D={x:b.x-P*Math.cos(N),y:b.y-P*Math.sin(N)};x.rotator=D,x.anchor=b}return x}},{key:"_getBBox",value:function(){var t=this.elements,e=this.options,n=e.container;if(e.isGrouped){var r=t.reduce(function(t,e){var r=Je(e,n);return[].concat(Xt(t),Xt(Tr(e,r)))},[]),a=se(T(r),2),o=se(a[0],2),i=o[0],s=o[1],c=se(a[1],2),l=c[0];return{x:i,y:l,width:s-i,height:c[1]-l}}return t[0].getBBox()}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,a=n.center,o=n.radius,i=r.center,s=r.center,c=s.hx,l=s.hy,u=r.transform.controlsMatrix;if(!Et(a)){var h=c+t,v=l+e;a.cx.baseVal.value=h,a.cy.baseVal.value=v,o.x2.baseVal.value=h,o.y2.baseVal.value=v,this.storage.center=gt({},i,{isShifted:!0,cached:gt({},tr(u.inverse(),h,v))})}}},{key:"_processMoveRestrict",value:function(t,e){var r=e.dx,n=e.dy,a=this.storage.data.get(t).transform,o=a.matrix,i=a.auxiliary.translate.parentMatrix;i.e=i.f=0;var s=tr(i,r,n),c=s.x,l=s.y,u=Qe(c,l).multiply(o);return this._restrictHandler(t,u)}},{key:"_processRotateRestrict",value:function(t,e){var r=this.storage,n=(r=void 0===r?{}:r).data.get(t).transform,a=n.matrix,o=n.parentMatrix,i=n.auxiliary.rotate.translateMatrix,s=le(Math.cos(e)),c=le(Math.sin(e)),l=Ue(c,s);o.e=o.f=0;var u=o.inverse().multiply(l).multiply(o),h=i.multiply(u).multiply(i.inverse()).multiply(a);return this._restrictHandler(t,h)}},{key:"_processResizeRestrict",value:function(t,e){var r,n,a,o,i,s=e.dx,c=e.dy,l=this.storage,u=l.doW,h=l.doH,v=l.data,f=l.bBox,d=f.width,p=f.height,y=this.options.proportions,m=v.get(t).transform,x=m.matrix,b=m.auxiliary.scale.translateMatrix,g=x.multiply(function(t,e){var r=$e(t,e);return b.multiply(r).multiply(b.inverse())}.apply(void 0,Xt((r=s,n=c,a=u||!u&&!h?(d+r)/d:(p+n)/p,[(o=y?d*a:d+r)/d,(i=y?p*a:p+n)/p,o,i]))));return this._restrictHandler(t,g)}},{key:"_processControlsResize",value:function(){var t=this.storage,e=(t=void 0===t?{}:t).transform.controlsMatrix;this._applyTransformToHandles({boxMatrix:e.inverse()})}},{key:"_processControlsMove",value:function(t){var e=t.dx,r=t.dy,n=this.storage,a=(n=void 0===n?{}:n).transform,o=a.controlsMatrix,i=a.controlsTranslateMatrix,s=n.center;i.e=e,i.f=r;var c=i.multiply(o);if(this._updateControlsView(c),s.isShifted){var l=o.inverse();l.e=l.f=0;var u=tr(l,e,r),h=u.x,v=u.y;this._moveCenterHandle(-h,-v)}}},{key:"_processControlsRotate",value:function(t){var e=t.radians,r=this.storage,n=(r=void 0===r?{}:r).transform,a=n.controlsMatrix,o=n.wrapperOriginMatrix,i=le(Math.cos(e)),s=le(Math.sin(e)),c=Ue(s,i),l=o.multiply(c).multiply(o.inverse()).multiply(a);this._updateControlsView(l)}},{key:"_updateElementView",value:function(t,e){var r=se(e,2),n=r[0],a=r[1];"transform"===n&&t.setAttribute(n,Ke(a))}},{key:"_updateControlsView",value:function(t){var e=0<arguments.length&&void 0!==t?t:Ze();this.storage.controls.setAttribute("transform",Ke(e))}},{key:"_applyTransformToHandles",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).boxMatrix,r=void 0===e?Ze():e,n=this.options.rotatable,a=this.storage,o=a.handles,i=a.center.isShifted,s=this._getVertices(r),c=s.anchor,l=void 0===c?null:c,u=s.center,h=R(s,["anchor","center"]),v={te:[h.tl,h.tr],be:[h.bl,h.br],le:[h.tl,h.bl],re:[h.tr,h.br]};if(n){var f=o.normal,d=o.radius;j(f)&&(f.x1.baseVal.value=l.x,f.y1.baseVal.value=l.y,f.x2.baseVal.value=h.rotator.x,f.y2.baseVal.value=h.rotator.y),j(d)&&(d.x1.baseVal.value=u.x,d.y1.baseVal.value=u.y,i||(d.x2.baseVal.value=u.x,d.y2.baseVal.value=u.y))}pr(v).forEach(function(t){var a=o[t],e=se(v[t],2),r=e[0],n=e[1];Et(r)||Et(a)||yr({x1:r.x,y1:r.y,x2:n.x,y2:n.y}).map(function(t){var e=se(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)})});var p=gt({},h,{},!i&&Boolean(u)&&{center:u});pr(p).forEach(function(t){var e=o[t],r=p[t];Et(r)||Et(e)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))})}},{key:"resetCenterPoint",value:function(){var t=this.storage,e=(t=void 0===t?{}:t).handles,r=(e=void 0===e?{}:e).center,n=e.radius,a=t.center,o=t.transform,i=(o=void 0===o?{}:o).controlsMatrix,s=void 0===i?Ze():i;if(a&&r&&n){var c=this._getVertices(s.inverse()).center,l=c.x,u=c.y;r.cx.baseVal.value=l,r.cy.baseVal.value=u,n.x2.baseVal.value=l,n.y2.baseVal.value=u,a.isShifted=!1}}},{key:"fitControlsToSize",value:function(){var t=this.storage,e=void 0===t?{}:t,r=Ze();this.storage=gt({},e,{transform:gt({},e.transform||{},{controlsMatrix:r})}),this._updateControlsView(r),this._applyTransformToHandles({boxMatrix:r})}},{key:"getBoundingRect",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:null,n=this.options,a=(n=void 0===n?{}:n).restrict,o=n.container,i=a||o,s=r?Je(t.parentNode,i).multiply(r):Je(t,i);return Tr(t,s,t.getBBox())}},{key:"applyAlignment",value:function(i){var s=this,t=this.elements,c=this.options.container,e=this._getVertices(),r=(e.anchor,e.rotator,e.center,R(e,["anchor","rotator","center"])),n=this._getRestrictedBBox(!0),a=mr(r).map(function(t){return[t.x,t.y]}),o=se(T(n),2),l=se(o[0],2),u=l[0],h=l[1],v=se(o[1],2),f=v[0],d=v[1],p=se(T(a),2),y=se(p[0],2),m=y[0],x=y[1],b=se(p[1],2),g=b[0],_=b[1];t.map(function(t){var e=Je(t.parentNode,c);e.e=e.f=0;var r=tr(e.inverse(),function(){switch(!0){case/[l]/.test(i):return u-m;case/[r]/.test(i):return h-x;case/[h]/.test(i):return(h+u)/2-(x+m)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(i):return f-g;case/[b]/.test(i):return d-_;case/[v]/.test(i):return(d+f)/2-(_+g)/2;default:return 0}}()),n=r.x,a=r.y,o=Qe(n,a).multiply(Je(t,t.parentNode));s._updateElementView(t,["transform",o])}),this.fitControlsToSize()}}]),e}(),br=function(e,t){var r=t.x,n=t.y,a=[];switch(e.tagName.toLowerCase()){case"text":var o=j(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,i=j(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=j(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=j(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;a.push(["x",s],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;a.push(["cx",l],["cy",u]);break;case"line":var h=e.x1.baseVal.value+r,v=e.y1.baseVal.value+n,f=e.x2.baseVal.value+r,d=e.y2.baseVal.value+n;a.push(["x1",h],["y1",v],["x2",f],["y2",d]);break;case"polygon":case"polyline":var p=nr(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");a.push(["points",p]);break;case"path":var y=e.getAttribute("d");a.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var a=ar(e),o="",i=" ",s=!0,c=0,l=a.length;c<l;c++){var u=a[c],h=u.values,v=u.key,f=u.relative,d=[];switch(v){case"M":for(var p=0,y=h.length;p<y;p+=2){var m=se(h.slice(p,p+2),2),x=m[0],b=m[1];f&&!s||(x+=r,b+=n),d.push(x,b),s=!1}break;case"A":for(var g=0,_=h.length;g<_;g+=7){var k=h.slice(g,g+7);f||(k[5]+=r,k[6]+=n),d.push.apply(d,Xt(k))}break;case"C":for(var E=0,M=h.length;E<M;E+=6){var T=h.slice(E,E+6);f||(T[0]+=r,T[1]+=n,T[2]+=r,T[3]+=n,T[4]+=r,T[5]+=n),d.push.apply(d,Xt(T))}break;case"H":for(var w=0,R=h.length;w<R;w+=1){var O=h.slice(w,w+1);f||(O[0]+=r),d.push(O[0])}break;case"V":for(var S=0,V=h.length;S<V;S+=1){var C=h.slice(S,S+1);f||(C[0]+=n),d.push(C[0])}break;case"L":case"T":for(var A=0,N=h.length;A<N;A+=2){var P=se(h.slice(A,A+2),2),D=P[0],j=P[1];f||(D+=r,j+=n),d.push(D,j)}break;case"Q":case"S":for(var B=0,Y=h.length;B<Y;B+=4){var z=se(h.slice(B,B+4),4),X=z[0],H=z[1],L=z[2],I=z[3];f||(X+=r,H+=n,L+=r,I+=n),d.push(X,H,L,I)}break;case"Z":i=h[0]=""}o+=v+d.join(",")+i}return o}catch(t){ce("Path parsing error: "+t)}}({path:y,dx:r,dy:n})])}a.forEach(function(t){e.setAttribute(t[0],t[1])})},gr=function(a,t){var e=t.scaleX,r=t.scaleY,o=t.localCTM,n=t.bBox,i=n.width,s=n.height,c=t.__data__,l=t.transformMatrix,u=t.isGrouped,h=[],v=c.get(a);switch(a.tagName.toLowerCase()){case"text":case"tspan":var f=v.x,d=v.y,p=v.textLength,y=tr(o,f,d),m=y.x,x=y.y;h.push(["x",m+(e<0?i:0)],["y",x-(r<0?s:0)],["textLength",Math.abs(e*p)]);break;case"circle":var b=v.r,g=v.cx,_=v.cy,k=b*(Math.abs(e)+Math.abs(r))/2,E=tr(o,g,_),M=E.x,T=E.y;h.push(["r",k],["cx",M],["cy",T]);break;case"foreignobject":case"image":case"rect":if(u){var w=v.matrix,R=v.childCTM,O=R.inverse().multiply(l).multiply(R),S=w.multiply(O);h.push(["transform",Ke(S)])}else{var V=v.width,C=v.height,A=v.x,N=v.y,P=tr(o,A,N),D=P.x,j=P.y,B=Math.abs(V*e),Y=Math.abs(C*r);h.push(["x",D-(e<0?B:0)],["y",j-(r<0?Y:0)],["width",B],["height",Y])}break;case"ellipse":var z=v.rx,X=v.ry,H=v.cx,L=v.cy,I=tr(o,H,L),G=I.x,W=I.y,F=Ze();F.a=e,F.d=r;var q=tr(F,z,X),Z=q.x,Q=q.y;h.push(["rx",Math.abs(Z)],["ry",Math.abs(Q)],["cx",G],["cy",W]);break;case"line":var U=v.resX1,$=v.resY1,J=v.resX2,K=v.resY2,tt=tr(o,U,$),et=tt.x,rt=tt.y,nt=tr(o,J,K),at=nt.x,ot=nt.y;h.push(["x1",et],["y1",rt],["x2",at],["y2",ot]);break;case"polygon":case"polyline":var it=v.points,st=nr(it).map(function(t){var e=tr(o,Number(t[0]),Number(t[1])),r=e.x,n=e.y;return t[0]=le(r),t[1]=le(n),t.join(" ")}).join(" ");h.push(["points",st]);break;case"path":var ct=v.path;h.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=ar(e),a="",o=" ",i=[],s=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,v=u.key,f=u.relative,d=void 0!==f&&f;switch(v){case"A":var p=[],y=er(r);d&&(y.e=y.f=0);for(var m=0,x=h.length;m<x;m+=7){var b=se(h.slice(m,m+7),7),g=b[0],_=b[1],k=b[2],E=b[3],M=b[4],T=b[5],w=b[6],R=tr(y,T,w),O=R.x,S=R.y;p.push(le(O),le(S)),y.e=y.f=0;var V=tr(y,g,_),C=V.x,A=V.y;p.unshift(le(C),le(A),k,E,M)}i.push(p);break;case"C":var N=[],P=er(r);d&&(P.e=P.f=0);for(var D=0,j=h.length;D<j;D+=6){var B=se(h.slice(D,D+6),6),Y=B[0],z=B[1],X=B[2],H=B[3],L=B[4],I=B[5],G=tr(P,Y,z),W=G.x,F=G.y,q=tr(P,X,H),Z=q.x,Q=q.y,U=tr(P,L,I),$=U.x,J=U.y;N.push(le(W),le(F),le(Z),le(Q),le($),le(J))}i.push(N);break;case"H":var K=[],tt=er(r);d&&(tt.e=tt.f=0);for(var et=0,rt=h.length;et<rt;et+=1){var nt=se(h.slice(et,et+1),1)[0],at=tr(tt,nt,0).x;K.push(le(at))}i.push(K);break;case"V":var ot=[],it=er(r);d&&(it.e=it.f=0);for(var st=0,ct=h.length;st<ct;st+=1){var lt=se(h.slice(st,st+1),1)[0],ut=tr(it,0,lt).y;ot.push(le(ut))}i.push(ot);break;case"T":case"L":var ht=[],vt=er(r);d&&(vt.e=vt.f=0);for(var ft=0,dt=h.length;ft<dt;ft+=2){var pt=se(h.slice(ft,ft+2),2),yt=pt[0],mt=pt[1],xt=tr(vt,yt,mt),bt=xt.x,gt=xt.y;ht.push(le(bt),le(gt))}i.push(ht);break;case"M":var _t=[],kt=er(r);d&&!s&&(kt.e=kt.f=0);for(var Et=0,Mt=h.length;Et<Mt;Et+=2){var Tt=se(h.slice(Et,Et+2),2),wt=Tt[0],Rt=Tt[1],Ot=tr(kt,wt,Rt),St=Ot.x,Vt=Ot.y;_t.push(le(St),le(Vt)),s=!1}i.push(_t);break;case"Q":var Ct=[],At=er(r);d&&(At.e=At.f=0);for(var Nt=0,Pt=h.length;Nt<Pt;Nt+=4){var Dt=se(h.slice(Nt,Nt+4),4),jt=Dt[0],Bt=Dt[1],Yt=Dt[2],zt=Dt[3],Xt=tr(At,jt,Bt),Ht=Xt.x,Lt=Xt.y,It=tr(At,Yt,zt),Gt=It.x,Wt=It.y;Ct.push(le(Ht),le(Lt),le(Gt),le(Wt))}i.push(Ct);break;case"S":var Ft=[],qt=er(r);d&&(qt.e=qt.f=0);for(var Zt=0,Qt=h.length;Zt<Qt;Zt+=4){var Ut=se(h.slice(Zt,Zt+4),4),$t=Ut[0],Jt=Ut[1],Kt=Ut[2],te=Ut[3],ee=tr(qt,$t,Jt),re=ee.x,ne=ee.y,ae=tr(qt,Kt,te),oe=ae.x,ie=ae.y;Ft.push(le(re),le(ne),le(oe),le(ie))}i.push(Ft);break;case"Z":i.push([""]),o=""}a+=u.key+i[c].join(",")+o}return a.trim()}catch(t){ce("Path parsing error: "+t)}}({path:ct,localCTM:o})])}h.forEach(function(t){var e=se(t,2),r=e[0],n=e[1];a.setAttribute(r,n)})},_r=function(t,e,r,n){var a=Fe("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(n)]);return yr({cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"}).forEach(function(t){var e=se(t,2),r=e[0],n=e[1];return a.setAttribute(r,n)}),a},kr=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")},Er=function(t,e,r,n){var a=null;switch(t.tagName.toLowerCase()){case"text":a={x:j(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,y:j(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,textLength:j(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null};break;case"circle":a={r:t.r.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"foreignobject":case"image":case"rect":a={width:t.width.baseVal.value,height:t.height.baseVal.value,x:t.x.baseVal.value,y:t.y.baseVal.value};break;case"ellipse":a={rx:t.rx.baseVal.value,ry:t.ry.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"line":a={resX1:t.x1.baseVal.value,resY1:t.y1.baseVal.value,resX2:t.x2.baseVal.value,resY2:t.y2.baseVal.value};break;case"polygon":case"polyline":a={points:t.getAttribute("points")};break;case"path":a={path:t.getAttribute("d")}}e.__data__.set(t,gt({},a,{matrix:Je(t,t.parentNode),ctm:Je(t.parentNode,r),childCTM:Je(t,n?r.parentNode:r)}))},Mr=function(t,e,r){var n=se(t,2),a=n[0],o=n[1],i=Fe("line",["sjx-svg-line","sjx-svg-line-".concat(r)]),s={x1:a.x,y1:a.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return yr(s).forEach(function(t){var e=se(t,2),r=e[0],n=e[1];return i.setAttribute(r,n)}),i},Tr=function(t,o,e){var r=2<arguments.length&&void 0!==e?e:t.getBBox(),n=r.x,a=r.y,i=r.width,s=r.height;return[[n,a],[n+i,a],[n+i,a+s],[n,a+s]].map(function(t){var e=se(t,2),r=e[0],n=e[1],a=tr(o,r,n);return[a.x,a.y]})};function wr(t,e){if(this.length){var r=j(e)&&e instanceof Ct?e:new Ct;if(this[0]instanceof SVGElement){var n=d.call(this,function(t,e){return function(t){var e=t.tagName.toLowerCase();return-1!==We.indexOf(e)||(ce('Selected element "'.concat(e,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)}(e)&&t.push(e),t},[]);return new xr(n,t,r)}return new Ye(f.call(this,function(t){return t}),t,r)}}var Rr=U.EMITTER_EVENTS,Or=$,Sr=pt,Vr=function(){o(a,zt);var n=c(a);function a(t,e){var r;return i(this,a),(r=n.call(this,t)).enable(e),r}return r(a,[{key:"_init",value:function(){var e=this,t=this.elements,r=this.options,n=rt(t),a=r.style,o=r.appendTo,i=gt({position:"absolute","z-index":"2147483647"},a),s=new WeakMap;t.map(function(t){return s.set(t,{parent:j(o)?rt(o)[0]:document.body})}),this.storage={css:i,data:s},n.on(Or,this._onMouseDown).on(Sr,this._onTouchStart),Rr.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e={},r=null,n=document,a=tt,o=tt,i=tt,s=tt;if(j(t)){var c=t.style,l=t.appendTo,u=t.stack,h=t.onInit,v=t.onMove,f=t.onDrop,d=t.onDestroy;e=j(c)&&"object"===K(c)?c:e,r=l||null;var p=j(u)?rt(u)[0]:document;a=et(h),o=et(v),i=y(f)?function(t){var e=this.storage,r=(e=void 0===e?{}:e).clone;!function(t,e){var r=x(t),n=r.top,a=r.left,o=x(e),i=o.top,s=o.left,c=rt(t),l=rt(e);return!(n<i||n+parseFloat(c.css("height"))>i+parseFloat(l.css("height"))||a<s||a+parseFloat(c.css("width"))>s+parseFloat(l.css("width")))}(r,p)||f.call(this,t,this.elements,r)}:tt,s=et(d)}this.options={style:e,appendTo:r,stack:n},this.proxyMethods={onInit:a,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.target,r=t.clientX,n=t.clientY,a=this.elements,o=this.storage,i=this.storage,s=i.data,c=i.css,l=a.find(function(t){return t===e||t.contains(e)});if(l){var u=(s.get(l)||{}).parent,h=void 0===u?l.parentNode:u,v=x(h),f=v.left,d=v.top;c.left="".concat(r-f,"px"),c.top="".concat(n-d,"px");var p=l.cloneNode(!0);rt(p).css(c),o.clientX=r,o.clientY=n,o.cx=r,o.cy=n,o.clone=p,h.appendChild(p),this._draw()}}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage;n.clientX=e,n.clientY=r,n.doDraw=!0,n.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,k(n),Et(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=Mt(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,a=t.cx,o=t.cy,i=t.clone;e&&(t.doDraw=!1,this._drag({element:i,dx:r-a,dy:n-o}))}},{key:"_processMove",value:function(t,e){var r=e.dx,n=e.dy,a=this.storage,o=(a=void 0===a?{}:a).clone,i="translate(".concat(r,"px, ").concat(n,"px)");rt(o).css({transform:i,webkitTranform:i,mozTransform:i,msTransform:i,otransform:i})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.elements;Et(t)||(rt(r).off(Or,this._onMouseDown).off(Sr,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),a}();function Cr(t){if(this.length)return new Vr(f.call(this,function(t){return t}),t)}var Ar=function(){o(e,p);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"drag",value:function(){return wr.call.apply(wr,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return Cr.call.apply(Cr,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function Nr(t){return new Ar(t)}return Object.defineProperty(Nr,"createObservable",{value:function(){return new Ct}}),Object.defineProperty(Nr,"Subjx",{value:Ar}),Object.defineProperty(Nr,"Observable",{value:Ct}),Nr});
