/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2021
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function gt(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,r,a;e=n,a=o[r=t],r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function R(t,e){if(null==t)return{};var r=function(t,e){if(null==t)return{};var r={};var a=Object.keys(t);var n,o;for(o=0;o<a.length;o++)n=a[o],0<=e.indexOf(n)||(r[n]=t[n]);return r}(t,e);var a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],0<=e.indexOf(a)||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(a){return function(){var t,e=_t(a);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var r=_t(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}(this,t)}}function kt(t,e,r){return(kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_t(t)););return t}(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function se(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[];var a=!0;var n=!1;var o=void 0;try{for(var i,s=t[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){n=!0,o=t}finally{try{a||null==s["return"]||s["return"]()}finally{if(n)throw o}}return r}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}var Et=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)};var k=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)};var t=Array.prototype,u=t.forEach,h=t.slice,f=t.map,d=t.reduce;var ce=console.warn;function tt(t){return t}var j=function(t){return null!=t};function Mt(t){return null==t}function y(t){return"function"==typeof t}function et(t){return y(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:tt}var p=function(){function o(t){if(i(this,o),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==K(t)||1!==t.nodeType&&t!==document)if(t instanceof o){this.length=t.length;for(var a=0;a<this.length;a++)this[a]=t[a]}else{if(!function(t){return j(t)&&"object"===K(t)&&(Array.isArray(t)||j(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||j(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=t.length;for(var n=0;n<this.length;n++)1===t[n].nodeType&&(this[n]=t[n])}else this[0]=t,this.length=1}return r(o,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){var r=t.length;for(;r--;)for(var a in e)t[r].style[a]=e[a];return t.style}(this,t)},getStyle:function(){return function(t){var e=t.length;for(;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,h.call(arguments,1)):"object"!==K(r)&&r?(ce("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,a){var n=this.length;for(;n--;)this[n].events||(this[n].events={},this[n].events[t]=[]),"string"!=typeof e?document.addEventListener?this[n].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[n].attachEvent("on".concat(t),e):this[n]["on".concat(t)]=e:m(this[n],t,e,r,a,!0);return this}},{key:"off",value:function(t,e,r,a){var n=this.length;for(;n--;)this[n].events||(this[n].events={},this[n].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[n].removeEventListener(t,e,r):document.detachEvent?this[n].detachEvent("on".concat(t),e):this[n]["on".concat(t)]=null:m(this[n],t,e,r,a,!1);return this}},{key:"is",value:function(t){if(Mt(t))return!1;var e=rt(t);var r=this.length;for(;r--;)if(this[r]===e[r])return!0;return!1}}]),o}();function m(t,e,r,a,n,o){function i(t){var e=t.target;for(;e&&e!==this;)e.matches(r)&&a.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,n||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,n||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function rt(t){return new p(t)}var Y=2;var w="#00a8ff";var at="sjx-";var x="dragStart";var b="drag";var g="dragEnd";var _="resizeStart";var E="resize";var M="resizeEnd";var T="rotateStart";var O="rotate";var S="rotateEnd";var V="setPointStart";var C="setPointEnd";var A=["","-webkit-","-moz-","-ms-","-o-"];var N="ongetstate";var P="onapply";var D="onmove";var B="onresize";var L="onrotate";var z={NOTIFIER_EVENTS:[N,P,D,B,L],ON_GETSTATE:N,ON_APPLY:P,ON_MOVE:D,ON_RESIZE:B,ON_ROTATE:L};var H={EMITTER_EVENTS:[x,b,,g,_,E,M,T,O,S,V,C],E_DRAG_START:x,E_DRAG:b,E_DRAG_END:g,E_RESIZE_START:_,E_RESIZE:E,E_RESIZE_END:M,E_ROTATE_START:T,E_ROTATE:O,E_ROTATE_END:S,E_SET_POINT_START:V,E_SET_POINT_END:C};var X="mousedown",I="mouseup",G="mousemove",W="touchstart",F="touchend",q="touchmove";var Z={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},Q={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"};var U=z.ON_GETSTATE,$=z.ON_APPLY,J=z.ON_MOVE,nt=z.ON_RESIZE,ot=z.ON_ROTATE;var it=function(){function t(){i(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return Mt(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(j(r[t])){var a=r[t].indexOf(e);r[t].splice(a,1)}return this}},{key:"notify",value:function(e,r,a){Mt(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case J:t.notifyMove(a);break;case ot:t.notifyRotate(a);break;case nt:t.notifyResize(a);break;case $:t.notifyApply(a);break;case U:t.notifyGetState(a)}})}}]),t}();var st=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return r(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}();var ct=function(){function t(){i(this,t),this.events={}}return r(t,[{key:"registerEvent",value:function(t){this.events[t]=new st(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}();var vt=H.E_DRAG;var lt=G,ut=I,ht=q,ft=F;var dt=function(){function e(t){i(this,e),this.elements=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new ct,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.elements),this.proxyMethods.onInit.call(this,this.elements)}},{key:"disable",value:function(){pt()}},{key:"_init",value:function(){pt()}},{key:"_destroy",value:function(){pt()}},{key:"_processOptions",value:function(){pt()}},{key:"_start",value:function(){pt()}},{key:"_moving",value:function(){pt()}},{key:"_end",value:function(){pt()}},{key:"_animate",value:function(){pt()}},{key:"_drag",value:function(t){var e=t.element,r=t.dx,a=t.dy,n=R(t,["element","dx","dy"]);var o=gt({dx:r,dy:a,transform:this._processMove(e,{dx:r,dy:a})},n);this.proxyMethods.onMove.call(this,o),this._emitEvent(vt,o)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),rt(document).on(lt,this._onMouseMove).on(ut,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),rt(document).on(ht,this._onTouchMove).on(ft,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0])}},{key:"_onMouseUp",value:function(t){rt(document).off(lt,this._onMouseMove).off(ut,this._onMouseUp),this._end(t,this.elements)}},{key:"_onTouchEnd",value:function(t){rt(document).off(ht,this._onTouchMove).off(ft,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.elements)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}();var pt=function(){throw Error("Method not implemented")};var yt=Math.PI/180;function Tt(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0}function ve(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}function mt(r,t){var e=1<arguments.length&&void 0!==t?t:2;var a=[];function n(e){var t=r.map(function(t){return t[e]});a.push([Math.min.apply(Math,Yt(t)),Math.max.apply(Math,Yt(t))])}for(var o=0;o<e;o++)n(o);return a}function xt(t){return t.getBoundingClientRect()}function wt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function Rt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function bt(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function Ot(t,e){var r=window.getComputedStyle(t);var a=null;var n,o=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=v(t))){var e=0;var r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,o=!0,i=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return o=t.done,t},e:function(t){i=!0,n=t},f:function(){try{o||null==a.return||a.return()}finally{if(i)throw n}}}}(A);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(a=r.getPropertyValue("".concat(i).concat(e))||a)break}}catch(t){o.e(t)}finally{o.f()}return a}var St=z.NOTIFIER_EVENTS,Vt=z.ON_GETSTATE,Ct=z.ON_APPLY,At=z.ON_MOVE,Nt=z.ON_RESIZE,Pt=z.ON_ROTATE;var Dt=H.EMITTER_EVENTS,jt=H.E_DRAG_START,Bt=H.E_DRAG,Lt=H.E_DRAG_END,zt=H.E_RESIZE_START,Ht=H.E_RESIZE,Xt=H.E_RESIZE_END,It=H.E_ROTATE_START,Gt=H.E_ROTATE,Wt=H.E_ROTATE_END;var Ft=Z,qt=Q;var Zt=X,Qt=W,Ut=G,$t=I,Jt=q,Kt=F;var te=Ft.TOP_LEFT,ee=Ft.TOP_CENTER,re=Ft.TOP_RIGHT,ae=Ft.BOTTOM_LEFT,ne=Ft.BOTTOM_RIGHT,oe=Ft.BOTTOM_CENTER,ie=Ft.MIDDLE_LEFT,le=Ft.MIDDLE_RIGHT;var ue=qt.TOP_EDGE,he=qt.BOTTOM_EDGE,fe=qt.LEFT_EDGE,de=qt.RIGHT_EDGE;var pe=Object.keys,ye=Object.values;var me=function(){o(bt,dt);var n=c(bt);function bt(t,e,r){var a;if(i(this,bt),(a=n.call(this,t)).constructor===bt)throw new TypeError("Cannot construct Transformable instances directly");return a.observable=r,Dt.forEach(function(t){return a.eventDispatcher.registerEvent(t)}),kt(_t(bt.prototype),"enable",s(a)).call(s(a),e),a}return r(bt,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.element,r=t.radians,a=R(t,["element","radians"]);var n=gt({transform:this._processRotate(e,r),delta:r},a);this.proxyMethods.onRotate.call(this,n),kt(_t(bt.prototype),"_emitEvent",this).call(this,Gt,n)}},{key:"_resize",value:function(t){var e=t.element,r=t.dx,a=t.dy,n=R(t,["element","dx","dy"]);var o=gt({},this._processResize(e,{dx:r,dy:a}),{dx:r,dy:a},n);this.proxyMethods.onResize.call(this,o),kt(_t(bt.prototype),"_emitEvent",this).call(this,Ht,o)}},{key:"_processOptions",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};var r=this.elements;Yt(r).map(function(t){return wt(t,"".concat(at,"drag"))});var a=e.each,n=void 0===a?{move:!1,resize:!1,rotate:!1}:a,o=e.snap,i=void 0===o?{x:10,y:10,angle:10}:o,s=e.axis,c=void 0===s?"xy":s,v=e.cursorMove,l=void 0===v?"auto":v,u=e.cursorResize,h=void 0===u?"auto":u,f=e.cursorRotate,d=void 0===f?"auto":f,p=e.rotationPoint,y=void 0!==p&&p,m=e.restrict,x=e.draggable,b=void 0===x||x,g=e.resizable,_=void 0===g||g,k=e.rotatable,E=void 0===k||k,M=e.scalable,T=void 0!==M&&M,w=e.applyTranslate,R=void 0!==w&&w,O=e.onInit,S=void 0===O?tt:O,V=e.onDrop,C=void 0===V?tt:V,A=e.onMove,N=void 0===A?tt:A,P=e.onResize,D=void 0===P?tt:P,j=e.onRotate,B=void 0===j?tt:j,L=e.onDestroy,z=void 0===L?tt:L,Y=e.container,H=void 0===Y?r[0].parentNode:Y,X=e.controlsContainer,I=void 0===X?H:X,G=e.proportions,W=void 0!==G&&G,F=e.rotatorAnchor,q=void 0===F?null:F,Z=e.rotatorOffset,Q=void 0===Z?50:Z,U=e.showNormal,$=void 0===U||U,J=e.custom;this.options={axis:c,cursorMove:l,cursorRotate:d,cursorResize:h,rotationPoint:y,restrict:m?rt(m)[0]||document.body:null,container:rt(H)[0],controlsContainer:rt(I)[0],snap:gt({},i,{angle:i.angle*yt}),each:n,proportions:W,draggable:b,resizable:_,rotatable:E,scalable:T,applyTranslate:R,custom:"object"===K(J)&&J||null,rotatorAnchor:q,rotatorOffset:Q,showNormal:$,isGrouped:1<r.length},this.proxyMethods={onInit:et(S),onDrop:et(C),onMove:et(N),onResize:et(D),onRotate:et(B),onDestroy:et(z)},this.subscribe(n)}},{key:"_animate",value:function(){var u=this;var s=this;var t=s.observable,e=s.storage,r=s.options,a=s.elements;if(!Mt(e)&&(e.frame=Et(s._animate),e.doDraw)){e.doDraw=!1;var h=e.dox,f=e.doy,n=e.clientX,o=e.clientY,i=e.relativeX,c=e.relativeY,v=e.doDrag,l=e.doResize,d=e.doRotate,p=e.doSetCenter,y=e.revX,m=e.revY,x=e.mouseEvent,b=e.data;var g=r.snap,_=r.each,k=_.move,E=_.resize,M=_.rotate,T=r.draggable,w=r.resizable,R=r.rotatable,O=r.isGrouped,S=r.restrict;if(l&&w){var V=Tt(n-i,g.x);var C=Tt(o-c,g.y);var A=e.cached,N=e.cached;var P=(N=void 0===N?{}:N).dist;var D=(P=void 0===P?{}:P).dx,j=void 0===D?V:D,B=P.dy,L=void 0===B?C:B;var z={dx:V,dy:C,clientX:n,clientY:o,mouseEvent:x};var Y=S?a.reduce(function(t,e){var r=b.get(e).transform.ctm;var a=O?{x:V,y:C}:u._pointToTransform({x:V,y:C,matrix:r}),n=a.x,o=a.y;var i=h?y?-n:n:0;var s=f?m?-o:o:0;var c=u._processResizeRestrict(e,{dx:i,dy:s}),v=c.x,l=c.y;return{x:null!==v&&null===t.x?V:t.x,y:null!==l&&null===t.y?C:t.y}},{x:null,y:null}):{x:null,y:null},H=Y.x,X=Y.y;var I=S&&(null!==H||null!==X);var G=I?j:V;var W=I?L:C;var F=gt({},z,{dx:G,dy:W,revX:y,revY:m,dox:h,doy:f});a.map(function(t){var e=b.get(t).transform.ctm;var r=O?{x:G,y:W}:u._pointToTransform({x:G,y:W,matrix:e}),a=r.x,n=r.y;var o=h?y?-a:a:0;var i=f?m?-n:n:0;s._resize(gt({},F,{element:t,dx:o,dy:i}))}),this.storage.cached=gt({},A,{dist:{dx:G,dy:W}}),this._processControlsResize({dx:G,dy:W}),E&&t.notify(Nt,s,F)}if(v&&T){var q=h?Tt(n-i,g.x):0;var Z=f?Tt(o-c,g.y):0;var Q=e.cached,U=e.cached;var $=(U=void 0===U?{}:U).dist;var J=($=void 0===$?{}:$).dx,K=void 0===J?q:J,tt=$.dy,et=void 0===tt?Z:tt;var rt={dx:q,dy:Z,clientX:n,clientY:o,mouseEvent:x};var at=S?a.reduce(function(t,e){var r=u._processMoveRestrict(e,rt),a=r.x,n=r.y;return{x:null===t.x&&S?a:t.x,y:null===t.y&&S?n:t.y}},{x:null,y:null}):{x:null,y:null},nt=at.x,ot=at.y;var it=null!==nt&&S?K:q;var st=null!==ot&&S?et:Z;var ct=gt({},rt,{dx:it,dy:st});this.storage.cached=gt({},Q,{dist:{dx:it,dy:st}}),a.map(function(t){return kt(_t(bt.prototype),"_drag",u).call(u,gt({element:t},ct,{dx:it,dy:st}))}),this._processControlsMove({dx:it,dy:st}),k&&t.notify(At,s,ct)}if(d&&R){var vt=e.pressang,lt=e.center;var ut=Math.atan2(o-lt.y,n-lt.x);var ht=Tt(ut-vt,g.angle);if(S)if(a.some(function(t){var e=u._processRotateRestrict(t,ht),r=e.x,a=e.y;return null!==r||null!==a}))return;var ft={clientX:n,clientY:o,mouseEvent:x};a.map(function(t){return s._rotate(gt({element:t,radians:ht},ft))}),this._processControlsRotate({radians:ht}),M&&t.notify(Pt,s,gt({radians:ht},ft))}if(p&&R){var dt=e.bx,pt=e.by;var yt=this._pointToControls({x:n,y:o}),mt=yt.x,xt=yt.y;s._moveCenterHandle(mt-dt,xt-pt)}}}},{key:"_start",value:function(e){var t=e.clientX,r=e.clientY;var a=this.elements,n=this.observable,o=this.options,i=o.axis,s=o.each,c=this.storage,v=this.storage.handles;var l=ye(v).some(function(t){return rt(e.target).is(t)})||a.some(function(t){return t.contains(e.target)});if(c.isTarget=l){var u=this._compute(e,a);pe(u).map(function(t){return c[t]=u[t]});var h=u.onRightEdge,f=u.onBottomEdge,d=u.onTopEdge,p=u.onLeftEdge,y=u.handle,m=u.factor,x=u.revX,b=u.revY,g=u.doW,_=u.doH;var k=h||f||d||p;var E=v.rotator,M=v.center,T=v.radius;j(T)&&Rt(T,"".concat(at,"hidden"));var w=y.is(E),R=!!j(M)&&y.is(M);var O=l&&!(w||k||R);var S={mouseEvent:e,clientX:t,clientY:r,doResize:k,doDrag:O,doRotate:w,doSetCenter:R,onExecution:!0,cursor:null,dox:/\x/.test(i)&&(!k||(y.is(v.ml)||y.is(v.mr)||y.is(v.tl)||y.is(v.tr)||y.is(v.bl)||y.is(v.br)||y.is(v.le)||y.is(v.re))),doy:/\y/.test(i)&&(!k||(y.is(v.br)||y.is(v.bl)||y.is(v.bc)||y.is(v.tr)||y.is(v.tl)||y.is(v.tc)||y.is(v.te)||y.is(v.be)))};this.storage=gt({},c,{},S);var V={clientX:t,clientY:r};k?kt(_t(bt.prototype),"_emitEvent",this).call(this,zt,V):w?kt(_t(bt.prototype),"_emitEvent",this).call(this,It,V):O&&kt(_t(bt.prototype),"_emitEvent",this).call(this,jt,V);var C=s.move,A=s.resize,N=s.rotate;var P=k?Ht:w?Gt:Bt;var D=k&&A||w&&N||O&&C;n.notify(Vt,this,{clientX:t,clientY:r,actionName:P,triggerEvent:D,factor:m,revX:x,revY:b,doW:g,doH:_}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,a=this.options;if(r.isTarget){var n=this._cursorPoint(t),o=n.x,i=n.y;r.mouseEvent=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,c=r.doDrag,v=r.doResize,l=r.cursor;var u=a.cursorMove,h=a.cursorResize,f=a.cursorRotate;Mt(l)&&(c?l=u:s?l=f:v&&(l=h),rt(document.body).css({cursor:l}))}}},{key:"_end",value:function(t){var e=this;var r=t.clientX,a=t.clientY;var n=this.elements,o=this.options.each,i=this.observable,s=this.storage,c=this.storage,v=c.doResize,l=c.doDrag,u=c.doRotate,h=c.frame,f=c.handles.radius,d=c.isTarget,p=this.proxyMethods;if(d){var y=v?Ht:l?Bt:Gt;s.doResize=!1,s.doDrag=!1,s.doRotate=!1,s.doSetCenter=!1,s.doDraw=!1,s.onExecution=!1,s.cursor=null,n.map(function(t){return e._applyTransformToElement(t,y)});var m={clientX:r,clientY:a};p.onDrop.call(this,m),v?kt(_t(bt.prototype),"_emitEvent",this).call(this,Xt,m):u?kt(_t(bt.prototype),"_emitEvent",this).call(this,Wt,m):l&&kt(_t(bt.prototype),"_emitEvent",this).call(this,Lt,m);var x=o.move,b=o.resize,g=o.rotate;var _=v&&b||u&&g||l&&x;i.notify(Ct,this,{clientX:r,clientY:a,actionName:y,triggerEvent:_}),k(h),rt(document.body).css({cursor:"auto"}),j(f)&&wt(f,"".concat(at,"hidden"))}}},{key:"_compute",value:function(e,t){var s=this;var r=this.storage;var a=(r=void 0===r?{}:r).handles,c=r.data;var n=rt(e.target);var o=this._checkHandles(n,a),v=o.revX,l=o.revY,u=o.doW,h=o.doH,i=R(o,["revX","revY","doW","doH"]);var f=this._getCommonState();var d=this._cursorPoint(e),p=d.x,y=d.y;var m=this._pointToControls({x:p,y:y},f.transform),x=m.x,b=m.y;t.map(function(t){var e=s._getElementState(t,{revX:v,revY:l,doW:u,doH:h}),r=e.transform,a=R(e,["transform"]);var n=s._pointToTransform({x:p,y:y,matrix:r.ctm}),o=n.x,i=n.y;c.set(t,gt({},c.get(t),{},a,{transform:r,cx:o,cy:i}))});var g=Math.atan2(y-f.center.y,p-f.center.x);return gt({data:c},i,{handle:ye(a).some(function(t){return rt(e.target).is(t)})?n:rt(t[0]),pressang:g},f,{revX:v,revY:l,doW:u,doH:h,relativeX:p,relativeY:y,bx:x,by:b})}},{key:"_checkHandles",value:function(e,r){function t(t){return t.some(function(t){return function(t){return!!j(t)&&e.is(t)}(r[t])})}return{revX:t([te,ie,ae,ee,fe]),revY:t([te,re,ee,ie,ue]),onTopEdge:t([ee,re,te,ue]),onLeftEdge:t([te,ie,ae,fe]),onRightEdge:t([re,le,ne,de]),onBottomEdge:t([ne,oe,ae,he]),doW:t([ie,le,fe,de]),doH:t([ee,oe,he,ue])}}},{key:"_restrictHandler",value:function(t,e){var r=null,a=null;var n=this.getBoundingRect(t,e);var o=this._getRestrictedBBox();var i=se(mt(o),2),s=se(i[0],2),c=s[0],v=s[1],l=se(i[1],2),u=l[0],h=l[1];for(var f=0,d=n.length;f<d;f++){var p=se(n[f],2),y=p[0],m=p[1];(y<c||v<y)&&(r=y),(m<u||h<m)&&(a=m)}return{x:r,y:a}}},{key:"_destroy",value:function(){var e=this;var t=this.elements,r=this.storage;var a=(r=void 0===r?{}:r).controls,n=r.wrapper;[].concat(Yt(t),[a]).map(function(t){return rt(t).off(Zt,e._onMouseDown).off(Qt,e._onTouchStart)}),n.parentNode.removeChild(n)}},{key:"notifyMove",value:function(t){var e=this;var r=t.dx,a=t.dy;this.elements.map(function(t){return kt(_t(bt.prototype),"_drag",e).call(e,{element:t,dx:r,dy:a})}),this._processControlsMove({dx:r,dy:a})}},{key:"notifyRotate",value:function(t){var e=this;var r=t.radians,a=R(t,["radians"]);var n=this.elements,o=this.options;var i=(o=void 0===o?{}:o).snap.angle;n.map(function(t){return e._rotate(gt({element:t,radians:Tt(r,i)},a))}),this._processControlsRotate({radians:r})}},{key:"notifyResize",value:function(t){var o=this;var i=t.dx,s=t.dy,c=t.revX,v=t.revY,l=t.dox,u=t.doy;var e=this.elements,h=this.storage.data,f=this.options.isGrouped;e.map(function(t){var e=h.get(t).transform.ctm;var r=f?{x:i,y:s}:o._pointToTransform({x:i,y:s,matrix:e}),a=r.x,n=r.y;o._resize({element:t,dx:l?c?-a:a:0,dy:u?v?-n:n:0})}),this._processControlsResize({dx:i,dy:s})}},{key:"notifyApply",value:function(t){var e=this;var r=t.clientX,a=t.clientY,n=t.actionName,o=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:r,clientY:a}),o&&(this.elements.map(function(t){return e._applyTransformToElement(t,n)}),kt(_t(bt.prototype),"_emitEvent",this).call(this,"".concat(n,"End"),{clientX:r,clientY:a}))}},{key:"notifyGetState",value:function(t){var r=this;var e=t.clientX,a=t.clientY,n=t.actionName,o=t.triggerEvent,i=R(t,["clientX","clientY","actionName","triggerEvent"]);if(o){var s=this.elements,c=this.storage.data;s.map(function(t){var e=r._getElementState(t,i);c.set(t,gt({},c.get(t),{},e))});var v=this._getCommonState();this.storage=gt({},this.storage,{},v),kt(_t(bt.prototype),"_emitEvent",this).call(this,"".concat(n,"Start"),{clientX:e,clientY:a})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,a=t.rotate;var n=this.observable;(r||e||a)&&n.subscribe(Vt,this).subscribe(Ct,this),r&&n.subscribe(At,this),e&&n.subscribe(Nt,this),a&&n.subscribe(Pt,this)}},{key:"unsubscribe",value:function(){var e=this;var r=this.observable;St.map(function(t){return r.unsubscribe(t,e)})}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.elements;Mt(t)||(t.onExecution&&rt(document).off(Ut,this._onMouseMove).off($t,this._onMouseUp).off(Jt,this._onTouchMove).off(Kt,this._onTouchEnd),r.map(function(t){return Rt(t,"".concat(at,"drag"))}),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var r=this;var e=t.dx,a=t.dy;var n=this.elements,o=this.options.draggable,i=this.storage,s=this.storage.data;if(o){var c=this._getCommonState();n.map(function(t){var e=r._getElementState(t,{revX:!1,revY:!1,doW:!1,doH:!1});s.set(t,gt({},s.get(t),{},e))}),this.storage=gt({},i,{},c),n.map(function(t){kt(_t(bt.prototype),"_drag",r).call(r,{element:t,dx:e,dy:a}),r._applyTransformToElement(t,Bt)}),this._processControlsMove({dx:e,dy:a})}}},{key:"exeResize",value:function(t){var r=this;var e=t.dx,a=t.dy,n=t.revX,o=void 0!==n&&n,i=t.revY,s=void 0!==i&&i,c=t.doW,v=void 0!==c&&c,l=t.doH,u=void 0!==l&&l;var h=this.elements,f=this.options.resizable,d=this.storage,p=this.storage.data;if(f){var y=this._getCommonState();h.map(function(t){var e=r._getElementState(t,{revX:o,revY:s,doW:v,doH:u});p.set(t,gt({},p.get(t),{},e))}),this.storage=gt({},d,{},y),h.map(function(t){r._resize({element:t,dx:e,dy:a}),r._applyTransformToElement(t,Ht)}),this._processControlsMove({dx:e,dy:a})}}},{key:"exeRotate",value:function(t){var r=this;var e=t.delta;var a=this.elements,n=this.options.rotatable,o=this.storage,i=this.storage.data;if(n){var s=this._getCommonState();a.map(function(t){var e=r._getElementState(t,{revX:!1,revY:!1,doW:!1,doH:!1});i.set(t,gt({},i.get(t),{},e))}),this.storage=gt({},o,{},s),a.map(function(t){r._rotate({element:t,radians:e}),r._applyTransformToElement(t,Gt)}),this._processControlsRotate({radians:e})}}},{key:"controls",get:function(){return this.storage.wrapper}}]),bt}();function xe(t){return t.map(function(t){return Yt(t)})}function be(a){return a.reduce(function(t,e,r){return[].concat(Yt(t),[a[0][r],a[1][r],a[2][r],a[3][r]])},[])}function ge(t){return Yt(Array(0<arguments.length&&void 0!==t?t:4)).map(function(t,e,r){return r.map(function(){return+!e--})})}function _e(r,a,t){var n=2<arguments.length&&void 0!==t?t:0;return ge().map(function(t,e){return t[3]=[r,a,n,1][e],t})}function ke(r,a,t,e){var n=2<arguments.length&&void 0!==t?t:1;var o=3<arguments.length&&void 0!==e?e:1;return ge().map(function(t,e){return t[e]=[r,a,n,o][e],t})}function Ee(t,e){var r=ge();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r}function Me(t,e){var r=!(1<arguments.length&&void 0!==e)||e?xe(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r}function Te(t,e){var r=[];for(var a=0,n=t.length;a<n;++a){var o=0;for(var i=0;i<n;++i)o+=+t[a][i]*e[i];r[a]=o}return r}function we(t,e){var r=[];for(var a=0;a<e.length;a++){r[a]=[];for(var n=0;n<t[0].length;n++){var o=0;for(var i=0;i<t.length;i++)o+=t[i][n]*e[a][i];r[a].push(o)}}return r}function Re(t){var e=xe(t);var r,a=e.length,n=[];for(var o=0;o<a;o++)n[o]=[];for(var i=0;i<a;i++)for(var s=0;s<a;s++)n[i][s]=0,i==s&&(n[i][s]=1);for(var c=0;c<a;c++){r=e[c][c];for(var v=0;v<a;v++)e[c][v]/=r,n[c][v]/=r;for(var l=c+1;l<a;l++){r=e[l][c];for(var u=0;u<a;u++)e[l][u]-=e[c][u]*r,n[l][u]-=n[c][u]*r}}for(var h=a-1;0<h;h--)for(var f=h-1;0<=f;f--){r=e[f][h];for(var d=0;d<a;d++)e[f][d]-=e[h][d]*r,n[f][d]-=n[h][d]*r}for(var p=0;p<a;p++)for(var y=0;y<a;y++)e[p][y]=n[p][y];return e}function Oe(t,e,r){var a=1<arguments.length&&void 0!==e?e:document.body;var n=2<arguments.length?r:void 0;var o=ge();var i=t;var s=n||Ve(i);var c=!1;for(;i&&i instanceof Element;){var v=Ce(i,c);if(o=we(o,(l=s,void 0,u=se(v,3),h=u[0],f=u[1],d=u[2],p=_e(-h,-f,-d),y=_e(h,f,d),we(we(p,l),y))),c=!0,i===a||null===i.offsetParent)break;i=i.offsetParent,s=Ve(i)}var l,u,h,f,d,p,y;return o}function Se(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),a=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]);var n=Math.atan2(-t[0][3]/a,t[1][3]/a),o=Math.asin(t[3][1]/a),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=t[n=0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:n,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/a},scale:{sX:e,sY:r,sZ:a}}}var Ve=function(t){var e=Ot(t,"transform")||"none";var r=ge();if("none"===e)return r;var a=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==a.length)return[[+a[0],+a[2],0,+a[4]],[+a[1],+a[3],0,+a[5]],[0,0,1,0],[0,0,0,1]];for(var n=0;n<4;++n)for(var o=0;o<4;++o)r[o][n]=+a[4*n+o];return r};var Ce=function(t,e){var r=Ot(t,"transform-origin");var a=r?r.split(" "):[];var n=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1];for(var o=0;o<a.length;++o)n[o]+=parseFloat(a[o]);return n};function Ae(t,e){var r=1<arguments.length&&void 0!==e?e:document.body;var a=0,n=0;var o=t;var i=!1;for(;o&&o.offsetParent;){var s=Oe(o.offsetParent);var c=se(Te(Me(s,!1),[o.offsetLeft+(i?o.clientLeft:0),o.offsetTop+(i?o.clientTop:0),0,1]),2);if(n+=c[0],a+=c[1],r===o)break;i=!0,o=o.offsetParent}return[n,a,0,1]}var Ne=X,Pe=W;var De=Object.keys,je=Object.entries,Be=Object.values;var Le=function(){o(e,me);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this;var r=this.options,a=r.rotationPoint,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,c=r.showNormal;var v=Ie(["sjx-wrapper"]);var l=Ie(["sjx-controls"]);var u={};var h=this._getVertices(),f=h.rotator,d=void 0===f?null:f,p=h.anchor,y=void 0===p?null:p,m=R(h,["rotator","anchor"]);var x={};if(s){var b=c?Ye([[y.x,y.y],d],"normal"):null;c&&l.appendChild(b);var g=null;a&&(g=Ye([m.center,m.center],"radius"),wt(g,"sjx-hidden"),l.appendChild(g)),x=gt({},x,{normal:b,radius:g})}var _={te:[m.tl,m.tr],be:[m.bl,m.br],le:[m.tl,m.bl],re:[m.tr,m.br]};var k=i?{tl:m.tl,tr:m.tr,br:m.br,bl:m.bl,tc:m.tc,bc:m.bc,ml:m.ml,mr:m.mr}:{};var E=Array.isArray(a)?[].concat(Yt(a),[0,1]):m.center;var M=gt({},k,{center:a&&s?E:void 0,rotator:d});function T(a,n){return De(a).map(function(t){var e=a[t];if(!Mt(e)){var r=n(e,t);u[t]=r,l.appendChild(r)}})}T(_,Ye),T(M,ze),v.appendChild(l),o.appendChild(v);var w=new WeakMap;t.map(function(t){return w.set(t,{parent:t.parentNode,transform:{ctm:Oe(t,n)},bBox:e._getBBox(),__data__:new WeakMap,cached:{}})}),this.storage={wrapper:v,controls:l,handles:gt({},u,{},x),data:w,center:{isShifted:Boolean(a)}},[].concat(Yt(t),[l]).map(function(t){return rt(t).on(Ne,e._onMouseDown).on(Pe,e._onTouchStart)})}},{key:"_pointToTransform",value:function(t){var e=t.x,r=t.y,a=t.matrix;var n=Re(a);return this._applyMatrixToPoint(Me(n,!1),e,r)}},{key:"_pointToControls",value:function(t,e){var r=t.x,a=t.y;var n=(1<arguments.length&&void 0!==e?e:this.storage.transform).controlsMatrix;var o=Re(n);return this._applyMatrixToPoint(Me(o,!1),r,a)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var a=se(Te(t,[e,r,0,1]),2);return{x:a[0],y:a[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY;var a=this.options.container;var n=Oe(a);var o=function(t){var e=0;var r=0;for(;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,r+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{left:e,top:r}}(a);var i=function(){var t=document.documentElement;return{left:(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0),top:(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}}(),s=i.left,c=i.top;var v=_e(o.left-s,o.top-c);return this._applyMatrixToPoint(Re(we(n,v)),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t;var r=this.storage.transform.containerMatrix,a=this.options,n=a.restrict,o=a.container;var i=n||o;return Xe(i,o,e?Oe(i,o):r)}},{key:"_applyTransformToElement",value:function(t){var e=this.storage,r=e.controls,a=e.data,n=this.options.applyTranslate;var o=a.get(t),i=o.cached,s=o.transform.matrix;var c=rt(r);if(!Mt(i)){if(n){var v=rt(t);var l=i.dx,u=i.dy;var h=bt(s);var f=parseFloat(t.style.left||v.css("left"));var d=parseFloat(t.style.top||v.css("top"));h.left="".concat(f+l,"px"),h.top="".concat(d+u,"px"),v.css(h),c.css(h)}this.storage.cached={}}}},{key:"_processResize",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.revX,i=n.revY,s=n.doW,c=n.doH,v=n.data,l=n.bBox,u=l.width,h=l.height,f=this.options,d=f.proportions,p=f.scalable;var y=v.get(t);var m=y.transform,x=m.matrix,b=m.auxiliary.scale.translateMatrix,g=y.cached;var _=se((w=r,R=a,O=s||!s&&!c?(u+w)/u:(h+R)/h,[(S=d?u*O:u+w)/u,(V=d?h*O:h+R)/h,S,V]),4),k=_[0],E=_[1],M=_[2],T=_[3];var w,R,O,S,V;var C=(A=ke(k,E),we(we(b,A),Re(b)));var A;var N=p?we(C,x):(D=x,j=(P=C)[0][3],B=P[1][3],L=_e(j,B),z=_e(j*(o?-1:1),B*(i?-1:1)),we(we(z,D),Re(L)));var P,D,j,B,L,z;return M<=Y||T<=Y||(this._updateElementView(t,gt({},bt(be(N)),{},!p&&{width:"".concat(M,"px"),height:"".concat(T,"px")})),v.set(t,gt({},y,{cached:gt({},g,{dx:r,dy:a,bBox:{width:M,height:T}})}))),{transform:N,width:M,height:T}}},{key:"_processMove",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.data,i=n.center;var s=o.get(t);var c=s.transform,v=c.matrix,l=c.auxiliary.translate.parentMatrix,u=s.cached,h=void 0===u?{}:u;var f=se(Te(l,[r,a,0,1]),2),d=f[0],p=f[1];var y=we(v,_e(d,p));var m=bt(be(y));return this._updateElementView(t,m),o.set(t,gt({},s,{cached:gt({},h,{dist:{dx:ve(r),dy:ve(a),ox:ve(d),oy:ve(p)}})})),i.isShifted,y}},{key:"_processRotate",value:function(t,e){var r=this.storage.data,a=this.options.restrict;var n=r.get(t).transform,o=n.matrix,i=n.auxiliary.rotate.translateMatrix;var s=ve(Math.cos(e),4),c=ve(Math.sin(e),4);var v=Ee(c,s);var l=we(we(Re(i),v),i);var u=we(o,l);var h=a?this._restrictHandler(u):{x:null,y:null},f=h.x,d=h.y;return j(f)||j(d)||this._updateElementView(t,bt(be(u))),u}},{key:"_getElementState",value:function(t,e){var r=e.revX,a=e.revY,n=e.doW,o=e.doH;var i=this.storage,s=i.handles.center,c=i.wrapper,v=i.data,l=this.options,u=l.container,h=l.restrict,f=l.scalable;var d=v.get(t).parent;var p=h||u,y=p.offsetWidth,m=p.offsetHeight;var x=se(Ae(t,u),2),b=x[0],g=x[1];var _=t.offsetLeft,k=t.offsetTop,E=t.offsetWidth,M=t.offsetHeight;var T=Ve(t);var w=Oe(t,u);var R=Oe(d,u);var O=Oe(c,u);var S=h?Oe(h,h.parentNode):Oe(u,u.parentNode);var V=E/2,C=M/2;var A=se(Te(w,[V,C,0,1]),2);var N=o?0:r?-V:V,P=n?0:a?-C:C;var D=A[0]+b;var j=A[1]+g;var B=s?Ve(s):ge();var L=(s?Se(Oe(s)):{translate:{x:D,y:j}}).translate,z=L.x,Y=L.y;var H=se(Te(we(Re(Me(w)),Me(B)),[z-D,Y-j,0,1]),2),X=H[0],I=H[1];var G=se(Te(T,[X,I,0,1]),2),W=G[0],F=G[1];var q=Te(Me(S),[y,m,0,1]);var Z=Se(Oe(t,t.parentNode)).scale,Q=Z.sX,U=Z.sY;return{transform:{auxiliary:{scale:{translateMatrix:f?_e(N,P):_e(o?0:V,n?0:C)},translate:{parentMatrix:Re(Me(R))},rotate:{translateMatrix:_e(W,F)}},scaleX:N,scaleY:P,matrix:T,ctm:w,parentMatrix:R,containerMatrix:S,wrapperMatrix:O,scX:Q,scY:U,containerBox:q},bBox:{width:E,height:M,left:_,top:k,offset:{left:b,top:g}}}}},{key:"_getCommonState",value:function(){var t=this.elements,e=this.storage,r=e.controls,a=e.handles.center,n=e.center,o=this.options,i=o.container,s=o.restrict;var c=se(Ae(t[0],i),2),v=c[0],l=c[1];var u=Oe(t[0],i);var h=this._getBBox(),f=h.width,d=h.height;var p=se(Te(u,[f/2,d/2,0,1]),2);var y=p[0]+v;var m=p[1]+l;var x=a?Ve(a):ge();return{transform:{controlsMatrix:Oe(r,r.parentNode),containerMatrix:s?Oe(s,s.parentNode):Oe(i,i.parentNode)},bBox:gt({},this._getBBox()),center:gt({},n,{x:y,y:m,matrix:x})}}},{key:"_getBBox",value:function(){var t=se(this.elements,1)[0],e=this.options,r=e.isGrouped,a=e.container;if(r)return this._getGroupBbox();var n=se(Ae(t,a),2),o=n[0],i=n[1];return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}}}},{key:"_processControlsResize",value:function(){this._applyTransformToHandles({boxMatrix:ge()})}},{key:"_processControlsMove",value:function(t){var e=t.dx,r=t.dy;var a=this.storage.transform.controlsMatrix;var n=we(a,_e(e,r));var o=bt(be(n));this._updateControlsView(o)}},{key:"_processControlsRotate",value:function(){this._applyTransformToHandles({boxMatrix:ge()})}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,a=r.handles.center,n=r.center.matrix;var o=we(n,_e(t,e));rt(a).css(gt({},bt(be(o)))),this.storage.center.isShifted=!0}},{key:"_processMoveRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data.get(t).transform,o=n.matrix,i=n.auxiliary.translate.parentMatrix;var s=se(Te(i,[r,a,0,1]),2),c=s[0],v=s[1];var l=we(o,_e(c,v));return this._restrictHandler(l)}},{key:"_processRotateRestrict",value:function(t,e){var r=this.storage.data.get(t).transform,a=r.matrix,n=r.auxiliary.rotate.translateMatrix;var o=ve(Math.cos(e),4),i=ve(Math.sin(e),4);var s=Ee(i,o);var c=we(we(Re(n),s),n);var v=we(a,c);return this._restrictHandler(v)}},{key:"_processResizeRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.revX,i=n.revY,s=n.doW,c=n.doH,v=n.data,l=n.bBox,u=l.width,h=l.height,f=this.options,d=f.proportions,p=f.scalable;var y=v.get(t).transform,m=y.matrix,x=y.auxiliary.scale.translateMatrix;var b=se((k=r,E=a,M=s||!s&&!c?(u+k)/u:(h+E)/h,[(T=d?u*M:u+k)/u,(w=d?h*M:h+E)/h,T,w]),2),g=b[0],_=b[1];var k,E,M,T,w;var R=(O=ke(g,_),we(we(x,O),Re(x)));var O;var S=p?we(R,m):(C=m,A=(V=R)[0][3],N=V[1][3],P=_e(A,N),D=_e(A*(o?-1:1),N*(i?-1:1)),we(we(D,C),Re(P)));var V,C,A,N,P,D;return this._restrictHandler(S)}},{key:"_updateElementView",value:function(t,e){rt(t).css(e)}},{key:"_updateControlsView",value:function(t){rt(this.storage.controls).css(t)}},{key:"_getVertices",value:function(t){var e=0<arguments.length&&void 0!==t?t:ge();var r=this.elements;var a=se(r=void 0===r?[]:r,1)[0],n=this.options,o=n.isGrouped,i=n.rotatable,s=n.rotatorAnchor,c=n.rotatorOffset;var v=o?this._getGroupVertices():this._getElementVertices(a,e);var l=null;if(i){var u={};var h=1;switch(s){case"n":u.x=v.tc[0],u.y=v.tc[1];break;case"s":u.x=v.bc[0],u.y=v.bc[1],h=-1;break;case"w":u.x=v.ml[0],u.y=v.ml[1],h=-1;break;case"e":default:u.x=v.mr[0],u.y=v.mr[1]}var f="n"===s||"s"===s?Math.atan2(v.bl[1]-v.tl[1],v.bl[0]-v.tl[0]):Math.atan2(v.tl[1]-v.tr[1],v.tl[0]-v.tr[0]);l=[u.x-c*h*Math.cos(f),u.y-c*h*Math.sin(f)],v.rotator=l,v.anchor=u}return v}},{key:"_getElementVertices",value:function(t,e){var r=this.options,a=r.container,n=r.isGrouped;var o=se(Ae(t,a),2),v=o[0],l=o[1];var i=t.offsetWidth,s=t.offsetHeight;var c={tl:[0,0,0,1],bl:[0,s,0,1],br:[i,s,0,1],tr:[i,0,0,1],tc:[i/2,0,0,1],ml:[0,s/2,0,1],bc:[i/2,s,0,1],mr:[i,s/2,0,1],center:[i/2,s/2,0,1]};var u=n?e:we(Oe(t,a),e);return je(c).reduce(function(t,e){var r=se(e,2),a=r[0],n=r[1];return[].concat(Yt(t),[[a,Te(u,n)]])},[]).reduce(function(t,e){var r=se(e,2),a=r[0],n=se(r[1],4),o=n[0],i=n[1],s=n[2],c=n[3];return t[a]=[o+v,i+l,s,c],t},{})}},{key:"_getGroupVertices",value:function(){var t=this._getGroupBbox(),e=t.x,r=t.y,a=t.width,n=t.height;var o=a/2,i=n/2;return{tl:[e,r],tr:[e+a,r],mr:[e+a,r+i],ml:[e,r+i],tc:[e+o,r],bc:[e+o,r+n],br:[e+a,r+n],bl:[e,r+n],center:[e+o,r+i]}}},{key:"_getGroupBbox",value:function(){var t=this.elements,l=this.options.container;var e=t.reduce(function(t,e){var r=se(Ae(e,l),2),i=r[0],s=r[1];var a=e.offsetWidth,n=e.offsetHeight;var o=[[0,0,0,1],[0,n,0,1],[a,n,0,1],[a,0,0,1]];var c=Oe(e,l);var v=o.reduce(function(t,e){return[].concat(Yt(t),[Te(c,e)])},[]).map(function(t){var e=se(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+i,a+s,n,o]});return[].concat(Yt(t),[v])},[]);var r=se(mt(e.reduce(function(t,e){return[].concat(Yt(t),Yt(e))},[])),2),a=se(r[0],2),n=a[0],o=a[1],i=se(r[1],2),s=i[0];return{x:n,y:s,width:o-n,height:i[1]-s}}},{key:"_getElementBBox",value:function(t){var e=this.options.container;var r=se(Ae(t,e),2),i=r[0],s=r[1];var a=t.offsetWidth,n=t.offsetHeight;var o=[[0,0,0,1],[0,n,0,1],[a,n,0,1],[a,0,0,1]];var c=Oe(t,e);var v=o.reduce(function(t,e){return[].concat(Yt(t),[Te(c,e)])},[]).map(function(t){var e=se(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+i,a+s,n,o]});var l=se(mt(v),2),u=se(l[0],2),h=u[0],f=u[1],d=se(l[1],2),p=d[0];return{x:h,y:p,width:f-h,height:d[1]-p}}},{key:"_applyTransformToHandles",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).boxMatrix,r=void 0===e?ge():e;var a=this.options,n=a.rotatable,o=a.resizable,i=a.showNormal,s=this.storage,v=s.handles,c=s.center;var l=(c=void 0===c?{}:c).isShifted,u=void 0!==l&&l,h=s.transform.controlsMatrix;var f=we(r,Re(h));var d=this._getVertices(f),p=d.anchor,y=void 0===p?null:p,m=d.center,x=R(d,["anchor","center"]);var b=null;var g={};n&&(b=i?[[y.x,y.y],x.rotator]:null,g={rotator:x.rotator});var _=gt({te:[x.tl,x.tr],be:[x.bl,x.br],le:[x.tl,x.bl],re:[x.tr,x.br]},i&&b&&{normal:b});De(_).forEach(function(t){var e=se(_[t],2),r=e[0],a=e[1];var n=He(r,a),o=n.cx,i=n.cy,s=n.length,c=n.theta;rt(v[t]).css({transform:"translate(".concat(o,"px, ").concat(i,"px) rotate(").concat(c,"deg)"),width:"".concat(s,"px")})});var k=gt({},o&&x,{},g,{},!u&&Boolean(m)&&{center:m});De(k).forEach(function(t){var e=v[t];var r=k[t];if(!Mt(r)&&!Mt(e)){var a=se(r,2),n=a[0],o=a[1];rt(e).css({transform:"translate(".concat(n,"px, ").concat(o,"px)")})}})}},{key:"resetCenterPoint",value:function(){var t=this.elements;var e=se(t=void 0===t?[]:t,1)[0],r=this.storage,a=r.wrapper,n=r.handles.center,o=this.options.container;if(n){var i=e.offsetHeight,s=e.offsetWidth;var c=se(Ae(e,o),2),v=c[0],l=c[1];var u=we(Oe(e,o),Re(Oe(a,a.parentNode)));var h=se(Te(u,[s/2,i/2,0,1]),2),f=h[0],d=h[1];rt(n).css({transform:"translate(".concat(f+v,"px, ").concat(d+l,"px)")})}}},{key:"fitControlsToSize",value:function(){var t=ge();this.storage=gt({},this.storage,{transform:gt({},this.storage.transform||{},{controlsMatrix:t})}),this._updateControlsView(bt(be(t))),this._applyTransformToHandles()}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;var r=this.elements;var a=se(r=void 0===r?[]:r,1)[0],n=this.options,o=n.scalable,i=n.restrict,s=n.container,c=this.storage,v=c.bBox,l=c.bBox;var u=(l=void 0===l?{}:l).width,h=l.height,f=c.cached;var d=(f=void 0===f?{}:f).bBox;var p=(d=void 0===d?{}:d).width,y=void 0===p?u:p,m=d.height;var x=o?v:gt({},v,{width:y,height:void 0===m?h:m});var b=i||s;return Xe(a,b,Oe(a,b,e),x)}},{key:"applyAlignment",value:function(t){var e=this.elements,r=this.options.container;var a=this._getVertices(),n=(a.anchor,a.rotator,a.center,R(a,["anchor","rotator","center"]));var o=this._getRestrictedBBox(!0);var i=Be(n);var s=se(mt(o),2),c=se(s[0],2),v=c[0],l=c[1],u=se(s[1],2),h=u[0],f=u[1];var d=se(mt(i),2),p=se(d[0],2),y=p[0],m=p[1],x=se(d[1],2),b=x[0],g=x[1];var _=se(Te(Re(Me(Oe(e[0].parentNode,r))),[function(){switch(!0){case/[l]/.test(t):return v-y;case/[r]/.test(t):return l-m;case/[h]/.test(t):return(l+v)/2-(m+y)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(t):return h-b;case/[b]/.test(t):return f-g;case/[v]/.test(t):return(f+h)/2-(g+b)/2;default:return 0}}(),0,1]),2),k=_[0],E=_[1];var M=we(Ve(e[0]),_e(k,E));this._updateElementView(e[0],bt(be(M))),this.fitControlsToSize()}}]),e}();var ze=function(t,e,r){var a=se(t,2),n=a[0],o=a[1];var i=2<arguments.length&&void 0!==r?r:{};var s=Ie(["sjx-hdl","sjx-hdl-".concat(1<arguments.length&&void 0!==e?e:"handler")]);return rt(s).css(gt({transform:"translate(".concat(n,"px, ").concat(o,"px)")},i)),s};var Ye=function(t,e){var r=se(t,3),a=r[0],n=r[1],o=r[2],i=void 0===o?1:o;var s=He(a,n,i),c=s.cx,v=s.cy,l=s.length,u=s.theta;var h=Ie(["sjx-hdl-line","sjx-hdl-".concat(e)]);return rt(h).css({transform:"translate(".concat(c,"px, ").concat(v,"px) rotate(").concat(u,"deg)"),height:"".concat(i,"px"),width:"".concat(l,"px")}),h};var He=function(t,e,r){var a=2<arguments.length&&void 0!==r?r:1;var n=se(t,2),o=n[0],i=n[1];var s=se(e,2),c=s[0],v=s[1];var l=Math.sqrt((c-o)*(c-o)+(v-i)*(v-i));return{cx:(o+c)/2-l/2,cy:(i+v)/2-a/2,thickness:a,theta:Math.atan2(i-v,o-c)*(180/Math.PI),length:l}};var Xe=function(t,e,r,a){var n=se(Ae(t,e),2),o=n[0],i=n[1];var s=a||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},c=s.width,v=s.height,l=s.offset;var u=(l=void 0===l?{}:l).left,h=l.top;return[[0,0,0,1],[c,0,0,1],[0,v,0,1],[c,v,0,1]].reduce(function(t,e){return[].concat(Yt(t),[Te(r,e)])},[]).map(function(t){var e=se(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+u,a+h,n,o]})};var Ie=function(t){var e=0<arguments.length&&void 0!==t?t:[];var r=document.createElement("div");return e.forEach(function(t){return wt(r,t)}),r};var Ge=/\s*,\s*|\s+/g;var We=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Fe(t,e){var r=1<arguments.length&&void 0!==e?e:[];var a=document.createElementNS("http://www.w3.org/2000/svg",t);return r.forEach(function(t){return wt(a,t)}),a}function qe(t){var r=[];return rr(t)?u.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==We.indexOf(e)&&("g"===e&&r.push.apply(r,Yt(qe(t))),r.push(t))}}):r.push(t),r}function Ze(){return Fe("svg").createSVGMatrix()}function Qe(t,e){var r=Ze();return r.e=t,r.f=e,r}function Ue(t,e){var r=Ze();return r.a=e,r.b=t,r.c=-t,r.d=e,r}function $e(t,e){var r=Ze();return r.a=t,r.d=e,r}function Je(t,e){return(e.getScreenCTM&&e.getScreenCTM()||Ze()).inverse().multiply(t.getScreenCTM()||Ze())}function Ke(t){var e=t.a,r=t.b,a=t.c,n=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(a,",").concat(n,",").concat(o,",").concat(i,")")}function tr(t,e,r){return function(t,e){var r=Fe("svg").createSVGPoint();return r.x=t,r.y=e,r}(e,r).matrixTransform(t)}function er(t){var e=Ze();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}var rr=function(t){return"g"===t.tagName.toLowerCase()};function ar(t){return(0<arguments.length&&void 0!==t?t:"").replace(/[\n\r]/g,"").replace(/([^e])-/g,"$1 -").replace(/ +/g," ").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ")}function nr(t){return ar(t).trim().split(Ge).reduce(function(t,e,r,a){return r%2==0&&t.push(a.slice(r,r+2)),t},[])}var or=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi;function ir(t){var c=or.lastIndex=0;var v=[];function e(){var t=se(c,3),r=t[1],e=t[2];var a=r.toUpperCase();var n=r!==a;var o=ar(e).trim().split(Ge).map(function(t){if(!isNaN(t))return Number(t)});var i=!1;var s="M"===a;(function(r,a){return Array.from(new Array(Math.ceil(r.length/a)),function(t,e){return r.slice(e*a,e*a+a)})})(o,function(t){return[{size:2,condition:["M","m","L","l","T","t"].includes(t)},{size:1,condition:["H","h","V","v"].includes(t)},{size:6,condition:["C","c"].includes(t)},{size:4,condition:["S","s","Q","q"].includes(t)},{size:7,condition:["A","a"].includes(t)},{size:1,condition:!0}].find(function(t){return!!t.condition})}(r).size).map(function(t){var e=i&&s;return i=i||s,v.push({relative:n,key:e?"L":a,cmd:e?n?"l":"L":r,values:t})})}for(;c=or.exec(t);)e();return cr(sr(v))}var sr=function(t){var jt=null,Bt=null,Lt=null,zt=null;return t.reduce(function(t,e){var r=e.cmd,a=e.values;var n;switch(r){case"M":var o=se(a,2),i=o[0],s=o[1];n={key:"M",values:[i,s]},jt=Lt=i,Bt=zt=s;break;case"m":var c=se(a,2),v=c[0],l=c[1];var u=jt+v;var h=Bt+l;n={key:"M",values:[u,h]},jt=Lt=u,Bt=zt=h;break;case"L":var f=se(a,2),d=f[0],p=f[1];n={key:"L",values:[d,p]},jt=d,Bt=p;break;case"l":var y=se(a,2),m=y[0],x=y[1];var b=jt+m;var g=Bt+x;n={key:"L",values:[b,g]},jt=b,Bt=g;break;case"C":var _=se(a,6),k=_[0],E=_[1],M=_[2],T=_[3],w=_[4],R=_[5];n={key:"C",values:[k,E,M,T,w,R]},jt=w,Bt=R;break;case"c":var O=se(a,6),S=O[0],V=O[1],C=O[2],A=O[3],N=O[4],P=O[5];var D=[jt+S,Bt+V,jt+C,Bt+A,jt+N,Bt+P];n={key:"C",values:[].concat(D)},jt=D[4],Bt=D[5];break;case"Q":var j=se(a,4),B=j[0],L=j[1],z=j[2],Y=j[3];n={key:"Q",values:[B,L,z,Y]},jt=z,Bt=Y;break;case"q":var H=se(a,4),X=H[0],I=H[1],G=H[2],W=H[3];var F=[jt+X,Bt+I,jt+G,Bt+W];t.push({key:"Q",values:[].concat(F)}),jt=F[2],Bt=F[3];break;case"A":var q=se(a,7),Z=q[0],Q=q[1],U=q[2],$=q[3],J=q[4],K=q[5],tt=q[6];n={key:"A",values:[Z,Q,U,$,J,K,tt]},jt=K,Bt=tt;break;case"a":var et=se(a,7),rt=et[0],at=et[1],nt=et[2],ot=et[3],it=et[4],st=et[5],ct=et[6];var vt=jt+st;var lt=Bt+ct;n={key:"A",values:[rt,at,nt,ot,it,vt,lt]},jt=vt,Bt=lt;break;case"H":var ut=se(a,1)[0];n={key:"H",values:[ut]},jt=ut;break;case"h":var ht=se(a,1)[0];var ft=jt+ht;n={key:"H",values:[ft]},jt=ft;break;case"V":var dt=se(a,1)[0];n={key:"V",values:[dt]},Bt=dt;break;case"v":var pt=se(a,1)[0];var yt=Bt+pt;n={key:"V",values:[yt]},Bt=yt;break;case"S":var mt=se(a,4),xt=mt[0],bt=mt[1],gt=mt[2],_t=mt[3];n={key:"S",values:[xt,bt,gt,_t]},jt=gt,Bt=_t;break;case"s":var kt=se(a,4),Et=kt[0],Mt=kt[1],Tt=kt[2],wt=kt[3];var Rt=[jt+Et,Bt+Mt,jt+Tt,Bt+wt];n={key:"S",values:[].concat(Rt)},jt=Rt[2],Bt=Rt[3];break;case"T":var Ot=se(a,2),St=Ot[0],Vt=Ot[1];n={key:"T",values:[St,Vt]},jt=St,Bt=Vt;break;case"t":var Ct=se(a,2),At=Ct[0],Nt=Ct[1];var Pt=jt+At;var Dt=Bt+Nt;n={key:"T",values:[Pt,Dt]},jt=Pt,Bt=Dt;break;case"Z":case"z":n={key:"Z",values:[]},jt=Lt,Bt=zt}return[].concat(Yt(t),[n])},[])};var cr=function(t){var W=null;var F=null;var q=null;var Z=null;var Q=null;var U=null;var $=null;return t.reduce(function(t,e){var r=e.key,a=e.values;var n;switch(r){case"M":var o=se(a,2),i=o[0],s=o[1];n=[{key:"M",values:[i,s]}],Z=U=i,Q=$=s;break;case"C":var c=se(a,6),v=c[0],l=c[1],u=c[2],h=c[3],f=c[4],d=c[5];n=[{key:"C",values:[v,l,u,h,f,d]}],F=u,q=h,Z=f,Q=d;break;case"L":var p=se(a,2),y=p[0],m=p[1];n=[{key:"L",values:[y,m]}],Z=y,Q=m;break;case"H":var x=se(a,1)[0];n=[{key:"L",values:[x,Q]}],Z=x;break;case"V":var b=se(a,1)[0];n=[{key:"L",values:[Z,b]}],Q=b;break;case"S":var g=se(a,4),_=g[0],k=g[1],E=g[2],M=g[3];var T,w;w="C"===W||"S"===W?(T=Z+(Z-F),Q+(Q-q)):(T=Z,Q),n=[{key:"C",values:[T,w,_,k,E,M]}],F=_,q=k,Z=E,Q=M;break;case"T":var R=se(a,2),O=R[0],S=R[1];var V,C;C="Q"===W||"T"===W?(V=Z+(Z-F),Q+(Q-q)):(V=Z,Q),n=[{key:"C",values:[Z+2*(V-Z)/3,Q+2*(C-Q)/3,O+2*(V-O)/3,S+2*(C-S)/3,O,S]}],F=V,q=C,Z=O,Q=S;break;case"Q":var A=se(a,4),N=A[0],P=A[1],D=A[2],j=A[3];n=[{key:"C",values:[Z+2*(N-Z)/3,Q+2*(P-Q)/3,D+2*(N-D)/3,j+2*(P-j)/3,D,j]}],F=N,q=P,Z=D,Q=j;break;case"A":var B=se(a,7),L=B[0],z=B[1],Y=B[2],H=B[3],X=B[4],I=B[5],G=B[6];if(0===L||0===z)n=[{key:"C",values:[Z,Q,I,G,I,G]}],Z=I,Q=G;else if(Z!==I||Q!==G)n=vr(Z,Q,I,G,L,z,Y,H,X).map(function(t){return{key:"C",values:t}}),Z=I,Q=G;break;case"Z":n=[e],Z=U,Q=$}return W=r,[].concat(Yt(t),Yt(n))},[])};var vr=function t(e,r,a,n,o,i,s,c,v,l){function u(t,e,r){return{x:t*Math.cos(r)-e*Math.sin(r),y:t*Math.sin(r)+e*Math.cos(r)}}var h=(f=s,Math.PI*f/180);var f;var d=[];var p,y,m,x;if(l)p=l[0],y=l[1],m=l[2],x=l[3];else{var b=u(e,r,-h);e=b.x,r=b.y;var g=u(a,n,-h);var _=(e-(a=g.x))/2;var k=(r-(n=g.y))/2;var E=_*_/(o*o)+k*k/(i*i);1<E&&(o*=E=Math.sqrt(E),i*=E);var M=o*o;var T=i*i;var w=M*T-M*k*k-T*_*_;var R=M*k*k+T*_*_;var O=(c===v?-1:1)*Math.sqrt(Math.abs(w/R));m=O*o*k/i+(e+a)/2,x=O*-i*_/o+(r+n)/2,p=Math.asin(parseFloat(((r-x)/i).toFixed(9))),y=Math.asin(parseFloat(((n-x)/i).toFixed(9))),e<m&&(p=Math.PI-p),a<m&&(y=Math.PI-y),p<0&&(p=2*Math.PI+p),y<0&&(y=2*Math.PI+y),v&&y<p&&(p-=2*Math.PI),!v&&p<y&&(y-=2*Math.PI)}var S=y-p;if(Math.abs(S)>120*Math.PI/180){var V=y;var C=a;var A=n;var N=v&&p<y?1:-1;y=p+120*Math.PI/180*N,a=m+o*Math.cos(y),n=x+i*Math.sin(y),d=t(a,n,C,A,o,i,s,0,v,[y,V,m,x])}S=y-p;var P=Math.cos(p);var D=Math.sin(p);var j=Math.cos(y);var B=Math.sin(y);var L=Math.tan(S/4);var z=4/3*o*L;var Y=4/3*i*L;var H=[e,r];var X=[e+z*D,r-Y*P];var I=[a+z*B,n-Y*j];var G=[a,n];if(X[0]=2*H[0]-X[0],X[1]=2*H[1]-X[1],l)return[X,I,G].concat(Yt(d));d=[X,I,G].concat(Yt(d)).join().split(",");var W=[];var F=[];return d.forEach(function(t,e){e%2?F.push(u(d[e-1],d[e],h).y):F.push(u(d[e],d[e+1],h).x),6===F.length&&(W.push(F),F=[])}),W};var lr=H.E_DRAG,ur=H.E_RESIZE,hr=H.E_ROTATE;var fr=X,dr=W;var pr=Object.keys,yr=Object.entries,mr=Object.values;var xr=function(){o(e,me);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this;var r=this.options,a=r.rotationPoint,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,c=r.showNormal;var v=Fe("g",["sjx-svg-wrapper"]);var l=Fe("g",["sjx-svg-controls"]);var u=this._getVertices(),h=u.rotator,f=void 0===h?null:h,d=u.anchor,p=void 0===d?null:d,y=R(u,["rotator","anchor"]);var m={};var x={};var b=Array.isArray(a)?tr(Ze(),a[0],a[1]):y.center;if(s){var g=c?Mr([p,f],w,"normal"):null;c&&l.appendChild(g);var _=null;a&&((_=Fe("line",["sjx-hidden"])).x1.baseVal.value=y.center.x,_.y1.baseVal.value=y.center.y,_.x2.baseVal.value=b.x,_.y2.baseVal.value=b.y,kr(_,"#fe3232"),_.setAttribute("opacity",.5),l.appendChild(_)),x=gt({},x,{normal:g,radius:_})}var k=i?{tl:y.tl,tr:y.tr,br:y.br,bl:y.bl,tc:y.tc,bc:y.bc,ml:y.ml,mr:y.mr}:{};var E={te:[y.tl,y.tr],be:[y.bl,y.br],le:[y.tl,y.bl],re:[y.tr,y.br]};pr(E).forEach(function(t){var e=E[t];Mt(e)||(m[t]=Mr(e,w,t),l.appendChild(m[t]))});var M=gt({},k,{rotator:f,center:a&&s?b:void 0});pr(M).forEach(function(t){var e=M[t];if(!Mt(e)){var r=e.x,a=e.y;var n="center"===t?"#fe3232":w;m[t]=_r(r,a,n,t),l.appendChild(m[t])}}),v.appendChild(l),o.appendChild(v);var T=new WeakMap;t.map(function(t){return T.set(t,{parent:t.parentNode,transform:{ctm:Je(t,n)},bBox:t.getBBox(),__data__:new WeakMap,cached:{}})}),this.storage={wrapper:v,controls:l,handles:gt({},m,{},x),data:T,center:{isShifted:Boolean(a)}},[].concat(Yt(t),[l]).map(function(t){return rt(t).on(fr,e._onMouseDown).on(dr,e._onTouchStart)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY;var a=this.options.container;return this._applyMatrixToPoint(a.getScreenCTM().inverse(),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t;var r=this.storage;var a=(r=void 0===r?{}:r).transform;var n=(a=void 0===a?{}:a).containerMatrix,o=this.options;var i=(o=void 0===o?{}:o).container;var s=o.restrict||i;return Tr(s,e?Je(s,i):n)}},{key:"_pointToTransform",value:function(t){var e=t.x,r=t.y;var a=t.matrix.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,e,r)}},{key:"_pointToControls",value:function(t,e){var r=t.x,a=t.y;var n=(1<arguments.length&&void 0!==e?e:this.storage.transform).controlsMatrix.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,r,a)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var a=Fe("svg").createSVGPoint();return a.x=e,a.y=r,a.matrixTransform(t)}},{key:"_applyTransformToElement",value:function(a,t){var e=this.storage;var r=(e=void 0===e?{}:e).data,n=e.bBox,o=this.options;var i=(o=void 0===o?{}:o).isGrouped,s=o.scalable,c=o.applyTranslate;var v=r.get(a),l=v.cached,u=void 0===l?{}:l,h=R(v,["cached"]);var f=h.transform,d=f.matrix,p=f.parentMatrix,y=h.__data__;var m=u.scaleX,x=u.scaleY,b=u.dist;var g=(b=void 0===b?{}:b).dx,_=b.dy,k=b.ox,E=b.oy,M=u.transformMatrix;if(t===lr){if(!c||!g&&!_)return;var T=Qe(k,E);var w=T.multiply(d).multiply(T.inverse());this._updateElementView(["transform",w]),rr(a)?qe(a).map(function(t){var e=Qe(g,_);var r=e.multiply(Je(t,t.parentNode)).multiply(e.inverse());if(function(t){var e=t.a,r=t.b,a=t.c,n=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===a&&1===n&&0===o&&0===i}(r)||t.setAttribute("transform",Ke(r)),!rr(t)){var a=p.inverse();a.e=a.f=0;var n=tr(a,k,E),o=n.x,i=n.y;br(t,{x:o,y:i})}}):br(a,{x:k,y:E})}if(t===ur){if(!M)return;if(!s)if(rr(a)||i)qe(a).forEach(function(t){if(!rr(t)){var e=Je(t,i?a.parentNode:a);var r=e.inverse().multiply(M).multiply(e);gr(t,{dx:g,dy:_,scaleX:m,scaleY:x,localCTM:r,transformMatrix:M,bBox:n,__data__:y,isGrouped:i})}});else gr(a,{dx:g,dy:_,scaleX:m,scaleY:x,localCTM:M,transformMatrix:M,bBox:n,__data__:y,isGrouped:i})}i&&t===hr&&(this._applyTransformToHandles(),this._updateControlsView()),r.set(a,gt({},h))}},{key:"_processResize",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.revX,i=n.revY,s=n.doW,c=n.doH,v=n.data,l=n.bBox,u=l.x,h=l.y,f=l.width,d=l.height,p=this.options,y=p.isGrouped,m=p.proportions,x=p.scalable;var b=v.get(t);var g=b.transform,_=g.matrix,k=g.auxiliary.scale.translateMatrix,E=b.cached,M=void 0===E?{}:E;var T=se((V=r,C=a,A=s||!s&&!c?(f+V)/f:(d+C)/d,[(N=m?f*A:f+V)/f,(P=m?d*A:d+C)/d,N,P]),4),w=T[0],R=T[1],O=T[2],S=T[3];var V,C,A,N,P;var D=(j=$e(w,R),k.multiply(j).multiply(k.inverse()));var j;var B=u-(O-f)*(c?.5:o?1:0),L=h-(S-d)*(s?.5:i?1:0);var z=y?D.multiply(_):_.multiply(D);return x&&this._updateElementView(t,["transform",z]),v.set(t,gt({},b,{cached:gt({},M,{scaleX:w,scaleY:R,transformMatrix:D,resultMatrix:z})})),this._applyTransformToElement(t,ur),{x:B,y:L,width:O,height:S,transform:z}}},{key:"_processMove",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data;var o=n.get(t);var i=o.transform,s=i.matrix,c=i.auxiliary.translate,v=c.translateMatrix,l=c.parentMatrix,u=o.cached;l.e=l.f=0;var h=tr(l,r,a),f=h.x,d=h.y;n.set(t,gt({},o,{cached:gt({},u,{dist:{dx:ve(r),dy:ve(a),ox:ve(f),oy:ve(d)}})})),v.e=f,v.f=d;var p=v.multiply(s);return this._updateElementView(t,["transform",p]),p}},{key:"_processRotate",value:function(t,e){var r=this.storage;var a=(r=void 0===r?{}:r).data.get(t).transform,n=a.matrix,o=a.parentMatrix,i=a.auxiliary.rotate.translateMatrix;var s=ve(Math.cos(e)),c=ve(Math.sin(e));var v=Ue(c,s);o.e=o.f=0;var l=o.inverse().multiply(v).multiply(o);var u=i.multiply(l).multiply(i.inverse()).multiply(n);return this._updateElementView(t,["transform",u]),u}},{key:"_getElementState",value:function(e,t){var r=t.revX,a=t.revY,n=t.doW,o=t.doH;var i=this.options,s=i.container,c=i.isGrouped,v=this.storage,l=v.data,u=v.controls,h=v.handles.center;var f=l.get(e);var d=f.__data__;Er(e,f,s),d["delete"](e),qe(e).forEach(function(t){d["delete"](t),Er(t,f,e,c)});var p=this._getBBox();var y=p.x,m=p.y,x=p.width,b=p.height;var g=Je(e,e.parentNode),_=Je(e,s),k=Je(e.parentNode,s);var E=k.inverse();var M=y+x*(o?.5:r?1:0),T=m+b*(n?.5:a?1:0);var w=Je(u,s);var R=y+x/2,O=m+b/2;var S=h?h.cx.baseVal.value:R;var V=h?h.cy.baseVal.value:O;var C=tr(w,S,V),A=C.x,N=C.y;var P=h?tr(E,A,N):tr(c?E:g,R,O),D=P.x,j=P.y;var B=tr(c?E:Ze(),M,T),L=B.x,z=B.y;return{transform:{auxiliary:{scale:{scaleMatrix:Ze(),translateMatrix:Qe(L,z)},translate:{parentMatrix:E,translateMatrix:Ze()},rotate:{translateMatrix:Qe(D,j)}},matrix:g,ctm:_,parentMatrix:k,scX:Math.sqrt(_.a*_.a+_.b*_.b),scY:Math.sqrt(_.c*_.c+_.d*_.d)},bBox:p}}},{key:"_getCommonState",value:function(){var t=this.elements,e=this.options,r=e.isGrouped,a=e.container,n=e.restrict,o=this.storage,i=o.controls,s=o.handles.center;var c=this._getBBox();var v=c.x,l=c.y;var u=v+c.width/2,h=l+c.height/2;var f=Je(i,a);var d=s?s.cx.baseVal.value:u;var p=s?s.cy.baseVal.value:h;var y=tr(f,d,p),m=y.x,x=y.y;var b=tr(r?Ze():Je(t[0],a),u,h),g=b.x,_=b.y;var k=n?Je(n,n.parentNode):Je(a,a.parentNode);var E=gt({},this.storage.center||{},{x:s?m:g,y:s?x:_,hx:s?s.cx.baseVal.value:null,hy:s?s.cy.baseVal.value:null});return{transform:{containerMatrix:k,controlsMatrix:Je(i,i.parentNode),controlsTranslateMatrix:Ze(),wrapperOriginMatrix:Qe(E.x,E.y)},bBox:c,center:E}}},{key:"_getVertices",value:function(t){var e=0<arguments.length&&void 0!==t?t:Ze();var r=this.elements,a=this.options,n=a.isGrouped,o=a.rotatable,i=a.rotatorAnchor,s=a.rotatorOffset,c=a.container;var v=this._getBBox(),l=v.x,u=v.y,h=v.width,f=v.height;var d=h/2,p=f/2;var y={tl:[l,u],tr:[l+h,u],mr:[l+h,u+p],ml:[l,u+p],tc:[l+d,u],bc:[l+d,u+f],br:[l+h,u+f],bl:[l,u+f],center:[l+d,u+p]};var m=n?e:e.multiply(Je(r[0],c));var x=yr(y).reduce(function(t,e){var r=se(e,2),a=r[0],n=se(r[1],2),o=n[0],i=n[1];return t[a]=tr(m,o,i),t},{});if(o){var b={};var g=1;switch(i){case"n":var _=x.tc,k=_.x,E=_.y;b.x=k,b.y=E;break;case"s":var M=x.bc,T=M.x,w=M.y;b.x=T,b.y=w,g=-1;break;case"w":var R=x.ml,O=R.x,S=R.y;b.x=O,b.y=S,g=-1;break;case"e":default:var V=x.mr,C=V.x,A=V.y;b.x=C,b.y=A}var N="n"===i||"s"===i?Math.atan2(x.bl.y-x.tl.y,x.bl.x-x.tl.x):Math.atan2(x.tl.y-x.tr.y,x.tl.x-x.tr.x);var P=s*g;var D={x:b.x-P*Math.cos(N),y:b.y-P*Math.sin(N)};x.rotator=D,x.anchor=b}return x}},{key:"_getBBox",value:function(){var t=this.elements,e=this.options,a=e.container;if(e.isGrouped){var r=t.reduce(function(t,e){var r=Je(e,a);return[].concat(Yt(t),Yt(Tr(e,r)))},[]);var n=se(mt(r),2),o=se(n[0],2),i=o[0],s=o[1],c=se(n[1],2),v=c[0];return{x:i,y:v,width:s-i,height:c[1]-v}}return t[0].getBBox()}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,a=r.handles,n=a.center,o=a.radius,i=r.center,s=r.center,c=s.hx,v=s.hy,l=r.transform;var u=(l=void 0===l?{}:l).controlsMatrix,h=void 0===u?Ze():u;if(!Mt(n)){var f=c+t,d=v+e;n.cx.baseVal.value=f,n.cy.baseVal.value=d,o.x2.baseVal.value=f,o.y2.baseVal.value=d,this.storage.center=gt({},i,{isShifted:!0,cached:gt({},tr(h.inverse(),f,d))})}}},{key:"_processMoveRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data.get(t).transform,o=n.matrix,i=n.auxiliary.translate.parentMatrix;i.e=i.f=0;var s=tr(i,r,a),c=s.x,v=s.y;var l=Qe(c,v).multiply(o);return this._restrictHandler(t,l)}},{key:"_processRotateRestrict",value:function(t,e){var r=this.storage;var a=(r=void 0===r?{}:r).data.get(t).transform,n=a.matrix,o=a.parentMatrix,i=a.auxiliary.rotate.translateMatrix;var s=ve(Math.cos(e)),c=ve(Math.sin(e));var v=Ue(c,s);o.e=o.f=0;var l=o.inverse().multiply(v).multiply(o);var u=i.multiply(l).multiply(i.inverse()).multiply(n);return this._restrictHandler(t,u)}},{key:"_processResizeRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.doW,i=n.doH,s=n.data,c=n.bBox,v=c.width,l=c.height,u=this.options.proportions;var h=s.get(t).transform,f=h.matrix,d=h.auxiliary.scale.translateMatrix;var p=f.multiply(function(t,e){var r=$e(t,e);return d.multiply(r).multiply(d.inverse())}.apply(void 0,Yt((y=r,m=a,x=o||!o&&!i?(v+y)/v:(l+m)/l,[(b=u?v*x:v+y)/v,(g=u?l*x:l+m)/l,b,g]))));var y,m,x,b,g;return this._restrictHandler(t,p)}},{key:"_processControlsResize",value:function(){var t=this.storage;var e=(t=void 0===t?{}:t).transform.controlsMatrix;this._applyTransformToHandles({boxMatrix:e.inverse()})}},{key:"_processControlsMove",value:function(t){var e=t.dx,r=t.dy;var a=this.storage;var n=(a=void 0===a?{}:a).transform,o=n.controlsMatrix,i=n.controlsTranslateMatrix,s=a.center;i.e=e,i.f=r;var c=i.multiply(o);if(this._updateControlsView(c),s.isShifted){var v=o.inverse();v.e=v.f=0;var l=tr(v,e,r),u=l.x,h=l.y;this._moveCenterHandle(-u,-h)}}},{key:"_processControlsRotate",value:function(t){var e=t.radians;var r=this.storage;var a=(r=void 0===r?{}:r).transform,n=a.controlsMatrix,o=a.wrapperOriginMatrix;var i=ve(Math.cos(e)),s=ve(Math.sin(e));var c=Ue(s,i);var v=o.multiply(c).multiply(o.inverse()).multiply(n);this._updateControlsView(v)}},{key:"_updateElementView",value:function(t,e){var r=se(e,2),a=r[0],n=r[1];"transform"===a&&t.setAttribute(a,Ke(n))}},{key:"_updateControlsView",value:function(t){var e=0<arguments.length&&void 0!==t?t:Ze();this.storage.controls.setAttribute("transform",Ke(e))}},{key:"_applyTransformToHandles",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).boxMatrix,r=void 0===e?Ze():e;var a=this.options.rotatable,n=this.storage,o=n.handles,i=n.center.isShifted;var s=this._getVertices(r),c=s.anchor,v=void 0===c?null:c,l=s.center,u=R(s,["anchor","center"]);var h={te:[u.tl,u.tr],be:[u.bl,u.br],le:[u.tl,u.bl],re:[u.tr,u.br]};if(a){var f=o.normal,d=o.radius;j(f)&&(f.x1.baseVal.value=v.x,f.y1.baseVal.value=v.y,f.x2.baseVal.value=u.rotator.x,f.y2.baseVal.value=u.rotator.y),j(d)&&(d.x1.baseVal.value=l.x,d.y1.baseVal.value=l.y,i||(d.x2.baseVal.value=l.x,d.y2.baseVal.value=l.y))}pr(h).forEach(function(t){var n=o[t];var e=se(h[t],2),r=e[0],a=e[1];Mt(r)||Mt(n)||yr({x1:r.x,y1:r.y,x2:a.x,y2:a.y}).map(function(t){var e=se(t,2),r=e[0],a=e[1];return n.setAttribute(r,a)})});var p=gt({},u,{},!i&&Boolean(l)&&{center:l});pr(p).forEach(function(t){var e=o[t];var r=p[t];Mt(r)||Mt(e)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))})}},{key:"resetCenterPoint",value:function(){var t=this.elements,e=this.storage;var r=(e=void 0===e?{}:e).controls,a=e.handles;var n=(a=void 0===a?{}:a).center,o=a.radius,i=e.center,s=this.options,c=s.container,v=s.isGrouped;if(i&&n&&o){var l=this._getBBox(),u=l.x,h=l.y;var f=l.width/2,d=l.height/2;var p=Je(r,r.parentNode).inverse();var y=v?p:p.multiply(Je(t[0],c));var m=tr(y,u+f,h+d),x=m.x,b=m.y;n.cx.baseVal.value=x,n.cy.baseVal.value=b,o.x2.baseVal.value=x,o.y2.baseVal.value=b,i.isShifted=!1}}},{key:"fitControlsToSize",value:function(){var t=this.storage,e=void 0===t?{}:t;var r=Ze();this.storage=gt({},e,{transform:gt({},e.transform||{},{controlsMatrix:r})}),this._updateControlsView(r),this._applyTransformToHandles({boxMatrix:r})}},{key:"getBoundingRect",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:null;var a=this.options;var n=(a=void 0===a?{}:a).restrict,o=a.container;var i=n||o;var s=r?Je(t.parentNode,i).multiply(r):Je(t,i);return Tr(t,s,t.getBBox())}},{key:"applyAlignment",value:function(i){var s=this;var t=this.elements,c=this.options.container;var e=this._getVertices(),r=(e.anchor,e.rotator,e.center,R(e,["anchor","rotator","center"]));var a=this._getRestrictedBBox(!0);var n=mr(r).map(function(t){return[t.x,t.y]});var o=se(mt(a),2),v=se(o[0],2),l=v[0],u=v[1],h=se(o[1],2),f=h[0],d=h[1];var p=se(mt(n),2),y=se(p[0],2),m=y[0],x=y[1],b=se(p[1],2),g=b[0],_=b[1];t.map(function(t){var e=Je(t.parentNode,c);e.e=e.f=0;var r=tr(e.inverse(),function(){switch(!0){case/[l]/.test(i):return l-m;case/[r]/.test(i):return u-x;case/[h]/.test(i):return(u+l)/2-(x+m)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(i):return f-g;case/[b]/.test(i):return d-_;case/[v]/.test(i):return(d+f)/2-(_+g)/2;default:return 0}}()),a=r.x,n=r.y;var o=Qe(a,n).multiply(Je(t,t.parentNode));s._updateElementView(t,["transform",o])}),this.fitControlsToSize()}}]),e}();var br=function(e,t){var r=t.x,a=t.y;var n=[];switch(e.tagName.toLowerCase()){case"text":var o=j(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r;var i=j(e.y.baseVal[0])?e.y.baseVal[0].value+a:(Number(e.getAttribute("y"))||0)+a;n.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=j(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r;var c=j(e.y.baseVal.value)?e.y.baseVal.value+a:(Number(e.getAttribute("y"))||0)+a;n.push(["x",s],["y",c]);break;case"circle":case"ellipse":var v=e.cx.baseVal.value+r,l=e.cy.baseVal.value+a;n.push(["cx",v],["cy",l]);break;case"line":var u=e.x1.baseVal.value+r,h=e.y1.baseVal.value+a,f=e.x2.baseVal.value+r,d=e.y2.baseVal.value+a;n.push(["x1",u],["y1",h],["x2",f],["y2",d]);break;case"polygon":case"polyline":var p=nr(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+a,t.join(" ")}).join(" ");n.push(["points",p]);break;case"path":var y=e.getAttribute("d");n.push(["d",function(t){var e=t.path,r=t.dx,a=t.dy;try{var n=ir(e);var o="";var i=" ";var s=!0;for(var c=0,v=n.length;c<v;c++){var l=n[c];var u=l.values,h=l.key,f=l.relative;var d=[];switch(h){case"M":for(var p=0,y=u.length;p<y;p+=2){var m=se(u.slice(p,p+2),2),x=m[0],b=m[1];f&&!s||(x+=r,b+=a),d.push(x,b),s=!1}break;case"A":for(var g=0,_=u.length;g<_;g+=7){var k=u.slice(g,g+7);f||(k[5]+=r,k[6]+=a),d.push.apply(d,Yt(k))}break;case"C":for(var E=0,M=u.length;E<M;E+=6){var T=u.slice(E,E+6);f||(T[0]+=r,T[1]+=a,T[2]+=r,T[3]+=a,T[4]+=r,T[5]+=a),d.push.apply(d,Yt(T))}break;case"H":for(var w=0,R=u.length;w<R;w+=1){var O=u.slice(w,w+1);f||(O[0]+=r),d.push(O[0])}break;case"V":for(var S=0,V=u.length;S<V;S+=1){var C=u.slice(S,S+1);f||(C[0]+=a),d.push(C[0])}break;case"L":case"T":for(var A=0,N=u.length;A<N;A+=2){var P=se(u.slice(A,A+2),2),D=P[0],j=P[1];f||(D+=r,j+=a),d.push(D,j)}break;case"Q":case"S":for(var B=0,L=u.length;B<L;B+=4){var z=se(u.slice(B,B+4),4),Y=z[0],H=z[1],X=z[2],I=z[3];f||(Y+=r,H+=a,X+=r,I+=a),d.push(Y,H,X,I)}break;case"Z":i=u[0]=""}o+=h+d.join(",")+i}return o}catch(t){ce("Path parsing error: "+t)}}({path:y,dx:r,dy:a})])}n.forEach(function(t){e.setAttribute(t[0],t[1])})};var gr=function(n,t){var e=t.scaleX,r=t.scaleY,o=t.localCTM,a=t.bBox,i=a.width,s=a.height,c=t.__data__,v=t.transformMatrix,l=t.isGrouped;var u=[];var h=c.get(n);switch(n.tagName.toLowerCase()){case"text":case"tspan":var f=h.x,d=h.y,p=h.textLength;var y=tr(o,f,d),m=y.x,x=y.y;u.push(["x",m+(e<0?i:0)],["y",x-(r<0?s:0)],["textLength",Math.abs(e*p)]);break;case"circle":var b=h.r,g=h.cx,_=h.cy,k=b*(Math.abs(e)+Math.abs(r))/2;var E=tr(o,g,_),M=E.x,T=E.y;u.push(["r",k],["cx",M],["cy",T]);break;case"foreignobject":case"image":case"rect":if(l){var w=h.matrix,R=h.childCTM;var O=R.inverse().multiply(v).multiply(R);var S=w.multiply(O);u.push(["transform",Ke(S)])}else{var V=h.width,C=h.height,A=h.x,N=h.y;var P=tr(o,A,N),D=P.x,j=P.y;var B=Math.abs(V*e),L=Math.abs(C*r);u.push(["x",D-(e<0?B:0)],["y",j-(r<0?L:0)],["width",B],["height",L])}break;case"ellipse":var z=h.rx,Y=h.ry,H=h.cx,X=h.cy;var I=tr(o,H,X),G=I.x,W=I.y;var F=Ze();F.a=e,F.d=r;var q=tr(F,z,Y),Z=q.x,Q=q.y;u.push(["rx",Math.abs(Z)],["ry",Math.abs(Q)],["cx",G],["cy",W]);break;case"line":var U=h.resX1,$=h.resY1,J=h.resX2,K=h.resY2;var tt=tr(o,U,$),et=tt.x,rt=tt.y;var at=tr(o,J,K),nt=at.x,ot=at.y;u.push(["x1",et],["y1",rt],["x2",nt],["y2",ot]);break;case"polygon":case"polyline":var it=h.points;var st=nr(it).map(function(t){var e=tr(o,Number(t[0]),Number(t[1])),r=e.x,a=e.y;return t[0]=ve(r),t[1]=ve(a),t.join(" ")}).join(" ");u.push(["points",st]);break;case"path":var ct=h.path;u.push(["d",function(t){var e=t.path,r=t.localCTM;try{var a=ir(e);var n="";var o=" ";var i=[];var s=!0;for(var c=0,v=a.length;c<v;c++){var l=a[c];var u=l.values,h=l.key,f=l.relative,d=void 0!==f&&f;switch(h){case"A":var p=[];var y=er(r);d&&(y.e=y.f=0);for(var m=0,x=u.length;m<x;m+=7){var b=se(u.slice(m,m+7),7),g=b[0],_=b[1],k=b[2],E=b[3],M=b[4],T=b[5],w=b[6];var R=tr(y,T,w),O=R.x,S=R.y;p.push(ve(O),ve(S)),y.e=y.f=0;var V=tr(y,g,_),C=V.x,A=V.y;p.unshift(ve(C),ve(A),k,E,M)}i.push(p);break;case"C":var N=[];var P=er(r);d&&(P.e=P.f=0);for(var D=0,j=u.length;D<j;D+=6){var B=se(u.slice(D,D+6),6),L=B[0],z=B[1],Y=B[2],H=B[3],X=B[4],I=B[5];var G=tr(P,L,z),W=G.x,F=G.y;var q=tr(P,Y,H),Z=q.x,Q=q.y;var U=tr(P,X,I),$=U.x,J=U.y;N.push(ve(W),ve(F),ve(Z),ve(Q),ve($),ve(J))}i.push(N);break;case"H":var K=[];var tt=er(r);d&&(tt.e=tt.f=0);for(var et=0,rt=u.length;et<rt;et+=1){var at=se(u.slice(et,et+1),1)[0];var nt=tr(tt,at,0).x;K.push(ve(nt))}i.push(K);break;case"V":var ot=[];var it=er(r);d&&(it.e=it.f=0);for(var st=0,ct=u.length;st<ct;st+=1){var vt=se(u.slice(st,st+1),1)[0];var lt=tr(it,0,vt).y;ot.push(ve(lt))}i.push(ot);break;case"T":case"L":var ut=[];var ht=er(r);d&&(ht.e=ht.f=0);for(var ft=0,dt=u.length;ft<dt;ft+=2){var pt=se(u.slice(ft,ft+2),2),yt=pt[0],mt=pt[1];var xt=tr(ht,yt,mt),bt=xt.x,gt=xt.y;ut.push(ve(bt),ve(gt))}i.push(ut);break;case"M":var _t=[];var kt=er(r);d&&!s&&(kt.e=kt.f=0);for(var Et=0,Mt=u.length;Et<Mt;Et+=2){var Tt=se(u.slice(Et,Et+2),2),wt=Tt[0],Rt=Tt[1];var Ot=tr(kt,wt,Rt),St=Ot.x,Vt=Ot.y;_t.push(ve(St),ve(Vt)),s=!1}i.push(_t);break;case"Q":var Ct=[];var At=er(r);d&&(At.e=At.f=0);for(var Nt=0,Pt=u.length;Nt<Pt;Nt+=4){var Dt=se(u.slice(Nt,Nt+4),4),jt=Dt[0],Bt=Dt[1],Lt=Dt[2],zt=Dt[3];var Yt=tr(At,jt,Bt),Ht=Yt.x,Xt=Yt.y;var It=tr(At,Lt,zt),Gt=It.x,Wt=It.y;Ct.push(ve(Ht),ve(Xt),ve(Gt),ve(Wt))}i.push(Ct);break;case"S":var Ft=[];var qt=er(r);d&&(qt.e=qt.f=0);for(var Zt=0,Qt=u.length;Zt<Qt;Zt+=4){var Ut=se(u.slice(Zt,Zt+4),4),$t=Ut[0],Jt=Ut[1],Kt=Ut[2],te=Ut[3];var ee=tr(qt,$t,Jt),re=ee.x,ae=ee.y;var ne=tr(qt,Kt,te),oe=ne.x,ie=ne.y;Ft.push(ve(re),ve(ae),ve(oe),ve(ie))}i.push(Ft);break;case"Z":i.push([""]),o=""}n+=l.key+i[c].join(",")+o}return n.trim()}catch(t){ce("Path parsing error: "+t)}}({path:ct,localCTM:o})])}u.forEach(function(t){var e=se(t,2),r=e[0],a=e[1];n.setAttribute(r,a)})};var _r=function(t,e,r,a){var n=Fe("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(a)]);return yr({cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"}).forEach(function(t){var e=se(t,2),r=e[0],a=e[1];return n.setAttribute(r,a)}),n};var kr=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")};var Er=function(t,e,r,a){var n=null;switch(t.tagName.toLowerCase()){case"text":n={x:j(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,y:j(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,textLength:j(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null};break;case"circle":n={r:t.r.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"foreignobject":case"image":case"rect":n={width:t.width.baseVal.value,height:t.height.baseVal.value,x:t.x.baseVal.value,y:t.y.baseVal.value};break;case"ellipse":n={rx:t.rx.baseVal.value,ry:t.ry.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"line":n={resX1:t.x1.baseVal.value,resY1:t.y1.baseVal.value,resX2:t.x2.baseVal.value,resY2:t.y2.baseVal.value};break;case"polygon":case"polyline":n={points:t.getAttribute("points")};break;case"path":n={path:t.getAttribute("d")}}e.__data__.set(t,gt({},n,{matrix:Je(t,t.parentNode),ctm:Je(t.parentNode,r),childCTM:Je(t,a?r.parentNode:r)}))};var Mr=function(t,e,r){var a=se(t,2),n=a[0],o=a[1];var i=Fe("line",["sjx-svg-line","sjx-svg-line-".concat(r)]);var s={x1:n.x,y1:n.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return yr(s).forEach(function(t){var e=se(t,2),r=e[0],a=e[1];return i.setAttribute(r,a)}),i};var Tr=function(t,o,e){var r=2<arguments.length&&void 0!==e?e:t.getBBox();var a=r.x,n=r.y,i=r.width,s=r.height;return[[a,n],[a+i,n],[a+i,n+s],[a,n+s]].map(function(t){var e=se(t,2),r=e[0],a=e[1];var n=tr(o,r,a);return[n.x,n.y]})};function wr(t,e){if(this.length){var r=j(e)&&e instanceof it?e:new it;if(this[0]instanceof SVGElement){var a=d.call(this,function(t,e){return function(t){var e=t.tagName.toLowerCase();return-1!==We.indexOf(e)||(ce('Selected element "'.concat(e,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)}(e)&&t.push(e),t},[]);return new xr(a,t,r)}return new Le(f.call(this,function(t){return t}),t,r)}}var Rr=H.EMITTER_EVENTS;var Or=X,Sr=W;var Vr=function(){o(n,dt);var a=c(n);function n(t,e){var r;return i(this,n),(r=a.call(this,t)).enable(e),r}return r(n,[{key:"_init",value:function(){var e=this;var t=this.elements,r=this.options;var a=rt(t);var n=r.style,o=r.appendTo;var i=gt({position:"absolute","z-index":"2147483647"},n);var s=new WeakMap;t.map(function(t){return s.set(t,{parent:j(o)?rt(o)[0]:document.body})}),this.storage={css:i,data:s},a.on(Or,this._onMouseDown).on(Sr,this._onTouchStart),Rr.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e={},r=null,a=document,n=tt,o=tt,i=tt,s=tt;if(j(t)){var c=t.style,v=t.appendTo,l=t.stack,u=t.onInit,h=t.onMove,f=t.onDrop,d=t.onDestroy;e=j(c)&&"object"===K(c)?c:e,r=v||null;var p=j(l)?rt(l)[0]:document;n=et(u),o=et(h),i=y(f)?function(t){var e=this.storage;var r=(e=void 0===e?{}:e).clone;!function(t,e){var r=xt(t),a=r.top,n=r.left,o=xt(e),i=o.top,s=o.left,c=rt(t),v=rt(e);return!(a<i||a+parseFloat(c.css("height"))>i+parseFloat(v.css("height"))||n<s||n+parseFloat(c.css("width"))>s+parseFloat(v.css("width")))}(r,p)||f.call(this,t,this.elements,r)}:tt,s=et(d)}this.options={style:e,appendTo:r,stack:a},this.proxyMethods={onInit:n,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.target,r=t.clientX,a=t.clientY;var n=this.elements,o=this.storage,i=this.storage,s=i.data,c=i.css;var v=n.find(function(t){return t===e||t.contains(e)});if(v){var l=(s.get(v)||{}).parent,u=void 0===l?v.parentNode:l;var h=xt(u),f=h.left,d=h.top;c.left="".concat(r-f,"px"),c.top="".concat(a-d,"px");var p=v.cloneNode(!0);rt(p).css(c),o.clientX=r,o.clientY=a,o.cx=r,o.cy=a,o.clone=p,u.appendChild(p),this._draw()}}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY;var a=this.storage;a.clientX=e,a.clientY=r,a.doDraw=!0,a.doMove=!0}},{key:"_end",value:function(t){var e=this.storage;var r=e.clone,a=e.frameId;e.doDraw=!1,k(a),Mt(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=Et(this._animate);var e=t.doDraw,r=t.clientX,a=t.clientY,n=t.cx,o=t.cy,i=t.clone;e&&(t.doDraw=!1,this._drag({element:i,dx:r-n,dy:a-o}))}},{key:"_processMove",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage;var o=(n=void 0===n?{}:n).clone;var i="translate(".concat(r,"px, ").concat(a,"px)");rt(o).css({transform:i,webkitTranform:i,mozTransform:i,msTransform:i,otransform:i})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.elements;Mt(t)||(rt(r).off(Or,this._onMouseDown).off(Sr,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),n}();function Cr(t){if(this.length)return new Vr(f.call(this,function(t){return t}),t)}var Ar=function(){o(e,p);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"drag",value:function(){return wr.call.apply(wr,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return Cr.call.apply(Cr,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function Nr(t){return new Ar(t)}return Object.defineProperty(Nr,"createObservable",{value:function(){return new it}}),Object.defineProperty(Nr,"Subjx",{value:Ar}),Object.defineProperty(Nr,"Observable",{value:it}),Nr});
