/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2022
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function r(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),t}function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function bt(n){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?e(Object(o),!0).forEach(function(t){var e,r,a;e=n,a=o[r=t],r in e?Object.defineProperty(e,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[r]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(o,t))})}return n}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function _t(t){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function R(t,e){if(null==t)return{};var r=function(t,e){if(null==t)return{};var r={};var a=Object.keys(t);var n,o;for(o=0;o<a.length;o++)n=a[o],0<=e.indexOf(n)||(r[n]=t[n]);return r}(t,e);var a,n;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)a=o[n],0<=e.indexOf(a)||Object.prototype.propertyIsEnumerable.call(t,a)&&(r[a]=t[a])}return r}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function c(a){return function(){var t,e=_t(a);if(function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()){var r=_t(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}(this,t)}}function kt(t,e,r){return(kt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_t(t)););return t}(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(r):n.value}})(t,e,r||t)}function se(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var r=[];var a=!0;var n=!1;var o=void 0;try{for(var i,s=t[Symbol.iterator]();!(a=(i=s.next()).done)&&(r.push(i.value),!e||r.length!==e);a=!0);}catch(t){n=!0,o=t}finally{try{a||null==s["return"]||s["return"]()}finally{if(n)throw o}}return r}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){if(t){if("string"==typeof t)return l(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}var Mt=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)};var M=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)};var t=Array.prototype,u=t.forEach,h=t.slice,f=t.map,d=t.reduce;var ce=console.warn;function rt(t){return t}var j=function(t){return null!=t};function Et(t){return null==t}function y(t){return"function"==typeof t}function at(t){return y(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:rt}var p=function(){function o(t){if(i(this,o),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==et(t)||1!==t.nodeType&&t!==document)if(t instanceof o){this.length=t.length;for(var a=0;a<this.length;a++)this[a]=t[a]}else{if(!function(t){return j(t)&&"object"===et(t)&&(Array.isArray(t)||j(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||j(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");this.length=t.length;for(var n=0;n<this.length;n++)1===t[n].nodeType&&(this[n]=t[n])}else this[0]=t,this.length=1}return r(o,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){var r=t.length;for(;r--;)for(var a in e)t[r].style[a]=e[a];return t.style}(this,t)},getStyle:function(){return function(t){var e=t.length;for(;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,h.call(arguments,1)):"object"!==et(r)&&r?(ce("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,a){var n=this.length;for(;n--;)this[n].events||(this[n].events={},this[n].events[t]=[]),"string"!=typeof e?document.addEventListener?this[n].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[n].attachEvent("on".concat(t),e):this[n]["on".concat(t)]=e:m(this[n],t,e,r,a,!0);return this}},{key:"off",value:function(t,e,r,a){var n=this.length;for(;n--;)this[n].events||(this[n].events={},this[n].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[n].removeEventListener(t,e,r):document.detachEvent?this[n].detachEvent("on".concat(t),e):this[n]["on".concat(t)]=null:m(this[n],t,e,r,a,!1);return this}},{key:"is",value:function(t){if(Et(t))return!1;var e=nt(t);var r=this.length;for(;r--;)if(this[r]===e[r])return!0;return!1}}]),o}();function m(t,e,r,a,n,o){function i(t){var e=t.target;for(;e&&e!==this;)e.matches(r)&&a.call(e,t),e=e.parentNode}!0===o?document.addEventListener?t.addEventListener(e,i,n||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),i):t["on".concat(e)]=i:document.removeEventListener?t.removeEventListener(e,i,n||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),i):t["on".concat(e)]=null}function nt(t){return new p(t)}var Y=2;var S="#00a8ff";var ot="sjx-";var x="dragStart";var g="drag";var b="dragEnd";var _="resizeStart";var k="resize";var E="resizeEnd";var T="rotateStart";var w="rotate";var O="rotateEnd";var C="setPointStart";var V="setPointEnd";var N=["","-webkit-","-moz-","-ms-","-o-"];var A="ongetstate";var P="onapply";var D="onmove";var B="onresize";var L="onrotate";var z={NOTIFIER_EVENTS:[A,P,D,B,L],ON_GETSTATE:A,ON_APPLY:P,ON_MOVE:D,ON_RESIZE:B,ON_ROTATE:L};var H={EMITTER_EVENTS:[x,g,,b,_,k,E,T,w,O,C,V],E_DRAG_START:x,E_DRAG:g,E_DRAG_END:b,E_RESIZE_START:_,E_RESIZE:k,E_RESIZE_END:E,E_ROTATE_START:T,E_ROTATE:w,E_ROTATE_END:O,E_SET_POINT:"setPoint",E_SET_POINT_START:C,E_SET_POINT_END:V};var I="mousedown",X="mouseup",G="mousemove",W="touchstart",F="touchend",q="touchmove";var Z={TOP_LEFT:"tl",TOP_CENTER:"tc",TOP_RIGHT:"tr",BOTTOM_LEFT:"bl",BOTTOM_RIGHT:"br",BOTTOM_CENTER:"bc",MIDDLE_LEFT:"ml",MIDDLE_RIGHT:"mr",CENTER:"center"},Q={TOP_EDGE:"te",BOTTOM_EDGE:"be",LEFT_EDGE:"le",RIGHT_EDGE:"re"};var U=z.ON_GETSTATE,$=z.ON_APPLY,J=z.ON_MOVE,K=z.ON_RESIZE,tt=z.ON_ROTATE;var it=function(){function t(){i(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return Et(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(j(r[t])){var a=r[t].indexOf(e);r[t].splice(a,1)}return this}},{key:"notify",value:function(e,r,a){Et(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case J:t.notifyMove(a);break;case tt:t.notifyRotate(a);break;case K:t.notifyResize(a);break;case $:t.notifyApply(a);break;case U:t.notifyGetState(a)}})}}]),t}();var st=function(){function e(t){i(this,e),this.name=t,this.callbacks=[]}return r(e,[{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"removeCallback",value:function(t){var e=this.callbacks(t);this.callbacks.splice(e,1)}}]),e}();var ct=function(){function t(){i(this,t),this.events={}}return r(t,[{key:"registerEvent",value:function(t){this.events[t]=new st(t)}},{key:"emit",value:function(e,t,r){this.events[t].callbacks.forEach(function(t){t.call(e,r)})}},{key:"addEventListener",value:function(t,e){this.events[t].registerCallback(e)}},{key:"removeEventListener",value:function(t,e){this.events[t].removeCallback(e)}}]),t}();var vt=H.E_DRAG;var lt=G,ut=X,ht=q,ft=F;var dt=function(){function e(t){i(this,e),this.elements=t,this.storage=null,this.proxyMethods=null,this.eventDispatcher=new ct,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.elements),this.proxyMethods.onInit.call(this,this.elements)}},{key:"disable",value:function(){pt()}},{key:"_init",value:function(){pt()}},{key:"_destroy",value:function(){pt()}},{key:"_processOptions",value:function(){pt()}},{key:"_start",value:function(){pt()}},{key:"_moving",value:function(){pt()}},{key:"_end",value:function(){pt()}},{key:"_animate",value:function(){pt()}},{key:"_drag",value:function(t){var e=t.element,r=t.dx,a=t.dy,n=R(t,["element","dx","dy"]);var o=bt({dx:r,dy:a,transform:this._processMove(e,{dx:r,dy:a})},n);this.proxyMethods.onMove.call(this,o),this._emitEvent(vt,o)}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),nt(document).on(lt,this._onMouseMove).on(ut,this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),nt(document).on(ht,this._onTouchMove).on(ft,this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0])}},{key:"_onMouseUp",value:function(t){nt(document).off(lt,this._onMouseMove).off(ut,this._onMouseUp),this._end(t,this.elements)}},{key:"_onTouchEnd",value:function(t){nt(document).off(ht,this._onTouchMove).off(ft,this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.elements)}},{key:"_emitEvent",value:function(){var t;(t=this.eventDispatcher).emit.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"on",value:function(t,e){return this.eventDispatcher.addEventListener(t,e),this}},{key:"off",value:function(t,e){return this.eventDispatcher.removeEventListener(t,e),this}}]),e}();var pt=function(){throw Error("Method not implemented")};var yt=Math.PI/180;var mt=180/Math.PI;function Tt(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0}function ve(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}function xt(r,t){var e=1<arguments.length&&void 0!==t?t:2;var a=[];function n(e){var t=r.map(function(t){return t[e]});a.push([Math.min.apply(Math,Yt(t)),Math.max.apply(Math,Yt(t))])}for(var o=0;o<e;o++)n(o);return a}function gt(t){return t.getBoundingClientRect()}function wt(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function Ot(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function St(t){var e="matrix3d(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}function Rt(t,e){var r=window.getComputedStyle(t);var a=null;var n,o=function(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=v(t))){var e=0;var r=function(){};return{s:r,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,o=!0,i=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return o=t.done,t},e:function(t){i=!0,n=t},f:function(){try{o||null==a.return||a.return()}finally{if(i)throw n}}}}(N);try{for(o.s();!(n=o.n()).done;){var i=n.value;if(a=r.getPropertyValue("".concat(i).concat(e))||a)break}}catch(t){o.e(t)}finally{o.f()}return a}var Ct=z.NOTIFIER_EVENTS,Vt=z.ON_GETSTATE,Nt=z.ON_APPLY,At=z.ON_MOVE,Pt=z.ON_RESIZE,Dt=z.ON_ROTATE;var jt=H.EMITTER_EVENTS,Bt=H.E_DRAG_START,Lt=H.E_DRAG,zt=H.E_DRAG_END,Ht=H.E_RESIZE_START,It=H.E_RESIZE,Xt=H.E_RESIZE_END,Gt=H.E_ROTATE_START,Wt=H.E_ROTATE,Ft=H.E_ROTATE_END,qt=H.E_SET_POINT,Zt=H.E_SET_POINT_END;var Qt=Z,Ut=Q;var $t=I,Jt=W,Kt=G,te=X,ee=q,re=F;var ae=Qt.TOP_LEFT,ne=Qt.TOP_CENTER,oe=Qt.TOP_RIGHT,ie=Qt.BOTTOM_LEFT,le=Qt.BOTTOM_RIGHT,ue=Qt.BOTTOM_CENTER,he=Qt.MIDDLE_LEFT,fe=Qt.MIDDLE_RIGHT;var de=Ut.TOP_EDGE,pe=Ut.BOTTOM_EDGE,ye=Ut.LEFT_EDGE,me=Ut.RIGHT_EDGE;var xe=Object.keys,ge=Object.values;var be=function(){o(gt,dt);var n=c(gt);function gt(t,e,r){var a;if(i(this,gt),(a=n.call(this,t)).constructor===gt)throw new TypeError("Cannot construct Transformable instances directly");return a.observable=r,jt.forEach(function(t){return a.eventDispatcher.registerEvent(t)}),kt(_t(gt.prototype),"enable",s(a)).call(s(a),e),a}return r(gt,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(t){var e=t.element,r=t.radians,a=R(t,["element","radians"]);var n=bt({transform:this._processRotate(e,r),delta:r},a);this.proxyMethods.onRotate.call(this,n),kt(_t(gt.prototype),"_emitEvent",this).call(this,Wt,n)}},{key:"_resize",value:function(t){var e=t.element,r=t.dx,a=t.dy,n=R(t,["element","dx","dy"]);var o=bt({},this._processResize(e,{dx:r,dy:a}),{dx:r,dy:a},n);this.proxyMethods.onResize.call(this,o),kt(_t(gt.prototype),"_emitEvent",this).call(this,It,o)}},{key:"_processOptions",value:function(t){var e=0<arguments.length&&void 0!==t?t:{};var r=this.elements;Yt(r).map(function(t){return wt(t,"".concat(ot,"drag"))});var a=e.each,n=void 0===a?{move:!1,resize:!1,rotate:!1}:a,o=e.snap,i=void 0===o?{x:10,y:10,angle:10}:o,s=e.axis,c=void 0===s?"xy":s,v=e.cursorMove,l=void 0===v?"auto":v,u=e.cursorResize,h=void 0===u?"auto":u,f=e.cursorRotate,d=void 0===f?"auto":f,p=e.rotationPoint,y=void 0!==p&&p,m=e.transformOrigin,x=void 0!==m&&m,g=e.restrict,b=e.draggable,_=void 0===b||b,k=e.resizable,M=void 0===k||k,E=e.rotatable,T=void 0===E||E,w=e.scalable,O=void 0!==w&&w,S=e.applyTranslate,R=void 0!==S&&S,C=e.onInit,V=void 0===C?rt:C,N=e.onDrop,A=void 0===N?rt:N,P=e.onMove,D=void 0===P?rt:P,j=e.onResize,B=void 0===j?rt:j,L=e.onRotate,z=void 0===L?rt:L,Y=e.onDestroy,H=void 0===Y?rt:Y,I=e.container,X=void 0===I?r[0].parentNode:I,G=e.controlsContainer,W=void 0===G?X:G,F=e.proportions,q=void 0!==F&&F,Z=e.rotatorAnchor,Q=void 0===Z?null:Z,U=e.rotatorOffset,$=void 0===U?50:U,J=e.showNormal,K=void 0===J||J,tt=e.custom;this.options={axis:c,cursorMove:l,cursorRotate:d,cursorResize:h,rotationPoint:y,transformOrigin:x||y,restrict:g?nt(g)[0]||document.body:null,container:nt(X)[0],controlsContainer:nt(W)[0],snap:bt({},i,{angle:i.angle*yt}),each:n,proportions:q,draggable:_,resizable:M,rotatable:T,scalable:O,applyTranslate:R,custom:"object"===et(tt)&&tt||null,rotatorAnchor:Q,rotatorOffset:$,showNormal:K,isGrouped:1<r.length},this.proxyMethods={onInit:at(V),onDrop:at(A),onMove:at(D),onResize:at(B),onRotate:at(z),onDestroy:at(H)},this.subscribe(n)}},{key:"_animate",value:function(){var u=this;var s=this;var t=s.observable,e=s.storage,r=s.options,a=s.elements;if(!Et(e)&&(e.frame=Mt(s._animate),e.doDraw)){e.doDraw=!1;var h=e.dox,f=e.doy,n=e.clientX,o=e.clientY,i=e.relativeX,c=e.relativeY,v=e.doDrag,l=e.doResize,d=e.doRotate,p=e.doSetCenter,y=e.revX,m=e.revY,x=e.mouseEvent,g=e.data;var b=r.snap,_=r.each,k=_.move,M=_.resize,E=_.rotate,T=r.draggable,w=r.resizable,O=r.rotatable,S=r.isGrouped,R=r.restrict;if(l&&w){var C=Tt(n-i,b.x);var V=Tt(o-c,b.y);var N=e.cached,A=e.cached;var P=(A=void 0===A?{}:A).dist;var D=(P=void 0===P?{}:P).dx,j=void 0===D?C:D,B=P.dy,L=void 0===B?V:B;var z={dx:C,dy:V,clientX:n,clientY:o,mouseEvent:x};var Y=R?a.reduce(function(t,e){var r=g.get(e).transform.ctm;var a=S?{x:C,y:V}:u._pointToTransform({x:C,y:V,matrix:r}),n=a.x,o=a.y;var i=h?y?-n:n:0;var s=f?m?-o:o:0;var c=u._processResizeRestrict(e,{dx:i,dy:s}),v=c.x,l=c.y;return{x:null!==v&&null===t.x?C:t.x,y:null!==l&&null===t.y?V:t.y}},{x:null,y:null}):{x:null,y:null},H=Y.x,I=Y.y;var X=R&&(null!==H||null!==I);var G=X?j:C;var W=X?L:V;var F=bt({},z,{dx:G,dy:W,revX:y,revY:m,dox:h,doy:f});a.map(function(t){var e=g.get(t).transform.ctm;var r=S?{x:G,y:W}:u._pointToTransform({x:G,y:W,matrix:e}),a=r.x,n=r.y;var o=h?y?-a:a:0;var i=f?m?-n:n:0;s._resize(bt({},F,{element:t,dx:o,dy:i}))}),this.storage.cached=bt({},N,{dist:{dx:G,dy:W}}),this._processControlsResize({dx:G,dy:W}),M&&t.notify(Pt,s,F)}if(v&&T){var q=h?Tt(n-i,b.x):0;var Z=f?Tt(o-c,b.y):0;var Q=e.cached,U=e.cached;var $=(U=void 0===U?{}:U).dist;var J=($=void 0===$?{}:$).dx,K=void 0===J?q:J,tt=$.dy,et=void 0===tt?Z:tt;var rt={dx:q,dy:Z,clientX:n,clientY:o,mouseEvent:x};var at=R?a.reduce(function(t,e){var r=u._processMoveRestrict(e,rt),a=r.x,n=r.y;return{x:null===t.x&&R?a:t.x,y:null===t.y&&R?n:t.y}},{x:null,y:null}):{x:null,y:null},nt=at.x,ot=at.y;var it=null!==nt&&R?K:q;var st=null!==ot&&R?et:Z;var ct=bt({},rt,{dx:it,dy:st});this.storage.cached=bt({},Q,{dist:{dx:it,dy:st}}),a.map(function(t){return kt(_t(gt.prototype),"_drag",u).call(u,bt({element:t},ct,{dx:it,dy:st}))}),this._processControlsMove({dx:it,dy:st}),k&&t.notify(At,s,ct)}if(d&&O){var vt=e.pressang,lt=e.center;var ut=Math.atan2(o-lt.y,n-lt.x);var ht=Tt(ut-vt,b.angle);if(R)if(a.some(function(t){var e=u._processRotateRestrict(t,ht),r=e.x,a=e.y;return null!==r||null!==a}))return;var ft={clientX:n,clientY:o,mouseEvent:x};a.map(function(t){return s._rotate(bt({element:t,radians:ht},ft))}),this._processControlsRotate({radians:ht}),E&&t.notify(Dt,s,bt({radians:ht},ft))}if(p&&O){var dt=e.bx,pt=e.by;var yt=this._pointToControls({x:n,y:o}),mt=yt.x,xt=yt.y;s._moveCenterHandle(mt-dt,xt-pt)}}}},{key:"_start",value:function(e){var t=e.clientX,r=e.clientY;var a=this.elements,n=this.observable,o=this.options,i=o.axis,s=o.each,c=this.storage,v=this.storage.handles;var l=ge(v).some(function(t){return nt(e.target).is(t)})||a.some(function(t){return t.contains(e.target)});if(c.isTarget=l){var u=this._compute(e,a);xe(u).map(function(t){return c[t]=u[t]});var h=u.onRightEdge,f=u.onBottomEdge,d=u.onTopEdge,p=u.onLeftEdge,y=u.handle,m=u.factor,x=u.revX,g=u.revY,b=u.doW,_=u.doH;var k=h||f||d||p;var M=v.rotator,E=v.center,T=v.radius;j(T)&&Ot(T,"".concat(ot,"hidden"));var w=y.is(M),O=!!j(E)&&y.is(E);var S=l&&!(w||k||O);var R={mouseEvent:e,clientX:t,clientY:r,doResize:k,doDrag:S,doRotate:w,doSetCenter:O,onExecution:!0,cursor:null,dox:/\x/.test(i)&&(!k||(y.is(v.ml)||y.is(v.mr)||y.is(v.tl)||y.is(v.tr)||y.is(v.bl)||y.is(v.br)||y.is(v.le)||y.is(v.re))),doy:/\y/.test(i)&&(!k||(y.is(v.br)||y.is(v.bl)||y.is(v.bc)||y.is(v.tr)||y.is(v.tl)||y.is(v.tc)||y.is(v.te)||y.is(v.be)))};this.storage=bt({},c,{},R);var C={clientX:t,clientY:r};k?kt(_t(gt.prototype),"_emitEvent",this).call(this,Ht,C):w?kt(_t(gt.prototype),"_emitEvent",this).call(this,Gt,C):S&&kt(_t(gt.prototype),"_emitEvent",this).call(this,Bt,C);var V=s.move,N=s.resize,A=s.rotate;var P=k?It:w?Wt:Lt;var D=k&&N||w&&A||S&&V;n.notify(Vt,this,{clientX:t,clientY:r,actionName:P,triggerEvent:D,factor:m,revX:x,revY:g,doW:b,doH:_}),this._draw()}}},{key:"_moving",value:function(t){var e=this.storage,r=void 0===e?{}:e,a=this.options;if(r.isTarget){var n=this._cursorPoint(t),o=n.x,i=n.y;r.mouseEvent=t,r.clientX=o,r.clientY=i,r.doDraw=!0;var s=r.doRotate,c=r.doDrag,v=r.doResize,l=r.cursor;var u=a.cursorMove,h=a.cursorResize,f=a.cursorRotate;Et(l)&&(c?l=u:s?l=f:v&&(l=h),nt(document.body).css({cursor:l}))}}},{key:"_end",value:function(t){var e=this;var r=t.clientX,a=t.clientY;var n=this.elements,o=this.options.each,i=this.observable,s=this.storage,c=s.doResize,v=s.doDrag,l=s.doRotate,u=s.doSetCenter,h=s.frame,f=s.handles.radius,d=s.isTarget,p=this.proxyMethods;if(d){var y=([{actionName:It,condition:c},{actionName:Lt,condition:v},{actionName:Wt,condition:l},{actionName:qt,condition:u}].find(function(t){return t.condition})||{}).actionName,m=void 0===y?Lt:y;n.map(function(t){return e._applyTransformToElement(t,m)}),this._processActions(m),this._updateStorage();var x={clientX:r,clientY:a};p.onDrop.call(this,x),c?kt(_t(gt.prototype),"_emitEvent",this).call(this,Xt,x):l?kt(_t(gt.prototype),"_emitEvent",this).call(this,Ft,x):v?kt(_t(gt.prototype),"_emitEvent",this).call(this,zt,x):u&&kt(_t(gt.prototype),"_emitEvent",this).call(this,Zt,x);var g=o.move,b=o.resize,_=o.rotate;var k=c&&b||l&&_||v&&g;i.notify(Nt,this,{clientX:r,clientY:a,actionName:m,triggerEvent:k}),M(h),nt(document.body).css({cursor:"auto"}),j(f)&&wt(f,"".concat(ot,"hidden"))}}},{key:"_compute",value:function(e,t){var s=this;var r=this.storage;var a=(r=void 0===r?{}:r).handles,c=r.data;var n=nt(e.target);var o=this._checkHandles(n,a),v=o.revX,l=o.revY,u=o.doW,h=o.doH,i=R(o,["revX","revY","doW","doH"]);var f=this._getCommonState();var d=this._cursorPoint(e),p=d.x,y=d.y;var m=this._pointToControls({x:p,y:y},f.transform),x=m.x,g=m.y;t.map(function(t){var e=s._getElementState(t,{revX:v,revY:l,doW:u,doH:h}),r=e.transform,a=R(e,["transform"]);var n=s._pointToTransform({x:p,y:y,matrix:r.ctm}),o=n.x,i=n.y;c.set(t,bt({},c.get(t),{},a,{transform:r,cx:o,cy:i}))});var b=Math.atan2(y-f.center.y,p-f.center.x);return bt({data:c},i,{handle:ge(a).some(function(t){return nt(e.target).is(t)})?n:nt(t[0]),pressang:b},f,{revX:v,revY:l,doW:u,doH:h,relativeX:p,relativeY:y,bx:x,by:g})}},{key:"_checkHandles",value:function(e,r){function t(t){return t.some(function(t){return function(t){return!!j(t)&&e.is(t)}(r[t])})}return{revX:t([ae,he,ie,ne,ye]),revY:t([ae,oe,ne,he,de]),onTopEdge:t([ne,oe,ae,de]),onLeftEdge:t([ae,he,ie,ye]),onRightEdge:t([oe,fe,le,me]),onBottomEdge:t([le,ue,ie,pe]),doW:t([he,fe,ye,me]),doH:t([ne,ue,pe,de])}}},{key:"_restrictHandler",value:function(t,e){var r=null,a=null;var n=this.getBoundingRect(t,e);var o=this._getRestrictedBBox();var i=se(xt(o),2),s=se(i[0],2),c=s[0],v=s[1],l=se(i[1],2),u=l[0],h=l[1];for(var f=0,d=n.length;f<d;f++){var p=se(n[f],2),y=p[0],m=p[1];(y<c||v<y)&&(r=y),(m<u||h<m)&&(a=m)}return{x:r,y:a}}},{key:"_destroy",value:function(){var e=this;var t=this.elements,r=this.storage;var a=(r=void 0===r?{}:r).controls,n=r.wrapper;[].concat(Yt(t),[a]).map(function(t){return nt(t).off($t,e._onMouseDown).off(Jt,e._onTouchStart)}),n.parentNode.removeChild(n)}},{key:"_updateStorage",value:function(){var t=this.storage,e=this.storage,r=e.transformOrigin,a=e.transform;var n=(a=void 0===a?{}:a).controlsMatrix,o=e.cached;var i=(o=void 0===o?{}:o).transformOrigin,s=void 0===i?r:i,c=o.controlsMatrix,v=void 0===c?n:c;this.storage=bt({},t,{doResize:!1,doDrag:!1,doRotate:!1,doSetCenter:!1,doDraw:!1,onExecution:!1,cursor:null,transformOrigin:s,controlsMatrix:v,cached:{}})}},{key:"notifyMove",value:function(t){var e=this;var r=t.dx,a=t.dy;this.elements.map(function(t){return kt(_t(gt.prototype),"_drag",e).call(e,{element:t,dx:r,dy:a})}),this._processControlsMove({dx:r,dy:a})}},{key:"notifyRotate",value:function(t){var e=this;var r=t.radians,a=R(t,["radians"]);var n=this.elements,o=this.options;var i=(o=void 0===o?{}:o).snap.angle;n.map(function(t){return e._rotate(bt({element:t,radians:Tt(r,i)},a))}),this._processControlsRotate({radians:r})}},{key:"notifyResize",value:function(t){var o=this;var i=t.dx,s=t.dy,c=t.revX,v=t.revY,l=t.dox,u=t.doy;var e=this.elements,h=this.storage.data,f=this.options.isGrouped;e.map(function(t){var e=h.get(t).transform.ctm;var r=f?{x:i,y:s}:o._pointToTransform({x:i,y:s,matrix:e}),a=r.x,n=r.y;o._resize({element:t,dx:l?c?-a:a:0,dy:u?v?-n:n:0})}),this._processControlsResize({dx:i,dy:s})}},{key:"notifyApply",value:function(t){var e=this;var r=t.clientX,a=t.clientY,n=t.actionName,o=t.triggerEvent;this.proxyMethods.onDrop.call(this,{clientX:r,clientY:a}),o&&(this.elements.map(function(t){return e._applyTransformToElement(t,n)}),kt(_t(gt.prototype),"_emitEvent",this).call(this,"".concat(n,"End"),{clientX:r,clientY:a}))}},{key:"notifyGetState",value:function(t){var r=this;var e=t.clientX,a=t.clientY,n=t.actionName,o=t.triggerEvent,i=R(t,["clientX","clientY","actionName","triggerEvent"]);if(o){var s=this.elements,c=this.storage.data;s.map(function(t){var e=r._getElementState(t,i);c.set(t,bt({},c.get(t),{},e))});var v=this._getCommonState();this.storage=bt({},this.storage,{},v),kt(_t(gt.prototype),"_emitEvent",this).call(this,"".concat(n,"Start"),{clientX:e,clientY:a})}}},{key:"subscribe",value:function(t){var e=t.resize,r=t.move,a=t.rotate;var n=this.observable;(r||e||a)&&n.subscribe(Vt,this).subscribe(Nt,this),r&&n.subscribe(At,this),e&&n.subscribe(Pt,this),a&&n.subscribe(Dt,this)}},{key:"unsubscribe",value:function(){var e=this;var r=this.observable;Ct.map(function(t){return r.unsubscribe(t,e)})}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.elements;Et(t)||(t.onExecution&&nt(document).off(Kt,this._onMouseMove).off(te,this._onMouseUp).off(ee,this._onTouchMove).off(re,this._onTouchEnd),r.map(function(t){return Ot(t,"".concat(ot,"drag"))}),this.unsubscribe(),this._destroy(),e.onDestroy.call(this,r),delete this.storage)}},{key:"exeDrag",value:function(t){var r=this;var e=t.dx,a=t.dy;var n=this.elements,o=this.options.draggable,i=this.storage,s=this.storage.data;if(o){var c=this._getCommonState();n.map(function(t){var e=r._getElementState(t,{revX:!1,revY:!1,doW:!1,doH:!1});s.set(t,bt({},s.get(t),{},e))}),this.storage=bt({},i,{},c),n.map(function(t){kt(_t(gt.prototype),"_drag",r).call(r,{element:t,dx:e,dy:a}),r._applyTransformToElement(t,Lt)}),this._processControlsMove({dx:e,dy:a})}}},{key:"exeResize",value:function(t){var r=this;var e=t.dx,a=t.dy,n=t.revX,o=void 0!==n&&n,i=t.revY,s=void 0!==i&&i,c=t.doW,v=void 0!==c&&c,l=t.doH,u=void 0!==l&&l;var h=this.elements,f=this.options.resizable,d=this.storage,p=this.storage.data;if(f){var y=this._getCommonState();h.map(function(t){var e=r._getElementState(t,{revX:o,revY:s,doW:v,doH:u});p.set(t,bt({},p.get(t),{},e))}),this.storage=bt({},d,{},y),h.map(function(t){r._resize({element:t,dx:e,dy:a}),r._applyTransformToElement(t,It)}),this._processControlsMove({dx:e,dy:a})}}},{key:"exeRotate",value:function(t){var r=this;var e=t.delta;var a=this.elements,n=this.options.rotatable,o=this.storage,i=this.storage.data;if(n){var s=this._getCommonState();a.map(function(t){var e=r._getElementState(t,{revX:!1,revY:!1,doW:!1,doH:!1});i.set(t,bt({},i.get(t),{},e))}),this.storage=bt({},o,{},s),a.map(function(t){r._rotate({element:t,radians:e}),r._applyTransformToElement(t,Wt)}),this._processControlsRotate({radians:e})}}},{key:"setCenterPoint",value:function(){throw Error("'setCenterPoint()' method not implemented")}},{key:"resetCenterPoint",value:function(){ce('"resetCenterPoint" method is replaced by "resetTransformOrigin" and would be removed soon'),this.setTransformOrigin({dx:0,dy:0},!1)}},{key:"setTransformOrigin",value:function(){throw Error("'setTransformOrigin()' method not implemented")}},{key:"resetTransformOrigin",value:function(){this.setTransformOrigin({dx:0,dy:0},!1)}},{key:"controls",get:function(){return this.storage.wrapper}}]),gt}();function _e(t){return t.map(function(t){return Yt(t)})}function ke(a){return a.reduce(function(t,e,r){return[].concat(Yt(t),[a[0][r],a[1][r],a[2][r],a[3][r]])},[])}function Me(t){return Yt(Array(0<arguments.length&&void 0!==t?t:4)).map(function(t,e,r){return r.map(function(){return+!e--})})}function Ee(r,a,t){var n=2<arguments.length&&void 0!==t?t:0;return Me().map(function(t,e){return t[3]=[r,a,n,1][e],t})}function Te(r,a,t,e){var n=2<arguments.length&&void 0!==t?t:1;var o=3<arguments.length&&void 0!==e?e:1;return Me().map(function(t,e){return t[e]=[r,a,n,o][e],t})}function we(t,e){var r=Me();return r[0][0]=e,r[0][1]=-t,r[1][0]=t,r[1][1]=e,r}function Oe(t,e){var r=!(1<arguments.length&&void 0!==e)||e?_e(t):t;return r[0][3]=r[1][3]=r[2][3]=0,r}function Se(t,e){var r=[];for(var a=0,n=t.length;a<n;++a){var o=0;for(var i=0;i<n;++i)o+=+t[a][i]*e[i];r[a]=o}return r}function Re(t,e){var r=[];for(var a=0;a<e.length;a++){r[a]=[];for(var n=0;n<t[0].length;n++){var o=0;for(var i=0;i<t.length;i++)o+=t[i][n]*e[a][i];r[a].push(o)}}return r}function Ce(t){var e=_e(t);var r,a=e.length,n=[];for(var o=0;o<a;o++)n[o]=[];for(var i=0;i<a;i++)for(var s=0;s<a;s++)n[i][s]=0,i==s&&(n[i][s]=1);for(var c=0;c<a;c++){r=e[c][c];for(var v=0;v<a;v++)e[c][v]/=r,n[c][v]/=r;for(var l=c+1;l<a;l++){r=e[l][c];for(var u=0;u<a;u++)e[l][u]-=e[c][u]*r,n[l][u]-=n[c][u]*r}}for(var h=a-1;0<h;h--)for(var f=h-1;0<=f;f--){r=e[f][h];for(var d=0;d<a;d++)e[f][d]-=e[h][d]*r,n[f][d]-=n[h][d]*r}for(var p=0;p<a;p++)for(var y=0;y<a;y++)e[p][y]=n[p][y];return e}function Ve(t,e,r){var a=1<arguments.length&&void 0!==e?e:document.body;var n=2<arguments.length?r:void 0;var o=Me();var i=t;var s=n||Ne(i);var c=!1;for(;i&&i instanceof Element;){var v=Ae(i,c);if(o=Re(o,(l=s,void 0,u=se(v,3),h=u[0],f=u[1],d=u[2],p=Ee(-h,-f,-d),y=Ee(h,f,d),Re(Re(p,l),y))),c=!0,i===a||null===i.offsetParent)break;i=i.offsetParent,s=Ne(i)}var l,u,h,f,d,p,y;return o}var Ne=function(t){var e=Rt(t,"transform")||"none";var r=Me();if("none"===e)return r;var a=e.split(/\s*[(),]\s*/).slice(1,-1);if(16!==a.length)return[[+a[0],+a[2],0,+a[4]],[+a[1],+a[3],0,+a[5]],[0,0,1,0],[0,0,0,1]];for(var n=0;n<4;++n)for(var o=0;o<4;++o)r[o][n]=+a[4*n+o];return r};var Ae=function(t,e){var r=Rt(t,"transform-origin");var a=r?r.split(" "):[];var n=[e?-t.clientLeft:0,e?-t.clientTop:0,0,1];for(var o=0;o<a.length;++o)n[o]+=parseFloat(a[o]);return n};function Pe(t,e){var r=1<arguments.length&&void 0!==e?e:document.body;var a=0,n=0;var o=t;var i=!1;for(;o&&o.offsetParent;){var s=Ve(o.offsetParent);var c=se(Se(Oe(s,!1),[o.offsetLeft+(i?o.clientLeft:0),o.offsetTop+(i?o.clientTop:0),0,1]),2);if(n+=c[0],a+=c[1],r===o)break;i=!0,o=o.offsetParent}return[n,a,0,1]}var De=I,je=W;var Be=Object.keys,Le=Object.entries,ze=Object.values;var Ye=function(){o(e,be);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this;var r=this.options,a=r.transformOrigin,n=r.container,o=r.controlsContainer,i=r.resizable,s=r.rotatable,c=r.showNormal,v=r.restrict;var l=We(["sjx-wrapper"]);var u=We(["sjx-controls"]);var h={};var f=this._getVertices(),d=f.rotator,p=void 0===d?null:d,y=f.anchor,m=void 0===y?null:y,x=R(f,["rotator","anchor"]);var g={};if(s){var b=c?Ie([[m.x,m.y],p],"normal"):null;c&&u.appendChild(b);var _=null;a&&(_=Ie([x.center,x.center],"radius"),wt(_,"sjx-hidden"),u.appendChild(_)),g=bt({},g,{normal:b,radius:_})}var k={te:[x.tl,x.tr],be:[x.bl,x.br],le:[x.tl,x.bl],re:[x.tr,x.br]};var M=i?{tl:x.tl,tr:x.tr,br:x.br,bl:x.bl,tc:x.tc,bc:x.bc,ml:x.ml,mr:x.mr}:{};var E=Array.isArray(a)?[].concat(Yt(a),[0,1]):x.center;var T=bt({},M,{center:a&&s?E:void 0,rotator:p});function w(a,n){return Be(a).map(function(t){var e=a[t];if(!Et(e)){var r=n(e,t);h[t]=r,u.appendChild(r)}})}w(k,Ie),w(T,He),l.appendChild(u),o.appendChild(l);var O=new WeakMap;t.map(function(t){return O.set(t,{parent:t.parentNode,transform:{ctm:Ve(t,n)},bBox:e._getBBox(),__data__:new WeakMap,cached:{}})});var S=v||n;this.storage={wrapper:l,controls:u,handles:bt({},h,{},g),data:O,center:{isShifted:Array.isArray(a)},transformOrigin:E,transform:{containerMatrix:Ve(S,S.parentNode)},cached:{}},[].concat(Yt(t),[u]).map(function(t){return nt(t).on(De,e._onMouseDown).on(je,e._onTouchStart)})}},{key:"_pointToTransform",value:function(t){var e=t.x,r=t.y,a=t.matrix;var n=Ce(a);return this._applyMatrixToPoint(Oe(n,!1),e,r)}},{key:"_pointToControls",value:function(t,e){var r=t.x,a=t.y;var n=(1<arguments.length&&void 0!==e?e:this.storage.transform).controlsMatrix;var o=Ce(n);return this._applyMatrixToPoint(Oe(o,!1),r,a)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var a=se(Se(t,[e,r,0,1]),2);return{x:a[0],y:a[1]}}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY;var a=this.options.container;var n=Ve(a);var o=function(t){var e=0;var r=0;for(;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)e+=t.offsetLeft-t.scrollLeft,r+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{left:e,top:r}}(a);var i=function(){var t=document.documentElement;return{left:(window.pageXOffset||t.scrollLeft)-(t.clientLeft||0),top:(window.pageYOffset||t.scrollTop)-(t.clientTop||0)}}(),s=i.left,c=i.top;var v=Ee(o.left-s,o.top-c);return this._applyMatrixToPoint(Ce(Re(n,v)),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t;var r=this.storage.transform.containerMatrix,a=this.options,n=a.restrict,o=a.container;var i=n||o;return Ge(i,o,e?Ve(i,o):r)}},{key:"_applyTransformToElement",value:function(t){var e=this.storage,r=e.controls,a=e.data,n=this.options.applyTranslate;var o=a.get(t),i=o.cached,s=o.transform.matrix;var c=nt(r);if(!Et(i)&&n){var v=nt(t);var l=i.dx,u=i.dy;var h=St(s);var f=parseFloat(t.style.left||v.css("left"));var d=parseFloat(t.style.top||v.css("top"));h.left="".concat(f+l,"px"),h.top="".concat(d+u,"px"),v.css(h),c.css(h)}}},{key:"_processActions",value:function(){}},{key:"_processResize",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.revX,i=n.revY,s=n.doW,c=n.doH,v=n.data,l=n.bBox,u=l.width,h=l.height,f=this.options,d=f.proportions,p=f.scalable;var y=v.get(t);var m=y.transform,x=m.matrix,g=m.auxiliary.scale.translateMatrix,b=y.cached;var _=se((w=r,O=a,S=s||!s&&!c?(u+w)/u:(h+O)/h,[(R=d?u*S:u+w)/u,(C=d?h*S:h+O)/h,R,C]),4),k=_[0],M=_[1],E=_[2],T=_[3];var w,O,S,R,C;var V=(N=Te(k,M),Re(Re(g,N),Ce(g)));var N;var A=p?Re(V,x):(D=x,j=(P=V)[0][3],B=P[1][3],L=Ee(j,B),z=Ee(j*(o?-1:1),B*(i?-1:1)),Re(Re(z,D),Ce(L)));var P,D,j,B,L,z;return E<=Y||T<=Y||(this._updateElementView(t,bt({},St(ke(A)),{},!p&&{width:"".concat(E,"px"),height:"".concat(T,"px")})),v.set(t,bt({},y,{cached:bt({},b,{dx:r,dy:a,bBox:{width:E,height:T}})}))),{transform:A,width:E,height:T}}},{key:"_processMove",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data;var o=n.get(t);var i=o.transform,s=i.matrix,c=i.auxiliary.translate.parentMatrix,v=o.cached,l=void 0===v?{}:v;var u=se(Se(c,[r,a,0,1]),2),h=u[0],f=u[1];var d=Re(s,Ee(h,f));var p=St(ke(d));return this._updateElementView(t,p),n.set(t,bt({},o,{cached:bt({},l,{dist:{dx:ve(r),dy:ve(a),ox:ve(h),oy:ve(f)}})})),d}},{key:"_processRotate",value:function(t,e){var r=this.storage.data,a=this.options.restrict;var n=r.get(t).transform,o=n.matrix,i=n.auxiliary.rotate.translateMatrix;var s=ve(Math.cos(e),4),c=ve(Math.sin(e),4);var v=we(c,s);var l=Re(Re(Ce(i),v),i);var u=Re(o,l);var h=a?this._restrictHandler(u):{x:null,y:null},f=h.x,d=h.y;return j(f)||j(d)||this._updateElementView(t,St(ke(u))),u}},{key:"_getElementState",value:function(t,e){var r=e.revX,a=e.revY,n=e.doW,o=e.doH;var i=this.storage,s=i.handles.center,c=i.data,v=i.transformOrigin,l=this.options,u=l.container,h=l.scalable;var f=c.get(t).parent;var d=se(Pe(t,u),2),p=d[0],y=d[1];var m=t.offsetLeft,x=t.offsetTop,g=t.offsetWidth,b=t.offsetHeight;var _=Ne(t);var k=Ve(t,u);var M=Ve(f,u);var E=g/2,T=b/2;var w=se(Se(k,[E,T,0,1]),2);var O=o?0:r?-E:E,S=n?0:a?-T:T;var R=w[0]+p;var C=w[1]+y;var V=s?Ne(s):Me();var N=se(Se(Re(Ce(Oe(k)),Oe(V)),[v[0]-R,v[1]-C,0,1]),2),A=N[0],P=N[1];var D=se(Se(_,[A,P,0,1]),2),j=D[0],B=D[1];var L=function(t){var e=Math.sqrt(t[0][0]*t[0][0]+t[1][0]*t[1][0]+t[2][0]*t[2][0]),r=Math.sqrt(t[0][1]*t[0][1]+t[1][1]*t[1][1]+t[2][1]*t[2][1]),a=Math.sqrt(t[0][2]*t[0][2]+t[1][2]*t[1][2]+t[2][2]*t[2][2]);var n=Math.atan2(-t[0][3]/a,t[1][3]/a),o=Math.asin(t[3][1]/a),i=Math.atan2(-t[3][0]/r,t[0][0]/e);return 1!==t[0][1]&&-1!==t[0][1]||(o=t[n=0][1]*-Math.PI/2,i=t[0][1]*Math.atan2(t[1][1]/r,t[0][1]/r)),{rotate:{x:n,y:o,z:i},translate:{x:t[0][3]/e,y:t[1][3]/r,z:t[2][3]/a},scale:{sX:e,sY:r,sZ:a}}}(Ve(t,t.parentNode)).scale,z=L.sX,Y=L.sY;return{transform:{auxiliary:{scale:{translateMatrix:h?Ee(O,S):Ee(o?0:E,n?0:T)},translate:{parentMatrix:Ce(Oe(M))},rotate:{translateMatrix:Ee(j,B)}},scaleX:O,scaleY:S,matrix:_,ctm:k,parentMatrix:M,scX:z,scY:Y},bBox:{width:g,height:b,left:m,top:x,offset:{left:p,top:y}}}}},{key:"_getCommonState",value:function(){var t=this.elements,e=this.storage,r=e.controls,a=e.handles.center,n=e.center,o=e.wrapper,i=this.options,s=i.container,c=i.restrict;var v=se(Pe(t[0],s),2),l=v[0],u=v[1];var h=Ve(t[0],s);var f=c||s;var d=Ve(f,f.parentNode);var p=this._getBBox(),y=p.width,m=p.height;var x=se(Se(h,[y/2,m/2,0,1]),2);var g=x[0]+l;var b=x[1]+u;var _=a?Ne(a):Me();return{transform:{controlsMatrix:Ve(r,r.parentNode),containerMatrix:d,wrapperMatrix:Ve(o,s)},bBox:bt({},this._getBBox()),center:bt({},n,{x:g,y:b,matrix:_})}}},{key:"_getBBox",value:function(){var t=se(this.elements,1)[0],e=this.options,r=e.isGrouped,a=e.container;if(r)return this._getGroupBbox();var n=se(Pe(t,a),2),o=n[0],i=n[1];return{x:t.offsetLeft,y:t.offsetTop,width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}}}},{key:"_processControlsResize",value:function(){var t=this._applyTransformToHandles().center;var e=this.storage.transform.controlsMatrix;t&&(this.storage=bt({},this.storage,{cached:{transformOrigin:Se(e,t)}}))}},{key:"_processControlsMove",value:function(t){var e=t.dx,r=t.dy;var a=this.storage,n=a.transform,o=n.controlsMatrix,i=n.wrapperMatrix,s=a.center,c=a.transformOrigin;var v=Re(o,Ee(e,r));this._updateControlsView(v);var l=Oe(Ce(i));var u=se(Se(l,[e,r,0,1]),2),h=u[0],f=u[1];if(s.isShifted)this._moveCenterHandle(-h,-f,!1);else{var d=Ee(h,f);this.storage=bt({},this.storage,{cached:{transformOrigin:Se(d,c)}})}}},{key:"_processControlsRotate",value:function(){this._applyTransformToHandles()}},{key:"_moveCenterHandle",value:function(t,e,r){var a=!(2<arguments.length&&void 0!==r)||r;var n=this.storage,o=n.handles.center,i=n.center.matrix,s=n.center,c=n.transformOrigin;var v=Ee(t,e);var l=Re(i,v);nt(o).css(bt({},St(ke(l)))),this.storage=bt({},this.storage,{center:bt({},s,{isShifted:!0})},a?{cached:{transformOrigin:Se(v,c)}}:{})}},{key:"_processMoveRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data.get(t).transform,o=n.matrix,i=n.auxiliary.translate.parentMatrix;var s=se(Se(i,[r,a,0,1]),2),c=s[0],v=s[1];var l=Re(o,Ee(c,v));return this._restrictHandler(l)}},{key:"_processRotateRestrict",value:function(t,e){var r=this.storage.data.get(t).transform,a=r.matrix,n=r.auxiliary.rotate.translateMatrix;var o=ve(Math.cos(e),4),i=ve(Math.sin(e),4);var s=we(i,o);var c=Re(Re(Ce(n),s),n);var v=Re(a,c);return this._restrictHandler(v)}},{key:"_processResizeRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.revX,i=n.revY,s=n.doW,c=n.doH,v=n.data,l=n.bBox,u=l.width,h=l.height,f=this.options,d=f.proportions,p=f.scalable;var y=v.get(t).transform,m=y.matrix,x=y.auxiliary.scale.translateMatrix;var g=se((k=r,M=a,E=s||!s&&!c?(u+k)/u:(h+M)/h,[(T=d?u*E:u+k)/u,(w=d?h*E:h+M)/h,T,w]),2),b=g[0],_=g[1];var k,M,E,T,w;var O=(S=Te(b,_),Re(Re(x,S),Ce(x)));var S;var R=p?Re(O,m):(V=m,N=(C=O)[0][3],A=C[1][3],P=Ee(N,A),D=Ee(N*(o?-1:1),A*(i?-1:1)),Re(Re(D,V),Ce(P)));var C,V,N,A,P,D;return this._restrictHandler(R)}},{key:"_updateElementView",value:function(t,e){nt(t).css(e)}},{key:"_updateControlsView",value:function(t){var e=0<arguments.length&&void 0!==t?t:Me();var r=St(ke(e));nt(this.storage.controls).css(r),this.storage.cached.controlsMatrix=e}},{key:"_getVertices",value:function(t){var e=0<arguments.length&&void 0!==t?t:Me();var r=this.elements;var a=se(r=void 0===r?[]:r,1)[0],n=this.options,o=n.isGrouped,i=n.rotatable,s=n.rotatorAnchor,c=n.rotatorOffset;var v=o?this._getGroupVertices():this._getElementVertices(a,e);var l=null;if(i){var u={};var h=1;switch(s){case"n":u.x=v.tc[0],u.y=v.tc[1];break;case"s":u.x=v.bc[0],u.y=v.bc[1],h=-1;break;case"w":u.x=v.ml[0],u.y=v.ml[1],h=-1;break;case"e":default:u.x=v.mr[0],u.y=v.mr[1]}var f="n"===s||"s"===s?Math.atan2(v.bl[1]-v.tl[1],v.bl[0]-v.tl[0]):Math.atan2(v.tl[1]-v.tr[1],v.tl[0]-v.tr[0]);l=[u.x-c*h*Math.cos(f),u.y-c*h*Math.sin(f)],v.rotator=l,v.anchor=u}return v}},{key:"_getElementVertices",value:function(t,e){var r=this.options,a=r.container,n=r.isGrouped;var o=se(Pe(t,a),2),v=o[0],l=o[1];var i=t.offsetWidth,s=t.offsetHeight;var c={tl:[0,0,0,1],bl:[0,s,0,1],br:[i,s,0,1],tr:[i,0,0,1],tc:[i/2,0,0,1],ml:[0,s/2,0,1],bc:[i/2,s,0,1],mr:[i,s/2,0,1],center:[i/2,s/2,0,1]};var u=n?e:Re(Ve(t,a),e);return Le(c).reduce(function(t,e){var r=se(e,2),a=r[0],n=r[1];return[].concat(Yt(t),[[a,Se(u,n)]])},[]).reduce(function(t,e){var r=se(e,2),a=r[0],n=se(r[1],4),o=n[0],i=n[1],s=n[2],c=n[3];return t[a]=[o+v,i+l,s,c],t},{})}},{key:"_getGroupVertices",value:function(){var t=this._getGroupBbox(),e=t.x,r=t.y,a=t.width,n=t.height;var o=a/2,i=n/2;return{tl:[e,r],tr:[e+a,r],mr:[e+a,r+i],ml:[e,r+i],tc:[e+o,r],bc:[e+o,r+n],br:[e+a,r+n],bl:[e,r+n],center:[e+o,r+i]}}},{key:"_getGroupBbox",value:function(){var t=this.elements,l=this.options.container;var e=t.reduce(function(t,e){var r=se(Pe(e,l),2),i=r[0],s=r[1];var a=e.offsetWidth,n=e.offsetHeight;var o=[[0,0,0,1],[0,n,0,1],[a,n,0,1],[a,0,0,1]];var c=Ve(e,l);var v=o.reduce(function(t,e){return[].concat(Yt(t),[Se(c,e)])},[]).map(function(t){var e=se(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+i,a+s,n,o]});return[].concat(Yt(t),[v])},[]);var r=se(xt(e.reduce(function(t,e){return[].concat(Yt(t),Yt(e))},[])),2),a=se(r[0],2),n=a[0],o=a[1],i=se(r[1],2),s=i[0];return{x:n,y:s,width:o-n,height:i[1]-s}}},{key:"_getElementBBox",value:function(t){var e=this.options.container;var r=se(Pe(t,e),2),i=r[0],s=r[1];var a=t.offsetWidth,n=t.offsetHeight;var o=[[0,0,0,1],[0,n,0,1],[a,n,0,1],[a,0,0,1]];var c=Ve(t,e);var v=o.reduce(function(t,e){return[].concat(Yt(t),[Se(c,e)])},[]).map(function(t){var e=se(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+i,a+s,n,o]});var l=se(xt(v),2),u=se(l[0],2),h=u[0],f=u[1],d=se(l[1],2),p=d[0];return{x:h,y:p,width:f-h,height:d[1]-p}}},{key:"_applyTransformToHandles",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).boxMatrix,r=void 0===e?Me():e;var a=this.options,n=a.rotatable,o=a.resizable,i=a.showNormal,s=this.storage,v=s.handles,c=s.controls,l=s.center;var u=(l=void 0===l?{}:l).isShifted,h=void 0!==u&&u,f=s.transform;var d=(f=void 0===f?{}:f).controlsMatrix,p=void 0===d?Ve(c,c.parentNode):d;var y=Re(r,Ce(p));var m=this._getVertices(y),x=m.anchor,g=void 0===x?null:x,b=m.center,_=R(m,["anchor","center"]);var k=null;var M={};n&&(k=i?[[g.x,g.y],_.rotator]:null,M={rotator:_.rotator});var E=bt({te:[_.tl,_.tr],be:[_.bl,_.br],le:[_.tl,_.bl],re:[_.tr,_.br]},i&&k&&{normal:k});Be(E).forEach(function(t){var e=se(E[t],2),r=e[0],a=e[1];var n=Xe(r,a),o=n.cx,i=n.cy,s=n.length,c=n.theta;nt(v[t]).css({transform:"translate(".concat(o,"px, ").concat(i,"px) rotate(").concat(c,"deg)"),width:"".concat(s,"px")})});var T=bt({},o&&_,{},M,{},!h&&Boolean(b)&&{center:b});return Be(T).reduce(function(t,e){var r=v[e];var a=T[e];if(t[e]=a,Et(a)||Et(r))return t;var n=se(a,2),o=n[0],i=n[1];return nt(r).css({transform:"translate(".concat(o,"px, ").concat(i,"px)")}),t},{})}},{key:"setCenterPoint",value:function(){ce('"setCenterPoint" method is replaced by "setTransformOrigin" and would be removed soon'),this.setTransformOrigin.apply(this,arguments)}},{key:"setTransformOrigin",value:function(t,e){var r=0<arguments.length&&void 0!==t?t:{},a=r.x,n=r.y,o=r.dx,i=r.dy;var s=!(1<arguments.length&&void 0!==e)||e;var c=this.elements;var v=se(c=void 0===c?[]:c,1)[0],l=this.storage,u=this.storage;var h=(u=void 0===u?{}:u).wrapper,f=u.handles.center,d=u.center,p=this.options;var y=(p=void 0===p?{}:p).container;var m=j(o)&&j(i),x=j(a)&&j(n);if(f&&d&&(m||x)){var g=Re(Ve(v,y),Ce(Ve(h,h.parentNode)));var b,_;var k=se(Pe(v,y),2),M=k[0],E=k[1];if(m){var T=v.offsetHeight,w=v.offsetWidth;var O=se(Se(g,[-o+w/2,-i+T/2,0,1]),2);b=O[0],_=O[1]}else b=a,_=n;nt(f).css({transform:"translate(".concat(b+M,"px, ").concat(_+E,"px)")}),d.isShifted=s,l.transformOrigin=Se(Me(),[b,_,0,1])}}},{key:"fitControlsToSize",value:function(){var t=this.storage,e=t.controls,r=t.center;var a=(r=void 0===r?{}:r).isShifted,n=se(t.transformOrigin,2),o=n[0],i=n[1];var s=Ve(e,e.parentNode);var c=se(Se(s,[o,i,0,1]),2),v=c[0],l=c[1];var u=[{nextValues:function(){return{x:v,y:l}},pin:!0,condition:function(){return a}},{nextValues:function(){return{dx:0,dy:0}},pin:!1,condition:function(){return!a}}].find(function(t){return(0,t.condition)()}),h=u.nextValues,f=u.pin;this._updateControlsView(),this.setTransformOrigin(bt({},h()),f),this._applyTransformToHandles()}},{key:"getBoundingRect",value:function(t){var e=0<arguments.length&&void 0!==t?t:null;var r=this.elements;var a=se(r=void 0===r?[]:r,1)[0],n=this.options,o=n.scalable,i=n.restrict,s=n.container,c=this.storage,v=c.bBox,l=c.bBox;var u=(l=void 0===l?{}:l).width,h=l.height,f=c.cached;var d=(f=void 0===f?{}:f).bBox;var p=(d=void 0===d?{}:d).width,y=void 0===p?u:p,m=d.height;var x=o?v:bt({},v,{width:y,height:void 0===m?h:m});var g=i||s;return Ge(a,g,Ve(a,g,e),x)}},{key:"applyAlignment",value:function(t){var e=this;var r=this.elements,a=this.options.container;var n=this._getVertices(),o=(n.anchor,n.rotator,n.center,R(n,["anchor","rotator","center"]));var i=this._getRestrictedBBox(!0);var s=ze(o);var c=se(xt(i),2),v=se(c[0],2),l=v[0],u=v[1],h=se(c[1],2),f=h[0],d=h[1];var p=se(xt(s),2),y=se(p[0],2),m=y[0],x=y[1],g=se(p[1],2),b=g[0],_=g[1];var k=se(Se(Ce(Oe(Ve(r[0].parentNode,a))),[function(){switch(!0){case/[l]/.test(t):return l-m;case/[r]/.test(t):return u-x;case/[h]/.test(t):return(u+l)/2-(x+m)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(t):return f-b;case/[b]/.test(t):return d-_;case/[v]/.test(t):return(d+f)/2-(_+b)/2;default:return 0}}(),0,1]),2),M=k[0],E=k[1];var T=Re(Ne(r[0]),Ee(M,E));r.map(function(t){return e._updateElementView(t,St(ke(T)))}),this.fitControlsToSize()}},{key:"getDimensions",value:function(){var t=this.elements;var e=se(t=void 0===t?[]:t,1)[0];var r=this.options.isGrouped?this._getGroupVertices():this._getElementVertices(e,Me()),a=r.tl,n=r.tr,o=r.br;return{x:ve(a[0]),y:ve(a[1]),width:ve(Math.sqrt(Math.pow(a[0]-n[0],2)+Math.pow(a[1]-n[1],2))),height:ve(Math.sqrt(Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2))),rotation:ve(Math.atan2(n[1]-a[1],n[0]-a[0])*mt)}}}]),e}();var He=function(t,e,r){var a=se(t,2),n=a[0],o=a[1];var i=2<arguments.length&&void 0!==r?r:{};var s=We(["sjx-hdl","sjx-hdl-".concat(1<arguments.length&&void 0!==e?e:"handler")]);return nt(s).css(bt({transform:"translate(".concat(n,"px, ").concat(o,"px)")},i)),s};var Ie=function(t,e){var r=se(t,3),a=r[0],n=r[1],o=r[2],i=void 0===o?1:o;var s=Xe(a,n,i),c=s.cx,v=s.cy,l=s.length,u=s.theta;var h=We(["sjx-hdl-line","sjx-hdl-".concat(e)]);return nt(h).css({transform:"translate(".concat(c,"px, ").concat(v,"px) rotate(").concat(u,"deg)"),height:"".concat(i,"px"),width:"".concat(l,"px")}),h};var Xe=function(t,e,r){var a=2<arguments.length&&void 0!==r?r:1;var n=se(t,2),o=n[0],i=n[1];var s=se(e,2),c=s[0],v=s[1];var l=Math.sqrt((c-o)*(c-o)+(v-i)*(v-i));return{cx:(o+c)/2-l/2,cy:(i+v)/2-a/2,thickness:a,theta:Math.atan2(i-v,o-c)*(180/Math.PI),length:l}};var Ge=function(t,e,r,a){var n=se(Pe(t,e),2),o=n[0],i=n[1];var s=a||{width:t.offsetWidth,height:t.offsetHeight,offset:{left:o,top:i}},c=s.width,v=s.height,l=s.offset;var u=(l=void 0===l?{}:l).left,h=l.top;return[[0,0,0,1],[c,0,0,1],[0,v,0,1],[c,v,0,1]].reduce(function(t,e){return[].concat(Yt(t),[Se(r,e)])},[]).map(function(t){var e=se(t,4),r=e[0],a=e[1],n=e[2],o=e[3];return[r+u,a+h,n,o]})};var We=function(t){var e=0<arguments.length&&void 0!==t?t:[];var r=document.createElement("div");return e.forEach(function(t){return wt(r,t)}),r};var Fe=/\s*,\s*|\s+/g;var qe=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g","foreignobject","use"];function Ze(t,e){var r=1<arguments.length&&void 0!==e?e:[];var a=document.createElementNS("http://www.w3.org/2000/svg",t);return r.forEach(function(t){return wt(a,t)}),a}function Qe(t){var r=[];return nr(t)?u.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==qe.indexOf(e)&&("g"===e&&r.push.apply(r,Yt(Qe(t))),r.push(t))}}):r.push(t),r}function Ue(){return Ze("svg").createSVGMatrix()}function $e(t,e){var r=Ue();return r.e=t,r.f=e,r}function Je(t,e){var r=Ue();return r.a=e,r.b=t,r.c=-t,r.d=e,r}function Ke(t,e){var r=Ue();return r.a=t,r.d=e,r}function tr(t,e){return(e.getScreenCTM&&e.getScreenCTM()||Ue()).inverse().multiply(t.getScreenCTM()||Ue())}function er(t){var e=t.a,r=t.b,a=t.c,n=t.d,o=t.e,i=t.f;return"matrix(".concat(e,",").concat(r,",").concat(a,",").concat(n,",").concat(o,",").concat(i,")")}function rr(t,e,r){return function(t,e){var r=Ze("svg").createSVGPoint();return r.x=t,r.y=e,r}(e,r).matrixTransform(t)}function ar(t){var e=Ue();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}var nr=function(t){return"g"===t.tagName.toLowerCase()};function or(t){return(0<arguments.length&&void 0!==t?t:"").replace(/[\n\r]/g,"").replace(/([^e])-/g,"$1 -").replace(/ +/g," ").replace(/(\d*\.)(\d+)(?=\.)/g,"$1$2 ")}function ir(t){return or(t).trim().split(Fe).reduce(function(t,e,r,a){return r%2==0&&t.push(a.slice(r,r+2)),t},[])}var sr=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi;function cr(t){var c=sr.lastIndex=0;var v=[];function e(){var t=se(c,3),r=t[1],e=t[2];var a=r.toUpperCase();var n=r!==a;var o=or(e).trim().split(Fe).map(function(t){if(!isNaN(t))return Number(t)});var i=!1;var s="M"===a;(function(r,a){return Array.from(new Array(Math.ceil(r.length/a)),function(t,e){return r.slice(e*a,e*a+a)})})(o,function(t){return[{size:2,condition:["M","m","L","l","T","t"].includes(t)},{size:1,condition:["H","h","V","v"].includes(t)},{size:6,condition:["C","c"].includes(t)},{size:4,condition:["S","s","Q","q"].includes(t)},{size:7,condition:["A","a"].includes(t)},{size:1,condition:!0}].find(function(t){return!!t.condition})}(r).size).map(function(t){var e=i&&s;return i=i||s,v.push({relative:n,key:e?"L":a,cmd:e?n?"l":"L":r,values:t})})}for(;c=sr.exec(t);)e();return lr(vr(v))}var vr=function(t){var jt=null,Bt=null,Lt=null,zt=null;return t.reduce(function(t,e){var r=e.cmd,a=e.values;var n;switch(r){case"M":var o=se(a,2),i=o[0],s=o[1];n={key:"M",values:[i,s]},jt=Lt=i,Bt=zt=s;break;case"m":var c=se(a,2),v=c[0],l=c[1];var u=jt+v;var h=Bt+l;n={key:"M",values:[u,h]},jt=Lt=u,Bt=zt=h;break;case"L":var f=se(a,2),d=f[0],p=f[1];n={key:"L",values:[d,p]},jt=d,Bt=p;break;case"l":var y=se(a,2),m=y[0],x=y[1];var g=jt+m;var b=Bt+x;n={key:"L",values:[g,b]},jt=g,Bt=b;break;case"C":var _=se(a,6),k=_[0],M=_[1],E=_[2],T=_[3],w=_[4],O=_[5];n={key:"C",values:[k,M,E,T,w,O]},jt=w,Bt=O;break;case"c":var S=se(a,6),R=S[0],C=S[1],V=S[2],N=S[3],A=S[4],P=S[5];var D=[jt+R,Bt+C,jt+V,Bt+N,jt+A,Bt+P];n={key:"C",values:[].concat(D)},jt=D[4],Bt=D[5];break;case"Q":var j=se(a,4),B=j[0],L=j[1],z=j[2],Y=j[3];n={key:"Q",values:[B,L,z,Y]},jt=z,Bt=Y;break;case"q":var H=se(a,4),I=H[0],X=H[1],G=H[2],W=H[3];var F=[jt+I,Bt+X,jt+G,Bt+W];t.push({key:"Q",values:[].concat(F)}),jt=F[2],Bt=F[3];break;case"A":var q=se(a,7),Z=q[0],Q=q[1],U=q[2],$=q[3],J=q[4],K=q[5],tt=q[6];n={key:"A",values:[Z,Q,U,$,J,K,tt]},jt=K,Bt=tt;break;case"a":var et=se(a,7),rt=et[0],at=et[1],nt=et[2],ot=et[3],it=et[4],st=et[5],ct=et[6];var vt=jt+st;var lt=Bt+ct;n={key:"A",values:[rt,at,nt,ot,it,vt,lt]},jt=vt,Bt=lt;break;case"H":var ut=se(a,1)[0];n={key:"H",values:[ut]},jt=ut;break;case"h":var ht=se(a,1)[0];var ft=jt+ht;n={key:"H",values:[ft]},jt=ft;break;case"V":var dt=se(a,1)[0];n={key:"V",values:[dt]},Bt=dt;break;case"v":var pt=se(a,1)[0];var yt=Bt+pt;n={key:"V",values:[yt]},Bt=yt;break;case"S":var mt=se(a,4),xt=mt[0],gt=mt[1],bt=mt[2],_t=mt[3];n={key:"S",values:[xt,gt,bt,_t]},jt=bt,Bt=_t;break;case"s":var kt=se(a,4),Mt=kt[0],Et=kt[1],Tt=kt[2],wt=kt[3];var Ot=[jt+Mt,Bt+Et,jt+Tt,Bt+wt];n={key:"S",values:[].concat(Ot)},jt=Ot[2],Bt=Ot[3];break;case"T":var St=se(a,2),Rt=St[0],Ct=St[1];n={key:"T",values:[Rt,Ct]},jt=Rt,Bt=Ct;break;case"t":var Vt=se(a,2),Nt=Vt[0],At=Vt[1];var Pt=jt+Nt;var Dt=Bt+At;n={key:"T",values:[Pt,Dt]},jt=Pt,Bt=Dt;break;case"Z":case"z":n={key:"Z",values:[]},jt=Lt,Bt=zt}return[].concat(Yt(t),[n])},[])};var lr=function(t){var W=null;var F=null;var q=null;var Z=null;var Q=null;var U=null;var $=null;return t.reduce(function(t,e){var r=e.key,a=e.values;var n;switch(r){case"M":var o=se(a,2),i=o[0],s=o[1];n=[{key:"M",values:[i,s]}],Z=U=i,Q=$=s;break;case"C":var c=se(a,6),v=c[0],l=c[1],u=c[2],h=c[3],f=c[4],d=c[5];n=[{key:"C",values:[v,l,u,h,f,d]}],F=u,q=h,Z=f,Q=d;break;case"L":var p=se(a,2),y=p[0],m=p[1];n=[{key:"L",values:[y,m]}],Z=y,Q=m;break;case"H":var x=se(a,1)[0];n=[{key:"L",values:[x,Q]}],Z=x;break;case"V":var g=se(a,1)[0];n=[{key:"L",values:[Z,g]}],Q=g;break;case"S":var b=se(a,4),_=b[0],k=b[1],M=b[2],E=b[3];var T,w;w="C"===W||"S"===W?(T=Z+(Z-F),Q+(Q-q)):(T=Z,Q),n=[{key:"C",values:[T,w,_,k,M,E]}],F=_,q=k,Z=M,Q=E;break;case"T":var O=se(a,2),S=O[0],R=O[1];var C,V;V="Q"===W||"T"===W?(C=Z+(Z-F),Q+(Q-q)):(C=Z,Q),n=[{key:"C",values:[Z+2*(C-Z)/3,Q+2*(V-Q)/3,S+2*(C-S)/3,R+2*(V-R)/3,S,R]}],F=C,q=V,Z=S,Q=R;break;case"Q":var N=se(a,4),A=N[0],P=N[1],D=N[2],j=N[3];n=[{key:"C",values:[Z+2*(A-Z)/3,Q+2*(P-Q)/3,D+2*(A-D)/3,j+2*(P-j)/3,D,j]}],F=A,q=P,Z=D,Q=j;break;case"A":var B=se(a,7),L=B[0],z=B[1],Y=B[2],H=B[3],I=B[4],X=B[5],G=B[6];if(0===L||0===z)n=[{key:"C",values:[Z,Q,X,G,X,G]}],Z=X,Q=G;else if(Z!==X||Q!==G)n=ur(Z,Q,X,G,L,z,Y,H,I).map(function(t){return{key:"C",values:t}}),Z=X,Q=G;break;case"Z":n=[e],Z=U,Q=$}return W=r,[].concat(Yt(t),Yt(n))},[])};var ur=function t(e,r,a,n,o,i,s,c,v,l){function u(t,e,r){return{x:t*Math.cos(r)-e*Math.sin(r),y:t*Math.sin(r)+e*Math.cos(r)}}var h=(f=s,Math.PI*f/180);var f;var d=[];var p,y,m,x;if(l)p=l[0],y=l[1],m=l[2],x=l[3];else{var g=u(e,r,-h);e=g.x,r=g.y;var b=u(a,n,-h);var _=(e-(a=b.x))/2;var k=(r-(n=b.y))/2;var M=_*_/(o*o)+k*k/(i*i);1<M&&(o*=M=Math.sqrt(M),i*=M);var E=o*o;var T=i*i;var w=E*T-E*k*k-T*_*_;var O=E*k*k+T*_*_;var S=(c===v?-1:1)*Math.sqrt(Math.abs(w/O));m=S*o*k/i+(e+a)/2,x=S*-i*_/o+(r+n)/2,p=Math.asin(parseFloat(((r-x)/i).toFixed(9))),y=Math.asin(parseFloat(((n-x)/i).toFixed(9))),e<m&&(p=Math.PI-p),a<m&&(y=Math.PI-y),p<0&&(p=2*Math.PI+p),y<0&&(y=2*Math.PI+y),v&&y<p&&(p-=2*Math.PI),!v&&p<y&&(y-=2*Math.PI)}var R=y-p;if(Math.abs(R)>120*Math.PI/180){var C=y;var V=a;var N=n;var A=v&&p<y?1:-1;y=p+120*Math.PI/180*A,a=m+o*Math.cos(y),n=x+i*Math.sin(y),d=t(a,n,V,N,o,i,s,0,v,[y,C,m,x])}R=y-p;var P=Math.cos(p);var D=Math.sin(p);var j=Math.cos(y);var B=Math.sin(y);var L=Math.tan(R/4);var z=4/3*o*L;var Y=4/3*i*L;var H=[e,r];var I=[e+z*D,r-Y*P];var X=[a+z*B,n-Y*j];var G=[a,n];if(I[0]=2*H[0]-I[0],I[1]=2*H[1]-I[1],l)return[I,X,G].concat(Yt(d));d=[I,X,G].concat(Yt(d)).join().split(",");var W=[];var F=[];return d.forEach(function(t,e){e%2?F.push(u(d[e-1],d[e],h).y):F.push(u(d[e],d[e+1],h).x),6===F.length&&(W.push(F),F=[])}),W};var hr=H.E_DRAG,fr=H.E_RESIZE,dr=H.E_ROTATE;var pr=I,yr=W;var mr=Object.keys,xr=Object.entries,gr=Object.values;var br=function(){o(e,be);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"_init",value:function(t){var e=this;var r=this.options,a=r.container,n=r.controlsContainer,o=r.resizable,i=r.rotatable,s=r.showNormal,c=r.transformOrigin,v=r.restrict;var l=Ze("g",["sjx-svg-wrapper"]);var u=Ze("g",["sjx-svg-controls"]);var h=this._getVertices(),f=h.rotator,d=void 0===f?null:f,p=h.anchor,y=void 0===p?null:p,m=R(h,["rotator","anchor"]);var x={};var g={};var b=Array.isArray(c)?rr(Ue(),c[0],c[1]):m.center;if(i){var _=s?wr([y,d],S,"normal"):null;s&&u.appendChild(_);var k=null;c&&((k=Ze("line",["sjx-hidden"])).x1.baseVal.value=m.center.x,k.y1.baseVal.value=m.center.y,k.x2.baseVal.value=b.x,k.y2.baseVal.value=b.y,Er(k,"#fe3232"),k.setAttribute("opacity",.5),u.appendChild(k)),g=bt({},g,{normal:_,radius:k})}var M=o?{tl:m.tl,tr:m.tr,br:m.br,bl:m.bl,tc:m.tc,bc:m.bc,ml:m.ml,mr:m.mr}:{};var E={te:[m.tl,m.tr],be:[m.bl,m.br],le:[m.tl,m.bl],re:[m.tr,m.br]};mr(E).forEach(function(t){var e=E[t];Et(e)||(x[t]=wr(e,S,t),u.appendChild(x[t]))});var T=bt({},M,{rotator:d,center:c&&i?b:void 0});mr(T).forEach(function(t){var e=T[t];if(!Et(e)){var r=e.x,a=e.y;var n="center"===t?"#fe3232":S;x[t]=Mr(r,a,n,t),u.appendChild(x[t])}}),l.appendChild(u),n.appendChild(l);var w=new WeakMap;t.map(function(t){return w.set(t,{parent:t.parentNode,transform:{ctm:tr(t,a)},bBox:t.getBBox(),__data__:new WeakMap,cached:{}})});var O=v||a;this.storage={wrapper:l,controls:u,handles:bt({},x,{},g),data:w,center:{isShifted:Array.isArray(c)},transformOrigin:b,transform:{containerMatrix:tr(O,O.parentNode)},cached:{}},[].concat(Yt(t),[u]).map(function(t){return nt(t).on(pr,e._onMouseDown).on(yr,e._onTouchStart)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY;var a=this.options.container;return this._applyMatrixToPoint(a.getScreenCTM().inverse(),e,r)}},{key:"_getRestrictedBBox",value:function(t){var e=0<arguments.length&&void 0!==t&&t;var r=this.storage;var a=(r=void 0===r?{}:r).transform;var n=(a=void 0===a?{}:a).containerMatrix,o=this.options;var i=(o=void 0===o?{}:o).container;var s=o.restrict||i;return Or(s,e?tr(s,i):n)}},{key:"_pointToTransform",value:function(t){var e=t.x,r=t.y;var a=t.matrix.inverse();return a.e=a.f=0,this._applyMatrixToPoint(a,e,r)}},{key:"_pointToControls",value:function(t,e){var r=t.x,a=t.y;var n=(1<arguments.length&&void 0!==e?e:this.storage.transform).controlsMatrix.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,r,a)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var a=Ze("svg").createSVGPoint();return a.x=e,a.y=r,a.matrixTransform(t)}},{key:"_applyTransformToElement",value:function(a,t){var e=this.storage;var r=(e=void 0===e?{}:e).data,n=e.bBox,o=this.options;var i=(o=void 0===o?{}:o).isGrouped,s=o.scalable,c=o.applyTranslate;var v=r.get(a),l=v.cached,u=void 0===l?{}:l,h=R(v,["cached"]);var f=h.transform,d=f.matrix,p=f.parentMatrix,y=h.__data__;var m=u.scaleX,x=u.scaleY,g=u.dist;var b=(g=void 0===g?{}:g).dx,_=g.dy,k=g.ox,M=g.oy,E=u.transformMatrix;if(t===hr){if(!c||!b&&!_)return;var T=$e(k,M);var w=T.multiply(d).multiply(T.inverse());this._updateElementView(["transform",w]),nr(a)?Qe(a).map(function(t){var e=$e(b,_);var r=e.multiply(tr(t,t.parentNode)).multiply(e.inverse());if(function(t){var e=t.a,r=t.b,a=t.c,n=t.d,o=t.e,i=t.f;return 1===e&&0===r&&0===a&&1===n&&0===o&&0===i}(r)||t.setAttribute("transform",er(r)),!nr(t)){var a=p.inverse();a.e=a.f=0;var n=rr(a,k,M),o=n.x,i=n.y;_r(t,{x:o,y:i})}}):_r(a,{x:k,y:M})}if(t===fr){if(!E)return;if(!s)if(nr(a)||i)Qe(a).forEach(function(t){if(!nr(t)){var e=tr(t,i?a.parentNode:a);var r=e.inverse().multiply(E).multiply(e);kr(t,{dx:b,dy:_,scaleX:m,scaleY:x,localCTM:r,transformMatrix:E,bBox:n,__data__:y,isGrouped:i})}});else kr(a,{dx:b,dy:_,scaleX:m,scaleY:x,localCTM:E,transformMatrix:E,bBox:n,__data__:y,isGrouped:i})}r.set(a,bt({},h))}},{key:"_processActions",value:function(t){var e=this.storage,r=e.transform.controlsMatrix,a=e.center;var n=(a=void 0===a?{}:a).isShifted;if(this.options.isGrouped&&t===dr){this._applyTransformToHandles();var o=rr(r,0,0),i=o.x,s=o.y;n&&this._moveCenterHandle(i,s),this._updateControlsView(),n||this.setTransformOrigin({dx:0,dy:0},!1)}}},{key:"_processResize",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.revX,i=n.revY,s=n.doW,c=n.doH,v=n.data,l=n.bBox,u=l.x,h=l.y,f=l.width,d=l.height,p=this.options,y=p.isGrouped,m=p.proportions,x=p.scalable;var g=v.get(t);var b=g.transform,_=b.matrix,k=b.auxiliary.scale.translateMatrix,M=g.cached,E=void 0===M?{}:M;var T=se((C=r,V=a,N=Math.max(1,f),A=Math.max(1,d),P=s||!s&&!c?(N+C)/N:(A+V)/A,[(D=m?N*P:N+C)/N,(j=m?A*P:A+V)/A,D,j]),4),w=T[0],O=T[1],S=T[2],R=T[3];var C,V,N,A,P,D,j;var B=(L=Ke(w,O),k.multiply(L).multiply(k.inverse()));var L;var z=u-(S-f)*(c?.5:o?1:0),Y=h-(R-d)*(s?.5:i?1:0);var H=y?B.multiply(_):_.multiply(B);return x&&this._updateElementView(t,["transform",H]),v.set(t,bt({},g,{cached:bt({},E,{scaleX:w,scaleY:O,transformMatrix:B,resultMatrix:H})})),this._applyTransformToElement(t,fr),{x:z,y:Y,width:S,height:R,transform:H}}},{key:"_processMove",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data;var o=n.get(t);var i=o.transform,s=i.matrix,c=i.auxiliary.translate,v=c.translateMatrix,l=c.parentMatrix,u=o.cached;l.e=l.f=0;var h=rr(l,r,a),f=h.x,d=h.y;n.set(t,bt({},o,{cached:bt({},u,{dist:{dx:ve(r),dy:ve(a),ox:ve(f),oy:ve(d)}})})),v.e=f,v.f=d;var p=v.multiply(s);return this._updateElementView(t,["transform",p]),p}},{key:"_processRotate",value:function(t,e){var r=this.storage;var a=(r=void 0===r?{}:r).data.get(t).transform,n=a.matrix,o=a.parentMatrix,i=a.auxiliary.rotate.translateMatrix;var s=ve(Math.cos(e)),c=ve(Math.sin(e));var v=Je(c,s);o.e=o.f=0;var l=o.inverse().multiply(v).multiply(o);var u=i.multiply(l).multiply(i.inverse()).multiply(n);return this._updateElementView(t,["transform",u]),u}},{key:"_getElementState",value:function(e,t){var r=t.revX,a=t.revY,n=t.doW,o=t.doH;var i=this.options,s=i.container,c=i.isGrouped,v=this.storage,l=v.data,u=v.controls,h=v.handles.center,f=v.transformOrigin,d=f.x,p=f.y;var y=l.get(e);var m=y.__data__;Tr(e,y,s),m["delete"](e),Qe(e).forEach(function(t){m["delete"](t),Tr(t,y,e,c)});var x=this._getBBox();var g=x.x,b=x.y,_=x.width,k=x.height;var M=tr(e,e.parentNode),E=tr(e,s),T=tr(e.parentNode,s);var w=T.inverse();var O=g+_*(o?.5:r?1:0),S=b+k*(n?.5:a?1:0);var R=tr(u,s);var C=g+_/2,V=b+k/2;var N=rr(R,d,p),A=N.x,P=N.y;var D=h?rr(w,A,P):rr(c?w:M,C,V),j=D.x,B=D.y;var L=h?rr(c?w:E.inverse(),A,P):rr(c?w:Ue(),O,S),z=L.x,Y=L.y;return{transform:{auxiliary:{scale:{scaleMatrix:Ue(),translateMatrix:$e(z,Y)},translate:{parentMatrix:w,translateMatrix:Ue()},rotate:{translateMatrix:$e(j,B)}},matrix:M,ctm:E,parentMatrix:T,scX:Math.sqrt(E.a*E.a+E.b*E.b),scY:Math.sqrt(E.c*E.c+E.d*E.d)},bBox:x}}},{key:"_getCommonState",value:function(){var t=this.elements,e=this.options,r=e.isGrouped,a=e.container,n=e.restrict,o=this.storage,i=o.controls,s=o.handles.center;var c=this._getBBox();var v=c.x,l=c.y;var u=v+c.width/2,h=l+c.height/2;var f=tr(i,a);var d=s?s.cx.baseVal.value:u;var p=s?s.cy.baseVal.value:h;var y=rr(f,d,p),m=y.x,x=y.y;var g=rr(r?Ue():tr(t[0],a),u,h),b=g.x,_=g.y;var k=n||a;var M=tr(k,k.parentNode);var E=bt({},this.storage.center||{},{x:s?m:b,y:s?x:_,hx:s?s.cx.baseVal.value:null,hy:s?s.cy.baseVal.value:null});return{transform:{containerMatrix:M,controlsMatrix:tr(i,i.parentNode),controlsTranslateMatrix:Ue(),wrapperOriginMatrix:$e(E.x,E.y)},bBox:c,center:E}}},{key:"_getVertices",value:function(t){var e=0<arguments.length&&void 0!==t?t:Ue();var r=this.elements,a=this.options,n=a.isGrouped,o=a.rotatable,i=a.rotatorAnchor,s=a.rotatorOffset,c=a.container;var v=this._getBBox(),l=v.x,u=v.y,h=v.width,f=v.height;var d=h/2,p=f/2;var y={tl:[l,u],tr:[l+h,u],mr:[l+h,u+p],ml:[l,u+p],tc:[l+d,u],bc:[l+d,u+f],br:[l+h,u+f],bl:[l,u+f],center:[l+d,u+p]};var m=n?e:e.multiply(tr(r[0],c));var x=xr(y).reduce(function(t,e){var r=se(e,2),a=r[0],n=se(r[1],2),o=n[0],i=n[1];return t[a]=rr(m,o,i),t},{});if(o){var g={};var b=1;switch(i){case"n":var _=x.tc,k=_.x,M=_.y;g.x=k,g.y=M;break;case"s":var E=x.bc,T=E.x,w=E.y;g.x=T,g.y=w,b=-1;break;case"w":var O=x.ml,S=O.x,R=O.y;g.x=S,g.y=R,b=-1;break;case"e":default:var C=x.mr,V=C.x,N=C.y;g.x=V,g.y=N}var A="n"===i||"s"===i?Math.atan2(x.bl.y-x.tl.y,x.bl.x-x.tl.x):Math.atan2(x.tl.y-x.tr.y,x.tl.x-x.tr.x);var P=s*b;var D={x:g.x-P*Math.cos(A),y:g.y-P*Math.sin(A)};x.rotator=D,x.anchor=g}return x}},{key:"_getBBox",value:function(){var t=this.elements,e=this.options,a=e.container;if(e.isGrouped){var r=t.reduce(function(t,e){var r=tr(e,a);return[].concat(Yt(t),Yt(Or(e,r)))},[]);var n=se(xt(r),2),o=se(n[0],2),i=o[0],s=o[1],c=se(n[1],2),v=c[0];return{x:i,y:v,width:s-i,height:c[1]-v}}return t[0].getBBox()}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,a=r.handles,n=a.center,o=a.radius,i=r.center,s=r.transform;var c=(s=void 0===s?{}:s).controlsMatrix,v=void 0===c?Ue():c,l=r.transformOrigin;var u=(l=void 0===l?{}:l).x,h=l.y,f=r.cached;if(!Et(n)){var d=u+t,p=h+e;n.cx.baseVal.value=d,n.cy.baseVal.value=p,o.x2.baseVal.value=d,o.y2.baseVal.value=p,this.storage=bt({},this.storage,{center:bt({},i,{isShifted:!0},rr(v.inverse(),d,p)),cached:bt({},f,{transformOrigin:rr(Ue(),d,p)})})}}},{key:"_processMoveRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage.data.get(t).transform,o=n.matrix,i=n.auxiliary.translate.parentMatrix;i.e=i.f=0;var s=rr(i,r,a),c=s.x,v=s.y;var l=$e(c,v).multiply(o);return this._restrictHandler(t,l)}},{key:"_processRotateRestrict",value:function(t,e){var r=this.storage;var a=(r=void 0===r?{}:r).data.get(t).transform,n=a.matrix,o=a.parentMatrix,i=a.auxiliary.rotate.translateMatrix;var s=ve(Math.cos(e)),c=ve(Math.sin(e));var v=Je(c,s);o.e=o.f=0;var l=o.inverse().multiply(v).multiply(o);var u=i.multiply(l).multiply(i.inverse()).multiply(n);return this._restrictHandler(t,u)}},{key:"_processResizeRestrict",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage,o=n.doW,i=n.doH,s=n.data,c=n.bBox,v=c.width,l=c.height,u=this.options.proportions;var h=s.get(t).transform,f=h.matrix,d=h.auxiliary.scale.translateMatrix;var p=f.multiply(function(t,e){var r=Ke(t,e);return d.multiply(r).multiply(d.inverse())}.apply(void 0,Yt((y=r,m=a,x=Math.max(1,v),g=Math.max(1,l),b=o||!o&&!i?(x+y)/x:(g+m)/g,[(_=u?x*b:x+y)/x,(k=u?g*b:g+m)/g,_,k]))));var y,m,x,g,b,_,k;return this._restrictHandler(t,p)}},{key:"_processControlsResize",value:function(){var t=this.storage;var e=(t=void 0===t?{}:t).transform.controlsMatrix;this._applyTransformToHandles({boxMatrix:e.inverse()})}},{key:"_processControlsMove",value:function(t){var e=t.dx,r=t.dy;var a=this.storage;var n=(a=void 0===a?{}:a).transform,o=n.controlsMatrix,i=n.controlsTranslateMatrix,s=a.center;i.e=e,i.f=r;var c=i.multiply(o);if(this._updateControlsView(c),s.isShifted){var v=o.inverse();v.e=v.f=0;var l=rr(v,e,r),u=l.x,h=l.y;this._moveCenterHandle(-u,-h)}}},{key:"_processControlsRotate",value:function(t){var e=t.radians;var r=this.storage;var a=(r=void 0===r?{}:r).transform,n=a.controlsMatrix,o=a.wrapperOriginMatrix;var i=ve(Math.cos(e)),s=ve(Math.sin(e));var c=Je(s,i);var v=o.multiply(c).multiply(o.inverse()).multiply(n);this._updateControlsView(v)}},{key:"_updateElementView",value:function(t,e){var r=se(e,2),a=r[0],n=r[1];"transform"===a&&t.setAttribute(a,er(n))}},{key:"_updateControlsView",value:function(t){var e=0<arguments.length&&void 0!==t?t:Ue();this.storage.controls.setAttribute("transform",er(e)),this.storage.cached.controlsMatrix=e}},{key:"_applyTransformToHandles",value:function(t){var e=(0<arguments.length&&void 0!==t?t:{}).boxMatrix,r=void 0===e?Ue():e;var a=this.options.rotatable,n=this.storage,o=n.handles,i=n.center.isShifted;var s=this._getVertices(r),c=s.anchor,v=void 0===c?null:c,l=s.center,u=R(s,["anchor","center"]);var h={te:[u.tl,u.tr],be:[u.bl,u.br],le:[u.tl,u.bl],re:[u.tr,u.br]};if(a){var f=o.normal,d=o.radius;j(f)&&(f.x1.baseVal.value=v.x,f.y1.baseVal.value=v.y,f.x2.baseVal.value=u.rotator.x,f.y2.baseVal.value=u.rotator.y),j(d)&&(d.x1.baseVal.value=l.x,d.y1.baseVal.value=l.y,i||(d.x2.baseVal.value=l.x,d.y2.baseVal.value=l.y))}mr(h).forEach(function(t){var n=o[t];var e=se(h[t],2),r=e[0],a=e[1];Et(r)||Et(n)||xr({x1:r.x,y1:r.y,x2:a.x,y2:a.y}).map(function(t){var e=se(t,2),r=e[0],a=e[1];return n.setAttribute(r,a)})});var p=bt({},u,{},!i&&Boolean(l)&&{center:l});return mr(p).reduce(function(t,e){var r=o[e];var a=p[e];return t[e]=a,Et(a)||Et(r)||(r.setAttribute("cx",a.x),r.setAttribute("cy",a.y)),t},{})}},{key:"setCenterPoint",value:function(){ce('"setCenterPoint" method is replaced by "setTransformOrigin" and would be removed soon'),this.setTransformOrigin.apply(this,arguments)}},{key:"setTransformOrigin",value:function(t,e){var r=0<arguments.length&&void 0!==t?t:{},a=r.x,n=r.y,o=r.dx,i=r.dy;var s=!(1<arguments.length&&void 0!==e)||e;var c=this.elements,v=this.storage,l=this.storage;var u=(l=void 0===l?{}:l).controls,h=l.handles;var f=(h=void 0===h?{}:h).center,d=h.radius,p=l.center,y=this.options,m=y.container,x=y.isGrouped;var g=j(o)&&j(i),b=j(a)&&j(n);if(p&&f&&d&&(g||b)){var _=tr(u,u.parentNode).inverse();var k=x?_:_.multiply(tr(c[0],m));var M,E;if(g){var T=this._getBBox(),w=T.x,O=T.y,S=T.width,R=T.height;var C=rr(k,w+S/2+o,O+R/2+i);M=C.x,E=C.y}else M=a,E=n;f.cx.baseVal.value=M,f.cy.baseVal.value=E,d.x2.baseVal.value=M,d.y2.baseVal.value=E,p.isShifted=s,v.transformOrigin=rr(Ue(),M,E)}}},{key:"fitControlsToSize",value:function(){var t=this.storage,e=t.controls,r=t.center;var a=(r=void 0===r?{}:r).isShifted,n=t.transformOrigin;var o=(n=void 0===n?{}:n).x,i=n.y;var s=tr(e,e.parentNode);var c=rr(s,o,i),v=c.x,l=c.y;var u=[{nextValues:function(){return{x:v,y:l}},pin:!0,condition:function(){return a}},{nextValues:function(){return{dx:0,dy:0}},pin:!1,condition:function(){return!a}}].find(function(t){return(0,t.condition)()}),h=u.nextValues,f=u.pin;this._updateControlsView(),this.setTransformOrigin(bt({},h()),f),this._applyTransformToHandles()}},{key:"getBoundingRect",value:function(t,e){var r=1<arguments.length&&void 0!==e?e:null;var a=this.options;var n=(a=void 0===a?{}:a).restrict,o=a.container;var i=n||o;var s=r?tr(t.parentNode,i).multiply(r):tr(t,i);return Or(t,s,t.getBBox())}},{key:"applyAlignment",value:function(i){var s=this;var t=this.elements,c=this.options.container;var e=this._getVertices(),r=(e.anchor,e.rotator,e.center,R(e,["anchor","rotator","center"]));var a=this._getRestrictedBBox(!0);var n=gr(r).map(function(t){return[t.x,t.y]});var o=se(xt(a),2),v=se(o[0],2),l=v[0],u=v[1],h=se(o[1],2),f=h[0],d=h[1];var p=se(xt(n),2),y=se(p[0],2),m=y[0],x=y[1],g=se(p[1],2),b=g[0],_=g[1];t.map(function(t){var e=tr(t.parentNode,c);e.e=e.f=0;var r=rr(e.inverse(),function(){switch(!0){case/[l]/.test(i):return l-m;case/[r]/.test(i):return u-x;case/[h]/.test(i):return(u+l)/2-(x+m)/2;default:return 0}}(),function(){switch(!0){case/[t]/.test(i):return f-b;case/[b]/.test(i):return d-_;case/[v]/.test(i):return(d+f)/2-(_+b)/2;default:return 0}}()),a=r.x,n=r.y;var o=$e(a,n).multiply(tr(t,t.parentNode));s._updateElementView(t,["transform",o])}),this.fitControlsToSize()}},{key:"getDimensions",value:function(){var t=this.elements,e=this.options,r=e.isGrouped,a=e.container;var n=this._getBBox(),o=n.x,i=n.y,s=n.width,c=n.height;var v={tl:[o,i],tr:[o+s,i],bl:[o,i+c],br:[o+s,i+c]};var l=r?Ue():tr(t[0],a);var u=xr(v).reduce(function(t,e){var r=se(e,2),a=r[0],n=se(r[1],2),o=n[0],i=n[1];return t[a]=rr(l,o,i),t},{}),h=u.tl,f=u.br,d=u.tr;return{x:ve(h.x),y:ve(h.y),width:ve(Math.sqrt(Math.pow(h.x-d.x,2)+Math.pow(h.y-d.y,2))),height:ve(Math.sqrt(Math.pow(d.x-f.x,2)+Math.pow(d.y-f.y,2))),rotation:ve(Math.atan2(d.y-h.y,d.x-h.x)*mt)}}}]),e}();var _r=function(e,t){var r=t.x,a=t.y;var n=[];switch(e.tagName.toLowerCase()){case"text":var o=j(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r;var i=j(e.y.baseVal[0])?e.y.baseVal[0].value+a:(Number(e.getAttribute("y"))||0)+a;n.push(["x",o],["y",i]);break;case"foreignobject":case"use":case"image":case"rect":var s=j(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r;var c=j(e.y.baseVal.value)?e.y.baseVal.value+a:(Number(e.getAttribute("y"))||0)+a;n.push(["x",s],["y",c]);break;case"circle":case"ellipse":var v=e.cx.baseVal.value+r,l=e.cy.baseVal.value+a;n.push(["cx",v],["cy",l]);break;case"line":var u=e.x1.baseVal.value+r,h=e.y1.baseVal.value+a,f=e.x2.baseVal.value+r,d=e.y2.baseVal.value+a;n.push(["x1",u],["y1",h],["x2",f],["y2",d]);break;case"polygon":case"polyline":var p=ir(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+a,t.join(" ")}).join(" ");n.push(["points",p]);break;case"path":var y=e.getAttribute("d");n.push(["d",function(t){var e=t.path,r=t.dx,a=t.dy;try{var n=cr(e);var o="";var i=" ";var s=!0;for(var c=0,v=n.length;c<v;c++){var l=n[c];var u=l.values,h=l.key,f=l.relative;var d=[];switch(h){case"M":for(var p=0,y=u.length;p<y;p+=2){var m=se(u.slice(p,p+2),2),x=m[0],g=m[1];f&&!s||(x+=r,g+=a),d.push(x,g),s=!1}break;case"A":for(var b=0,_=u.length;b<_;b+=7){var k=u.slice(b,b+7);f||(k[5]+=r,k[6]+=a),d.push.apply(d,Yt(k))}break;case"C":for(var M=0,E=u.length;M<E;M+=6){var T=u.slice(M,M+6);f||(T[0]+=r,T[1]+=a,T[2]+=r,T[3]+=a,T[4]+=r,T[5]+=a),d.push.apply(d,Yt(T))}break;case"H":for(var w=0,O=u.length;w<O;w+=1){var S=u.slice(w,w+1);f||(S[0]+=r),d.push(S[0])}break;case"V":for(var R=0,C=u.length;R<C;R+=1){var V=u.slice(R,R+1);f||(V[0]+=a),d.push(V[0])}break;case"L":case"T":for(var N=0,A=u.length;N<A;N+=2){var P=se(u.slice(N,N+2),2),D=P[0],j=P[1];f||(D+=r,j+=a),d.push(D,j)}break;case"Q":case"S":for(var B=0,L=u.length;B<L;B+=4){var z=se(u.slice(B,B+4),4),Y=z[0],H=z[1],I=z[2],X=z[3];f||(Y+=r,H+=a,I+=r,X+=a),d.push(Y,H,I,X)}break;case"Z":i=u[0]=""}o+=h+d.join(",")+i}return o}catch(t){ce("Path parsing error: "+t)}}({path:y,dx:r,dy:a})])}n.forEach(function(t){e.setAttribute(t[0],t[1])})};var kr=function(n,t){var e=t.scaleX,r=t.scaleY,o=t.localCTM,a=t.bBox,i=a.width,s=a.height,c=t.__data__,v=t.transformMatrix,l=t.isGrouped;var u=[];var h=c.get(n);switch(n.tagName.toLowerCase()){case"text":case"tspan":var f=h.x,d=h.y,p=h.textLength;var y=rr(o,f,d),m=y.x,x=y.y;u.push(["x",m+(e<0?i:0)],["y",x-(r<0?s:0)],["textLength",Math.abs(e*p)]);break;case"circle":var g=h.r,b=h.cx,_=h.cy,k=g*(Math.abs(e)+Math.abs(r))/2;var M=rr(o,b,_),E=M.x,T=M.y;u.push(["r",k],["cx",E],["cy",T]);break;case"foreignobject":case"image":case"rect":if(l){var w=h.matrix,O=h.childCTM;var S=O.inverse().multiply(v).multiply(O);var R=w.multiply(S);u.push(["transform",er(R)])}else{var C=h.width,V=h.height,N=h.x,A=h.y;var P=rr(o,N,A),D=P.x,j=P.y;var B=Math.abs(C*e),L=Math.abs(V*r);u.push(["x",D-(e<0?B:0)],["y",j-(r<0?L:0)],["width",B],["height",L])}break;case"ellipse":var z=h.rx,Y=h.ry,H=h.cx,I=h.cy;var X=rr(o,H,I),G=X.x,W=X.y;var F=Ue();F.a=e,F.d=r;var q=rr(F,z,Y),Z=q.x,Q=q.y;u.push(["rx",Math.abs(Z)],["ry",Math.abs(Q)],["cx",G],["cy",W]);break;case"line":var U=h.resX1,$=h.resY1,J=h.resX2,K=h.resY2;var tt=rr(o,U,$),et=tt.x,rt=tt.y;var at=rr(o,J,K),nt=at.x,ot=at.y;u.push(["x1",et],["y1",rt],["x2",nt],["y2",ot]);break;case"polygon":case"polyline":var it=h.points;var st=ir(it).map(function(t){var e=rr(o,Number(t[0]),Number(t[1])),r=e.x,a=e.y;return t[0]=ve(r),t[1]=ve(a),t.join(" ")}).join(" ");u.push(["points",st]);break;case"path":var ct=h.path;u.push(["d",function(t){var e=t.path,r=t.localCTM;try{var a=cr(e);var n="";var o=" ";var i=[];var s=!0;for(var c=0,v=a.length;c<v;c++){var l=a[c];var u=l.values,h=l.key,f=l.relative,d=void 0!==f&&f;switch(h){case"A":var p=[];var y=ar(r);d&&(y.e=y.f=0);for(var m=0,x=u.length;m<x;m+=7){var g=se(u.slice(m,m+7),7),b=g[0],_=g[1],k=g[2],M=g[3],E=g[4],T=g[5],w=g[6];var O=rr(y,T,w),S=O.x,R=O.y;p.push(ve(S),ve(R)),y.e=y.f=0;var C=rr(y,b,_),V=C.x,N=C.y;p.unshift(ve(V),ve(N),k,M,E)}i.push(p);break;case"C":var A=[];var P=ar(r);d&&(P.e=P.f=0);for(var D=0,j=u.length;D<j;D+=6){var B=se(u.slice(D,D+6),6),L=B[0],z=B[1],Y=B[2],H=B[3],I=B[4],X=B[5];var G=rr(P,L,z),W=G.x,F=G.y;var q=rr(P,Y,H),Z=q.x,Q=q.y;var U=rr(P,I,X),$=U.x,J=U.y;A.push(ve(W),ve(F),ve(Z),ve(Q),ve($),ve(J))}i.push(A);break;case"H":var K=[];var tt=ar(r);d&&(tt.e=tt.f=0);for(var et=0,rt=u.length;et<rt;et+=1){var at=se(u.slice(et,et+1),1)[0];var nt=rr(tt,at,0).x;K.push(ve(nt))}i.push(K);break;case"V":var ot=[];var it=ar(r);d&&(it.e=it.f=0);for(var st=0,ct=u.length;st<ct;st+=1){var vt=se(u.slice(st,st+1),1)[0];var lt=rr(it,0,vt).y;ot.push(ve(lt))}i.push(ot);break;case"T":case"L":var ut=[];var ht=ar(r);d&&(ht.e=ht.f=0);for(var ft=0,dt=u.length;ft<dt;ft+=2){var pt=se(u.slice(ft,ft+2),2),yt=pt[0],mt=pt[1];var xt=rr(ht,yt,mt),gt=xt.x,bt=xt.y;ut.push(ve(gt),ve(bt))}i.push(ut);break;case"M":var _t=[];var kt=ar(r);d&&!s&&(kt.e=kt.f=0);for(var Mt=0,Et=u.length;Mt<Et;Mt+=2){var Tt=se(u.slice(Mt,Mt+2),2),wt=Tt[0],Ot=Tt[1];var St=rr(kt,wt,Ot),Rt=St.x,Ct=St.y;_t.push(ve(Rt),ve(Ct)),s=!1}i.push(_t);break;case"Q":var Vt=[];var Nt=ar(r);d&&(Nt.e=Nt.f=0);for(var At=0,Pt=u.length;At<Pt;At+=4){var Dt=se(u.slice(At,At+4),4),jt=Dt[0],Bt=Dt[1],Lt=Dt[2],zt=Dt[3];var Yt=rr(Nt,jt,Bt),Ht=Yt.x,It=Yt.y;var Xt=rr(Nt,Lt,zt),Gt=Xt.x,Wt=Xt.y;Vt.push(ve(Ht),ve(It),ve(Gt),ve(Wt))}i.push(Vt);break;case"S":var Ft=[];var qt=ar(r);d&&(qt.e=qt.f=0);for(var Zt=0,Qt=u.length;Zt<Qt;Zt+=4){var Ut=se(u.slice(Zt,Zt+4),4),$t=Ut[0],Jt=Ut[1],Kt=Ut[2],te=Ut[3];var ee=rr(qt,$t,Jt),re=ee.x,ae=ee.y;var ne=rr(qt,Kt,te),oe=ne.x,ie=ne.y;Ft.push(ve(re),ve(ae),ve(oe),ve(ie))}i.push(Ft);break;case"Z":i.push([""]),o=""}n+=l.key+i[c].join(",")+o}return n.trim()}catch(t){ce("Path parsing error: "+t)}}({path:ct,localCTM:o})])}u.forEach(function(t){var e=se(t,2),r=e[0],a=e[1];n.setAttribute(r,a)})};var Mr=function(t,e,r,a){var n=Ze("circle",["sjx-svg-hdl","sjx-svg-hdl-".concat(a)]);return xr({cx:t,cy:e,r:4,fill:"#fff",stroke:r,"stroke-width":1,"fill-opacity":1,"vector-effect":"non-scaling-stroke"}).forEach(function(t){var e=se(t,2),r=e[0],a=e[1];return n.setAttribute(r,a)}),n};var Er=function(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")};var Tr=function(t,e,r,a){var n=null;switch(t.tagName.toLowerCase()){case"text":n={x:j(t.x.baseVal[0])?t.x.baseVal[0].value:Number(t.getAttribute("x"))||0,y:j(t.y.baseVal[0])?t.y.baseVal[0].value:Number(t.getAttribute("y"))||0,textLength:j(t.textLength.baseVal)?t.textLength.baseVal.value:Number(t.getAttribute("textLength"))||null};break;case"circle":n={r:t.r.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"foreignobject":case"image":case"rect":n={width:t.width.baseVal.value,height:t.height.baseVal.value,x:t.x.baseVal.value,y:t.y.baseVal.value};break;case"ellipse":n={rx:t.rx.baseVal.value,ry:t.ry.baseVal.value,cx:t.cx.baseVal.value,cy:t.cy.baseVal.value};break;case"line":n={resX1:t.x1.baseVal.value,resY1:t.y1.baseVal.value,resX2:t.x2.baseVal.value,resY2:t.y2.baseVal.value};break;case"polygon":case"polyline":n={points:t.getAttribute("points")};break;case"path":n={path:t.getAttribute("d")}}e.__data__.set(t,bt({},n,{matrix:tr(t,t.parentNode),ctm:tr(t.parentNode,r),childCTM:tr(t,a?r.parentNode:r)}))};var wr=function(t,e,r){var a=se(t,2),n=a[0],o=a[1];var i=Ze("line",["sjx-svg-line","sjx-svg-line-".concat(r)]);var s={x1:n.x,y1:n.y,x2:o.x,y2:o.y,stroke:e,"stroke-width":1,"vector-effect":"non-scaling-stroke"};return xr(s).forEach(function(t){var e=se(t,2),r=e[0],a=e[1];return i.setAttribute(r,a)}),i};var Or=function(t,o,e){var r=2<arguments.length&&void 0!==e?e:t.getBBox();var a=r.x,n=r.y,i=r.width,s=r.height;return[[a,n],[a+i,n],[a+i,n+s],[a,n+s]].map(function(t){var e=se(t,2),r=e[0],a=e[1];var n=rr(o,r,a);return[n.x,n.y]})};function Sr(t,e){if(this.length){var r=j(e)&&e instanceof it?e:new it;if(this[0]instanceof SVGElement){var a=d.call(this,function(t,e){return function(t){var e=t.tagName.toLowerCase();return-1!==qe.indexOf(e)||(ce('Selected element "'.concat(e,'" is not allowed to transform. Allowed elements:\n\n            circle, ellipse, image, line, path, polygon, polyline, rect, text, g')),!1)}(e)&&t.push(e),t},[]);return new br(a,t,r)}return new Ye(f.call(this,function(t){return t}),t,r)}}var Rr=H.EMITTER_EVENTS;var Cr=I,Vr=W;var Nr=function(){o(n,dt);var a=c(n);function n(t,e){var r;return i(this,n),(r=a.call(this,t)).enable(e),r}return r(n,[{key:"_init",value:function(){var e=this;var t=this.elements,r=this.options;var a=nt(t);var n=r.style,o=r.appendTo;var i=bt({position:"absolute","z-index":"2147483647"},n);var s=new WeakMap;t.map(function(t){return s.set(t,{parent:j(o)?nt(o)[0]:document.body})}),this.storage={css:i,data:s},a.on(Cr,this._onMouseDown).on(Vr,this._onTouchStart),Rr.slice(0,3).forEach(function(t){e.eventDispatcher.registerEvent(t)})}},{key:"_processOptions",value:function(t){var e={},r=null,a=document,n=rt,o=rt,i=rt,s=rt;if(j(t)){var c=t.style,v=t.appendTo,l=t.stack,u=t.onInit,h=t.onMove,f=t.onDrop,d=t.onDestroy;e=j(c)&&"object"===et(c)?c:e,r=v||null;var p=j(l)?nt(l)[0]:document;n=at(u),o=at(h),i=y(f)?function(t){var e=this.storage;var r=(e=void 0===e?{}:e).clone;!function(t,e){var r=gt(t),a=r.top,n=r.left,o=gt(e),i=o.top,s=o.left,c=nt(t),v=nt(e);return!(a<i||a+parseFloat(c.css("height"))>i+parseFloat(v.css("height"))||n<s||n+parseFloat(c.css("width"))>s+parseFloat(v.css("width")))}(r,p)||f.call(this,t,this.elements,r)}:rt,s=at(d)}this.options={style:e,appendTo:r,stack:a},this.proxyMethods={onInit:n,onDrop:i,onMove:o,onDestroy:s}}},{key:"_start",value:function(t){var e=t.target,r=t.clientX,a=t.clientY;var n=this.elements,o=this.storage,i=this.storage,s=i.data,c=i.css;var v=n.find(function(t){return t===e||t.contains(e)});if(v){var l=(s.get(v)||{}).parent,u=void 0===l?v.parentNode:l;var h=gt(u),f=h.left,d=h.top;c.left="".concat(r-f,"px"),c.top="".concat(a-d,"px");var p=v.cloneNode(!0);nt(p).css(c),o.clientX=r,o.clientY=a,o.cx=r,o.cy=a,o.clone=p,u.appendChild(p),this._draw()}}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY;var a=this.storage;a.clientX=e,a.clientY=r,a.doDraw=!0,a.doMove=!0}},{key:"_end",value:function(t){var e=this.storage;var r=e.clone,a=e.frameId;e.doDraw=!1,M(a),Et(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=Mt(this._animate);var e=t.doDraw,r=t.clientX,a=t.clientY,n=t.cx,o=t.cy,i=t.clone;e&&(t.doDraw=!1,this._drag({element:i,dx:r-n,dy:a-o}))}},{key:"_processMove",value:function(t,e){var r=e.dx,a=e.dy;var n=this.storage;var o=(n=void 0===n?{}:n).clone;var i="translate(".concat(r,"px, ").concat(a,"px)");nt(o).css({transform:i,webkitTranform:i,mozTransform:i,msTransform:i,otransform:i})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.elements;Et(t)||(nt(r).off(Cr,this._onMouseDown).off(Vr,this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),n}();function Ar(t){if(this.length)return new Nr(f.call(this,function(t){return t}),t)}var Pr=function(){o(e,p);var t=c(e);function e(){return i(this,e),t.apply(this,arguments)}return r(e,[{key:"drag",value:function(){return Sr.call.apply(Sr,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return Ar.call.apply(Ar,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function Dr(t){return new Pr(t)}return Object.defineProperty(Dr,"createObservable",{value:function(){return new it}}),Object.defineProperty(Dr,"Subjx",{value:Pr}),Object.defineProperty(Dr,"Observable",{value:it}),Dr});
